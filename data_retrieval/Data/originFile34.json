{"items":[{"tags":["java","class","constructor","static","non-static"],"comments":[{"owner":{"account_id":247613,"reputation":284089,"user_id":522444,"accept_rate":100,"display_name":"Hovercraft Full Of Eels"},"score":2,"creation_date":1701124971,"post_id":77560344,"comment_id":136734195,"body_markdown":"Please check out Jon Skeet&#39;s answer [here](https://stackoverflow.com/a/12913767/). Note also that you could just declare the nested class as static: `static class Building {` and this would work, but if it doesn&#39;t need to be nested, then don&#39;t make it nested.","body":"Please check out Jon Skeet&#39;s answer <a href=\"https://stackoverflow.com/a/12913767/\">here</a>. Note also that you could just declare the nested class as static: <code>static class Building {</code> and this would work, but if it doesn&#39;t need to be nested, then don&#39;t make it nested."}],"owner":{"account_id":30007816,"reputation":11,"user_id":22996223,"display_name":"user22996223"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":38,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"closed_date":1701124915,"answer_count":0,"score":1,"last_activity_date":1701124695,"creation_date":1701124695,"question_id":77560344,"body_markdown":"I&#39;m kind of confused about how java classes work. \r\n\r\nHow come when I do this, it gives me an error that says: &quot;Non-static variable cannot be referenced from static context&quot;:\r\n\r\n```\r\npublic class Test {\r\n    class Building {\r\n        Building() {\r\n            System.out.println(&quot;You&#39;ve made a building&quot;);\r\n        }\r\n    }\r\n    \r\n    public static void main(String[] args) {\r\n        Building building1 = new Building();\r\n    }\r\n}\r\n\r\n```\r\n\r\nBut when I pull the building class out of the Test class:\r\n\r\n```\r\npublic class Test {\r\n\r\n    public static void main(String[] args) {\r\n        Building building1 = new Building();\r\n    }\r\n}\r\n\r\nclass Building {\r\n\r\n    Building() {\r\n        System.out.println(&quot;You&#39;ve made a building&quot;);\r\n    }\r\n}\r\n\r\n```\r\n\r\nNow it works?\r\n\r\nCan somebody explain why #2 works but #1 doesn&#39;t?\r\n\r\n\r\nI would expect both to work or neither to work\r\n","title":"Java Classes - Why is one of these valid and one is not?","body":"<p>I'm kind of confused about how java classes work.</p>\n<p>How come when I do this, it gives me an error that says: &quot;Non-static variable cannot be referenced from static context&quot;:</p>\n<pre><code>public class Test {\n    class Building {\n        Building() {\n            System.out.println(&quot;You've made a building&quot;);\n        }\n    }\n    \n    public static void main(String[] args) {\n        Building building1 = new Building();\n    }\n}\n\n</code></pre>\n<p>But when I pull the building class out of the Test class:</p>\n<pre><code>public class Test {\n\n    public static void main(String[] args) {\n        Building building1 = new Building();\n    }\n}\n\nclass Building {\n\n    Building() {\n        System.out.println(&quot;You've made a building&quot;);\n    }\n}\n\n</code></pre>\n<p>Now it works?</p>\n<p>Can somebody explain why #2 works but #1 doesn't?</p>\n<p>I would expect both to work or neither to work</p>\n"},{"tags":["java","mapstruct"],"comments":[{"owner":{"account_id":2719313,"reputation":15631,"user_id":2345933,"accept_rate":84,"display_name":"Adam Siemion"},"score":0,"creation_date":1700477911,"post_id":77515278,"comment_id":136655253,"body_markdown":"How new entries are added to `propA` and `propB`,? Does `Obj` contain a method to add new entries to `propA` and `propB`?","body":"How new entries are added to <code>propA</code> and <code>propB</code>,? Does <code>Obj</code> contain a method to add new entries to <code>propA</code> and <code>propB</code>?"},{"owner":{"account_id":12016842,"reputation":424,"user_id":8791696,"display_name":"Yann"},"score":0,"creation_date":1700478001,"post_id":77515278,"comment_id":136655263,"body_markdown":"Yes, there is a `putPropT(String key, T t)` method for each property map.","body":"Yes, there is a <code>putPropT(String key, T t)</code> method for each property map."},{"owner":{"account_id":2719313,"reputation":15631,"user_id":2345933,"accept_rate":84,"display_name":"Adam Siemion"},"score":0,"creation_date":1700478881,"post_id":77515278,"comment_id":136655417,"body_markdown":"The code you have provided probably does not work. `propA` values are of type `TypeA` and `propB` values are of type `TypeB` while `mergeMaps` expects the values of both of the maps to be the same (`&lt;T&gt;`). Maybe they share the same superclass, then `&lt;T&gt;` would rather be `&lt;T extends CommonSuperClass&gt;`.","body":"The code you have provided probably does not work. <code>propA</code> values are of type <code>TypeA</code> and <code>propB</code> values are of type <code>TypeB</code> while <code>mergeMaps</code> expects the values of both of the maps to be the same (<code>&lt;T&gt;</code>). Maybe they share the same superclass, then <code>&lt;T&gt;</code> would rather be <code>&lt;T extends CommonSuperClass&gt;</code>."},{"owner":{"account_id":12016842,"reputation":424,"user_id":8791696,"display_name":"Yann"},"score":0,"creation_date":1700479084,"post_id":77515278,"comment_id":136655454,"body_markdown":"The code runs. `mergeMaps` is generic on the method, so each call has its own type. (It&#39;s defined outside of the Obj class.)","body":"The code runs. <code>mergeMaps</code> is generic on the method, so each call has its own type. (It&#39;s defined outside of the Obj class.)"}],"answers":[{"tags":[],"owner":{"account_id":18044315,"reputation":1227,"user_id":13115701,"display_name":"Paul Marcelin Bejan"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":true,"score":1,"last_activity_date":1701123749,"creation_date":1701123749,"answer_id":77560278,"question_id":77515278,"body_markdown":"    @Mapper\r\n    public interface ObjMapper {\r\n    \r\n    \tObjMapper INSTANCE = Mappers.getMapper(ObjMapper.class);\r\n    \t\r\n    \tObj merge(Obj source, @MappingTarget Obj target);\r\n    \t\r\n        default &lt;T&gt; void mergeMaps(Map&lt;String, T&gt; source, @MappingTarget Map&lt;String, T&gt; target) {\r\n            if ( source == null ) {\r\n                return;\r\n            }\r\n            if ( target == null ) {\r\n                target = new HashMap&lt;&gt;();\r\n            }\r\n            target.putAll(source);\r\n        }\r\n    \t\r\n    }\r\n\r\nThe generated code is:\r\n\r\n    public class ObjMapperImpl implements ObjMapper {\r\n    \r\n        @Override\r\n        public Obj merge(Obj source, Obj target) {\r\n            if ( source == null ) {\r\n                return target;\r\n            }\r\n    \r\n            if ( source.getPropA() != null ) {\r\n                if ( target.getPropA() == null ) {\r\n                    target.setPropA( new LinkedHashMap&lt;String, ChildA&gt;() );\r\n                }\r\n                mergeMaps( source.getPropA(), target.getPropA() );\r\n            }\r\n            else {\r\n                target.setPropA( null );\r\n            }\r\n            if ( source.getPropB() != null ) {\r\n                if ( target.getPropB() == null ) {\r\n                    target.setPropB( new LinkedHashMap&lt;String, ChildB&gt;() );\r\n                }\r\n                mergeMaps( source.getPropB(), target.getPropB() );\r\n            }\r\n            else {\r\n                target.setPropB( null );\r\n            }\r\n    \r\n            return target;\r\n        }\r\n    \r\n    }\r\n\r\nthe only difference is that it makes an update on target.\r\nIf you need to have a new object, you need to execute the merge method twice:\r\n\r\n    Obj newObj = new Obj();\r\n    newObj = ObjMapper.INSTANCE.merge(ob1, newObj); // add from ob1\r\n    newObj = ObjMapper.INSTANCE.merge(ob2, newObj); // add from ob2","title":"Merge objects/maps with mapstruct","body":"<pre><code>@Mapper\npublic interface ObjMapper {\n\n    ObjMapper INSTANCE = Mappers.getMapper(ObjMapper.class);\n    \n    Obj merge(Obj source, @MappingTarget Obj target);\n    \n    default &lt;T&gt; void mergeMaps(Map&lt;String, T&gt; source, @MappingTarget Map&lt;String, T&gt; target) {\n        if ( source == null ) {\n            return;\n        }\n        if ( target == null ) {\n            target = new HashMap&lt;&gt;();\n        }\n        target.putAll(source);\n    }\n    \n}\n</code></pre>\n<p>The generated code is:</p>\n<pre><code>public class ObjMapperImpl implements ObjMapper {\n\n    @Override\n    public Obj merge(Obj source, Obj target) {\n        if ( source == null ) {\n            return target;\n        }\n\n        if ( source.getPropA() != null ) {\n            if ( target.getPropA() == null ) {\n                target.setPropA( new LinkedHashMap&lt;String, ChildA&gt;() );\n            }\n            mergeMaps( source.getPropA(), target.getPropA() );\n        }\n        else {\n            target.setPropA( null );\n        }\n        if ( source.getPropB() != null ) {\n            if ( target.getPropB() == null ) {\n                target.setPropB( new LinkedHashMap&lt;String, ChildB&gt;() );\n            }\n            mergeMaps( source.getPropB(), target.getPropB() );\n        }\n        else {\n            target.setPropB( null );\n        }\n\n        return target;\n    }\n\n}\n</code></pre>\n<p>the only difference is that it makes an update on target.\nIf you need to have a new object, you need to execute the merge method twice:</p>\n<pre><code>Obj newObj = new Obj();\nnewObj = ObjMapper.INSTANCE.merge(ob1, newObj); // add from ob1\nnewObj = ObjMapper.INSTANCE.merge(ob2, newObj); // add from ob2\n</code></pre>\n"}],"owner":{"account_id":12016842,"reputation":424,"user_id":8791696,"display_name":"Yann"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":49,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":77560278,"answer_count":1,"score":0,"last_activity_date":1701123749,"creation_date":1700477676,"question_id":77515278,"body_markdown":"I have two objects of the same type. All fields are `Map&lt;String, SomeType&gt;`, so the objects look like:\r\n\r\n```java\r\nclass Obj {\r\n  Map&lt;String, TypeA&gt; propA;\r\n  Map&lt;String, TypeB&gt; propB;\r\n  ...\r\n\r\n  Obj setPropA(Map&lt;String, TypeA&gt; newMap) { ... }\r\n  Obj setPropB(Map&lt;String, TypeB&gt; newMap) { ... }\r\n  ...\r\n \r\n  Obj putPropA(String key, TypeA a) { ... }\r\n  Obj putPropB(String key, TypeB b) { ... }\r\n  ...\r\n}\r\n```\r\n\r\nI need to merge two of these objects by merging/concatenating all map entries (the string keys never clash). Currently, this is done by hand. But, that seems clumsy and the as the class is generated, as soon as a property is added, the merge is incomplete.\r\n\r\n```java\r\nObj merge(Obj ob1, Obj ob2) {\r\n  return new Obj()\r\n    .setPropA(mergeMaps(ob1.getPropA(), ob2.getPropA()))\r\n    .setPropB(mergeMaps(ob1.getPropB(), ob2.getPropB()))\r\n    ...;\r\n}\r\n\r\n&lt;T&gt; Map&lt;String, T&gt; mergeMaps(Map&lt;String, T&gt; aMap, Map&lt;String, T&gt; bMap) {\r\n  aMap.putAll(bMap);\r\n  return aMap;\r\n}\r\n```\r\n\r\nCan mapstruct be used to automatically merge all of the field maps?\r\n","title":"Merge objects/maps with mapstruct","body":"<p>I have two objects of the same type. All fields are <code>Map&lt;String, SomeType&gt;</code>, so the objects look like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>class Obj {\n  Map&lt;String, TypeA&gt; propA;\n  Map&lt;String, TypeB&gt; propB;\n  ...\n\n  Obj setPropA(Map&lt;String, TypeA&gt; newMap) { ... }\n  Obj setPropB(Map&lt;String, TypeB&gt; newMap) { ... }\n  ...\n \n  Obj putPropA(String key, TypeA a) { ... }\n  Obj putPropB(String key, TypeB b) { ... }\n  ...\n}\n</code></pre>\n<p>I need to merge two of these objects by merging/concatenating all map entries (the string keys never clash). Currently, this is done by hand. But, that seems clumsy and the as the class is generated, as soon as a property is added, the merge is incomplete.</p>\n<pre class=\"lang-java prettyprint-override\"><code>Obj merge(Obj ob1, Obj ob2) {\n  return new Obj()\n    .setPropA(mergeMaps(ob1.getPropA(), ob2.getPropA()))\n    .setPropB(mergeMaps(ob1.getPropB(), ob2.getPropB()))\n    ...;\n}\n\n&lt;T&gt; Map&lt;String, T&gt; mergeMaps(Map&lt;String, T&gt; aMap, Map&lt;String, T&gt; bMap) {\n  aMap.putAll(bMap);\n  return aMap;\n}\n</code></pre>\n<p>Can mapstruct be used to automatically merge all of the field maps?</p>\n"},{"tags":["java","synchronization","volatile"],"comments":[{"owner":{"account_id":3211603,"reputation":289317,"user_id":2711488,"display_name":"Holger"},"score":1,"creation_date":1701862810,"post_id":77559975,"comment_id":136826964,"body_markdown":"If that’s the only method of the class, there is no need to store `a` and `b` in fields at all.","body":"If that’s the only method of the class, there is no need to store <code>a</code> and <code>b</code> in fields at all."}],"answers":[{"tags":[],"owner":{"account_id":401843,"reputation":89863,"user_id":768644,"display_name":"rzwitserloot"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1701123392,"creation_date":1701123392,"answer_id":77560244,"question_id":77559975,"body_markdown":"the first.\r\n\r\nBut, only in interactions between other threads that _also_ lock on this lock object. In other words, if 10 threads all call `doStuff` simultaneously:\r\n\r\n* Those 10 threads each run the code there in some undefined order.\r\n* Each of the 10 executions sees the updates of the previous execution, and will run its execution as an atomic unit (i.e. the `a == 8` check will see its own `a = i`, guaranteed, as the state of `a`.\r\n\r\nThere is no need to _also_ declare those fields `volatile`.","title":"Java use synchronized and volatile when manipulating multiple properties and locking on a lock object","body":"<p>the first.</p>\n<p>But, only in interactions between other threads that <em>also</em> lock on this lock object. In other words, if 10 threads all call <code>doStuff</code> simultaneously:</p>\n<ul>\n<li>Those 10 threads each run the code there in some undefined order.</li>\n<li>Each of the 10 executions sees the updates of the previous execution, and will run its execution as an atomic unit (i.e. the <code>a == 8</code> check will see its own <code>a = i</code>, guaranteed, as the state of <code>a</code>.</li>\n</ul>\n<p>There is no need to <em>also</em> declare those fields <code>volatile</code>.</p>\n"}],"owner":{"account_id":23825289,"reputation":35,"user_id":17832434,"display_name":"Fexl"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":33,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"accepted_answer_id":77560244,"answer_count":1,"score":1,"last_activity_date":1701123392,"creation_date":1701119585,"question_id":77559975,"body_markdown":"I need to manipulate multiple properties in Java while keeping them in sync.\r\n\r\nIs this code correct (from my understanding this is):\r\n\r\n    class X {\r\n        private final Object lockObject = new Object();\r\n        private int a;\r\n        private boolean b;\r\n        private Y y;\r\n\r\n        public void doStuff(int i) {\r\n              synchronized (lockObject) {\r\n                    a = i;\r\n                    b = a == 8;\r\n                    y.someMethod(b);\r\n                    y = new Y(a, y);\r\n              }\r\n        }\r\n    }\r\n\r\nDoes this `synchronized` block ensure updates to all properties or just the locked property are written (in which case it would not really make sense to lock on a final object with no state)?\r\n\r\nOr do I need to use `volatile` in order to ensure memory visibility updates on all threads:\r\n\r\n    class X {\r\n        private final Object lockObject = new Object();\r\n        private volatile int a;\r\n        private volatile boolean b;\r\n        private volatile Y y;\r\n\r\n        public void doStuff(int i) {\r\n              synchronized (lockObject) {\r\n                    a = i;\r\n                    b = a == 8;\r\n                    y.someMethod(b);\r\n                    y = new Y(a, y);\r\n              }\r\n        }\r\n    }\r\n\r\nI am actually 99% sure the first one is correct but not a 100%, thanks for answers.","title":"Java use synchronized and volatile when manipulating multiple properties and locking on a lock object","body":"<p>I need to manipulate multiple properties in Java while keeping them in sync.</p>\n<p>Is this code correct (from my understanding this is):</p>\n<pre><code>class X {\n    private final Object lockObject = new Object();\n    private int a;\n    private boolean b;\n    private Y y;\n\n    public void doStuff(int i) {\n          synchronized (lockObject) {\n                a = i;\n                b = a == 8;\n                y.someMethod(b);\n                y = new Y(a, y);\n          }\n    }\n}\n</code></pre>\n<p>Does this <code>synchronized</code> block ensure updates to all properties or just the locked property are written (in which case it would not really make sense to lock on a final object with no state)?</p>\n<p>Or do I need to use <code>volatile</code> in order to ensure memory visibility updates on all threads:</p>\n<pre><code>class X {\n    private final Object lockObject = new Object();\n    private volatile int a;\n    private volatile boolean b;\n    private volatile Y y;\n\n    public void doStuff(int i) {\n          synchronized (lockObject) {\n                a = i;\n                b = a == 8;\n                y.someMethod(b);\n                y = new Y(a, y);\n          }\n    }\n}\n</code></pre>\n<p>I am actually 99% sure the first one is correct but not a 100%, thanks for answers.</p>\n"},{"tags":["java","swing","zooming","graphics2d"],"answers":[{"tags":[],"owner":{"account_id":12872220,"reputation":515,"user_id":9310248,"display_name":"krise"},"comment_count":0,"down_vote_count":0,"up_vote_count":4,"is_accepted":true,"score":4,"last_activity_date":1598437008,"creation_date":1598437008,"answer_id":63595468,"question_id":63583595,"body_markdown":"I solved the problem by implementing what is being described [here][1] \r\n\r\nHere is the updated code: \r\n\r\n    public class MyPanel extends JPanel {\r\n    ...\r\n        private double zoom = 1;\r\n        private int zoomPointX;\r\n        private int zoomPointY;\r\n    ...\r\n    \r\n       class CustomMouseWheelListener implements MouseWheelListener {\r\n            @Override\r\n            public void mouseWheelMoved(MouseWheelEvent e) {\r\n                zoomPointX = e.getX();\r\n                zoomPointY = e.getY();\r\n                if (e.getPreciseWheelRotation() &lt; 0) {\r\n                    zoom -= 0.1;\r\n                } else {\r\n                    zoom += 0.1;\r\n                }\r\n                if (zoom &lt; 0.01) {\r\n                    zoom = 0.01;\r\n                }\r\n                repaint();\r\n            }\r\n        }\r\n    ...\r\n        protected void paintComponent(Graphics g) {\r\n            Graphics2D g2D = (Graphics2D) g;\r\n            super.paintComponent(g2D);\r\n            AffineTransform at = g2D.getTransform();\r\n            at.translate(zoomPointX, zoomPointY);\r\n            at.scale(zoom, zoom);\r\n            at.translate(-zoomPointX, -zoomPointY);\r\n            g2D.setTransform(at);\r\n            a_different_class_where_i_do_some_drawing.draw(g2D);\r\n        }\r\n    \r\n    }\r\n\r\n[![enter image description here][2]][2]\r\n\r\n\r\n  [1]: https://medium.com/@benjamin.botto/zooming-at-the-mouse-coordinates-with-affine-transformations-86e7312fd50b\r\n  [2]: https://i.stack.imgur.com/lzcDs.gif","title":"Java Graphics2D - Zoom on mouse location","body":"<p>I solved the problem by implementing what is being described <a href=\"https://medium.com/@benjamin.botto/zooming-at-the-mouse-coordinates-with-affine-transformations-86e7312fd50b\" rel=\"nofollow noreferrer\">here</a></p>\n<p>Here is the updated code:</p>\n<pre><code>public class MyPanel extends JPanel {\n...\n    private double zoom = 1;\n    private int zoomPointX;\n    private int zoomPointY;\n...\n\n   class CustomMouseWheelListener implements MouseWheelListener {\n        @Override\n        public void mouseWheelMoved(MouseWheelEvent e) {\n            zoomPointX = e.getX();\n            zoomPointY = e.getY();\n            if (e.getPreciseWheelRotation() &lt; 0) {\n                zoom -= 0.1;\n            } else {\n                zoom += 0.1;\n            }\n            if (zoom &lt; 0.01) {\n                zoom = 0.01;\n            }\n            repaint();\n        }\n    }\n...\n    protected void paintComponent(Graphics g) {\n        Graphics2D g2D = (Graphics2D) g;\n        super.paintComponent(g2D);\n        AffineTransform at = g2D.getTransform();\n        at.translate(zoomPointX, zoomPointY);\n        at.scale(zoom, zoom);\n        at.translate(-zoomPointX, -zoomPointY);\n        g2D.setTransform(at);\n        a_different_class_where_i_do_some_drawing.draw(g2D);\n    }\n\n}\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/lzcDs.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/lzcDs.gif\" alt=\"enter image description here\" /></a></p>\n"},{"tags":[],"owner":{"account_id":15152640,"reputation":39,"user_id":13133485,"display_name":"Andrew Cline"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701123287,"creation_date":1701123287,"answer_id":77560236,"question_id":63583595,"body_markdown":"Here is another solution if anyone is curious how to do this. My program was written differently so I had to take a different approach.\r\n\r\nThe premise is somewhat simple, but there are some gotchas. I will try to explain how the code works below. You most likely won&#39;t be able to copy and paste, so understanding how this works is most important.\r\n```\r\n    public void mouseWheelMoved(MouseWheelEvent e) {\r\n\t\t\tPoint2D before = null;\r\n\t\t\tPoint2D after = null;\r\n\r\n\t\t\tAffineTransform originalTransform = new AffineTransform(at);\r\n\t\t\tAffineTransform zoomedTransform = new AffineTransform();\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tbefore = originalTransform.inverseTransform(e.getPoint(), null);\r\n\t\t\t} catch (NoninvertibleTransformException e1) {\r\n\t\t\t\te1.printStackTrace();\r\n\t\t\t}\r\n\r\n\t\t\tzoom *= 1-(e.getPreciseWheelRotation()/5);\r\n\t\t\t((Painter) Frame1.painter).setScale(zoom/100);\r\n\t\t\t\r\n\t\t\tzoomedTransform.setToIdentity();\r\n\t\t\tzoomedTransform.translate(getWidth()/2, getHeight()/2);\r\n\t\t\tzoomedTransform.scale(scale, scale);\r\n\t\t\tzoomedTransform.translate(-getWidth()/2, -getHeight()/2);\r\n\t\t\tzoomedTransform.translate(translateX, translateY);\r\n\r\n\t\t    try {\r\n\t\t\t\tafter = zoomedTransform.inverseTransform(e.getPoint(), null);\r\n\t\t\t} catch (NoninvertibleTransformException e1) {\r\n\t\t\t\te1.printStackTrace();\r\n\t\t\t}\r\n\t\t    \r\n\t\t    \r\n\t\t    double deltaX = after.getX() - before.getX();\r\n\t\t    double deltaY = after.getY() - before.getY();\r\n\t\t    translate(deltaX,deltaY);\r\n    \r\n\t\t    Frame1.painter.repaint();\r\n}\r\n```\r\nThese variables will hold the transformed mouse position.\r\n```\r\nPoint2D before = null;\r\nPoint2D after = null;\r\n```\r\nWhat does that mean?\r\n\r\ne.getPoint() gives the PIXEL position of the mouse. We need the &quot;world&quot; coordinates of where the mouse is. If we are hovering over a boxes origin at the position (50,40), we want those values, not the mouse position values.\r\n\r\nE.g. if we translated our panel by 10 pixels in the X with 1x zoom/scale, our mouse position would be (40,40) while hovering over the box at (50,40). This becomes more complicated when you are zooming AND translating.\r\n\r\nTo make it easier to get the &#39;world&#39; coordinates, we need the inverseTransform() function. To prepare for that, we need to save the current AffineTransform BEFORE we zoom. (&#39;at&#39; is the global AffineTransform in my program)\r\n```\r\nAffineTransform originalTransform = new AffineTransform(at);\r\n```\r\nThen we will create another transform but this one is an identity transform, it has not been scaled or translated yet.\r\n```\r\nAffineTransform zoomedTransform = new AffineTransform();\r\n```\r\n\r\nOnce we have these, we can get the &#39;world&#39; coordinates of the mouse (before zooming). (50,40 as mentioned above)\r\n```\r\nbefore = originalTransform.inverseTransform(e.getPoint(), null);\r\n// before.getX() returns 50;\r\n// before.getY() returns 40;\r\n```\r\nNow we set the scale value based on the mouse scroll event.\r\n```\r\nzoom *= 1-(e.getPreciseWheelRotation()/5);\r\n/// This line just calls a function to set the variable &#39;scale&#39;\r\n((Painter) Frame1.painter).setScale(zoom/100);\r\n```\r\n\r\nNow we want to take our ***NEW*** identity transform and transform it using the old translation values but with the NEW scale value. ***(NOTE: This must be performed exactly the same way as in your paint() function.)***\r\n```\r\nzoomedTransform.setToIdentity();\r\nzoomedTransform.translate(getWidth()/2, getHeight()/2);\r\nzoomedTransform.scale(scale, scale);\r\nzoomedTransform.translate(-getWidth()/2, -getHeight()/2);\r\nzoomedTransform.translate(translateX, translateY);\r\n```\r\nNOTE: Our originalTransform is the transform BEFORE scaling/zooming. The zoomedTransform is after applying our new zoom/scale.\r\n\r\nNow that we have zoomed in, lets say our mouse is now over top of a different boxes origin at 20,30. Our mouse position has not changed, all we did was scroll the mouse wheel. What we want to do is take our mouse position and get the 20,30 coordinates. We do that by taking the inverse transform of our NEW transform.\r\n```\r\nafter = zoomedTransform.inverseTransform(e.getPoint(), null);\r\n```\r\n\r\nSo, &#39;before&#39; = (50,40) and &#39;after&#39; = (20,30)\r\nWe now want to translate the view by this difference. This will move the box at 50,40 under the mouse position. This will give the effect of zooming into the box at 50,40 instead of just zooming into the center of the screen.\r\n```\r\ndouble deltaX = after.getX() - before.getX();\r\ndouble deltaY = after.getY() - before.getY();\r\ntranslate(deltaX,deltaY);\r\n```\r\n\r\nThen we repaint.\r\n```\r\nFrame1.painter.repaint();\r\n```\r\n\r\n\r\n\r\nFor reference, here is the code in my paint function. NOTE how the translation and scaling is applied exactly the same as in the mouseWheel function.\r\n\r\n```\r\n\tpublic void paint(Graphics g) {\r\n\t\tloadColors();\r\n\t\tsuper.paint(g);\r\n\t\tGraphics2D g2D = (Graphics2D) g;\r\n\t\t\r\n\t\t//Set  anti-alias!\r\n\t    g2D.setRenderingHint(RenderingHints.KEY_ANTIALIASING,\r\n\t            RenderingHints.VALUE_ANTIALIAS_ON); \r\n\r\n\t   // Set anti-alias for text\r\n\t    g2D.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,\r\n\t            RenderingHints.VALUE_TEXT_ANTIALIAS_ON); \r\n\t\t\r\n\t\tAffineTransform saveTransform = g2D.getTransform();\r\n\t\tg2D.setColor(backgroundColor);\r\n\t    g2D.fillRect(0, 0, getWidth(), getHeight());\r\n\t    at = new AffineTransform(saveTransform);\r\n\t    if(newTruss) {\r\n\t    \ttry {\r\n\t\t\t\tcenterView();\r\n\t\t\t} catch (NoninvertibleTransformException e) {\r\n\t\t\t\t// TODO Auto-generated catch block\r\n\t\t\t\te.printStackTrace();\r\n\t\t\t}\r\n\t    \tnewTruss = false;\r\n\t    }\r\n\t    at.translate(getWidth()/2, getHeight()/2);\r\n\t    at.scale(scale, scale);\r\n\t    at.translate(-getWidth()/2, -getHeight()/2);\r\n\t    at.translate(translateX, translateY);\r\n\t    g2D.setTransform(at);\r\n\r\n\t\tif(truss != null) {\r\n\t\t\tg2D.setColor(Color.WHITE);\r\n\t\t\t//truss.drawBoardsOutline(g2D);\r\n\t\t\ttruss.drawBoards(g2D, boardColor, lineColor);\r\n\t\t\ttruss.drawBoardsLongitudinalCOG(g2D, pointColor, 3);\r\n\t\t\ttruss.drawBoardsCOG(g2D, Color.GREEN, 1);\r\n\t\t\ttruss.drawSelectedBoards(g2D, Frame1.boardList, boardColor, Color.RED, lastSelectedBoard);\r\n\t\t\tif (lastSelectedBoard &gt; -1) {\r\n\t\t\t\ttruss.drawBoardPath(g2D, lastSelectedBoard, lastSelectedBoardDir, 50.0f, 7);\r\n\t\t\t\t//System.out.println(Frame1.placementList);\r\n\t\t\t}\r\n\t\t\t//truss.drawBoardPaths(g2D, 50.0f, 7);\r\n\t\t}\r\n\t}\r\n```","title":"Java Graphics2D - Zoom on mouse location","body":"<p>Here is another solution if anyone is curious how to do this. My program was written differently so I had to take a different approach.</p>\n<p>The premise is somewhat simple, but there are some gotchas. I will try to explain how the code works below. You most likely won't be able to copy and paste, so understanding how this works is most important.</p>\n<pre><code>    public void mouseWheelMoved(MouseWheelEvent e) {\n            Point2D before = null;\n            Point2D after = null;\n\n            AffineTransform originalTransform = new AffineTransform(at);\n            AffineTransform zoomedTransform = new AffineTransform();\n            \n            try {\n                before = originalTransform.inverseTransform(e.getPoint(), null);\n            } catch (NoninvertibleTransformException e1) {\n                e1.printStackTrace();\n            }\n\n            zoom *= 1-(e.getPreciseWheelRotation()/5);\n            ((Painter) Frame1.painter).setScale(zoom/100);\n            \n            zoomedTransform.setToIdentity();\n            zoomedTransform.translate(getWidth()/2, getHeight()/2);\n            zoomedTransform.scale(scale, scale);\n            zoomedTransform.translate(-getWidth()/2, -getHeight()/2);\n            zoomedTransform.translate(translateX, translateY);\n\n            try {\n                after = zoomedTransform.inverseTransform(e.getPoint(), null);\n            } catch (NoninvertibleTransformException e1) {\n                e1.printStackTrace();\n            }\n            \n            \n            double deltaX = after.getX() - before.getX();\n            double deltaY = after.getY() - before.getY();\n            translate(deltaX,deltaY);\n    \n            Frame1.painter.repaint();\n}\n</code></pre>\n<p>These variables will hold the transformed mouse position.</p>\n<pre><code>Point2D before = null;\nPoint2D after = null;\n</code></pre>\n<p>What does that mean?</p>\n<p>e.getPoint() gives the PIXEL position of the mouse. We need the &quot;world&quot; coordinates of where the mouse is. If we are hovering over a boxes origin at the position (50,40), we want those values, not the mouse position values.</p>\n<p>E.g. if we translated our panel by 10 pixels in the X with 1x zoom/scale, our mouse position would be (40,40) while hovering over the box at (50,40). This becomes more complicated when you are zooming AND translating.</p>\n<p>To make it easier to get the 'world' coordinates, we need the inverseTransform() function. To prepare for that, we need to save the current AffineTransform BEFORE we zoom. ('at' is the global AffineTransform in my program)</p>\n<pre><code>AffineTransform originalTransform = new AffineTransform(at);\n</code></pre>\n<p>Then we will create another transform but this one is an identity transform, it has not been scaled or translated yet.</p>\n<pre><code>AffineTransform zoomedTransform = new AffineTransform();\n</code></pre>\n<p>Once we have these, we can get the 'world' coordinates of the mouse (before zooming). (50,40 as mentioned above)</p>\n<pre><code>before = originalTransform.inverseTransform(e.getPoint(), null);\n// before.getX() returns 50;\n// before.getY() returns 40;\n</code></pre>\n<p>Now we set the scale value based on the mouse scroll event.</p>\n<pre><code>zoom *= 1-(e.getPreciseWheelRotation()/5);\n/// This line just calls a function to set the variable 'scale'\n((Painter) Frame1.painter).setScale(zoom/100);\n</code></pre>\n<p>Now we want to take our <em><strong>NEW</strong></em> identity transform and transform it using the old translation values but with the NEW scale value. <em><strong>(NOTE: This must be performed exactly the same way as in your paint() function.)</strong></em></p>\n<pre><code>zoomedTransform.setToIdentity();\nzoomedTransform.translate(getWidth()/2, getHeight()/2);\nzoomedTransform.scale(scale, scale);\nzoomedTransform.translate(-getWidth()/2, -getHeight()/2);\nzoomedTransform.translate(translateX, translateY);\n</code></pre>\n<p>NOTE: Our originalTransform is the transform BEFORE scaling/zooming. The zoomedTransform is after applying our new zoom/scale.</p>\n<p>Now that we have zoomed in, lets say our mouse is now over top of a different boxes origin at 20,30. Our mouse position has not changed, all we did was scroll the mouse wheel. What we want to do is take our mouse position and get the 20,30 coordinates. We do that by taking the inverse transform of our NEW transform.</p>\n<pre><code>after = zoomedTransform.inverseTransform(e.getPoint(), null);\n</code></pre>\n<p>So, 'before' = (50,40) and 'after' = (20,30)\nWe now want to translate the view by this difference. This will move the box at 50,40 under the mouse position. This will give the effect of zooming into the box at 50,40 instead of just zooming into the center of the screen.</p>\n<pre><code>double deltaX = after.getX() - before.getX();\ndouble deltaY = after.getY() - before.getY();\ntranslate(deltaX,deltaY);\n</code></pre>\n<p>Then we repaint.</p>\n<pre><code>Frame1.painter.repaint();\n</code></pre>\n<p>For reference, here is the code in my paint function. NOTE how the translation and scaling is applied exactly the same as in the mouseWheel function.</p>\n<pre><code>    public void paint(Graphics g) {\n        loadColors();\n        super.paint(g);\n        Graphics2D g2D = (Graphics2D) g;\n        \n        //Set  anti-alias!\n        g2D.setRenderingHint(RenderingHints.KEY_ANTIALIASING,\n                RenderingHints.VALUE_ANTIALIAS_ON); \n\n       // Set anti-alias for text\n        g2D.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,\n                RenderingHints.VALUE_TEXT_ANTIALIAS_ON); \n        \n        AffineTransform saveTransform = g2D.getTransform();\n        g2D.setColor(backgroundColor);\n        g2D.fillRect(0, 0, getWidth(), getHeight());\n        at = new AffineTransform(saveTransform);\n        if(newTruss) {\n            try {\n                centerView();\n            } catch (NoninvertibleTransformException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n            newTruss = false;\n        }\n        at.translate(getWidth()/2, getHeight()/2);\n        at.scale(scale, scale);\n        at.translate(-getWidth()/2, -getHeight()/2);\n        at.translate(translateX, translateY);\n        g2D.setTransform(at);\n\n        if(truss != null) {\n            g2D.setColor(Color.WHITE);\n            //truss.drawBoardsOutline(g2D);\n            truss.drawBoards(g2D, boardColor, lineColor);\n            truss.drawBoardsLongitudinalCOG(g2D, pointColor, 3);\n            truss.drawBoardsCOG(g2D, Color.GREEN, 1);\n            truss.drawSelectedBoards(g2D, Frame1.boardList, boardColor, Color.RED, lastSelectedBoard);\n            if (lastSelectedBoard &gt; -1) {\n                truss.drawBoardPath(g2D, lastSelectedBoard, lastSelectedBoardDir, 50.0f, 7);\n                //System.out.println(Frame1.placementList);\n            }\n            //truss.drawBoardPaths(g2D, 50.0f, 7);\n        }\n    }\n</code></pre>\n"}],"owner":{"account_id":12872220,"reputation":515,"user_id":9310248,"display_name":"krise"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":1249,"favorite_count":0,"down_vote_count":1,"up_vote_count":1,"accepted_answer_id":63595468,"answer_count":2,"score":0,"last_activity_date":1701123287,"creation_date":1598374204,"question_id":63583595,"body_markdown":"I have a jpanel that I draw on. I would like to be able to zoom in and out using the mousewheel, but I want to zoom to the location of the mouse, such that the point under the mouse stays the same. I have found some [questions here on stackoverflow][1], but they did not work for me.\r\n\r\nI got pretty close to doing what I want by implementing what is described [here][2]. Here is my code: \r\n\r\n    public class MyPanel extends JPanel {\r\n    ...\r\n        private double zoom = 1;\r\n        private double zoom_old = 1;\r\n        private int zoomPointX;\r\n        private int zoomPointY;\r\n    ...\r\n    \r\n       class CustomMouseWheelListener implements MouseWheelListener {\r\n            @Override\r\n            public void mouseWheelMoved(MouseWheelEvent e) {\r\n                zoomPointX = e.getX();\r\n                zoomPointY = e.getY();\r\n                if (e.getPreciseWheelRotation() &lt; 0) {\r\n                    zoom -= 0.1;\r\n                } else {\r\n                    zoom += 0.1;\r\n                }\r\n                if (zoom &lt; 0.01) {\r\n                    zoom = 0.01;\r\n                }\r\n                repaint();\r\n            }\r\n        }\r\n    ...\r\n        protected void paintComponent(Graphics g) {\r\n            Graphics2D g2D = (Graphics2D) g;\r\n            super.paintComponent(g2D);\r\n            if (zoom != zoom_old) {\r\n                double scalechange = zoom - zoom_old;\r\n                zoom_old = zoom;\r\n                double offsetX = -(zoomPointX * scalechange);\r\n                double offsetY = -(zoomPointY * scalechange) ;\r\n                AffineTransform at = new AffineTransform();\r\n                at.scale(zoom, zoom);\r\n                at.translate(offsetX, offsetY);\r\n                g2D.setTransform(at);\r\n            }\r\n            a_different_class_where_i_do_some_drawing.draw(g2D);\r\n        }\r\n    \r\n    }\r\n\r\nThis ALMOST does what I want. If I try to zoom, I notice that the position of the mouse is taken into account, so for example If I have my mouse on the left of the panel it will roughly zoom in on the left. However, it does not zoom exactly onto the mouse, so the point under the mouse still changes.\r\n\r\nCan anyone help me fix this?\r\n\r\nEDIT: \r\nHere is a picture of what is happening with the code posted above: I start out with the mouse on the blue square and then just scroll with the mouse wheel. As you can see, the mouse position if being changed:\r\n[![enter image description here][3]][3]\r\n\r\n\r\n  [1]: https://stackoverflow.com/questions/30792089/java-graphics2d-translate-and-scale\r\n  [2]: https://stackoverflow.com/questions/2916081/zoom-in-on-a-point-using-scale-and-translate\r\n  [3]: https://i.stack.imgur.com/7Y4NI.gif","title":"Java Graphics2D - Zoom on mouse location","body":"<p>I have a jpanel that I draw on. I would like to be able to zoom in and out using the mousewheel, but I want to zoom to the location of the mouse, such that the point under the mouse stays the same. I have found some <a href=\"https://stackoverflow.com/questions/30792089/java-graphics2d-translate-and-scale\">questions here on stackoverflow</a>, but they did not work for me.</p>\n<p>I got pretty close to doing what I want by implementing what is described <a href=\"https://stackoverflow.com/questions/2916081/zoom-in-on-a-point-using-scale-and-translate\">here</a>. Here is my code:</p>\n<pre><code>public class MyPanel extends JPanel {\n...\n    private double zoom = 1;\n    private double zoom_old = 1;\n    private int zoomPointX;\n    private int zoomPointY;\n...\n\n   class CustomMouseWheelListener implements MouseWheelListener {\n        @Override\n        public void mouseWheelMoved(MouseWheelEvent e) {\n            zoomPointX = e.getX();\n            zoomPointY = e.getY();\n            if (e.getPreciseWheelRotation() &lt; 0) {\n                zoom -= 0.1;\n            } else {\n                zoom += 0.1;\n            }\n            if (zoom &lt; 0.01) {\n                zoom = 0.01;\n            }\n            repaint();\n        }\n    }\n...\n    protected void paintComponent(Graphics g) {\n        Graphics2D g2D = (Graphics2D) g;\n        super.paintComponent(g2D);\n        if (zoom != zoom_old) {\n            double scalechange = zoom - zoom_old;\n            zoom_old = zoom;\n            double offsetX = -(zoomPointX * scalechange);\n            double offsetY = -(zoomPointY * scalechange) ;\n            AffineTransform at = new AffineTransform();\n            at.scale(zoom, zoom);\n            at.translate(offsetX, offsetY);\n            g2D.setTransform(at);\n        }\n        a_different_class_where_i_do_some_drawing.draw(g2D);\n    }\n\n}\n</code></pre>\n<p>This ALMOST does what I want. If I try to zoom, I notice that the position of the mouse is taken into account, so for example If I have my mouse on the left of the panel it will roughly zoom in on the left. However, it does not zoom exactly onto the mouse, so the point under the mouse still changes.</p>\n<p>Can anyone help me fix this?</p>\n<p>EDIT:\nHere is a picture of what is happening with the code posted above: I start out with the mouse on the blue square and then just scroll with the mouse wheel. As you can see, the mouse position if being changed:\n<a href=\"https://i.stack.imgur.com/7Y4NI.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/7Y4NI.gif\" alt=\"enter image description here\" /></a></p>\n"},{"tags":["java","c++","performance","cpu-architecture","branch-prediction"],"comments":[{"owner":{"account_id":7428050,"reputation":677,"user_id":5649936,"display_name":"Šimon Hrabec"},"score":119,"creation_date":1526042708,"post_id":11227809,"comment_id":87601479,"body_markdown":"Another observation is that you don&#39;t need to sort the array, but you just need to partition it with the value 128. Sorting is n*log(n), whereas partitioning is just linear. Basically it is just one run of the quick sort partitioning step with the pivot chosen to be 128. Unfortunately in C++ there is just nth_element function, which partition by position, not by value.","body":"Another observation is that you don&#39;t need to sort the array, but you just need to partition it with the value 128. Sorting is n*log(n), whereas partitioning is just linear. Basically it is just one run of the quick sort partitioning step with the pivot chosen to be 128. Unfortunately in C++ there is just nth_element function, which partition by position, not by value."},{"owner":{"account_id":23414,"reputation":7718,"user_id":58668,"accept_rate":39,"display_name":"Jonas K&#246;lker"},"score":46,"creation_date":1601886376,"post_id":11227809,"comment_id":113534273,"body_markdown":"@screwnut here&#39;s an experiment which would show that partitioning is sufficient: create an unsorted but partitioned array with otherwise random contents. Measure time. Sort it. Measure time again. The two measurements should be basically indistinguishable. (Experiment 2: create a random array. Measure time. Partition it. Measure time again. You should see the same speed-up as sorting. You could roll the two experiments into one.)","body":"@screwnut here&#39;s an experiment which would show that partitioning is sufficient: create an unsorted but partitioned array with otherwise random contents. Measure time. Sort it. Measure time again. The two measurements should be basically indistinguishable. (Experiment 2: create a random array. Measure time. Partition it. Measure time again. You should see the same speed-up as sorting. You could roll the two experiments into one.)"},{"owner":{"account_id":29830,"reputation":25912,"user_id":80869,"accept_rate":88,"display_name":"Piotr Czapla"},"score":41,"creation_date":1617181625,"post_id":11227809,"comment_id":118229765,"body_markdown":"Btw. on Apple M1 the code runs in 17 sec unsorted, and in 7 sec sorted, so the branch prediction penalty isn&#39;t that bad on risc architecture.","body":"Btw. on Apple M1 the code runs in 17 sec unsorted, and in 7 sec sorted, so the branch prediction penalty isn&#39;t that bad on risc architecture."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":36,"creation_date":1618468287,"post_id":11227809,"comment_id":118610990,"body_markdown":"@RomanYavorskyi: It depends on the compiler.  If they make branchless asm for this specific test (e.g. as part of vectorizing with SIMD like in [Why is processing an unsorted array the same speed as processing a sorted array with modern x86-64 clang?](https://stackoverflow.com/q/66521344), or just with scalar `cmov` ([gcc optimization flag -O3 makes code slower than -O2](https://stackoverflow.com/q/28875325)), then sorted or not doesn&#39;t matter.  But unpredictable branches are still a very real thing when it&#39;s not as simple as counting, so it would be insane to delete this question.","body":"@RomanYavorskyi: It depends on the compiler.  If they make branchless asm for this specific test (e.g. as part of vectorizing with SIMD like in <a href=\"https://stackoverflow.com/q/66521344\">Why is processing an unsorted array the same speed as processing a sorted array with modern x86-64 clang?</a>, or just with scalar <code>cmov</code> (<a href=\"https://stackoverflow.com/q/28875325\">gcc optimization flag -O3 makes code slower than -O2</a>), then sorted or not doesn&#39;t matter.  But unpredictable branches are still a very real thing when it&#39;s not as simple as counting, so it would be insane to delete this question."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":20,"creation_date":1618469213,"post_id":11227809,"comment_id":118611283,"body_markdown":"@screwnut: To be fair, though, it still wouldn&#39;t be worth partitioning first, because partitioning requires conditional copying or swapping based on the same `array[i] &gt; 128` compare.  (Unless you&#39;re going to be counting multiple times, and you want to partition the bulk of an array so it&#39;s still fast, only mispredicting in an unpartitioned part after some appends or modifications).  If you can get the compiler to do it, ideally just vectorize with SIMD, or at least use branchless scalar if the data is unpredictable.  (See previous comment for links.)","body":"@screwnut: To be fair, though, it still wouldn&#39;t be worth partitioning first, because partitioning requires conditional copying or swapping based on the same <code>array[i] &gt; 128</code> compare.  (Unless you&#39;re going to be counting multiple times, and you want to partition the bulk of an array so it&#39;s still fast, only mispredicting in an unpartitioned part after some appends or modifications).  If you can get the compiler to do it, ideally just vectorize with SIMD, or at least use branchless scalar if the data is unpredictable.  (See previous comment for links.)"},{"owner":{"account_id":10795251,"reputation":5207,"user_id":7941251,"display_name":"SuperStormer"},"score":2,"creation_date":1654310355,"post_id":11227809,"comment_id":128067004,"body_markdown":"2021 followup: [Why is processing an unsorted array the same speed as processing a sorted array with modern x86-64 clang?](https://stackoverflow.com/q/66521344)","body":"2021 followup: <a href=\"https://stackoverflow.com/q/66521344\">Why is processing an unsorted array the same speed as processing a sorted array with modern x86-64 clang?</a>"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":2,"creation_date":1654375339,"post_id":11227809,"comment_id":128077512,"body_markdown":"@SuperStormer: Yup, that&#39;s already linked at the bottom of the question, in the &quot;Related / followup Q&amp;As&quot; section I added, and an earlier comment.  Perhaps it should be even more prominent since multiple people do still manage to miss it, e.g. a recent duplicate of that clang auto-vectorization question even linked this one.","body":"@SuperStormer: Yup, that&#39;s already linked at the bottom of the question, in the &quot;Related / followup Q&amp;As&quot; section I added, and an earlier comment.  Perhaps it should be even more prominent since multiple people do still manage to miss it, e.g. a recent duplicate of that clang auto-vectorization question even linked this one."},{"owner":{"account_id":10541,"reputation":5244,"user_id":19974,"accept_rate":100,"display_name":"Jason Short"},"score":2,"creation_date":1657058940,"post_id":11227809,"comment_id":128718359,"body_markdown":"Unironically have you tried this run in RELEASE mode?  On my local Core i7 laptop debug is similar to your numbers.  But in release mode it is 0.7 and 0.68 seconds.  The compiler optimized it for you.","body":"Unironically have you tried this run in RELEASE mode?  On my local Core i7 laptop debug is similar to your numbers.  But in release mode it is 0.7 and 0.68 seconds.  The compiler optimized it for you."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":6,"creation_date":1657064804,"post_id":11227809,"comment_id":128719329,"body_markdown":"@JasonShort: This question is from 2012.  Even modern Java probably still uses a branch.  And GCC auto-vectorization was only enabled at `-O3` until GCC12 (this year) enabled it at `-O2`.  And as the linked Q&amp;As at the bottom show, [specifically the GCC -O2 vs -O3 one](https://stackoverflow.com/q/28875325), GCC `-O2` used a branch for its scalar code.  But yes, the right choice for C++ compilers these days is auto-vectorization, or at least scalar if-conversion to cmov, on unpredictable branches like this, and that happens if you enable *full* optimization, but many people use `-O2`.","body":"@JasonShort: This question is from 2012.  Even modern Java probably still uses a branch.  And GCC auto-vectorization was only enabled at <code>-O3</code> until GCC12 (this year) enabled it at <code>-O2</code>.  And as the linked Q&amp;As at the bottom show, <a href=\"https://stackoverflow.com/q/28875325\">specifically the GCC -O2 vs -O3 one</a>, GCC <code>-O2</code> used a branch for its scalar code.  But yes, the right choice for C++ compilers these days is auto-vectorization, or at least scalar if-conversion to cmov, on unpredictable branches like this, and that happens if you enable <i>full</i> optimization, but many people use <code>-O2</code>."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":2,"creation_date":1701123253,"post_id":11227809,"comment_id":136733980,"body_markdown":"@ColeTobin : You&#39;re right that the underlying effect isn&#39;t language-specific, but it is more pronounced in language implementations that AoT or JIT compile to native machine code.  An interpreter would still have some unpredictable data-dependent branching, but lots of other (predictable) branching to dispatch handler functions.  And only happens when the optimizer chooses not to make branchless (scalar or vector) asm.  There aren&#39;t 2 other tags we really want, so I&#39;m going to roll back to re-add the [c++][java] tags.  They don&#39;t make the question worse, and the examples use them.","body":"@ColeTobin : You&#39;re right that the underlying effect isn&#39;t language-specific, but it is more pronounced in language implementations that AoT or JIT compile to native machine code.  An interpreter would still have some unpredictable data-dependent branching, but lots of other (predictable) branching to dispatch handler functions.  And only happens when the optimizer chooses not to make branchless (scalar or vector) asm.  There aren&#39;t 2 other tags we really want, so I&#39;m going to roll back to re-add the [c++][java] tags.  They don&#39;t make the question worse, and the examples use them."}],"answers":[{"comments":[{"owner":{"account_id":257205,"reputation":1271,"user_id":538458,"display_name":"Adam Freeman"},"score":165,"creation_date":1411498692,"post_id":11227877,"comment_id":40722655,"body_markdown":"Does branch prediction work better on sorted arrays vs. arrays with different patterns?  For example, for the array --&gt; { 10, 5, 20, 10, 40, 20, ... } the next element in the array from the pattern is 80.  Would this kind of array be sped up by branch prediction in which the next element is 80 here if the pattern is followed?  Or does it usually only help with sorted arrays?","body":"Does branch prediction work better on sorted arrays vs. arrays with different patterns?  For example, for the array --&gt; { 10, 5, 20, 10, 40, 20, ... } the next element in the array from the pattern is 80.  Would this kind of array be sped up by branch prediction in which the next element is 80 here if the pattern is followed?  Or does it usually only help with sorted arrays?"},{"owner":{"account_id":3871445,"reputation":3077,"user_id":3206624,"accept_rate":94,"display_name":"Agrim Pathak"},"score":210,"creation_date":1414655518,"post_id":11227877,"comment_id":41900025,"body_markdown":"So basically everything I conventionally learned about big-O is out of the window?  Better to incur a sorting cost than a branching cost?","body":"So basically everything I conventionally learned about big-O is out of the window?  Better to incur a sorting cost than a branching cost?"},{"owner":{"account_id":996105,"reputation":182284,"user_id":1011995,"display_name":"Daniel Fischer"},"score":198,"creation_date":1414664052,"post_id":11227877,"comment_id":41904388,"body_markdown":"@AgrimPathak That depends. For not too large input, an algorithm with higher complexity is faster than an algorithm with lower complexity when the constants are smaller for the algorithm with higher complexity. Where the break-even point is can be hard to predict. Also, [compare this](http://stackoverflow.com/questions/14023988/why-is-processing-a-sorted-array-slower-than-an-unsorted-array?lq=1), locality is important. Big-O is important, but it is not the sole criterion for performance.","body":"@AgrimPathak That depends. For not too large input, an algorithm with higher complexity is faster than an algorithm with lower complexity when the constants are smaller for the algorithm with higher complexity. Where the break-even point is can be hard to predict. Also, <a href=\"http://stackoverflow.com/questions/14023988/why-is-processing-a-sorted-array-slower-than-an-unsorted-array?lq=1\">compare this</a>, locality is important. Big-O is important, but it is not the sole criterion for performance."},{"owner":{"account_id":2334835,"reputation":5741,"user_id":2047418,"accept_rate":83,"display_name":"Filip Bartuzi"},"score":108,"creation_date":1415540238,"post_id":11227877,"comment_id":42224805,"body_markdown":"When does branch prediction takes place? When does language will know that array is sorted? I&#39;m thinking of situation of array that looks like: [1,2,3,4,5,...998,999,1000, 3, 10001, 10002] ? will this obscure 3 increase running time? Will it be as long as unsorted array?","body":"When does branch prediction takes place? When does language will know that array is sorted? I&#39;m thinking of situation of array that looks like: [1,2,3,4,5,...998,999,1000, 3, 10001, 10002] ? will this obscure 3 increase running time? Will it be as long as unsorted array?"},{"owner":{"account_id":996105,"reputation":182284,"user_id":1011995,"display_name":"Daniel Fischer"},"score":107,"creation_date":1415540977,"post_id":11227877,"comment_id":42225007,"body_markdown":"@FilipBartuzi Branch prediction takes place in the processor, below the language level (but the language may offer ways to tell the compiler what&#39;s likely, so the compiler can emit code suited to that). In your example, the out-of-order 3 will lead to a branch-misprediction (for appropriate conditions, where 3 gives a different result than 1000), and thus processing that array will likely take a couple dozen or hundred nanoseconds longer than a sorted array would, hardly ever noticeable. What costs time is i high rate of mispredictions, one misprediction per 1000 isn&#39;t much.","body":"@FilipBartuzi Branch prediction takes place in the processor, below the language level (but the language may offer ways to tell the compiler what&#39;s likely, so the compiler can emit code suited to that). In your example, the out-of-order 3 will lead to a branch-misprediction (for appropriate conditions, where 3 gives a different result than 1000), and thus processing that array will likely take a couple dozen or hundred nanoseconds longer than a sorted array would, hardly ever noticeable. What costs time is i high rate of mispredictions, one misprediction per 1000 isn&#39;t much."},{"owner":{"account_id":10525,"reputation":18129,"user_id":1715673,"accept_rate":86,"display_name":"Peter Wone"},"score":7,"creation_date":1430452976,"post_id":11227877,"comment_id":48082367,"body_markdown":"@AdamFreeman - Sorting is relevant here only inasmuch as *in this code* it increases branch prediction to 100% success.","body":"@AdamFreeman - Sorting is relevant here only inasmuch as <i>in this code</i> it increases branch prediction to 100% success."},{"owner":{"account_id":10715374,"reputation":247,"user_id":7886227,"display_name":"Dr t"},"score":8,"creation_date":1495734693,"post_id":11227877,"comment_id":75387346,"body_markdown":"I would recommend a look at: https://en.wikibooks.org/wiki/Optimizing_C%2B%2B/Writing_efficient_code/Performance_improving_features  which provides a good discussion with examples of this topic including some that are not mentioned in any comments that i have seen regarding this question.","body":"I would recommend a look at: <a href=\"https://en.wikibooks.org/wiki/Optimizing_C%2B%2B/Writing_efficient_code/Performance_improving_features\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Optimizing_C%2B%2B/Writing_efficient_c&zwnj;&#8203;ode/&hellip;</a>  which provides a good discussion with examples of this topic including some that are not mentioned in any comments that i have seen regarding this question."},{"owner":{"account_id":5380558,"reputation":2482,"user_id":4285898,"accept_rate":75,"display_name":"आनंद"},"score":7,"creation_date":1505485014,"post_id":11227877,"comment_id":79447312,"body_markdown":"@DanielFischer does compiler knows which array is sorted and which one is not?","body":"@DanielFischer does compiler knows which array is sorted and which one is not?"},{"owner":{"account_id":1050592,"reputation":581,"user_id":1054647,"display_name":"knickum"},"score":8,"creation_date":1507930981,"post_id":11227877,"comment_id":80423729,"body_markdown":"@AnandTyagi As Peter Wone noted, it&#39;s not that the compiler knows which array is sorted or not. Imagine an extremely simple branch predictor that takes the same path as the previous iteration, e.g. a train taking a left if it took a left last time, and vice versa. For a sorted array of 256 ints, (ignoring the undefined first iteration), the prediction would be correct from 2-128, wrong at 129, and then correct from 130-256. Now, that&#39;s a terrible branch predictor that would only work in this specific situation, but a really good predictor should still handle this capably.","body":"@AnandTyagi As Peter Wone noted, it&#39;s not that the compiler knows which array is sorted or not. Imagine an extremely simple branch predictor that takes the same path as the previous iteration, e.g. a train taking a left if it took a left last time, and vice versa. For a sorted array of 256 ints, (ignoring the undefined first iteration), the prediction would be correct from 2-128, wrong at 129, and then correct from 130-256. Now, that&#39;s a terrible branch predictor that would only work in this specific situation, but a really good predictor should still handle this capably."},{"owner":{"account_id":1617353,"reputation":534,"user_id":1494680,"accept_rate":100,"display_name":"Omer"},"score":3,"creation_date":1593237458,"post_id":11227877,"comment_id":110714690,"body_markdown":"Is the branch predictions mostly happen at compiler level or it is handled by processor? And why java or c++ can not handled it? I mean why is not complicated to predict it right?","body":"Is the branch predictions mostly happen at compiler level or it is handled by processor? And why java or c++ can not handled it? I mean why is not complicated to predict it right?"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":0,"creation_date":1650519380,"post_id":11227877,"comment_id":127137562,"body_markdown":"@AgrimPathak: No, unless you can sort once but iterate over the array many times, the time to sort an array is much larger than one pass with this loop.  Comparison-based sorting also involves many data-dependent branches.  (O(N) sorts like Counting Sort or Radix Sort may avoid mispredicts depending on implementation choice, but still have enough overhead to make it not worth it.)  What you should actually do is encourage the compiler to make branchless asm, like `sum +=  (v &gt;= 128 ? v : 0);` or similar, or to [vectorize with SIMD](https://stackoverflow.com/q/66521344).","body":"@AgrimPathak: No, unless you can sort once but iterate over the array many times, the time to sort an array is much larger than one pass with this loop.  Comparison-based sorting also involves many data-dependent branches.  (O(N) sorts like Counting Sort or Radix Sort may avoid mispredicts depending on implementation choice, but still have enough overhead to make it not worth it.)  What you should actually do is encourage the compiler to make branchless asm, like <code>sum +=  (v &gt;= 128 ? v : 0);</code> or similar, or to <a href=\"https://stackoverflow.com/q/66521344\">vectorize with SIMD</a>."},{"owner":{"account_id":22374659,"reputation":1608,"user_id":16589128,"display_name":"puppydrum64"},"score":0,"creation_date":1669207500,"post_id":11227877,"comment_id":131591422,"body_markdown":"@Omer The branch predictions are purely at a processor level.  Even in assembly there&#39;s no syntax to help the CPU branch predict. It boils down to the way the hardware works. There&#39;s just no way to know whether a branch will be taken ahead of time.  While it&#39;s obvious to you and me, a computer really isn&#39;t as smart. It&#39;s not aware of anything that exists outside of a few instructions ahead and the caches.","body":"@Omer The branch predictions are purely at a processor level.  Even in assembly there&#39;s no syntax to help the CPU branch predict. It boils down to the way the hardware works. There&#39;s just no way to know whether a branch will be taken ahead of time.  While it&#39;s obvious to you and me, a computer really isn&#39;t as smart. It&#39;s not aware of anything that exists outside of a few instructions ahead and the caches."}],"tags":[],"owner":{"account_id":996105,"reputation":182284,"user_id":1011995,"display_name":"Daniel Fischer"},"comment_count":12,"down_vote_count":21,"up_vote_count":4683,"is_accepted":false,"score":4662,"last_activity_date":1470383590,"creation_date":1340805285,"answer_id":11227877,"question_id":11227809,"body_markdown":"**Branch prediction.**\n\n  With a sorted array, the condition `data[c] &gt;= 128` is first `false` for a streak of values, then becomes `true` for all later values. That&#39;s easy to predict. With an unsorted array, you pay for the branching cost.","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p><strong>Branch prediction.</strong></p>\n<p>With a sorted array, the condition <code>data[c] &gt;= 128</code> is first <code>false</code> for a streak of values, then becomes <code>true</code> for all later values. That's easy to predict. With an unsorted array, you pay for the branching cost.</p>\n"},{"comments":[{"owner":{"account_id":5570752,"reputation":941,"user_id":4416169,"accept_rate":100,"display_name":"Matias Chara"},"score":49,"creation_date":1594597968,"post_id":11227902,"comment_id":111173010,"body_markdown":"wait a second, doesnt shifting negative values to the right yield implementation-defined values? int t = (data[c] - 128) &gt;&gt; 31;\nsum += ~t &amp; data[c];","body":"wait a second, doesnt shifting negative values to the right yield implementation-defined values? int t = (data[c] - 128) &gt;&gt; 31; sum += ~t &amp; data[c];"},{"owner":{"account_id":230261,"reputation":791,"user_id":493759,"display_name":"Agoston Horvath"},"score":6,"creation_date":1601973465,"post_id":11227902,"comment_id":113565282,"body_markdown":"@MatiasChara it&#39;s really hidden, see https://en.wikipedia.org/wiki/Bitwise_operations_in_C#Right_shift_%3E%3E ; &quot;however most compilers will perform an arithmetic shift, causing the blank to be filled with the sign bit of the left operand&quot;. I guess it&#39;s a de-facto standard by now.","body":"@MatiasChara it&#39;s really hidden, see <a href=\"https://en.wikipedia.org/wiki/Bitwise_operations_in_C#Right_shift_%3E%3E\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a> ; &quot;however most compilers will perform an arithmetic shift, causing the blank to be filled with the sign bit of the left operand&quot;. I guess it&#39;s a de-facto standard by now."},{"owner":{"account_id":405591,"reputation":6670,"user_id":774575,"accept_rate":78,"display_name":"mins"},"score":69,"creation_date":1602857081,"post_id":11227902,"comment_id":113860806,"body_markdown":"Incidently branch prediction failure can also be [exploited by a program to obtain crypto keys being used by another program](https://eprint.iacr.org/2006/288.pdf) on the same CPU core.","body":"Incidently branch prediction failure can also be <a href=\"https://eprint.iacr.org/2006/288.pdf\" rel=\"nofollow noreferrer\">exploited by a program to obtain crypto keys being used by another program</a> on the same CPU core."},{"owner":{"account_id":11938397,"reputation":389,"user_id":8736053,"display_name":"Mycotina"},"score":9,"creation_date":1607419616,"post_id":11227902,"comment_id":115259910,"body_markdown":"I have a hard time understanding the explanation. Because, even with branch predictor, isn&#39;t the computer still need to know if it guessed right or wrong in the end? Because if not, how will it know if it should do the rollback? And for knowing if it is right or wrong, isn&#39;t we need to compute the result of the if condition nonetheless? Which in the end, will consume the same resource without branch prediction, or even slower because we need to correct mistakes?","body":"I have a hard time understanding the explanation. Because, even with branch predictor, isn&#39;t the computer still need to know if it guessed right or wrong in the end? Because if not, how will it know if it should do the rollback? And for knowing if it is right or wrong, isn&#39;t we need to compute the result of the if condition nonetheless? Which in the end, will consume the same resource without branch prediction, or even slower because we need to correct mistakes?"},{"owner":{"account_id":483889,"reputation":1846,"user_id":899213,"accept_rate":92,"display_name":"Raphael"},"score":45,"creation_date":1609861882,"post_id":11227902,"comment_id":115951193,"body_markdown":"@Mycotina, I&#39;m no expert, but what I understand is: the processor needs multiple steps to execute a single instruction (fetching, decoding, etc) -- this is called &quot;instruction pipelining&quot; -- so, as an optimization, it will fetch multiple instructions at once and &quot;warm up&quot; the next instructions while executing the current one. If the wrong branch is chosen, the instructions being &quot;warmed up&quot; in the pipeline must be discarded, so that the instructions on the right branch can be put into the pipeline instead.","body":"@Mycotina, I&#39;m no expert, but what I understand is: the processor needs multiple steps to execute a single instruction (fetching, decoding, etc) -- this is called &quot;instruction pipelining&quot; -- so, as an optimization, it will fetch multiple instructions at once and &quot;warm up&quot; the next instructions while executing the current one. If the wrong branch is chosen, the instructions being &quot;warmed up&quot; in the pipeline must be discarded, so that the instructions on the right branch can be put into the pipeline instead."},{"owner":{"account_id":1392510,"reputation":65518,"user_id":1322972,"display_name":"WhozCraig"},"score":22,"creation_date":1610071437,"post_id":11227902,"comment_id":116023390,"body_markdown":"@Mycotina It&#39;s easier to understand when you think of the instruction pipeline cache as tracks, the train (with cars) as the instructions, and the indicator of whether you go left or right by some dude at the END of the train; not the beginning. By the time you see him to know you&#39;ve guessed right, not only is it too late to switch things, the pipeline ahead is already populated, but in the wrong direction. If you guessed wrong the predicted pipeline needs to be thrown out (derail the train; drag it back before the switch house, put it back on the tracks, and send it the other way).","body":"@Mycotina It&#39;s easier to understand when you think of the instruction pipeline cache as tracks, the train (with cars) as the instructions, and the indicator of whether you go left or right by some dude at the END of the train; not the beginning. By the time you see him to know you&#39;ve guessed right, not only is it too late to switch things, the pipeline ahead is already populated, but in the wrong direction. If you guessed wrong the predicted pipeline needs to be thrown out (derail the train; drag it back before the switch house, put it back on the tracks, and send it the other way)."},{"owner":{"account_id":14146953,"reputation":419,"user_id":10220019,"display_name":"C. Binair"},"score":8,"creation_date":1614788479,"post_id":11227902,"comment_id":117493367,"body_markdown":"I hope this question is simple, but I&#39;m confused. The prediction is that made during runtime or already when compiling?","body":"I hope this question is simple, but I&#39;m confused. The prediction is that made during runtime or already when compiling?"},{"owner":{"account_id":10227771,"reputation":290,"user_id":8132066,"display_name":"Tom"},"score":18,"creation_date":1615387664,"post_id":11227902,"comment_id":117675227,"body_markdown":"@C.Binair Primarily it&#39;s runtime, i.e. processor predicts branches while executing the code. The processor also remembers previous results and use that to predict next jump. However, compiler can provide some initial hints for branch prediction while compiling - search for &quot;likely&quot; and &quot;unlikely&quot; attributes. So you could say the answer is kinda both, but runtime is when it actually happens.","body":"@C.Binair Primarily it&#39;s runtime, i.e. processor predicts branches while executing the code. The processor also remembers previous results and use that to predict next jump. However, compiler can provide some initial hints for branch prediction while compiling - search for &quot;likely&quot; and &quot;unlikely&quot; attributes. So you could say the answer is kinda both, but runtime is when it actually happens."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":5,"creation_date":1623459218,"post_id":11227902,"comment_id":120093110,"body_markdown":"@Tom: Not exactly.  Most ISAs don&#39;t have any mechanism for the compiler to actually provide branch hints to the CPU.  `likely`/`unlikely` macros mostly just affect decision to use cmov (branchless) vs. actually branching, and to lay out the asm so the expected case has fewer taken branches.  (i.e. the fast path can get fetched contiguously in wide chunks by the pipeline.)  [Is there a compiler hint for GCC to force branch prediction to always go a certain way?](https://stackoverflow.com/a/30136196), and [this](https://stackoverflow.com/a/31133787/224132) is an example of actual x86 code-gen.","body":"@Tom: Not exactly.  Most ISAs don&#39;t have any mechanism for the compiler to actually provide branch hints to the CPU.  <code>likely</code>/<code>unlikely</code> macros mostly just affect decision to use cmov (branchless) vs. actually branching, and to lay out the asm so the expected case has fewer taken branches.  (i.e. the fast path can get fetched contiguously in wide chunks by the pipeline.)  <a href=\"https://stackoverflow.com/a/30136196\">Is there a compiler hint for GCC to force branch prediction to always go a certain way?</a>, and <a href=\"https://stackoverflow.com/a/31133787/224132\">this</a> is an example of actual x86 code-gen."},{"owner":{"account_id":1173540,"reputation":96514,"user_id":1329652,"accept_rate":41,"display_name":"Kuba hasn&#39;t forgotten Monica"},"score":7,"creation_date":1629519874,"post_id":11227902,"comment_id":121713611,"body_markdown":"@C.Binair The prediction is made at runtime, and it costs millions of transistors per core to implement it. And multiple Ph.D. dissertations worth of work :) Modern branch predictors are marvels of engineering, to the point that the Eiffel Tower starts looking minuscule. They are hidden from the view, but they are largely responsible for the performance of modern processors. Turn branch prediction off (e.g. by writing code that slams the predictor and makes it useless), and an i7 3GHz core is like a cheap ARM Arduino...","body":"@C.Binair The prediction is made at runtime, and it costs millions of transistors per core to implement it. And multiple Ph.D. dissertations worth of work :) Modern branch predictors are marvels of engineering, to the point that the Eiffel Tower starts looking minuscule. They are hidden from the view, but they are largely responsible for the performance of modern processors. Turn branch prediction off (e.g. by writing code that slams the predictor and makes it useless), and an i7 3GHz core is like a cheap ARM Arduino..."}],"tags":[],"owner":{"account_id":559988,"reputation":466349,"user_id":922184,"display_name":"Mysticial"},"comment_count":10,"down_vote_count":32,"up_vote_count":34890,"is_accepted":true,"score":34858,"last_activity_date":1695116158,"creation_date":1340805402,"answer_id":11227902,"question_id":11227809,"body_markdown":"**You are a victim of [branch prediction][1] fail.**\r\n\r\n---\r\n\r\n## What is Branch Prediction?\r\n\r\nConsider a railroad junction:\r\n\r\n[![Image showing a railroad junction][2]][3]\r\n&lt;sub&gt;[Image][3] by Mecanismo, via Wikimedia Commons. Used under the [CC-By-SA 3.0][4] license.&lt;/sub&gt;\r\n\r\nNow for the sake of argument, suppose this is back in the 1800s - before long-distance or radio communication.\r\n\r\nYou are a blind operator of a junction and you hear a train coming. You have no idea which way it is supposed to go. You stop the train to ask the driver which direction they want. And then you set the switch appropriately.\r\n\r\n*Trains are heavy and have a lot of inertia, so they take forever to start up and slow down.*\r\n\r\nIs there a better way? You guess which direction the train will go!\r\n\r\n- If you guessed right, it continues on.\r\n- If you guessed wrong, the driver will stop, back up, and yell at you to flip the switch. Then it can restart down the other path.\r\n\r\n**If you guess right every time**, the train will never have to stop.  \r\n**If you guess wrong too often**, the train will spend a lot of time stopping, backing up, and restarting.\r\n\r\n---\r\n\r\n**Consider an if-statement:** At the processor level, it is a branch instruction:\r\n\r\n![if(x &gt;= 128) compiles into a jump-if-less-than processor instruction.][5]\r\n\r\nYou are a processor and you see a branch. You have no idea which way it will go. What do you do? You halt execution and wait until the previous instructions are complete. Then you continue down the correct path.\r\n\r\n*Modern processors are complicated and have long pipelines. This means they take forever to &quot;warm up&quot; and &quot;slow down&quot;.*\r\n\r\nIs there a better way? You guess which direction the branch will go!\r\n\r\n- If you guessed right, you continue executing.\r\n- If you guessed wrong, you need to flush the pipeline and roll back to the branch. Then you can restart down the other path.\r\n\r\n**If you guess right every time**, the execution will never have to stop.  \r\n**If you guess wrong too often**, you spend a lot of time stalling, rolling back, and restarting.\r\n\r\n---\r\n\r\nThis is branch prediction. I admit it&#39;s not the best analogy since the train could just signal the direction with a flag. But in computers, the processor doesn&#39;t know which direction a branch will go until the last moment.\r\n\r\nHow would you strategically guess to minimize the number of times that the train must back up and go down the other path? You look at the past history! If the train goes left 99% of the time, then you guess left. If it alternates, then you alternate your guesses. If it goes one way every three times, you guess the same...\r\n\r\n***In other words, you try to identify a pattern and follow it.*** This is more or less how branch predictors work.\r\n\r\nMost applications have well-behaved branches. Therefore, modern branch predictors will typically achieve &gt;90% hit rates. But when faced with unpredictable branches with no recognizable patterns, branch predictors are virtually useless.\r\n\r\nFurther reading: [&quot;Branch predictor&quot; article on Wikipedia][1].\r\n\r\n---\r\n\r\n## As hinted from above, the culprit is this if-statement:\r\n\r\n    if (data[c] &gt;= 128)\r\n        sum += data[c];\r\n\r\nNotice that the data is evenly distributed between 0 and 255. When the data is sorted, roughly the first half of the iterations will not enter the if-statement. After that, they will all enter the if-statement.\r\n\r\nThis is very friendly to the branch predictor since the branch consecutively goes the same direction many times. Even a simple saturating counter will correctly predict the branch except for the few iterations after it switches direction.\r\n\r\n**Quick visualization:**\r\n\r\n```none\r\nT = branch taken\r\nN = branch not taken\r\n\r\ndata[] = 0, 1, 2, 3, 4, ... 126, 127, 128, 129, 130, ... 250, 251, 252, ...\r\nbranch = N  N  N  N  N  ...   N    N    T    T    T  ...   T    T    T  ...\r\n\r\n       = NNNNNNNNNNNN ... NNNNNNNTTTTTTTTT ... TTTTTTTTTT  (easy to predict)\r\n```\r\nHowever, when the data is completely random, the branch predictor is rendered useless, because it can&#39;t predict random data. Thus there will probably be around 50% misprediction (no better than random guessing).\r\n\r\n```none\r\ndata[] = 226, 185, 125, 158, 198, 144, 217, 79, 202, 118,  14, 150, 177, 182, ...\r\nbranch =   T,   T,   N,   T,   T,   T,   T,  N,   T,   N,   N,   T,   T,   T  ...\r\n\r\n       = TTNTTTTNTNNTTT ...   (completely random - impossible to predict)\r\n```\r\n\r\n---\r\n\r\n**What can be done?**\r\n\r\nIf the compiler isn&#39;t able to optimize the branch into a conditional move, you can try some hacks if you are willing to sacrifice readability for performance.\r\n\r\nReplace:\r\n\r\n    if (data[c] &gt;= 128)\r\n        sum += data[c];\r\n\r\nwith:\r\n\r\n    int t = (data[c] - 128) &gt;&gt; 31;\r\n    sum += ~t &amp; data[c];\r\n\r\nThis eliminates the branch and replaces it with some bitwise operations.\r\n\r\n&lt;sub&gt;(Note that this hack is not strictly equivalent to the original if-statement. But in this case, it&#39;s valid for all the input values of `data[]`.)&lt;/sub&gt;\r\n\r\n**Benchmarks: Core i7 920 @ 3.5 GHz**\r\n\r\nC++ - Visual Studio 2010 - x64 Release\r\n\r\n|Scenario|Time (seconds)|\r\n|---|---|\r\n|Branching - Random data|11.777|\r\n|Branching - Sorted data|2.352|\r\n|Branchless - Random data|2.564|\r\n|Branchless - Sorted data|2.587|\r\n\r\nJava - NetBeans 7.1.1 JDK 7 - x64\r\n\r\n|Scenario|Time (seconds)|\r\n|---|---|\r\n|Branching - Random data|10.93293813|\r\n|Branching - Sorted data|5.643797077|\r\n|Branchless - Random data|3.113581453|\r\n|Branchless - Sorted data|3.186068823|\r\n\r\nObservations:\r\n\r\n- **With the Branch:** There is a huge difference between the sorted and unsorted data.\r\n- **With the Hack:** There is no difference between sorted and unsorted data.\r\n- In the C++ case, the hack is actually a tad slower than with the branch when the data is sorted.\r\n\r\nA general rule of thumb is to avoid data-dependent branching in critical loops (such as in this example).\r\n\r\n---\r\n\r\n**Update:**\r\n\r\n- GCC 4.6.1 with `-O3` or `-ftree-vectorize` on x64 is able to generate a conditional move, so there is no difference between the sorted and unsorted data - both are fast.\r\n\r\n   (Or somewhat fast: for the already-sorted case, `cmov` can be slower especially if GCC puts it on the critical path instead of just `add`, especially on Intel before Broadwell where `cmov` has 2 cycle latency: https://stackoverflow.com/questions/28875325/gcc-optimization-flag-o3-makes-code-slower-than-o2)\r\n\r\n- VC++ 2010 is unable to generate conditional moves for this branch even under `/Ox`.\r\n\r\n- [Intel C++ Compiler][6] (ICC) 11 does something miraculous. It [interchanges the two loops][7], thereby hoisting the unpredictable branch to the outer loop. Not only is it immune to the mispredictions, it&#39;s also twice as fast as whatever VC++ and GCC can generate! In other words, ICC took advantage of the test-loop to defeat the benchmark...\r\n\r\n- If you give the Intel compiler the branchless code, it just outright vectorizes it... and is just as fast as with the branch (with the loop interchange).\r\n\r\nThis goes to show that even mature modern compilers can vary wildly in their ability to optimize code...\r\n\r\n\r\n  [1]: https://en.wikipedia.org/wiki/Branch_predictor\r\n  [2]: https://i.stack.imgur.com/muxnt.jpg\r\n  [3]: https://commons.wikimedia.org/wiki/File:Entroncamento_do_Transpraia.JPG\r\n  [4]: https://creativecommons.org/licenses/by-sa/3.0/deed.en\r\n  [5]: https://i.stack.imgur.com/pyfwC.png\r\n  [6]: https://en.wikipedia.org/wiki/Intel_C++_Compiler\r\n  [7]: https://en.wikipedia.org/wiki/Loop_interchange","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p><strong>You are a victim of <a href=\"https://en.wikipedia.org/wiki/Branch_predictor\" rel=\"noreferrer\">branch prediction</a> fail.</strong></p>\n<hr />\n<h2>What is Branch Prediction?</h2>\n<p>Consider a railroad junction:</p>\n<p><a href=\"https://commons.wikimedia.org/wiki/File:Entroncamento_do_Transpraia.JPG\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/muxnt.jpg\" alt=\"Image showing a railroad junction\" /></a>\n<sub><a href=\"https://commons.wikimedia.org/wiki/File:Entroncamento_do_Transpraia.JPG\" rel=\"noreferrer\">Image</a> by Mecanismo, via Wikimedia Commons. Used under the <a href=\"https://creativecommons.org/licenses/by-sa/3.0/deed.en\" rel=\"noreferrer\">CC-By-SA 3.0</a> license.</sub></p>\n<p>Now for the sake of argument, suppose this is back in the 1800s - before long-distance or radio communication.</p>\n<p>You are a blind operator of a junction and you hear a train coming. You have no idea which way it is supposed to go. You stop the train to ask the driver which direction they want. And then you set the switch appropriately.</p>\n<p><em>Trains are heavy and have a lot of inertia, so they take forever to start up and slow down.</em></p>\n<p>Is there a better way? You guess which direction the train will go!</p>\n<ul>\n<li>If you guessed right, it continues on.</li>\n<li>If you guessed wrong, the driver will stop, back up, and yell at you to flip the switch. Then it can restart down the other path.</li>\n</ul>\n<p><strong>If you guess right every time</strong>, the train will never have to stop.<br />\n<strong>If you guess wrong too often</strong>, the train will spend a lot of time stopping, backing up, and restarting.</p>\n<hr />\n<p><strong>Consider an if-statement:</strong> At the processor level, it is a branch instruction:</p>\n<p><img src=\"https://i.stack.imgur.com/pyfwC.png\" alt=\"if(x &gt;= 128) compiles into a jump-if-less-than processor instruction.\" /></p>\n<p>You are a processor and you see a branch. You have no idea which way it will go. What do you do? You halt execution and wait until the previous instructions are complete. Then you continue down the correct path.</p>\n<p><em>Modern processors are complicated and have long pipelines. This means they take forever to &quot;warm up&quot; and &quot;slow down&quot;.</em></p>\n<p>Is there a better way? You guess which direction the branch will go!</p>\n<ul>\n<li>If you guessed right, you continue executing.</li>\n<li>If you guessed wrong, you need to flush the pipeline and roll back to the branch. Then you can restart down the other path.</li>\n</ul>\n<p><strong>If you guess right every time</strong>, the execution will never have to stop.<br />\n<strong>If you guess wrong too often</strong>, you spend a lot of time stalling, rolling back, and restarting.</p>\n<hr />\n<p>This is branch prediction. I admit it's not the best analogy since the train could just signal the direction with a flag. But in computers, the processor doesn't know which direction a branch will go until the last moment.</p>\n<p>How would you strategically guess to minimize the number of times that the train must back up and go down the other path? You look at the past history! If the train goes left 99% of the time, then you guess left. If it alternates, then you alternate your guesses. If it goes one way every three times, you guess the same...</p>\n<p><em><strong>In other words, you try to identify a pattern and follow it.</strong></em> This is more or less how branch predictors work.</p>\n<p>Most applications have well-behaved branches. Therefore, modern branch predictors will typically achieve &gt;90% hit rates. But when faced with unpredictable branches with no recognizable patterns, branch predictors are virtually useless.</p>\n<p>Further reading: <a href=\"https://en.wikipedia.org/wiki/Branch_predictor\" rel=\"noreferrer\">&quot;Branch predictor&quot; article on Wikipedia</a>.</p>\n<hr />\n<h2>As hinted from above, the culprit is this if-statement:</h2>\n<pre><code>if (data[c] &gt;= 128)\n    sum += data[c];\n</code></pre>\n<p>Notice that the data is evenly distributed between 0 and 255. When the data is sorted, roughly the first half of the iterations will not enter the if-statement. After that, they will all enter the if-statement.</p>\n<p>This is very friendly to the branch predictor since the branch consecutively goes the same direction many times. Even a simple saturating counter will correctly predict the branch except for the few iterations after it switches direction.</p>\n<p><strong>Quick visualization:</strong></p>\n<pre class=\"lang-none prettyprint-override\"><code>T = branch taken\nN = branch not taken\n\ndata[] = 0, 1, 2, 3, 4, ... 126, 127, 128, 129, 130, ... 250, 251, 252, ...\nbranch = N  N  N  N  N  ...   N    N    T    T    T  ...   T    T    T  ...\n\n       = NNNNNNNNNNNN ... NNNNNNNTTTTTTTTT ... TTTTTTTTTT  (easy to predict)\n</code></pre>\n<p>However, when the data is completely random, the branch predictor is rendered useless, because it can't predict random data. Thus there will probably be around 50% misprediction (no better than random guessing).</p>\n<pre class=\"lang-none prettyprint-override\"><code>data[] = 226, 185, 125, 158, 198, 144, 217, 79, 202, 118,  14, 150, 177, 182, ...\nbranch =   T,   T,   N,   T,   T,   T,   T,  N,   T,   N,   N,   T,   T,   T  ...\n\n       = TTNTTTTNTNNTTT ...   (completely random - impossible to predict)\n</code></pre>\n<hr />\n<p><strong>What can be done?</strong></p>\n<p>If the compiler isn't able to optimize the branch into a conditional move, you can try some hacks if you are willing to sacrifice readability for performance.</p>\n<p>Replace:</p>\n<pre><code>if (data[c] &gt;= 128)\n    sum += data[c];\n</code></pre>\n<p>with:</p>\n<pre><code>int t = (data[c] - 128) &gt;&gt; 31;\nsum += ~t &amp; data[c];\n</code></pre>\n<p>This eliminates the branch and replaces it with some bitwise operations.</p>\n<p><sub>(Note that this hack is not strictly equivalent to the original if-statement. But in this case, it's valid for all the input values of <code>data[]</code>.)</sub></p>\n<p><strong>Benchmarks: Core i7 920 @ 3.5 GHz</strong></p>\n<p>C++ - Visual Studio 2010 - x64 Release</p>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Scenario</th>\n<th>Time (seconds)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Branching - Random data</td>\n<td>11.777</td>\n</tr>\n<tr>\n<td>Branching - Sorted data</td>\n<td>2.352</td>\n</tr>\n<tr>\n<td>Branchless - Random data</td>\n<td>2.564</td>\n</tr>\n<tr>\n<td>Branchless - Sorted data</td>\n<td>2.587</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>Java - NetBeans 7.1.1 JDK 7 - x64</p>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Scenario</th>\n<th>Time (seconds)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Branching - Random data</td>\n<td>10.93293813</td>\n</tr>\n<tr>\n<td>Branching - Sorted data</td>\n<td>5.643797077</td>\n</tr>\n<tr>\n<td>Branchless - Random data</td>\n<td>3.113581453</td>\n</tr>\n<tr>\n<td>Branchless - Sorted data</td>\n<td>3.186068823</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>Observations:</p>\n<ul>\n<li><strong>With the Branch:</strong> There is a huge difference between the sorted and unsorted data.</li>\n<li><strong>With the Hack:</strong> There is no difference between sorted and unsorted data.</li>\n<li>In the C++ case, the hack is actually a tad slower than with the branch when the data is sorted.</li>\n</ul>\n<p>A general rule of thumb is to avoid data-dependent branching in critical loops (such as in this example).</p>\n<hr />\n<p><strong>Update:</strong></p>\n<ul>\n<li><p>GCC 4.6.1 with <code>-O3</code> or <code>-ftree-vectorize</code> on x64 is able to generate a conditional move, so there is no difference between the sorted and unsorted data - both are fast.</p>\n<p>(Or somewhat fast: for the already-sorted case, <code>cmov</code> can be slower especially if GCC puts it on the critical path instead of just <code>add</code>, especially on Intel before Broadwell where <code>cmov</code> has 2 cycle latency: <a href=\"https://stackoverflow.com/questions/28875325/gcc-optimization-flag-o3-makes-code-slower-than-o2\">gcc optimization flag -O3 makes code slower than -O2</a>)</p>\n</li>\n<li><p>VC++ 2010 is unable to generate conditional moves for this branch even under <code>/Ox</code>.</p>\n</li>\n<li><p><a href=\"https://en.wikipedia.org/wiki/Intel_C++_Compiler\" rel=\"noreferrer\">Intel C++ Compiler</a> (ICC) 11 does something miraculous. It <a href=\"https://en.wikipedia.org/wiki/Loop_interchange\" rel=\"noreferrer\">interchanges the two loops</a>, thereby hoisting the unpredictable branch to the outer loop. Not only is it immune to the mispredictions, it's also twice as fast as whatever VC++ and GCC can generate! In other words, ICC took advantage of the test-loop to defeat the benchmark...</p>\n</li>\n<li><p>If you give the Intel compiler the branchless code, it just outright vectorizes it... and is just as fast as with the branch (with the loop interchange).</p>\n</li>\n</ul>\n<p>This goes to show that even mature modern compilers can vary wildly in their ability to optimize code...</p>\n"},{"comments":[{"owner":{"account_id":4865795,"reputation":496,"user_id":3924108,"display_name":"Linus Fernandes"},"score":10,"creation_date":1606973524,"post_id":11237235,"comment_id":115127186,"body_markdown":"https://stackoverflow.com/questions/9745389/is-the-ternary-operator-faster-than-an-if-condition-in-java","body":"<a href=\"https://stackoverflow.com/questions/9745389/is-the-ternary-operator-faster-than-an-if-condition-in-java\" title=\"is the ternary operator faster than an if condition in java\">stackoverflow.com/questions/9745389/&hellip;</a>"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":3,"creation_date":1656882316,"post_id":11237235,"comment_id":128673830,"body_markdown":"You forgot to enable optimization; it&#39;s not useful to benchmark debug builds that [store/reload everything to the stack](https://stackoverflow.com/questions/53366394/why-does-clang-produce-inefficient-asm-with-o0-for-this-simple-floating-point).  Use `gcc -O2 -fno-tree-vectorize -S` if you want efficient scalar asm that hopefully uses cmov.  (`-O3` would probably auto-vectorize, so would `-O2` with GCC12 or later.)  See also [gcc optimization flag -O3 makes code slower than -O2](https://stackoverflow.com/q/28875325) (for the sorted case, when it uses cmov poorly for the `if`).","body":"You forgot to enable optimization; it&#39;s not useful to benchmark debug builds that <a href=\"https://stackoverflow.com/questions/53366394/why-does-clang-produce-inefficient-asm-with-o0-for-this-simple-floating-point\">store/reload everything to the stack</a>.  Use <code>gcc -O2 -fno-tree-vectorize -S</code> if you want efficient scalar asm that hopefully uses cmov.  (<code>-O3</code> would probably auto-vectorize, so would <code>-O2</code> with GCC12 or later.)  See also <a href=\"https://stackoverflow.com/q/28875325\">gcc optimization flag -O3 makes code slower than -O2</a> (for the sorted case, when it uses cmov poorly for the <code>if</code>)."}],"tags":[],"owner":{"account_id":463679,"reputation":47287,"user_id":866732,"accept_rate":88,"display_name":"WiSaGaN"},"comment_count":2,"down_vote_count":13,"up_vote_count":3814,"is_accepted":false,"score":3801,"last_activity_date":1656861172,"creation_date":1340849643,"answer_id":11237235,"question_id":11227809,"body_markdown":"The reason why performance improves drastically when the data is sorted is that the branch prediction penalty is removed, as explained beautifully in [Mysticial&#39;s answer][1].\r\n\r\nNow, if we look at the code\r\n\r\n\tif (data[c] &gt;= 128)\r\n\t\tsum += data[c];\r\n\r\nwe can find that the meaning of this particular `if... else...` branch is to add something when a condition is satisfied. This type of branch can be easily transformed into a **conditional move** statement, which would be compiled into a conditional move instruction: `cmovl`, in an `x86` system. The branch and thus the potential branch prediction penalty is removed.\r\n\r\nIn `C`, thus `C++`, the statement, which would compile directly (without any optimization) into the conditional move instruction in `x86`, is the ternary operator `... ? ... : ...`. So we rewrite the above statement into an equivalent one:\r\n\r\n\tsum += data[c] &gt;=128 ? data[c] : 0;\r\n\r\nWhile maintaining readability, we can check the speedup factor.\r\n\r\nOn an Intel [Core i7][2]-2600K @ 3.4&amp;nbsp;GHz and Visual Studio 2010 Release Mode, the benchmark is:\r\n\r\n**x86**\r\n\r\n|Scenario|Time (seconds)|\r\n|---|---|\r\n|Branching - Random data|8.885|\r\n|Branching - Sorted data|1.528|\r\n|Branchless - Random data|3.716|\r\n|Branchless - Sorted data|3.71|\r\n\r\n**x64**\r\n\r\n|Scenario|Time (seconds)|\r\n|---|---|\r\n|Branching - Random data|11.302|\r\n|Branching - Sorted data|1.830|\r\n|Branchless - Random data|2.736|\r\n|Branchless - Sorted data|2.737|\r\n\r\nThe result is robust in multiple tests. We get a great speedup when the branch result is unpredictable, but we suffer a little bit when it is predictable. In fact, when using a conditional move, the performance is the same regardless of the data pattern.\r\n\r\nNow let&#39;s look more closely by investigating the `x86` assembly they generate. For simplicity, we use two functions `max1` and `max2`.\r\n\r\n`max1` uses the conditional branch `if... else ...`:\r\n```\r\nint max1(int a, int b) {\r\n\tif (a &gt; b)\r\n\t\treturn a;\r\n\telse\r\n\t\treturn b;\r\n}\r\n```\r\n\r\n`max2` uses the ternary operator `... ? ... : ...`:\r\n```\r\nint max2(int a, int b) {\r\n\treturn a &gt; b ? a : b;\r\n}\r\n```\r\n\r\nOn an x86-64 machine, `GCC -S` generates the assembly below.\r\n```\r\n:max1\r\n\tmovl    %edi, -4(%rbp)\r\n\tmovl    %esi, -8(%rbp)\r\n\tmovl    -4(%rbp), %eax\r\n\tcmpl    -8(%rbp), %eax\r\n\tjle     .L2\r\n\tmovl    -4(%rbp), %eax\r\n\tmovl    %eax, -12(%rbp)\r\n\tjmp     .L4\r\n.L2:\r\n\tmovl    -8(%rbp), %eax\r\n\tmovl    %eax, -12(%rbp)\r\n.L4:\r\n\tmovl    -12(%rbp), %eax\r\n\tleave\r\n\tret\r\n\r\n:max2\r\n\tmovl    %edi, -4(%rbp)\r\n\tmovl    %esi, -8(%rbp)\r\n\tmovl    -4(%rbp), %eax\r\n\tcmpl    %eax, -8(%rbp)\r\n\tcmovge  -8(%rbp), %eax\r\n\tleave\r\n\tret\r\n```\r\n\r\n`max2` uses much less code due to the usage of instruction `cmovge`. But the real gain is that `max2` does not involve branch jumps, `jmp`, which would have a significant performance penalty if the predicted result is not right.\r\n\r\nSo why does a conditional move perform better?\r\n\r\nIn a typical `x86` processor, the execution of an instruction is divided into several stages. Roughly, we have different hardware to deal with different stages. So we do not have to wait for one instruction to finish to start a new one. This is called **[pipelining][3]**.\r\n\r\nIn a branch case, the following instruction is determined by the preceding one, so we cannot do pipelining. We have to either wait or predict.\r\n\r\nIn a conditional move case, the execution of conditional move instruction is divided into several stages, but the earlier stages like `Fetch` and `Decode` do not depend on the result of the previous instruction; only the latter stages need the result. Thus, we wait a fraction of one instruction&#39;s execution time. This is why the conditional move version is slower than the branch when the prediction is easy.\r\n\r\nThe book *[Computer Systems: A Programmer&#39;s Perspective, second edition][4]* explains this in detail. You can check Section 3.6.6 for *Conditional Move Instructions*, entire Chapter 4 for *Processor Architecture*, and Section 5.11.2 for special treatment for *Branch Prediction and Misprediction Penalties*.\r\n\r\nSometimes, some modern compilers can optimize our code to assembly with better performance, and sometimes some compilers can&#39;t (the code in question is using Visual Studio&#39;s native compiler). Knowing the performance difference between a branch and a conditional move when unpredictable can help us write code with better performance when the scenario gets so complex that the compiler can not optimize them automatically.\r\n\r\n [1]: //stackoverflow.com/questions/11227809/why-is-it-faster-to-process-a-sorted-array-than-an-unsorted-array/11227902#11227902\r\n [2]: //en.wikipedia.org/wiki/Intel_Core#Core_i7\r\n [3]: //en.wikipedia.org/wiki/Pipeline_(computing)\r\n [4]: //www.amazon.com/Computer-Systems-Programmers-Perspective-Edition/dp/0136108040/","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>The reason why performance improves drastically when the data is sorted is that the branch prediction penalty is removed, as explained beautifully in <a href=\"//stackoverflow.com/questions/11227809/why-is-it-faster-to-process-a-sorted-array-than-an-unsorted-array/11227902#11227902\">Mysticial's answer</a>.</p>\n<p>Now, if we look at the code</p>\n<pre><code>if (data[c] &gt;= 128)\n    sum += data[c];\n</code></pre>\n<p>we can find that the meaning of this particular <code>if... else...</code> branch is to add something when a condition is satisfied. This type of branch can be easily transformed into a <strong>conditional move</strong> statement, which would be compiled into a conditional move instruction: <code>cmovl</code>, in an <code>x86</code> system. The branch and thus the potential branch prediction penalty is removed.</p>\n<p>In <code>C</code>, thus <code>C++</code>, the statement, which would compile directly (without any optimization) into the conditional move instruction in <code>x86</code>, is the ternary operator <code>... ? ... : ...</code>. So we rewrite the above statement into an equivalent one:</p>\n<pre><code>sum += data[c] &gt;=128 ? data[c] : 0;\n</code></pre>\n<p>While maintaining readability, we can check the speedup factor.</p>\n<p>On an Intel <a href=\"//en.wikipedia.org/wiki/Intel_Core#Core_i7\" rel=\"noreferrer\">Core i7</a>-2600K @ 3.4 GHz and Visual Studio 2010 Release Mode, the benchmark is:</p>\n<p><strong>x86</strong></p>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Scenario</th>\n<th>Time (seconds)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Branching - Random data</td>\n<td>8.885</td>\n</tr>\n<tr>\n<td>Branching - Sorted data</td>\n<td>1.528</td>\n</tr>\n<tr>\n<td>Branchless - Random data</td>\n<td>3.716</td>\n</tr>\n<tr>\n<td>Branchless - Sorted data</td>\n<td>3.71</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p><strong>x64</strong></p>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Scenario</th>\n<th>Time (seconds)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Branching - Random data</td>\n<td>11.302</td>\n</tr>\n<tr>\n<td>Branching - Sorted data</td>\n<td>1.830</td>\n</tr>\n<tr>\n<td>Branchless - Random data</td>\n<td>2.736</td>\n</tr>\n<tr>\n<td>Branchless - Sorted data</td>\n<td>2.737</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>The result is robust in multiple tests. We get a great speedup when the branch result is unpredictable, but we suffer a little bit when it is predictable. In fact, when using a conditional move, the performance is the same regardless of the data pattern.</p>\n<p>Now let's look more closely by investigating the <code>x86</code> assembly they generate. For simplicity, we use two functions <code>max1</code> and <code>max2</code>.</p>\n<p><code>max1</code> uses the conditional branch <code>if... else ...</code>:</p>\n<pre><code>int max1(int a, int b) {\n    if (a &gt; b)\n        return a;\n    else\n        return b;\n}\n</code></pre>\n<p><code>max2</code> uses the ternary operator <code>... ? ... : ...</code>:</p>\n<pre><code>int max2(int a, int b) {\n    return a &gt; b ? a : b;\n}\n</code></pre>\n<p>On an x86-64 machine, <code>GCC -S</code> generates the assembly below.</p>\n<pre><code>:max1\n    movl    %edi, -4(%rbp)\n    movl    %esi, -8(%rbp)\n    movl    -4(%rbp), %eax\n    cmpl    -8(%rbp), %eax\n    jle     .L2\n    movl    -4(%rbp), %eax\n    movl    %eax, -12(%rbp)\n    jmp     .L4\n.L2:\n    movl    -8(%rbp), %eax\n    movl    %eax, -12(%rbp)\n.L4:\n    movl    -12(%rbp), %eax\n    leave\n    ret\n\n:max2\n    movl    %edi, -4(%rbp)\n    movl    %esi, -8(%rbp)\n    movl    -4(%rbp), %eax\n    cmpl    %eax, -8(%rbp)\n    cmovge  -8(%rbp), %eax\n    leave\n    ret\n</code></pre>\n<p><code>max2</code> uses much less code due to the usage of instruction <code>cmovge</code>. But the real gain is that <code>max2</code> does not involve branch jumps, <code>jmp</code>, which would have a significant performance penalty if the predicted result is not right.</p>\n<p>So why does a conditional move perform better?</p>\n<p>In a typical <code>x86</code> processor, the execution of an instruction is divided into several stages. Roughly, we have different hardware to deal with different stages. So we do not have to wait for one instruction to finish to start a new one. This is called <strong><a href=\"//en.wikipedia.org/wiki/Pipeline_(computing)\" rel=\"noreferrer\">pipelining</a></strong>.</p>\n<p>In a branch case, the following instruction is determined by the preceding one, so we cannot do pipelining. We have to either wait or predict.</p>\n<p>In a conditional move case, the execution of conditional move instruction is divided into several stages, but the earlier stages like <code>Fetch</code> and <code>Decode</code> do not depend on the result of the previous instruction; only the latter stages need the result. Thus, we wait a fraction of one instruction's execution time. This is why the conditional move version is slower than the branch when the prediction is easy.</p>\n<p>The book <em><a href=\"https://rads.stackoverflow.com/amzn/click/com/0136108040\" rel=\"noreferrer\" rel=\"nofollow noreferrer\">Computer Systems: A Programmer's Perspective, second edition</a></em> explains this in detail. You can check Section 3.6.6 for <em>Conditional Move Instructions</em>, entire Chapter 4 for <em>Processor Architecture</em>, and Section 5.11.2 for special treatment for <em>Branch Prediction and Misprediction Penalties</em>.</p>\n<p>Sometimes, some modern compilers can optimize our code to assembly with better performance, and sometimes some compilers can't (the code in question is using Visual Studio's native compiler). Knowing the performance difference between a branch and a conditional move when unpredictable can help us write code with better performance when the scenario gets so complex that the compiler can not optimize them automatically.</p>\n"},{"comments":[{"owner":{"account_id":1167854,"reputation":1906,"user_id":4969945,"accept_rate":11,"display_name":"cpcallen"},"score":14,"creation_date":1665494013,"post_id":11303693,"comment_id":130709739,"body_markdown":"This is delightful, but for anyone who might not understand the joke: the purpose of the `for (unsigned i = 0; i &lt; 100000; ++i)` in the original code is to run the code being benchmarked many times so as to be able to more accurately measure the time taken to execute it—measurements that would otherwise be compromised by limited timer resolution and/or jitter caused by other processes (including the OS) unpredictably preempting this one.  It is true that the benchmarked code does take much, _much_ less time to execute if you run it only once!","body":"This is delightful, but for anyone who might not understand the joke: the purpose of the <code>for (unsigned i = 0; i &lt; 100000; ++i)</code> in the original code is to run the code being benchmarked many times so as to be able to more accurately measure the time taken to execute it—measurements that would otherwise be compromised by limited timer resolution and/or jitter caused by other processes (including the OS) unpredictably preempting this one.  It is true that the benchmarked code does take much, <i>much</i> less time to execute if you run it only once!"}],"tags":[],"owner":{"account_id":461945,"reputation":32882,"user_id":863980,"accept_rate":83,"display_name":"vulcan raven"},"comment_count":1,"down_vote_count":27,"up_vote_count":2639,"is_accepted":false,"score":2612,"last_activity_date":1558961493,"creation_date":1341282330,"answer_id":11303693,"question_id":11227809,"body_markdown":"If you are curious about even more optimizations that can be done to this code, consider this:\r\n\r\nStarting with the original loop:\r\n\r\n    for (unsigned i = 0; i &lt; 100000; ++i)\r\n    {\r\n        for (unsigned j = 0; j &lt; arraySize; ++j)\r\n        {\r\n            if (data[j] &gt;= 128)\r\n                sum += data[j];\r\n        }\r\n    }\r\n\r\nWith loop interchange, we can safely change this loop to:\r\n\r\n    for (unsigned j = 0; j &lt; arraySize; ++j)\r\n    {\r\n        for (unsigned i = 0; i &lt; 100000; ++i)\r\n        {\r\n            if (data[j] &gt;= 128)\r\n                sum += data[j];\r\n        }\r\n    }\r\n\r\nThen, you can see that the `if` conditional is constant throughout the execution of the `i` loop, so you can hoist the `if` out:\r\n\r\n    for (unsigned j = 0; j &lt; arraySize; ++j)\r\n    {\r\n        if (data[j] &gt;= 128)\r\n        {\r\n            for (unsigned i = 0; i &lt; 100000; ++i)\r\n            {\r\n                sum += data[j];\r\n            }\r\n        }\r\n    }\r\n\r\nThen, you see that the inner loop can be collapsed into one single expression, assuming the floating point model allows it (`/fp:fast` is thrown, for example)\r\n\r\n    for (unsigned j = 0; j &lt; arraySize; ++j)\r\n    {\r\n        if (data[j] &gt;= 128)\r\n        {\r\n            sum += data[j] * 100000;\r\n        }\r\n    }\r\n\r\nThat one is 100,000 times faster than before.\r\n","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>If you are curious about even more optimizations that can be done to this code, consider this:</p>\n\n<p>Starting with the original loop:</p>\n\n<pre><code>for (unsigned i = 0; i &lt; 100000; ++i)\n{\n    for (unsigned j = 0; j &lt; arraySize; ++j)\n    {\n        if (data[j] &gt;= 128)\n            sum += data[j];\n    }\n}\n</code></pre>\n\n<p>With loop interchange, we can safely change this loop to:</p>\n\n<pre><code>for (unsigned j = 0; j &lt; arraySize; ++j)\n{\n    for (unsigned i = 0; i &lt; 100000; ++i)\n    {\n        if (data[j] &gt;= 128)\n            sum += data[j];\n    }\n}\n</code></pre>\n\n<p>Then, you can see that the <code>if</code> conditional is constant throughout the execution of the <code>i</code> loop, so you can hoist the <code>if</code> out:</p>\n\n<pre><code>for (unsigned j = 0; j &lt; arraySize; ++j)\n{\n    if (data[j] &gt;= 128)\n    {\n        for (unsigned i = 0; i &lt; 100000; ++i)\n        {\n            sum += data[j];\n        }\n    }\n}\n</code></pre>\n\n<p>Then, you see that the inner loop can be collapsed into one single expression, assuming the floating point model allows it (<code>/fp:fast</code> is thrown, for example)</p>\n\n<pre><code>for (unsigned j = 0; j &lt; arraySize; ++j)\n{\n    if (data[j] &gt;= 128)\n    {\n        sum += data[j] * 100000;\n    }\n}\n</code></pre>\n\n<p>That one is 100,000 times faster than before.</p>\n"},{"comments":[{"owner":{"account_id":2768667,"reputation":1230,"user_id":2383730,"accept_rate":83,"display_name":"TallBrianL"},"score":102,"creation_date":1386561609,"post_id":12853037,"comment_id":30576818,"body_markdown":"This is scary, in the unsorted list, there should be 50% chance of hitting the add.  Somehow the branch prediction only has a 25% miss rate, how can it do better than 50% miss?","body":"This is scary, in the unsorted list, there should be 50% chance of hitting the add.  Somehow the branch prediction only has a 25% miss rate, how can it do better than 50% miss?"},{"owner":{"account_id":45644,"reputation":234661,"user_id":134633,"display_name":"caf"},"score":171,"creation_date":1386563365,"post_id":12853037,"comment_id":30577316,"body_markdown":"@tall.b.lo: The 25% is of all branches - there are *two* branches in the loop, one for `data[c] &gt;= 128` (which has a 50% miss rate as you suggest) and one for the loop condition `c &lt; arraySize` which has ~0% miss rate.","body":"@tall.b.lo: The 25% is of all branches - there are <i>two</i> branches in the loop, one for <code>data[c] &gt;= 128</code> (which has a 50% miss rate as you suggest) and one for the loop condition <code>c &lt; arraySize</code> which has ~0% miss rate."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":6,"creation_date":1650519074,"post_id":12853037,"comment_id":127137494,"body_markdown":"Note that benchmarking / profiling un-optimized (&quot;debug mode&quot;) code is normally a bad idea.  With optimization, that version without branch misses would be faster by a much larger margin, not stalling on store/reload latency for local variables.  The actual branch mispredict rate for the critical branch should be about the same, though (assuming there is one: modern compilers can [vectorize this](https://stackoverflow.com/q/66521344) or otherwise make branchless asm).  Loop unrolling could change the overall miss rate by running a predictable loop branch less often.","body":"Note that benchmarking / profiling un-optimized (&quot;debug mode&quot;) code is normally a bad idea.  With optimization, that version without branch misses would be faster by a much larger margin, not stalling on store/reload latency for local variables.  The actual branch mispredict rate for the critical branch should be about the same, though (assuming there is one: modern compilers can <a href=\"https://stackoverflow.com/q/66521344\">vectorize this</a> or otherwise make branchless asm).  Loop unrolling could change the overall miss rate by running a predictable loop branch less often."}],"tags":[],"owner":{"account_id":45644,"reputation":234661,"user_id":134633,"display_name":"caf"},"comment_count":3,"down_vote_count":4,"up_vote_count":2167,"is_accepted":false,"score":2163,"last_activity_date":1350588021,"creation_date":1350021213,"answer_id":12853037,"question_id":11227809,"body_markdown":"No doubt some of us would be interested in ways of identifying code that is problematic for the CPU&#39;s branch-predictor. The Valgrind tool `cachegrind` has a branch-predictor simulator, enabled by using the `--branch-sim=yes` flag. Running it over the examples in this question, with the number of outer loops reduced to 10000 and compiled with `g++`, gives these results:\r\n\r\n**Sorted:**\r\n\r\n    ==32551== Branches:        656,645,130  (  656,609,208 cond +    35,922 ind)\r\n    ==32551== Mispredicts:         169,556  (      169,095 cond +       461 ind)\r\n    ==32551== Mispred rate:            0.0% (          0.0%     +       1.2%   )\r\n\r\n**Unsorted:**\r\n\r\n    ==32555== Branches:        655,996,082  (  655,960,160 cond +  35,922 ind)\r\n    ==32555== Mispredicts:     164,073,152  (  164,072,692 cond +     460 ind)\r\n    ==32555== Mispred rate:           25.0% (         25.0%     +     1.2%   )\r\n\r\nDrilling down into the line-by-line output produced by `cg_annotate` we see for the loop in question:\r\n\r\n**Sorted:**\r\n\r\n              Bc    Bcm Bi Bim\r\n          10,001      4  0   0      for (unsigned i = 0; i &lt; 10000; ++i)\r\n               .      .  .   .      {\r\n               .      .  .   .          // primary loop\r\n     327,690,000 10,016  0   0          for (unsigned c = 0; c &lt; arraySize; ++c)\r\n               .      .  .   .          {\r\n     327,680,000 10,006  0   0              if (data[c] &gt;= 128)\r\n               0      0  0   0                  sum += data[c];\r\n               .      .  .   .          }\r\n               .      .  .   .      }\r\n\r\n**Unsorted:**\r\n\r\n              Bc         Bcm Bi Bim\r\n          10,001           4  0   0      for (unsigned i = 0; i &lt; 10000; ++i)\r\n               .           .  .   .      {\r\n               .           .  .   .          // primary loop\r\n     327,690,000      10,038  0   0          for (unsigned c = 0; c &lt; arraySize; ++c)\r\n               .           .  .   .          {\r\n     327,680,000 164,050,007  0   0              if (data[c] &gt;= 128)\r\n               0           0  0   0                  sum += data[c];\r\n               .           .  .   .          }\r\n               .           .  .   .      }\r\n\r\nThis lets you easily identify the problematic line - in the unsorted version the `if (data[c] &gt;= 128)` line is causing 164,050,007 mispredicted conditional branches (`Bcm`) under cachegrind&#39;s branch-predictor model, whereas it&#39;s only causing 10,006 in the sorted version.\r\n\r\n----------\r\n\r\nAlternatively, on Linux you can use the performance counters subsystem to accomplish the same task, but with native performance using CPU counters.\r\n\r\n    perf stat ./sumtest_sorted\r\n\r\n**Sorted:**\r\n\r\n     Performance counter stats for &#39;./sumtest_sorted&#39;:\r\n\r\n      11808.095776 task-clock                #    0.998 CPUs utilized          \r\n             1,062 context-switches          #    0.090 K/sec                  \r\n                14 CPU-migrations            #    0.001 K/sec                  \r\n               337 page-faults               #    0.029 K/sec                  \r\n    26,487,882,764 cycles                    #    2.243 GHz                    \r\n    41,025,654,322 instructions              #    1.55  insns per cycle        \r\n     6,558,871,379 branches                  #  555.455 M/sec                  \r\n           567,204 branch-misses             #    0.01% of all branches        \r\n\r\n      11.827228330 seconds time elapsed\r\n\r\n**Unsorted:**\r\n\r\n     Performance counter stats for &#39;./sumtest_unsorted&#39;:\r\n\r\n      28877.954344 task-clock                #    0.998 CPUs utilized          \r\n             2,584 context-switches          #    0.089 K/sec                  \r\n                18 CPU-migrations            #    0.001 K/sec                  \r\n               335 page-faults               #    0.012 K/sec                  \r\n    65,076,127,595 cycles                    #    2.253 GHz                    \r\n    41,032,528,741 instructions              #    0.63  insns per cycle        \r\n     6,560,579,013 branches                  #  227.183 M/sec                  \r\n     1,646,394,749 branch-misses             #   25.10% of all branches        \r\n\r\n      28.935500947 seconds time elapsed\r\n\r\nIt can also do source code annotation with dissassembly.\r\n\r\n    perf record -e branch-misses ./sumtest_unsorted\r\n    perf annotate -d sumtest_unsorted\r\n&lt;div&gt;&lt;/div&gt;\r\n     Percent |      Source code &amp; Disassembly of sumtest_unsorted\r\n    ------------------------------------------------\r\n    ...\r\n             :                      sum += data[c];\r\n        0.00 :        400a1a:       mov    -0x14(%rbp),%eax\r\n       39.97 :        400a1d:       mov    %eax,%eax\r\n        5.31 :        400a1f:       mov    -0x20040(%rbp,%rax,4),%eax\r\n        4.60 :        400a26:       cltq   \r\n        0.00 :        400a28:       add    %rax,-0x30(%rbp)\r\n    ...\r\n\r\nSee [the performance tutorial][1] for more details.\r\n\r\n  [1]: https://perf.wiki.kernel.org/index.php/Tutorial\r\n","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>No doubt some of us would be interested in ways of identifying code that is problematic for the CPU's branch-predictor. The Valgrind tool <code>cachegrind</code> has a branch-predictor simulator, enabled by using the <code>--branch-sim=yes</code> flag. Running it over the examples in this question, with the number of outer loops reduced to 10000 and compiled with <code>g++</code>, gives these results:</p>\n\n<p><strong>Sorted:</strong></p>\n\n<pre><code>==32551== Branches:        656,645,130  (  656,609,208 cond +    35,922 ind)\n==32551== Mispredicts:         169,556  (      169,095 cond +       461 ind)\n==32551== Mispred rate:            0.0% (          0.0%     +       1.2%   )\n</code></pre>\n\n<p><strong>Unsorted:</strong></p>\n\n<pre><code>==32555== Branches:        655,996,082  (  655,960,160 cond +  35,922 ind)\n==32555== Mispredicts:     164,073,152  (  164,072,692 cond +     460 ind)\n==32555== Mispred rate:           25.0% (         25.0%     +     1.2%   )\n</code></pre>\n\n<p>Drilling down into the line-by-line output produced by <code>cg_annotate</code> we see for the loop in question:</p>\n\n<p><strong>Sorted:</strong></p>\n\n<pre><code>          Bc    Bcm Bi Bim\n      10,001      4  0   0      for (unsigned i = 0; i &lt; 10000; ++i)\n           .      .  .   .      {\n           .      .  .   .          // primary loop\n 327,690,000 10,016  0   0          for (unsigned c = 0; c &lt; arraySize; ++c)\n           .      .  .   .          {\n 327,680,000 10,006  0   0              if (data[c] &gt;= 128)\n           0      0  0   0                  sum += data[c];\n           .      .  .   .          }\n           .      .  .   .      }\n</code></pre>\n\n<p><strong>Unsorted:</strong></p>\n\n<pre><code>          Bc         Bcm Bi Bim\n      10,001           4  0   0      for (unsigned i = 0; i &lt; 10000; ++i)\n           .           .  .   .      {\n           .           .  .   .          // primary loop\n 327,690,000      10,038  0   0          for (unsigned c = 0; c &lt; arraySize; ++c)\n           .           .  .   .          {\n 327,680,000 164,050,007  0   0              if (data[c] &gt;= 128)\n           0           0  0   0                  sum += data[c];\n           .           .  .   .          }\n           .           .  .   .      }\n</code></pre>\n\n<p>This lets you easily identify the problematic line - in the unsorted version the <code>if (data[c] &gt;= 128)</code> line is causing 164,050,007 mispredicted conditional branches (<code>Bcm</code>) under cachegrind's branch-predictor model, whereas it's only causing 10,006 in the sorted version.</p>\n\n<hr>\n\n<p>Alternatively, on Linux you can use the performance counters subsystem to accomplish the same task, but with native performance using CPU counters.</p>\n\n<pre><code>perf stat ./sumtest_sorted\n</code></pre>\n\n<p><strong>Sorted:</strong></p>\n\n<pre><code> Performance counter stats for './sumtest_sorted':\n\n  11808.095776 task-clock                #    0.998 CPUs utilized          \n         1,062 context-switches          #    0.090 K/sec                  \n            14 CPU-migrations            #    0.001 K/sec                  \n           337 page-faults               #    0.029 K/sec                  \n26,487,882,764 cycles                    #    2.243 GHz                    \n41,025,654,322 instructions              #    1.55  insns per cycle        \n 6,558,871,379 branches                  #  555.455 M/sec                  \n       567,204 branch-misses             #    0.01% of all branches        \n\n  11.827228330 seconds time elapsed\n</code></pre>\n\n<p><strong>Unsorted:</strong></p>\n\n<pre><code> Performance counter stats for './sumtest_unsorted':\n\n  28877.954344 task-clock                #    0.998 CPUs utilized          \n         2,584 context-switches          #    0.089 K/sec                  \n            18 CPU-migrations            #    0.001 K/sec                  \n           335 page-faults               #    0.012 K/sec                  \n65,076,127,595 cycles                    #    2.253 GHz                    \n41,032,528,741 instructions              #    0.63  insns per cycle        \n 6,560,579,013 branches                  #  227.183 M/sec                  \n 1,646,394,749 branch-misses             #   25.10% of all branches        \n\n  28.935500947 seconds time elapsed\n</code></pre>\n\n<p>It can also do source code annotation with dissassembly.</p>\n\n<pre><code>perf record -e branch-misses ./sumtest_unsorted\nperf annotate -d sumtest_unsorted\n</code></pre>\n\n\n\n<pre><code> Percent |      Source code &amp; Disassembly of sumtest_unsorted\n------------------------------------------------\n...\n         :                      sum += data[c];\n    0.00 :        400a1a:       mov    -0x14(%rbp),%eax\n   39.97 :        400a1d:       mov    %eax,%eax\n    5.31 :        400a1f:       mov    -0x20040(%rbp,%rax,4),%eax\n    4.60 :        400a26:       cltq   \n    0.00 :        400a28:       add    %rax,-0x30(%rbp)\n...\n</code></pre>\n\n<p>See <a href=\"https://perf.wiki.kernel.org/index.php/Tutorial\" rel=\"noreferrer\">the performance tutorial</a> for more details.</p>\n"},{"comments":[{"owner":{"account_id":102248,"reputation":7823,"user_id":274579,"accept_rate":61,"display_name":"ysap"},"score":9,"creation_date":1368820380,"post_id":14092288,"comment_id":23890444,"body_markdown":"Just for the sake of completeness, this is probably not how you&#39;d implement that in Matlab. I bet it&#39;d be much faster if done after vectorizing the problem.","body":"Just for the sake of completeness, this is probably not how you&#39;d implement that in Matlab. I bet it&#39;d be much faster if done after vectorizing the problem."},{"owner":{"account_id":1006540,"reputation":5112,"user_id":1020149,"accept_rate":21,"display_name":"Shan"},"score":2,"creation_date":1368834624,"post_id":14092288,"comment_id":23895018,"body_markdown":"Matlab does automatic parallelization / vectorization in many situations but the issue here is to check the effect of branch prediction. Matlab is not immune in anyway!","body":"Matlab does automatic parallelization / vectorization in many situations but the issue here is to check the effect of branch prediction. Matlab is not immune in anyway!"},{"owner":{"account_id":21994,"reputation":73808,"user_id":53897,"accept_rate":56,"display_name":"Thorbj&#248;rn Ravn Andersen"},"score":2,"creation_date":1377362072,"post_id":14092288,"comment_id":27061346,"body_markdown":"Does matlab use native numbers or a mat lab specific implementation (infinite amount of digits or so?)","body":"Does matlab use native numbers or a mat lab specific implementation (infinite amount of digits or so?)"}],"tags":[],"owner":{"account_id":1006540,"reputation":5112,"user_id":1020149,"accept_rate":21,"display_name":"Shan"},"comment_count":3,"down_vote_count":2,"up_vote_count":188,"is_accepted":false,"score":186,"last_activity_date":1521204334,"creation_date":1356884206,"answer_id":14092288,"question_id":11227809,"body_markdown":"I tried the same code with MATLAB 2011b with my MacBook Pro (Intel i7, 64 bit, 2.4 GHz) for the following MATLAB code:\r\n\r\n    % Processing time with Sorted data vs unsorted data\r\n    %==========================================================================\r\n    % Generate data\r\n    arraySize = 32768\r\n    sum = 0;\r\n    % Generate random integer data from range 0 to 255\r\n    data = randi(256, arraySize, 1);\r\n\r\n\r\n    %Sort the data\r\n    data1= sort(data); % data1= data  when no sorting done\r\n\r\n\r\n    %Start a stopwatch timer to measure the execution time\r\n    tic;\r\n\r\n    for i=1:100000\r\n\r\n        for j=1:arraySize\r\n\r\n            if data1(j)&gt;=128\r\n                sum=sum + data1(j);\r\n            end\r\n        end\r\n    end\r\n\r\n    toc;\r\n\r\n    ExeTimeWithSorting = toc - tic;\r\n\r\n\r\nThe results for the above MATLAB code are as follows:\r\n\r\n      a: Elapsed time (without sorting) = 3479.880861 seconds.\r\n      b: Elapsed time (with sorting ) = 2377.873098 seconds.\r\n\r\nThe results of the C code as in @GManNickG I get:\r\n\r\n      a: Elapsed time (without sorting) = 19.8761 sec.\r\n      b: Elapsed time (with sorting ) = 7.37778 sec.\r\n\r\nBased on this, it looks MATLAB is almost *175 times* slower than the C implementation without sorting and *350 times* slower with sorting. In other words, the effect (of branch prediction) is *1.46x* for MATLAB implementation and *2.7x* for the C implementation.\r\n","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>I tried the same code with MATLAB 2011b with my MacBook Pro (Intel i7, 64 bit, 2.4 GHz) for the following MATLAB code:</p>\n\n<pre><code>% Processing time with Sorted data vs unsorted data\n%==========================================================================\n% Generate data\narraySize = 32768\nsum = 0;\n% Generate random integer data from range 0 to 255\ndata = randi(256, arraySize, 1);\n\n\n%Sort the data\ndata1= sort(data); % data1= data  when no sorting done\n\n\n%Start a stopwatch timer to measure the execution time\ntic;\n\nfor i=1:100000\n\n    for j=1:arraySize\n\n        if data1(j)&gt;=128\n            sum=sum + data1(j);\n        end\n    end\nend\n\ntoc;\n\nExeTimeWithSorting = toc - tic;\n</code></pre>\n\n<p>The results for the above MATLAB code are as follows:</p>\n\n<pre><code>  a: Elapsed time (without sorting) = 3479.880861 seconds.\n  b: Elapsed time (with sorting ) = 2377.873098 seconds.\n</code></pre>\n\n<p>The results of the C code as in @GManNickG I get:</p>\n\n<pre><code>  a: Elapsed time (without sorting) = 19.8761 sec.\n  b: Elapsed time (with sorting ) = 7.37778 sec.\n</code></pre>\n\n<p>Based on this, it looks MATLAB is almost <em>175 times</em> slower than the C implementation without sorting and <em>350 times</em> slower with sorting. In other words, the effect (of branch prediction) is <em>1.46x</em> for MATLAB implementation and <em>2.7x</em> for the C implementation.</p>\n"},{"comments":[{"owner":{"account_id":5024623,"reputation":3851,"user_id":4037019,"accept_rate":100,"display_name":"cst1992"},"score":52,"creation_date":1459169931,"post_id":14889969,"comment_id":60153643,"body_markdown":"@MooingDuck &#39;Cause it won&#39;t make a difference - that value can be anything, but it still will be in the bounds of these thresholds. So why show a random value when you already know the limits? Although I agree that you could show one for the sake of completeness, and &#39;just for the heck of it&#39;.","body":"@MooingDuck &#39;Cause it won&#39;t make a difference - that value can be anything, but it still will be in the bounds of these thresholds. So why show a random value when you already know the limits? Although I agree that you could show one for the sake of completeness, and &#39;just for the heck of it&#39;."},{"owner":{"account_id":449991,"reputation":65003,"user_id":845092,"accept_rate":93,"display_name":"Mooing Duck"},"score":53,"creation_date":1459189636,"post_id":14889969,"comment_id":60164274,"body_markdown":"@cst1992: Right now his slowest timing is TTFFTTFFTTFF, which seems, to my human eye, quite predictable. Random is inherently unpredictable, so it&#39;s entirely possible it would be slower still, and thus outside the limits shown here.  OTOH, it could be that TTFFTTFF perfectly hits the pathological case.  Can&#39;t tell, since he didn&#39;t show the timings for random.","body":"@cst1992: Right now his slowest timing is TTFFTTFFTTFF, which seems, to my human eye, quite predictable. Random is inherently unpredictable, so it&#39;s entirely possible it would be slower still, and thus outside the limits shown here.  OTOH, it could be that TTFFTTFF perfectly hits the pathological case.  Can&#39;t tell, since he didn&#39;t show the timings for random."},{"owner":{"account_id":55732,"reputation":75249,"user_id":166949,"accept_rate":90,"display_name":"steveha"},"score":47,"creation_date":1469048857,"post_id":14889969,"comment_id":64383305,"body_markdown":"@MooingDuck To a human eye, &quot;TTFFTTFFTTFF&quot; is a predictable sequence, but what we are talking about here is the behavior of the branch predictor built into a CPU.  The branch predictor is not AI-level pattern recognition; it&#39;s very simple.  When you just alternate branches it doesn&#39;t predict well.  In most code, branches go the same way almost all the time; consider a loop that executes a thousand times.  The branch at the end of the loop goes back to the start of the loop 999 times, and then the thousandth time does something different.  A very simple branch predictor works well, usually.","body":"@MooingDuck To a human eye, &quot;TTFFTTFFTTFF&quot; is a predictable sequence, but what we are talking about here is the behavior of the branch predictor built into a CPU.  The branch predictor is not AI-level pattern recognition; it&#39;s very simple.  When you just alternate branches it doesn&#39;t predict well.  In most code, branches go the same way almost all the time; consider a loop that executes a thousand times.  The branch at the end of the loop goes back to the start of the loop 999 times, and then the thousandth time does something different.  A very simple branch predictor works well, usually."},{"owner":{"account_id":449991,"reputation":65003,"user_id":845092,"accept_rate":93,"display_name":"Mooing Duck"},"score":44,"creation_date":1469049018,"post_id":14889969,"comment_id":64383386,"body_markdown":"@steveha: I think you&#39;re making assumptions about how the CPU branch predictor works, and I disagree with that methodology. I don&#39;t know how advanced that branch predictor is, but I seem to think it&#39;s far more advanced than you do. You&#39;re probably right, but measurements would definitely be good.","body":"@steveha: I think you&#39;re making assumptions about how the CPU branch predictor works, and I disagree with that methodology. I don&#39;t know how advanced that branch predictor is, but I seem to think it&#39;s far more advanced than you do. You&#39;re probably right, but measurements would definitely be good."},{"owner":{"account_id":55732,"reputation":75249,"user_id":166949,"accept_rate":90,"display_name":"steveha"},"score":8,"creation_date":1469504955,"post_id":14889969,"comment_id":64550377,"body_markdown":"@MooingDuck It is true that I am not an expert in processor design.  But I invite you to read the Wikipedia page about branch predictors.  Not one of the discussed designs could lock on to the pattern TTFFTTFF... and predict correctly.  (Except maybe for the neural net one, with a sufficiently advanced neural net, and I&#39;ll bet you cash money that you don&#39;t own a computing device that has such a branch predictor in its processor.)  https://en.wikipedia.org/wiki/Branch_predictor","body":"@MooingDuck It is true that I am not an expert in processor design.  But I invite you to read the Wikipedia page about branch predictors.  Not one of the discussed designs could lock on to the pattern TTFFTTFF... and predict correctly.  (Except maybe for the neural net one, with a sufficiently advanced neural net, and I&#39;ll bet you cash money that you don&#39;t own a computing device that has such a branch predictor in its processor.)  <a href=\"https://en.wikipedia.org/wiki/Branch_predictor\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Branch_predictor</a>"},{"owner":{"account_id":449991,"reputation":65003,"user_id":845092,"accept_rate":93,"display_name":"Mooing Duck"},"score":27,"creation_date":1469507635,"post_id":14889969,"comment_id":64551074,"body_markdown":"@steveha: The Two-level adaptive predictor could lock onto the TTFFTTFF pattern with no issue whatsoever. &quot;Variants of this prediction method are used in most modern microprocessors&quot;. Local branch prediction and Global branch prediction are based on a two level adaptive predictor, they can as well. &quot;Global branch prediction is used in AMD processors, and in Intel Pentium M, Core, Core 2, and Silvermont-based Atom processors&quot;  Also add Agree predictor, Hybrid predictor, Prediction of indirect jumps, to that list. Loop predictor wont lock on, but hits 75%. That leaves only 2 that can&#39;t lock on","body":"@steveha: The Two-level adaptive predictor could lock onto the TTFFTTFF pattern with no issue whatsoever. &quot;Variants of this prediction method are used in most modern microprocessors&quot;. Local branch prediction and Global branch prediction are based on a two level adaptive predictor, they can as well. &quot;Global branch prediction is used in AMD processors, and in Intel Pentium M, Core, Core 2, and Silvermont-based Atom processors&quot;  Also add Agree predictor, Hybrid predictor, Prediction of indirect jumps, to that list. Loop predictor wont lock on, but hits 75%. That leaves only 2 that can&#39;t lock on"},{"owner":{"account_id":5706118,"reputation":207,"user_id":4509583,"display_name":"Warren K"},"score":9,"creation_date":1482532327,"post_id":14889969,"comment_id":69820096,"body_markdown":"@MooingDuck : The diagram in Surt&#39;s [answer below](http://stackoverflow.com/a/33070112/4509583) I think explains why TTFFTTFF is in fact the &quot;pathological case&quot; in Saqlain&#39;s example.","body":"@MooingDuck : The diagram in Surt&#39;s <a href=\"http://stackoverflow.com/a/33070112/4509583\">answer below</a> I think explains why TTFFTTFF is in fact the &quot;pathological case&quot; in Saqlain&#39;s example."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1650538035,"post_id":14889969,"comment_id":127144053,"body_markdown":"What CPU did you benchmark this on? A real modern CPU like Haswell?  Or a simulator with an old 2-bit saturating counter branch predictor like @WarrenK mentioned?  Intel since Haswell has used IT-TAGE predictors that can spread the prediction history for a single branch across basically the whole storage space of the predictor.  (e.g. in a repeat loop, was able to &quot;learn&quot; all the branching in a 12 to 14 element bubble sort on my Skylake CPU, hand-written in asm with an outer loop to copy the same unsorted data back into place with a couple vmovdqa.)  https://danluu.com/branch-prediction/","body":"What CPU did you benchmark this on? A real modern CPU like Haswell?  Or a simulator with an old 2-bit saturating counter branch predictor like @WarrenK mentioned?  Intel since Haswell has used IT-TAGE predictors that can spread the prediction history for a single branch across basically the whole storage space of the predictor.  (e.g. in a repeat loop, was able to &quot;learn&quot; all the branching in a 12 to 14 element bubble sort on my Skylake CPU, hand-written in asm with an outer loop to copy the same unsorted data back into place with a couple vmovdqa.)  <a href=\"https://danluu.com/branch-prediction/\" rel=\"nofollow noreferrer\">danluu.com/branch-prediction</a>"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1650538940,"post_id":14889969,"comment_id":127144369,"body_markdown":"With this test code (https://godbolt.org/z/GY1dxh8Ka) compiled with clang++ 13.0 on my i7-6700k Skylake CPU, (with `-Os -mbranches-within-32B-boundaries` to make branchy asm), the `i&amp;2` TTFF pattern does predict perfectly.  I had to use `-Os` or `-O1` instead of `-O2`, to get such dumb asm for such simple source.  GCC -O2 uses `cmp` / `sbb count, -1` to add the cmp result.  clang -O2  unrolls by 4 which exposes the pattern, optimizing into `add sum, 2` / `sub counter, 4` / `jne top_of_loop` (with actual registers, that&#39;s pseudo-code).  I&#39;m curious what CPUs before Skylake would do, though.","body":"With this test code (<a href=\"https://godbolt.org/z/GY1dxh8Ka\" rel=\"nofollow noreferrer\">godbolt.org/z/GY1dxh8Ka</a>) compiled with clang++ 13.0 on my i7-6700k Skylake CPU, (with <code>-Os -mbranches-within-32B-boundaries</code> to make branchy asm), the <code>i&amp;2</code> TTFF pattern does predict perfectly.  I had to use <code>-Os</code> or <code>-O1</code> instead of <code>-O2</code>, to get such dumb asm for such simple source.  GCC -O2 uses <code>cmp</code> / <code>sbb count, -1</code> to add the cmp result.  clang -O2  unrolls by 4 which exposes the pattern, optimizing into <code>add sum, 2</code> / <code>sub counter, 4</code> / <code>jne top_of_loop</code> (with actual registers, that&#39;s pseudo-code).  I&#39;m curious what CPUs before Skylake would do, though."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1650539508,"post_id":14889969,"comment_id":127144604,"body_markdown":"Tried on an old Core2Duo; `i&amp;1` is twice as fast as `i&amp;2`.  (6.34s vs. 3.02s).  vs. both similar on my Skylake at 1.13 vs. 1.28 (yes, `i&amp;1` was slower on SKL, but I think due to some uop-cache effect, since I got higher counts for `idq.mite_uops`).","body":"Tried on an old Core2Duo; <code>i&amp;1</code> is twice as fast as <code>i&amp;2</code>.  (6.34s vs. 3.02s).  vs. both similar on my Skylake at 1.13 vs. 1.28 (yes, <code>i&amp;1</code> was slower on SKL, but I think due to some uop-cache effect, since I got higher counts for <code>idq.mite_uops</code>)."}],"tags":[],"owner":{"account_id":996825,"reputation":17630,"user_id":1012551,"accept_rate":92,"display_name":"Saqlain"},"comment_count":10,"down_vote_count":5,"up_vote_count":1425,"is_accepted":false,"score":1420,"last_activity_date":1551265112,"creation_date":1360913056,"answer_id":14889969,"question_id":11227809,"body_markdown":"As data is distributed between 0 and 255 when the array is sorted, around the first half of the iterations will not enter the `if`-statement (the `if` statement is shared below).\r\n\r\n    if (data[c] &gt;= 128)\r\n        sum += data[c];\r\n\r\nThe question is: What makes the above statement not execute in certain cases as in case of sorted data? Here comes the &quot;branch predictor&quot;. A branch predictor is a digital circuit that tries to guess which way a branch (e.g. an `if-then-else` structure) will go before this is known for sure. The purpose of the branch predictor is to improve the flow in the instruction pipeline. Branch predictors play a critical role in achieving high effective performance!\r\n\r\n**Let&#39;s do some bench marking to understand it better**\r\n\r\nThe performance of an `if`-statement depends on whether its condition has a predictable pattern. If the condition is always true or always false, the branch prediction logic in the processor will pick up the pattern. On the other hand, if the pattern is unpredictable, the `if`-statement will be much more expensive.\r\n\r\nLet’s measure the performance of this loop with different conditions:\r\n\r\n    for (int i = 0; i &lt; max; i++)\r\n        if (condition)\r\n            sum++;\r\n\r\nHere are the timings of the loop with different true-false patterns:\r\n\r\n    Condition                Pattern             Time (ms)\r\n    -------------------------------------------------------\r\n    (i &amp; 0&#215;80000000) == 0    T repeated          322\r\n\r\n    (i &amp; 0xffffffff) == 0    F repeated          276\r\n\r\n    (i &amp; 1) == 0             TF alternating      760\r\n\r\n    (i &amp; 3) == 0             TFFFTFFF…           513\r\n\r\n    (i &amp; 2) == 0             TTFFTTFF…           1675\r\n\r\n    (i &amp; 4) == 0             TTTTFFFFTTTTFFFF…   1275\r\n\r\n    (i &amp; 8) == 0             8T 8F 8T 8F …       752\r\n\r\n    (i &amp; 16) == 0            16T 16F 16T 16F …   490\r\n\r\nA “**bad**” true-false pattern can make an `if`-statement up to six times slower than a “**good**” pattern! Of course, which pattern is good and which is bad depends on the exact instructions generated by the compiler and on the specific processor.\r\n\r\nSo there is no doubt about the impact of branch prediction on performance!\r\n\r\n","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>As data is distributed between 0 and 255 when the array is sorted, around the first half of the iterations will not enter the <code>if</code>-statement (the <code>if</code> statement is shared below).</p>\n\n<pre><code>if (data[c] &gt;= 128)\n    sum += data[c];\n</code></pre>\n\n<p>The question is: What makes the above statement not execute in certain cases as in case of sorted data? Here comes the \"branch predictor\". A branch predictor is a digital circuit that tries to guess which way a branch (e.g. an <code>if-then-else</code> structure) will go before this is known for sure. The purpose of the branch predictor is to improve the flow in the instruction pipeline. Branch predictors play a critical role in achieving high effective performance!</p>\n\n<p><strong>Let's do some bench marking to understand it better</strong></p>\n\n<p>The performance of an <code>if</code>-statement depends on whether its condition has a predictable pattern. If the condition is always true or always false, the branch prediction logic in the processor will pick up the pattern. On the other hand, if the pattern is unpredictable, the <code>if</code>-statement will be much more expensive.</p>\n\n<p>Let’s measure the performance of this loop with different conditions:</p>\n\n<pre><code>for (int i = 0; i &lt; max; i++)\n    if (condition)\n        sum++;\n</code></pre>\n\n<p>Here are the timings of the loop with different true-false patterns:</p>\n\n<pre><code>Condition                Pattern             Time (ms)\n-------------------------------------------------------\n(i &amp; 0×80000000) == 0    T repeated          322\n\n(i &amp; 0xffffffff) == 0    F repeated          276\n\n(i &amp; 1) == 0             TF alternating      760\n\n(i &amp; 3) == 0             TFFFTFFF…           513\n\n(i &amp; 2) == 0             TTFFTTFF…           1675\n\n(i &amp; 4) == 0             TTTTFFFFTTTTFFFF…   1275\n\n(i &amp; 8) == 0             8T 8F 8T 8F …       752\n\n(i &amp; 16) == 0            16T 16F 16T 16F …   490\n</code></pre>\n\n<p>A “<strong>bad</strong>” true-false pattern can make an <code>if</code>-statement up to six times slower than a “<strong>good</strong>” pattern! Of course, which pattern is good and which is bad depends on the exact instructions generated by the compiler and on the specific processor.</p>\n\n<p>So there is no doubt about the impact of branch prediction on performance!</p>\n"},{"tags":[],"owner":{"account_id":1021317,"reputation":30648,"user_id":1031591,"accept_rate":71,"display_name":"atlaste"},"comment_count":0,"down_vote_count":3,"up_vote_count":1598,"is_accepted":false,"score":1595,"last_activity_date":1547614041,"creation_date":1366784788,"answer_id":16184827,"question_id":11227809,"body_markdown":"I just read up on this question and its answers, and I feel an answer is missing.\r\n\r\nA common way to eliminate branch prediction that I&#39;ve found to work particularly good in managed languages is a table lookup instead of using a branch (although I haven&#39;t tested it in this case).\r\n\r\nThis approach works in general if:\r\n\r\n1. it&#39;s a small table and is likely to be cached in the processor, and\r\n2. you are running things in a quite tight loop and/or the processor can preload the data.\r\n\r\n**Background and why**\r\n\r\nFrom a processor perspective, your memory is slow. To compensate for the difference in speed, a couple of caches are built into your processor (L1/L2 cache). So imagine that you&#39;re doing your nice calculations and figure out that you need a piece of memory. The processor will get its &#39;load&#39; operation and loads the piece of memory into cache -- and then uses the cache to do the rest of the calculations. Because memory is relatively slow, this &#39;load&#39; will slow down your program.\r\n\r\nLike branch prediction, this was optimized in the Pentium processors: the processor predicts that it needs to load a piece of data and attempts to load that into the cache before the operation actually hits the cache. As we&#39;ve already seen, branch prediction sometimes goes horribly wrong -- in the worst case scenario you need to go back and actually wait for a memory load, which will take forever (**in other words: failing branch prediction is bad, a memory load after a branch prediction fail is just horrible!**).\r\n\r\nFortunately for us, if the memory access pattern is predictable, the processor will load it in its fast cache and all is well.\r\n\r\nThe first thing we need to know is what is *small*? While smaller is generally better, a rule of thumb is to stick to lookup tables that are &lt;= 4096 bytes in size. As an upper limit: if your lookup table is larger than 64K it&#39;s probably worth reconsidering.\r\n\r\n**Constructing a table**\r\n\r\nSo we&#39;ve figured out that we can create a small table. Next thing to do is get a lookup function in place. Lookup functions are usually small functions that use a couple of basic integer operations (and, or, xor, shift, add, remove and perhaps multiply). You want to have your input translated by the lookup function to some kind of &#39;unique key&#39; in your table, which then simply gives you the answer of all the work you wanted it to do.\r\n\r\nIn this case: &gt;= 128 means we can keep the value, &lt; 128 means we get rid of it. The easiest way to do that is by using an &#39;AND&#39;: if we keep it, we AND it with 7FFFFFFF; if we want to get rid of it, we AND it with 0. Notice also that 128 is a power of 2 -- so we can go ahead and make a table of 32768/128 integers and fill it with one zero and a lot of 7FFFFFFFF&#39;s.\r\n\r\n**Managed languages**\r\n\r\nYou might wonder why this works well in managed languages. After all, managed languages check the boundaries of the arrays with a branch to ensure you don&#39;t mess up...\r\n\r\nWell, not exactly... :-)\r\n\r\nThere has been quite some work on eliminating this branch for managed languages. For example:\r\n\r\n&lt;!-- language-all: c# --&gt;\r\n\r\n    for (int i = 0; i &lt; array.Length; ++i)\r\n    {\r\n       // Use array[i]\r\n    }\r\n\r\nIn this case, it&#39;s obvious to the compiler that the boundary condition will never be hit. At least the Microsoft JIT compiler (but I expect Java does similar things) will notice this and remove the check altogether. WOW, that means no branch. Similarly, it will deal with other obvious cases.\r\n\r\nIf you run into trouble with lookups in managed languages -- the key is to add a `&amp; 0x[something]FFF` to your lookup function to make the boundary check predictable -- and watch it going faster.\r\n\r\n**The result of this case**\r\n\r\n    // Generate data\r\n    int arraySize = 32768;\r\n    int[] data = new int[arraySize];\r\n\r\n    Random random = new Random(0);\r\n    for (int c = 0; c &lt; arraySize; ++c)\r\n    {\r\n        data[c] = random.Next(256);\r\n    }\r\n\r\n    /*To keep the spirit of the code intact, I&#39;ll make a separate lookup table\r\n    (I assume we cannot modify &#39;data&#39; or the number of loops)*/\r\n\r\n    int[] lookup = new int[256];\r\n\r\n    for (int c = 0; c &lt; 256; ++c)\r\n    {\r\n        lookup[c] = (c &gt;= 128) ? c : 0;\r\n    }\r\n\r\n    // Test\r\n    DateTime startTime = System.DateTime.Now;\r\n    long sum = 0;\r\n\r\n    for (int i = 0; i &lt; 100000; ++i)\r\n    {\r\n        // Primary loop\r\n        for (int j = 0; j &lt; arraySize; ++j)\r\n        {\r\n            /* Here you basically want to use simple operations - so no\r\n            random branches, but things like &amp;, |, *, -, +, etc. are fine. */\r\n            sum += lookup[data[j]];\r\n        }\r\n    }\r\n\r\n    DateTime endTime = System.DateTime.Now;\r\n    Console.WriteLine(endTime - startTime);\r\n    Console.WriteLine(&quot;sum = &quot; + sum);\r\n    Console.ReadLine();","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>I just read up on this question and its answers, and I feel an answer is missing.</p>\n\n<p>A common way to eliminate branch prediction that I've found to work particularly good in managed languages is a table lookup instead of using a branch (although I haven't tested it in this case).</p>\n\n<p>This approach works in general if:</p>\n\n<ol>\n<li>it's a small table and is likely to be cached in the processor, and</li>\n<li>you are running things in a quite tight loop and/or the processor can preload the data.</li>\n</ol>\n\n<p><strong>Background and why</strong></p>\n\n<p>From a processor perspective, your memory is slow. To compensate for the difference in speed, a couple of caches are built into your processor (L1/L2 cache). So imagine that you're doing your nice calculations and figure out that you need a piece of memory. The processor will get its 'load' operation and loads the piece of memory into cache -- and then uses the cache to do the rest of the calculations. Because memory is relatively slow, this 'load' will slow down your program.</p>\n\n<p>Like branch prediction, this was optimized in the Pentium processors: the processor predicts that it needs to load a piece of data and attempts to load that into the cache before the operation actually hits the cache. As we've already seen, branch prediction sometimes goes horribly wrong -- in the worst case scenario you need to go back and actually wait for a memory load, which will take forever (<strong>in other words: failing branch prediction is bad, a memory load after a branch prediction fail is just horrible!</strong>).</p>\n\n<p>Fortunately for us, if the memory access pattern is predictable, the processor will load it in its fast cache and all is well.</p>\n\n<p>The first thing we need to know is what is <em>small</em>? While smaller is generally better, a rule of thumb is to stick to lookup tables that are &lt;= 4096 bytes in size. As an upper limit: if your lookup table is larger than 64K it's probably worth reconsidering.</p>\n\n<p><strong>Constructing a table</strong></p>\n\n<p>So we've figured out that we can create a small table. Next thing to do is get a lookup function in place. Lookup functions are usually small functions that use a couple of basic integer operations (and, or, xor, shift, add, remove and perhaps multiply). You want to have your input translated by the lookup function to some kind of 'unique key' in your table, which then simply gives you the answer of all the work you wanted it to do.</p>\n\n<p>In this case: >= 128 means we can keep the value, &lt; 128 means we get rid of it. The easiest way to do that is by using an 'AND': if we keep it, we AND it with 7FFFFFFF; if we want to get rid of it, we AND it with 0. Notice also that 128 is a power of 2 -- so we can go ahead and make a table of 32768/128 integers and fill it with one zero and a lot of 7FFFFFFFF's.</p>\n\n<p><strong>Managed languages</strong></p>\n\n<p>You might wonder why this works well in managed languages. After all, managed languages check the boundaries of the arrays with a branch to ensure you don't mess up...</p>\n\n<p>Well, not exactly... :-)</p>\n\n<p>There has been quite some work on eliminating this branch for managed languages. For example:</p>\n\n\n\n<pre class=\"lang-cs prettyprint-override\"><code>for (int i = 0; i &lt; array.Length; ++i)\n{\n   // Use array[i]\n}\n</code></pre>\n\n<p>In this case, it's obvious to the compiler that the boundary condition will never be hit. At least the Microsoft JIT compiler (but I expect Java does similar things) will notice this and remove the check altogether. WOW, that means no branch. Similarly, it will deal with other obvious cases.</p>\n\n<p>If you run into trouble with lookups in managed languages -- the key is to add a <code>&amp; 0x[something]FFF</code> to your lookup function to make the boundary check predictable -- and watch it going faster.</p>\n\n<p><strong>The result of this case</strong></p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>// Generate data\nint arraySize = 32768;\nint[] data = new int[arraySize];\n\nRandom random = new Random(0);\nfor (int c = 0; c &lt; arraySize; ++c)\n{\n    data[c] = random.Next(256);\n}\n\n/*To keep the spirit of the code intact, I'll make a separate lookup table\n(I assume we cannot modify 'data' or the number of loops)*/\n\nint[] lookup = new int[256];\n\nfor (int c = 0; c &lt; 256; ++c)\n{\n    lookup[c] = (c &gt;= 128) ? c : 0;\n}\n\n// Test\nDateTime startTime = System.DateTime.Now;\nlong sum = 0;\n\nfor (int i = 0; i &lt; 100000; ++i)\n{\n    // Primary loop\n    for (int j = 0; j &lt; arraySize; ++j)\n    {\n        /* Here you basically want to use simple operations - so no\n        random branches, but things like &amp;, |, *, -, +, etc. are fine. */\n        sum += lookup[data[j]];\n    }\n}\n\nDateTime endTime = System.DateTime.Now;\nConsole.WriteLine(endTime - startTime);\nConsole.WriteLine(\"sum = \" + sum);\nConsole.ReadLine();\n</code></pre>\n"},{"comments":[{"owner":{"account_id":1021317,"reputation":30648,"user_id":1031591,"accept_rate":71,"display_name":"atlaste"},"score":52,"creation_date":1375099524,"post_id":17782979,"comment_id":26185793,"body_markdown":"Right, you can also just use the bit directly and multiply (`data[c]&gt;&gt;7` - which is discussed somewhere here as well); I intentionally left this solution out, but of course you are correct. Just a small note: The rule of thumb for lookup tables is that if it fits in 4KB (because of caching), it&#39;ll work - preferably make the table as small as possible. For managed languages I&#39;d push that to 64KB, for low-level languages like C++ and C, I&#39;d probably reconsider (that&#39;s just my experience). Since `typeof(int) = 4`, I&#39;d try to stick to max 10 bits.","body":"Right, you can also just use the bit directly and multiply (<code>data[c]&gt;&gt;7</code> - which is discussed somewhere here as well); I intentionally left this solution out, but of course you are correct. Just a small note: The rule of thumb for lookup tables is that if it fits in 4KB (because of caching), it&#39;ll work - preferably make the table as small as possible. For managed languages I&#39;d push that to 64KB, for low-level languages like C++ and C, I&#39;d probably reconsider (that&#39;s just my experience). Since <code>typeof(int) = 4</code>, I&#39;d try to stick to max 10 bits."},{"owner":{"account_id":55732,"reputation":75249,"user_id":166949,"accept_rate":90,"display_name":"steveha"},"score":38,"creation_date":1375135333,"post_id":17782979,"comment_id":26206652,"body_markdown":"I think indexing with the 0/1 value will probably be faster than an integer multiply, but I guess if performance is really critical you should profile it.  I agree that small lookup tables are essential to avoid cache pressure, but clearly if you have a bigger cache you can get away with a bigger lookup table, so 4KB is more a rule of thumb than a hard rule.  I think you meant `sizeof(int) == 4`?  That would be true for 32-bit.  My two-year-old cell phone has a 32KB L1 cache, so even a 4K lookup table might work, especially if the lookup values were a byte instead of an int.","body":"I think indexing with the 0/1 value will probably be faster than an integer multiply, but I guess if performance is really critical you should profile it.  I agree that small lookup tables are essential to avoid cache pressure, but clearly if you have a bigger cache you can get away with a bigger lookup table, so 4KB is more a rule of thumb than a hard rule.  I think you meant <code>sizeof(int) == 4</code>?  That would be true for 32-bit.  My two-year-old cell phone has a 32KB L1 cache, so even a 4K lookup table might work, especially if the lookup values were a byte instead of an int."},{"owner":{"account_id":2515499,"reputation":16966,"user_id":2187042,"accept_rate":53,"display_name":"Richard Tingle"},"score":31,"creation_date":1393947504,"post_id":17782979,"comment_id":33658701,"body_markdown":"Possibly I&#39;m missing something but in your `j` equals 0 or 1 method why don&#39;t you just multiply your value by `j` before adding it rather than using the array indexing (possibly should be multiplied by `1-j` rather than `j`)","body":"Possibly I&#39;m missing something but in your <code>j</code> equals 0 or 1 method why don&#39;t you just multiply your value by <code>j</code> before adding it rather than using the array indexing (possibly should be multiplied by <code>1-j</code> rather than <code>j</code>)"},{"owner":{"account_id":1021317,"reputation":30648,"user_id":1031591,"accept_rate":71,"display_name":"atlaste"},"score":19,"creation_date":1395132305,"post_id":17782979,"comment_id":34186464,"body_markdown":"@steveha Multiplication should be faster, I tried looking it up in the Intel books, but couldn&#39;t find it... either way, benchmarking also gives me that result here.","body":"@steveha Multiplication should be faster, I tried looking it up in the Intel books, but couldn&#39;t find it... either way, benchmarking also gives me that result here."},{"owner":{"account_id":1021317,"reputation":30648,"user_id":1031591,"accept_rate":71,"display_name":"atlaste"},"score":24,"creation_date":1395132731,"post_id":17782979,"comment_id":34186699,"body_markdown":"@steveha P.S.: another possible answer would be `int c = data[j]; sum += c &amp; -(c &gt;&gt; 7);` which requires no multiplications at all.","body":"@steveha P.S.: another possible answer would be <code>int c = data[j]; sum += c &amp; -(c &gt;&gt; 7);</code> which requires no multiplications at all."},{"owner":{"account_id":3686352,"reputation":3327,"user_id":3070062,"display_name":"Falco"},"score":2,"creation_date":1396451702,"post_id":17782979,"comment_id":34796004,"body_markdown":"Good answer - since a lookup-table can also handle complex cases, where we cannot easily cheat with bit-manipulation","body":"Good answer - since a lookup-table can also handle complex cases, where we cannot easily cheat with bit-manipulation"},{"owner":{"account_id":40137,"reputation":37471,"user_id":116186,"accept_rate":77,"display_name":"Petter"},"score":2,"creation_date":1404485763,"post_id":17782979,"comment_id":38070759,"body_markdown":"Zain is correct. The “if” is just hidden in the lookup table. The code is faster because the lookup table is hidden OUTSIDE the 100000 iterations. There is nothign to gain from using a lookup table for this problem.","body":"Zain is correct. The “if” is just hidden in the lookup table. The code is faster because the lookup table is hidden OUTSIDE the 100000 iterations. There is nothign to gain from using a lookup table for this problem."},{"owner":{"account_id":1860420,"reputation":2294,"user_id":1685098,"display_name":"Logan Pickup"},"score":2,"creation_date":1414443702,"post_id":17782979,"comment_id":41807953,"body_markdown":"`i = (x &lt; node-&gt;value);\nnode = node-&gt;link[i];` doesn&#39;t have an explicit branch, but it still contains a comparison; it depends a lot on the target architecture as to whether this can be resolved without a branch or not. Since it can be done on x86 (using either CMOV or LAHF) and ARM (conditional add or move), which are the only architectures I use, this is possibly not important!","body":"<code>i = (x &lt; node-&gt;value); node = node-&gt;link[i];</code> doesn&#39;t have an explicit branch, but it still contains a comparison; it depends a lot on the target architecture as to whether this can be resolved without a branch or not. Since it can be done on x86 (using either CMOV or LAHF) and ARM (conditional add or move), which are the only architectures I use, this is possibly not important!"},{"owner":{"account_id":55732,"reputation":75249,"user_id":166949,"accept_rate":90,"display_name":"steveha"},"score":2,"creation_date":1414451157,"post_id":17782979,"comment_id":41810917,"body_markdown":"On what architecture would an expression like `(x &lt; node-&gt;value)` require a branch to evaluate?  All the architectures with which I am familiar have a &quot;flags&quot; register, and it is simple to extract the desired flag value.  I guess on the Pentium 4 the flag bit extraction might be slow as IIRC that chip doesn&#39;t have dedicated shifting hardware for addresses, but borrows the ALU to shift bits.  But I don&#39;t know where an actual branch would be needed.  Hmm, your examples were conditional... the idea is that once you extract the bit from flags, you can just use indexing with no branch.","body":"On what architecture would an expression like <code>(x &lt; node-&gt;value)</code> require a branch to evaluate?  All the architectures with which I am familiar have a &quot;flags&quot; register, and it is simple to extract the desired flag value.  I guess on the Pentium 4 the flag bit extraction might be slow as IIRC that chip doesn&#39;t have dedicated shifting hardware for addresses, but borrows the ALU to shift bits.  But I don&#39;t know where an actual branch would be needed.  Hmm, your examples were conditional... the idea is that once you extract the bit from flags, you can just use indexing with no branch."},{"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"score":2,"creation_date":1551357444,"post_id":17782979,"comment_id":96616372,"body_markdown":"Bit shifting is a zero-cost operation in ARM, so you may find the bit-shifted version is faster on ARM.","body":"Bit shifting is a zero-cost operation in ARM, so you may find the bit-shifted version is faster on ARM."},{"owner":{"account_id":24885,"reputation":30828,"user_id":63550,"accept_rate":78,"display_name":"Peter Mortensen"},"score":2,"creation_date":1558962425,"post_id":17782979,"comment_id":99261002,"body_markdown":"What about cache sizes, L1, L2, etc.? Having to go to main memory for a table lookup would be killer. Can you address that in your answer?","body":"What about cache sizes, L1, L2, etc.? Having to go to main memory for a table lookup would be killer. Can you address that in your answer?"}],"tags":[],"owner":{"account_id":55732,"reputation":75249,"user_id":166949,"accept_rate":90,"display_name":"steveha"},"comment_count":11,"down_vote_count":4,"up_vote_count":1358,"is_accepted":false,"score":1354,"last_activity_date":1611741816,"creation_date":1374481770,"answer_id":17782979,"question_id":11227809,"body_markdown":"One way to avoid branch prediction errors is to build a lookup table, and index it using the data.  Stefan de Bruijn discussed that in his answer.\r\n\r\nBut in this case, we know values are in the range [0, 255] and we only care about values &gt;= 128.  That means we can easily extract a single bit that will tell us whether we want a value or not: by shifting the data to the right 7 bits, we are left with a 0 bit or a 1 bit, and we only want to add the value when we have a 1 bit.  Let&#39;s call this bit the &quot;decision bit&quot;.\r\n\r\nBy using the 0/1 value of the decision bit as an index into an array, we can make code that will be equally fast whether the data is sorted or not sorted.  Our code will always add a value, but when the decision bit is 0, we will add the value somewhere we don&#39;t care about.  Here&#39;s the code:\r\n\r\n    // Test\r\n    clock_t start = clock();\r\n    long long a[] = {0, 0};\r\n    long long sum;\r\n\r\n    for (unsigned i = 0; i &lt; 100000; ++i)\r\n    {\r\n        // Primary loop\r\n        for (unsigned c = 0; c &lt; arraySize; ++c)\r\n        {\r\n            int j = (data[c] &gt;&gt; 7);\r\n            a[j] += data[c];\r\n        }\r\n    }\r\n\r\n    double elapsedTime = static_cast&lt;double&gt;(clock() - start) / CLOCKS_PER_SEC;\r\n    sum = a[1];\r\n\r\nThis code wastes half of the adds but never has a branch prediction failure.  It&#39;s tremendously faster on random data than the version with an actual if statement.\r\n\r\nBut in my testing, an explicit lookup table was slightly faster than this, probably because indexing into a lookup table was slightly faster than bit shifting.  This shows how my code sets up and uses the lookup table (unimaginatively called `lut` for &quot;LookUp Table&quot; in the code).  Here&#39;s the C++ code:\r\n\r\n    // Declare and then fill in the lookup table\r\n    int lut[256];\r\n    for (unsigned c = 0; c &lt; 256; ++c)\r\n        lut[c] = (c &gt;= 128) ? c : 0;\r\n\r\n    // Use the lookup table after it is built\r\n    for (unsigned i = 0; i &lt; 100000; ++i)\r\n    {\r\n        // Primary loop\r\n        for (unsigned c = 0; c &lt; arraySize; ++c)\r\n        {\r\n            sum += lut[data[c]];\r\n        }\r\n    }\r\n\r\nIn this case, the lookup table was only 256 bytes, so it fits nicely in a cache and all was fast.  This technique wouldn&#39;t work well if the data was 24-bit values and we only wanted half of them... the lookup table would be far too big to be practical.  On the other hand, we can combine the two techniques shown above: first shift the bits over, then index a lookup table.  For a 24-bit value that we only want the top half value, we could potentially shift the data right by 12 bits, and be left with a 12-bit value for a table index.  A 12-bit table index implies a table of 4096 values, which might be practical.\r\n\r\nThe technique of indexing into an array, instead of using an `if` statement, can be used for deciding which pointer to use.  I saw a library that implemented binary trees, and instead of having two named pointers (`pLeft` and `pRight` or whatever) had a length-2 array of pointers and used the &quot;decision bit&quot; technique to decide which one to follow.  For example, instead of:\r\n\r\n    if (x &lt; node-&gt;value)\r\n        node = node-&gt;pLeft;\r\n    else\r\n        node = node-&gt;pRight;\r\n\r\nthis library would do something like:\r\n\r\n    i = (x &lt; node-&gt;value);\r\n    node = node-&gt;link[i];\r\n\r\nHere&#39;s a link to this code: [Red Black Trees](https://web.archive.org/web/20190207151651/https://www.eternallyconfuzzled.com/tuts/datastructures/jsw_tut_rbtree.aspx), *Eternally Confuzzled*\r\n\r\n","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>One way to avoid branch prediction errors is to build a lookup table, and index it using the data.  Stefan de Bruijn discussed that in his answer.</p>\n<p>But in this case, we know values are in the range [0, 255] and we only care about values &gt;= 128.  That means we can easily extract a single bit that will tell us whether we want a value or not: by shifting the data to the right 7 bits, we are left with a 0 bit or a 1 bit, and we only want to add the value when we have a 1 bit.  Let's call this bit the &quot;decision bit&quot;.</p>\n<p>By using the 0/1 value of the decision bit as an index into an array, we can make code that will be equally fast whether the data is sorted or not sorted.  Our code will always add a value, but when the decision bit is 0, we will add the value somewhere we don't care about.  Here's the code:</p>\n<pre><code>// Test\nclock_t start = clock();\nlong long a[] = {0, 0};\nlong long sum;\n\nfor (unsigned i = 0; i &lt; 100000; ++i)\n{\n    // Primary loop\n    for (unsigned c = 0; c &lt; arraySize; ++c)\n    {\n        int j = (data[c] &gt;&gt; 7);\n        a[j] += data[c];\n    }\n}\n\ndouble elapsedTime = static_cast&lt;double&gt;(clock() - start) / CLOCKS_PER_SEC;\nsum = a[1];\n</code></pre>\n<p>This code wastes half of the adds but never has a branch prediction failure.  It's tremendously faster on random data than the version with an actual if statement.</p>\n<p>But in my testing, an explicit lookup table was slightly faster than this, probably because indexing into a lookup table was slightly faster than bit shifting.  This shows how my code sets up and uses the lookup table (unimaginatively called <code>lut</code> for &quot;LookUp Table&quot; in the code).  Here's the C++ code:</p>\n<pre><code>// Declare and then fill in the lookup table\nint lut[256];\nfor (unsigned c = 0; c &lt; 256; ++c)\n    lut[c] = (c &gt;= 128) ? c : 0;\n\n// Use the lookup table after it is built\nfor (unsigned i = 0; i &lt; 100000; ++i)\n{\n    // Primary loop\n    for (unsigned c = 0; c &lt; arraySize; ++c)\n    {\n        sum += lut[data[c]];\n    }\n}\n</code></pre>\n<p>In this case, the lookup table was only 256 bytes, so it fits nicely in a cache and all was fast.  This technique wouldn't work well if the data was 24-bit values and we only wanted half of them... the lookup table would be far too big to be practical.  On the other hand, we can combine the two techniques shown above: first shift the bits over, then index a lookup table.  For a 24-bit value that we only want the top half value, we could potentially shift the data right by 12 bits, and be left with a 12-bit value for a table index.  A 12-bit table index implies a table of 4096 values, which might be practical.</p>\n<p>The technique of indexing into an array, instead of using an <code>if</code> statement, can be used for deciding which pointer to use.  I saw a library that implemented binary trees, and instead of having two named pointers (<code>pLeft</code> and <code>pRight</code> or whatever) had a length-2 array of pointers and used the &quot;decision bit&quot; technique to decide which one to follow.  For example, instead of:</p>\n<pre><code>if (x &lt; node-&gt;value)\n    node = node-&gt;pLeft;\nelse\n    node = node-&gt;pRight;\n</code></pre>\n<p>this library would do something like:</p>\n<pre><code>i = (x &lt; node-&gt;value);\nnode = node-&gt;link[i];\n</code></pre>\n<p>Here's a link to this code: <a href=\"https://web.archive.org/web/20190207151651/https://www.eternallyconfuzzled.com/tuts/datastructures/jsw_tut_rbtree.aspx\" rel=\"noreferrer\">Red Black Trees</a>, <em>Eternally Confuzzled</em></p>\n"},{"comments":[{"owner":{"account_id":31164,"reputation":378689,"user_id":85371,"accept_rate":43,"display_name":"sehe"},"score":41,"creation_date":1374683490,"post_id":17828251,"comment_id":26040119,"body_markdown":"`sum= 3137536` - clever. That&#39;s kinda obviously not the point of the question. The question is clearly about explaining surprising performance characteristics. I&#39;m inclined to say that the addition of doing `std::partition` instead of `std::sort` is valuable. Though the actual question extends to more than just the synthetic benchmark given.","body":"<code>sum= 3137536</code> - clever. That&#39;s kinda obviously not the point of the question. The question is clearly about explaining surprising performance characteristics. I&#39;m inclined to say that the addition of doing <code>std::partition</code> instead of <code>std::sort</code> is valuable. Though the actual question extends to more than just the synthetic benchmark given."},{"owner":{"display_name":"user1196549"},"score":24,"creation_date":1374698251,"post_id":17828251,"comment_id":26048383,"body_markdown":"@DeadMG: this is indeed not the standard dichotomic search for a given key, but a search for the partitioning index; it requires a single compare per iteration. But don&#39;t rely on this code, I have not checked it. If you are interested in a guaranteed correct implementation, let me know.","body":"@DeadMG: this is indeed not the standard dichotomic search for a given key, but a search for the partitioning index; it requires a single compare per iteration. But don&#39;t rely on this code, I have not checked it. If you are interested in a guaranteed correct implementation, let me know."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":0,"creation_date":1650537132,"post_id":17828251,"comment_id":127143721,"body_markdown":"Binary search for the cut-point is unnecessary, just start summing from the end you want to keep, stopping when you get to a value you don&#39;t want.  (Unless HW prefetching works *much* worse when looping downwards instead of upwards).  Of course, actually taking time to sort is not a useful part of an algorithm that starts with unsorted data.  A histogram might be, if you want to answer multiple queries for different cut-points, other than 128, from the same data.  (Since the small value-range means there are many duplicates in this smallish array.)","body":"Binary search for the cut-point is unnecessary, just start summing from the end you want to keep, stopping when you get to a value you don&#39;t want.  (Unless HW prefetching works <i>much</i> worse when looping downwards instead of upwards).  Of course, actually taking time to sort is not a useful part of an algorithm that starts with unsorted data.  A histogram might be, if you want to answer multiple queries for different cut-points, other than 128, from the same data.  (Since the small value-range means there are many duplicates in this smallish array.)"}],"tags":[],"owner":{"display_name":"user1196549"},"comment_count":3,"down_vote_count":3,"up_vote_count":1219,"is_accepted":false,"score":1216,"last_activity_date":1557574272,"creation_date":1374652659,"answer_id":17828251,"question_id":11227809,"body_markdown":"In the sorted case, you can do better than relying on successful branch prediction or any branchless comparison trick: completely remove the branch.\r\n\r\nIndeed, the array is partitioned in a contiguous zone with `data &lt; 128` and another with `data &gt;= 128`. So you should find the partition point with a [dichotomic search][1] (using `Lg(arraySize) = 15` comparisons), then do a straight accumulation from that point.\r\n\r\nSomething like (unchecked)\r\n\r\n    int i= 0, j, k= arraySize;\r\n    while (i &lt; k)\r\n    {\r\n      j= (i + k) &gt;&gt; 1;\r\n      if (data[j] &gt;= 128)\r\n        k= j;\r\n      else\r\n        i= j;\r\n    }\r\n    sum= 0;\r\n    for (; i &lt; arraySize; i++)\r\n      sum+= data[i];\r\n\r\nor, slightly more obfuscated\r\n\r\n    int i, k, j= (i + k) &gt;&gt; 1;\r\n    for (i= 0, k= arraySize; i &lt; k; (data[j] &gt;= 128 ? k : i)= j)\r\n      j= (i + k) &gt;&gt; 1;\r\n    for (sum= 0; i &lt; arraySize; i++)\r\n      sum+= data[i];\r\n\r\nA yet faster approach, that gives an **approximate** solution for both sorted or unsorted is: `sum= 3137536;` (assuming a truly uniform distribution, 16384 samples with expected value 191.5) **:-)**\r\n\r\n\r\n  [1]: https://en.wikipedia.org/wiki/Dichotomic_search","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>In the sorted case, you can do better than relying on successful branch prediction or any branchless comparison trick: completely remove the branch.</p>\n\n<p>Indeed, the array is partitioned in a contiguous zone with <code>data &lt; 128</code> and another with <code>data &gt;= 128</code>. So you should find the partition point with a <a href=\"https://en.wikipedia.org/wiki/Dichotomic_search\" rel=\"noreferrer\">dichotomic search</a> (using <code>Lg(arraySize) = 15</code> comparisons), then do a straight accumulation from that point.</p>\n\n<p>Something like (unchecked)</p>\n\n<pre><code>int i= 0, j, k= arraySize;\nwhile (i &lt; k)\n{\n  j= (i + k) &gt;&gt; 1;\n  if (data[j] &gt;= 128)\n    k= j;\n  else\n    i= j;\n}\nsum= 0;\nfor (; i &lt; arraySize; i++)\n  sum+= data[i];\n</code></pre>\n\n<p>or, slightly more obfuscated</p>\n\n<pre><code>int i, k, j= (i + k) &gt;&gt; 1;\nfor (i= 0, k= arraySize; i &lt; k; (data[j] &gt;= 128 ? k : i)= j)\n  j= (i + k) &gt;&gt; 1;\nfor (sum= 0; i &lt; arraySize; i++)\n  sum+= data[i];\n</code></pre>\n\n<p>A yet faster approach, that gives an <strong>approximate</strong> solution for both sorted or unsorted is: <code>sum= 3137536;</code> (assuming a truly uniform distribution, 16384 samples with expected value 191.5) <strong>:-)</strong></p>\n"},{"comments":[{"owner":{"account_id":6111237,"reputation":18715,"user_id":4767498,"accept_rate":87,"display_name":"M.kazem Akhgary"},"score":7,"creation_date":1507733382,"post_id":31210295,"comment_id":80330289,"body_markdown":"how are two instructions executed together? is this done with separate cpu cores or is pipeline instruction is integrated in single cpu core?","body":"how are two instructions executed together? is this done with separate cpu cores or is pipeline instruction is integrated in single cpu core?"},{"owner":{"account_id":8810843,"reputation":1397,"user_id":6583956,"accept_rate":71,"display_name":"Sergey.quixoticaxis.Ivanov"},"score":6,"creation_date":1509695112,"post_id":31210295,"comment_id":81130628,"body_markdown":"@M.kazemAkhgary It&#39;s all inside one logical core. If you&#39;re interested, this is nicely described for example in [Intel Software Developer Manual](https://software.intel.com/en-us/articles/intel-sdm)","body":"@M.kazemAkhgary It&#39;s all inside one logical core. If you&#39;re interested, this is nicely described for example in <a href=\"https://software.intel.com/en-us/articles/intel-sdm\" rel=\"nofollow noreferrer\">Intel Software Developer Manual</a>"}],"tags":[],"owner":{"account_id":1786345,"reputation":11042,"user_id":1627741,"accept_rate":53,"display_name":"Harsh Sharma"},"comment_count":2,"down_vote_count":2,"up_vote_count":1024,"is_accepted":false,"score":1022,"last_activity_date":1650591088,"creation_date":1435937752,"answer_id":31210295,"question_id":11227809,"body_markdown":"The above behavior is happening because of Branch prediction.\r\n\r\nTo understand branch prediction one must first understand an **Instruction Pipeline.**\r\n\r\nThe the steps of running an instruction can be overlapped with the sequence of steps of running the previous and next instruction, so that different steps can be executed concurrently in parallel. This technique is known as instruction pipelining and is used to increase throughput in modern processors. To understand this better please see this [example on Wikipedia][1].\r\n\r\nGenerally, modern processors have quite long (and wide) pipelines, so many instruction can be in flight.  See [Modern Microprocessors\r\nA 90-Minute Guide!][2] which starts by introducing basic in-order pipelining and goes from there.\r\n\r\nBut for ease **let&#39;s consider a simple in-order pipeline with these 4 steps only.**  \r\n (Like a [classic 5-stage RISC][3], but omitting a separate MEM stage.)\r\n\r\n 1. IF -- Fetch the instruction from memory \r\n 1. ID -- Decode the instruction\r\n 1. EX -- Execute the instruction \r\n 1. WB -- Write back to CPU register\r\n\r\n **4-stage pipeline in general for 2 instructions.**  \r\n![4-stage pipeline in general][4]\r\n\r\nMoving back to the above question let&#39;s consider the following instructions:\r\n\r\n\t\t\t\t\t\t\tA) if (data[c] &gt;= 128)\r\n\t\t\t\t\t                /\\\r\n\t\t\t\t                   /  \\\r\n\t\t\t\t                  /    \\\r\n                            true /      \\ false\r\n\t\t\t                    /        \\\r\n                               /          \\\r\n                              /            \\\r\n                             /              \\\r\n                  B) sum += data[c];          C) for loop or print().\r\n\r\n\r\nWithout branch prediction, the following would occur:\r\n\r\nTo execute instruction B or instruction C the processor will have to wait (*stall*) till the instruction A leaves the EX stage in the pipeline, as the decision to go to instruction B or instruction C depends on the result of instruction A.  (i.e. where to fetch from next.) So the pipeline will look like this:\r\n\r\n***Without prediction: when `if` condition is true:***\r\n![enter image description here][5]\r\n\r\n***Without prediction: When `if` condition is false:***\r\n![enter image description here][6]\r\n\r\nAs a result of waiting for the result of instruction A, the total CPU cycles spent in the above case (without branch prediction; for both true and false) is 7.\r\n\r\n**So what is branch prediction?**\r\n\r\nBranch predictor will try to guess which way a branch (an if-then-else structure) will go before this is known for sure. It will not wait for the instruction A to reach the EX stage of the pipeline, but it will guess the decision and go to that instruction (B or C in case of our example).\r\n\r\n***In case of a correct guess, the pipeline looks something like this:***\r\n![enter image description here][7]\r\n\r\nIf it is later detected that the guess was wrong then the partially executed instructions are discarded and the pipeline starts over with the correct branch, incurring a delay. \r\nThe time that is wasted in case of a branch misprediction is equal to the number of stages in the pipeline from the fetch stage to the execute stage. Modern microprocessors tend to have quite long pipelines so that the misprediction delay is between 10 and 20 clock cycles. The longer the pipeline the greater the need for a good [branch predictor][8].\r\n\r\nIn the OP&#39;s code, the first time when the conditional, the branch predictor does not have any information to base up prediction, so the first time it will randomly choose the next instruction. (Or fall back to *static* prediction, typically forward not-taken, backward taken).  Later in the for loop, it can base the prediction on the history. \r\nFor an array sorted in ascending order, there are three possibilities:\r\n&lt;ol&gt;\r\n&lt;li&gt; All the elements are less than 128\r\n&lt;li&gt; All the elements are greater than 128\r\n&lt;li&gt; Some starting new elements are less than 128 and later it become greater than 128\r\n&lt;/ol&gt;\r\n\r\nLet us assume that the predictor will always assume the true branch on the first run.\r\n\r\nSo in the first case, it will always take the true branch since historically all its predictions are correct.\r\nIn the 2nd case, initially it will predict wrong, but after a few iterations, it will predict correctly.\r\nIn the 3rd case, it will initially predict correctly till the elements are less than 128. After which it will fail for some time and the correct itself when it sees branch prediction failure in history. \r\n \r\nIn all these cases the failure will be too less in number and as a result, only a few times it will need to discard the partially executed instructions and start over with the correct branch, resulting in fewer CPU cycles. \r\n\r\nBut in case of a random unsorted array, the prediction will need to discard the partially executed instructions and start over with the correct branch most of the time and result in more CPU cycles compared to the sorted array.\r\n\r\n----\r\n\r\nFurther reading:\r\n\r\n* [Modern Microprocessors\r\nA 90-Minute Guide!][2]\r\n* [Dan Luu&#39;s article on branch prediction][9] (which covers older branch predictors, not modern IT-TAGE or Perceptron)\r\n* https://en.wikipedia.org/wiki/Branch_predictor\r\n* [Branch Prediction and the Performance of Interpreters -\r\nDon’t Trust Folklore][10] - 2015 paper showing how well Intel&#39;s Haswell does at predicting the indirect branch of a Python interpreter&#39;s main loop (historically problematic due to a non-simple pattern), vs. earlier CPUs which didn&#39;t use IT-TAGE.  (They don&#39;t help with this fully random case, though.  Still 50% mispredict rate for the if inside the loop on a Skylake CPU when the source is compiled to branch asm.)\r\n* [Static branch prediction on newer Intel processors][11] - what CPUs actually do when running a branch instruction that doesn&#39;t have a dynamic prediction available.  Historically, forward not-taken (like an `if` or `break`), backward taken (like a loop) has been used because it&#39;s better than nothing.  Laying out code so the fast path / common case minimizes taken branches is good for I-cache density as well as static prediction, so compilers already do that.  (That&#39;s the [real effect][12] of `likely` / `unlikely` hints in C source, not actually hinting the hardware branch prediction in most CPU, except maybe via static prediction.)\r\n\r\n\r\n  [1]: https://en.wikipedia.org/wiki/Pipeline_(computing)#Concept_and_motivation\r\n  [2]: https://www.lighterra.com/papers/modernmicroprocessors/\r\n  [3]: https://en.wikipedia.org/wiki/Classic_RISC_pipeline\r\n  [4]: http://i.stack.imgur.com/PqBBR.png\r\n  [5]: http://i.stack.imgur.com/0H4gP.png\r\n  [6]: http://i.stack.imgur.com/APpca.png\r\n  [7]: http://i.stack.imgur.com/ZYUbs.png\r\n  [8]: https://en.wikipedia.org/wiki/Branch_predictor\r\n  [9]: https://danluu.com/branch-prediction/\r\n  [10]: https://hal.inria.fr/hal-01100647/document\r\n  [11]: https://xania.org/201602/bpu-part-one\r\n  [12]: https://stackoverflow.com/questions/1851299/is-it-possible-to-tell-the-branch-predictor-how-likely-it-is-to-follow-the-branc","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>The above behavior is happening because of Branch prediction.</p>\n<p>To understand branch prediction one must first understand an <strong>Instruction Pipeline.</strong></p>\n<p>The the steps of running an instruction can be overlapped with the sequence of steps of running the previous and next instruction, so that different steps can be executed concurrently in parallel. This technique is known as instruction pipelining and is used to increase throughput in modern processors. To understand this better please see this <a href=\"https://en.wikipedia.org/wiki/Pipeline_(computing)#Concept_and_motivation\" rel=\"noreferrer\">example on Wikipedia</a>.</p>\n<p>Generally, modern processors have quite long (and wide) pipelines, so many instruction can be in flight.  See <a href=\"https://www.lighterra.com/papers/modernmicroprocessors/\" rel=\"noreferrer\">Modern Microprocessors\nA 90-Minute Guide!</a> which starts by introducing basic in-order pipelining and goes from there.</p>\n<p>But for ease <strong>let's consider a simple in-order pipeline with these 4 steps only.</strong><br />\n(Like a <a href=\"https://en.wikipedia.org/wiki/Classic_RISC_pipeline\" rel=\"noreferrer\">classic 5-stage RISC</a>, but omitting a separate MEM stage.)</p>\n<ol>\n<li>IF -- Fetch the instruction from memory</li>\n<li>ID -- Decode the instruction</li>\n<li>EX -- Execute the instruction</li>\n<li>WB -- Write back to CPU register</li>\n</ol>\n<p><strong>4-stage pipeline in general for 2 instructions.</strong><br />\n<img src=\"https://i.stack.imgur.com/PqBBR.png\" alt=\"4-stage pipeline in general\" /></p>\n<p>Moving back to the above question let's consider the following instructions:</p>\n<pre><code>                        A) if (data[c] &gt;= 128)\n                                /\\\n                               /  \\\n                              /    \\\n                        true /      \\ false\n                            /        \\\n                           /          \\\n                          /            \\\n                         /              \\\n              B) sum += data[c];          C) for loop or print().\n</code></pre>\n<p>Without branch prediction, the following would occur:</p>\n<p>To execute instruction B or instruction C the processor will have to wait (<em>stall</em>) till the instruction A leaves the EX stage in the pipeline, as the decision to go to instruction B or instruction C depends on the result of instruction A.  (i.e. where to fetch from next.) So the pipeline will look like this:</p>\n<p><em><strong>Without prediction: when <code>if</code> condition is true:</strong></em>\n<img src=\"https://i.stack.imgur.com/0H4gP.png\" alt=\"enter image description here\" /></p>\n<p><em><strong>Without prediction: When <code>if</code> condition is false:</strong></em>\n<img src=\"https://i.stack.imgur.com/APpca.png\" alt=\"enter image description here\" /></p>\n<p>As a result of waiting for the result of instruction A, the total CPU cycles spent in the above case (without branch prediction; for both true and false) is 7.</p>\n<p><strong>So what is branch prediction?</strong></p>\n<p>Branch predictor will try to guess which way a branch (an if-then-else structure) will go before this is known for sure. It will not wait for the instruction A to reach the EX stage of the pipeline, but it will guess the decision and go to that instruction (B or C in case of our example).</p>\n<p><em><strong>In case of a correct guess, the pipeline looks something like this:</strong></em>\n<img src=\"https://i.stack.imgur.com/ZYUbs.png\" alt=\"enter image description here\" /></p>\n<p>If it is later detected that the guess was wrong then the partially executed instructions are discarded and the pipeline starts over with the correct branch, incurring a delay.\nThe time that is wasted in case of a branch misprediction is equal to the number of stages in the pipeline from the fetch stage to the execute stage. Modern microprocessors tend to have quite long pipelines so that the misprediction delay is between 10 and 20 clock cycles. The longer the pipeline the greater the need for a good <a href=\"https://en.wikipedia.org/wiki/Branch_predictor\" rel=\"noreferrer\">branch predictor</a>.</p>\n<p>In the OP's code, the first time when the conditional, the branch predictor does not have any information to base up prediction, so the first time it will randomly choose the next instruction. (Or fall back to <em>static</em> prediction, typically forward not-taken, backward taken).  Later in the for loop, it can base the prediction on the history.\nFor an array sorted in ascending order, there are three possibilities:</p>\n<ol>\n<li> All the elements are less than 128\n<li> All the elements are greater than 128\n<li> Some starting new elements are less than 128 and later it become greater than 128\n</ol>\n<p>Let us assume that the predictor will always assume the true branch on the first run.</p>\n<p>So in the first case, it will always take the true branch since historically all its predictions are correct.\nIn the 2nd case, initially it will predict wrong, but after a few iterations, it will predict correctly.\nIn the 3rd case, it will initially predict correctly till the elements are less than 128. After which it will fail for some time and the correct itself when it sees branch prediction failure in history.</p>\n<p>In all these cases the failure will be too less in number and as a result, only a few times it will need to discard the partially executed instructions and start over with the correct branch, resulting in fewer CPU cycles.</p>\n<p>But in case of a random unsorted array, the prediction will need to discard the partially executed instructions and start over with the correct branch most of the time and result in more CPU cycles compared to the sorted array.</p>\n<hr />\n<p>Further reading:</p>\n<ul>\n<li><a href=\"https://www.lighterra.com/papers/modernmicroprocessors/\" rel=\"noreferrer\">Modern Microprocessors\nA 90-Minute Guide!</a></li>\n<li><a href=\"https://danluu.com/branch-prediction/\" rel=\"noreferrer\">Dan Luu's article on branch prediction</a> (which covers older branch predictors, not modern IT-TAGE or Perceptron)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Branch_predictor\" rel=\"noreferrer\">https://en.wikipedia.org/wiki/Branch_predictor</a></li>\n<li><a href=\"https://hal.inria.fr/hal-01100647/document\" rel=\"noreferrer\">Branch Prediction and the Performance of Interpreters -\nDon’t Trust Folklore</a> - 2015 paper showing how well Intel's Haswell does at predicting the indirect branch of a Python interpreter's main loop (historically problematic due to a non-simple pattern), vs. earlier CPUs which didn't use IT-TAGE.  (They don't help with this fully random case, though.  Still 50% mispredict rate for the if inside the loop on a Skylake CPU when the source is compiled to branch asm.)</li>\n<li><a href=\"https://xania.org/201602/bpu-part-one\" rel=\"noreferrer\">Static branch prediction on newer Intel processors</a> - what CPUs actually do when running a branch instruction that doesn't have a dynamic prediction available.  Historically, forward not-taken (like an <code>if</code> or <code>break</code>), backward taken (like a loop) has been used because it's better than nothing.  Laying out code so the fast path / common case minimizes taken branches is good for I-cache density as well as static prediction, so compilers already do that.  (That's the <a href=\"https://stackoverflow.com/questions/1851299/is-it-possible-to-tell-the-branch-predictor-how-likely-it-is-to-follow-the-branc\">real effect</a> of <code>likely</code> / <code>unlikely</code> hints in C source, not actually hinting the hardware branch prediction in most CPU, except maybe via static prediction.)</li>\n</ul>\n"},{"tags":[],"owner":{"account_id":1380009,"reputation":16725,"user_id":1313233,"accept_rate":82,"display_name":"rkachach"},"comment_count":0,"down_vote_count":2,"up_vote_count":857,"is_accepted":false,"score":855,"last_activity_date":1477650491,"creation_date":1443020267,"answer_id":32742980,"question_id":11227809,"body_markdown":"In the same line (I think this was not highlighted by any answer) it&#39;s good to mention that sometimes (specially in software where the performance matters—like in the Linux kernel) you can find some if statements like the following:\r\n\r\n    if (likely( everything_is_ok ))\r\n    {\r\n        /* Do something */\r\n    }\r\n\r\nor similarly:\r\n\r\n    if (unlikely(very_improbable_condition))\r\n    {\r\n        /* Do something */    \r\n    }\r\n\r\nBoth `likely()` and `unlikely()` are in fact macros that are defined by using something like the GCC&#39;s `__builtin_expect` to help the compiler insert prediction code to favour the condition taking into account the information provided by the user. GCC supports other builtins that could change the behavior of the running program or emit low level instructions like clearing the cache, etc. See [this documentation][1] that goes through the available GCC&#39;s builtins.\r\n\r\nNormally this kind of optimizations are mainly found in hard-real time applications or embedded systems where execution time matters and it&#39;s critical. For example, if you are checking for some error condition that only happens 1/10000000 times, then why not inform the compiler about this? This way, by default, the branch prediction would assume that the condition is false.\r\n\r\n\r\n  [1]: https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>In the same line (I think this was not highlighted by any answer) it's good to mention that sometimes (specially in software where the performance matters—like in the Linux kernel) you can find some if statements like the following:</p>\n\n<pre><code>if (likely( everything_is_ok ))\n{\n    /* Do something */\n}\n</code></pre>\n\n<p>or similarly:</p>\n\n<pre><code>if (unlikely(very_improbable_condition))\n{\n    /* Do something */    \n}\n</code></pre>\n\n<p>Both <code>likely()</code> and <code>unlikely()</code> are in fact macros that are defined by using something like the GCC's <code>__builtin_expect</code> to help the compiler insert prediction code to favour the condition taking into account the information provided by the user. GCC supports other builtins that could change the behavior of the running program or emit low level instructions like clearing the cache, etc. See <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html\" rel=\"noreferrer\">this documentation</a> that goes through the available GCC's builtins.</p>\n\n<p>Normally this kind of optimizations are mainly found in hard-real time applications or embedded systems where execution time matters and it's critical. For example, if you are checking for some error condition that only happens 1/10000000 times, then why not inform the compiler about this? This way, by default, the branch prediction would assume that the condition is false.</p>\n"},{"tags":[],"owner":{"account_id":6300346,"reputation":9435,"user_id":4895229,"display_name":"Maciej"},"comment_count":0,"down_vote_count":4,"up_vote_count":836,"is_accepted":false,"score":832,"last_activity_date":1559234066,"creation_date":1444437042,"answer_id":33048998,"question_id":11227809,"body_markdown":"Frequently used Boolean operations in C++ produce many branches in the compiled program. If these branches are inside loops and are hard to predict they can slow down execution significantly. Boolean variables are stored as 8-bit integers with the value `0` for `false` and `1` for `true`.\r\n\r\nBoolean variables are overdetermined in the sense that all operators that have Boolean variables as input check if the inputs have any other value than `0` or `1`, but operators that have Booleans as output can produce no other value than `0` or `1`. This makes operations with Boolean variables as input less efficient than necessary.\r\nConsider example:\r\n\r\n    bool a, b, c, d;\r\n    c = a &amp;&amp; b;\r\n    d = a || b;\r\nThis is typically implemented by the compiler in the following way:\r\n\r\n    bool a, b, c, d;\r\n    if (a != 0) {\r\n        if (b != 0) {\r\n            c = 1;\r\n        }\r\n        else {\r\n            goto CFALSE;\r\n        }\r\n    }\r\n    else {\r\n        CFALSE:\r\n        c = 0;\r\n    }\r\n    if (a == 0) {\r\n        if (b == 0) {\r\n            d = 0;\r\n        }\r\n        else {\r\n            goto DTRUE;\r\n        }\r\n    }\r\n    else {\r\n        DTRUE:\r\n        d = 1;\r\n    }\r\nThis code is far from optimal. The branches may take a long time in case of mispredictions. The Boolean operations can be made much more efficient if it is known with certainty that the operands have no other values than `0` and `1`. The reason why the compiler does not make such an assumption is that the variables might have other values if they are uninitialized or come from unknown sources. The above code can be optimized if `a` and `b` has been initialized to valid values or if they come from operators that produce Boolean output. The optimized code looks like this:\r\n\r\n    char a = 0, b = 1, c, d;\r\n    c = a &amp; b;\r\n    d = a | b;\r\n`char` is used instead of `bool` in order to make it possible to use the bitwise operators (`&amp;` and `|`) instead of the Boolean operators (`&amp;&amp;` and `||`). The bitwise operators are single instructions that take only one clock cycle. The OR operator (`|`) works even if `a` and `b` have other values than `0` or `1`. The AND operator (`&amp;`) and the EXCLUSIVE OR operator (`^`) may give inconsistent results if the operands have other values than `0` and `1`.\r\n\r\n`~` can not be used for NOT. Instead, you can make a Boolean NOT on a variable which is known to be `0` or `1` by XOR&#39;ing it with `1`:\r\n\r\n    bool a, b;\r\n    b = !a;\r\ncan be optimized to:\r\n\r\n    char a = 0, b;\r\n    b = a ^ 1;\r\n`a &amp;&amp; b` cannot be replaced with `a &amp; b` if `b` is an expression that should not be evaluated if `a` is `false` ( `&amp;&amp;` will not evaluate `b`, `&amp;` will). Likewise, `a || b` can not be replaced with `a | b` if `b` is an expression that should not be evaluated if `a` is `true`.\r\n\r\nUsing bitwise operators is more advantageous if the operands are variables than if the operands are comparisons:\r\n\r\n    bool a; double x, y, z;\r\n    a = x &gt; y &amp;&amp; z &lt; 5.0;\r\nis optimal in most cases (unless you expect the `&amp;&amp;` expression to generate many branch mispredictions).","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>Frequently used Boolean operations in C++ produce many branches in the compiled program. If these branches are inside loops and are hard to predict they can slow down execution significantly. Boolean variables are stored as 8-bit integers with the value <code>0</code> for <code>false</code> and <code>1</code> for <code>true</code>.</p>\n\n<p>Boolean variables are overdetermined in the sense that all operators that have Boolean variables as input check if the inputs have any other value than <code>0</code> or <code>1</code>, but operators that have Booleans as output can produce no other value than <code>0</code> or <code>1</code>. This makes operations with Boolean variables as input less efficient than necessary.\nConsider example:</p>\n\n<pre><code>bool a, b, c, d;\nc = a &amp;&amp; b;\nd = a || b;\n</code></pre>\n\n<p>This is typically implemented by the compiler in the following way:</p>\n\n<pre><code>bool a, b, c, d;\nif (a != 0) {\n    if (b != 0) {\n        c = 1;\n    }\n    else {\n        goto CFALSE;\n    }\n}\nelse {\n    CFALSE:\n    c = 0;\n}\nif (a == 0) {\n    if (b == 0) {\n        d = 0;\n    }\n    else {\n        goto DTRUE;\n    }\n}\nelse {\n    DTRUE:\n    d = 1;\n}\n</code></pre>\n\n<p>This code is far from optimal. The branches may take a long time in case of mispredictions. The Boolean operations can be made much more efficient if it is known with certainty that the operands have no other values than <code>0</code> and <code>1</code>. The reason why the compiler does not make such an assumption is that the variables might have other values if they are uninitialized or come from unknown sources. The above code can be optimized if <code>a</code> and <code>b</code> has been initialized to valid values or if they come from operators that produce Boolean output. The optimized code looks like this:</p>\n\n<pre><code>char a = 0, b = 1, c, d;\nc = a &amp; b;\nd = a | b;\n</code></pre>\n\n<p><code>char</code> is used instead of <code>bool</code> in order to make it possible to use the bitwise operators (<code>&amp;</code> and <code>|</code>) instead of the Boolean operators (<code>&amp;&amp;</code> and <code>||</code>). The bitwise operators are single instructions that take only one clock cycle. The OR operator (<code>|</code>) works even if <code>a</code> and <code>b</code> have other values than <code>0</code> or <code>1</code>. The AND operator (<code>&amp;</code>) and the EXCLUSIVE OR operator (<code>^</code>) may give inconsistent results if the operands have other values than <code>0</code> and <code>1</code>.</p>\n\n<p><code>~</code> can not be used for NOT. Instead, you can make a Boolean NOT on a variable which is known to be <code>0</code> or <code>1</code> by XOR'ing it with <code>1</code>:</p>\n\n<pre><code>bool a, b;\nb = !a;\n</code></pre>\n\n<p>can be optimized to:</p>\n\n<pre><code>char a = 0, b;\nb = a ^ 1;\n</code></pre>\n\n<p><code>a &amp;&amp; b</code> cannot be replaced with <code>a &amp; b</code> if <code>b</code> is an expression that should not be evaluated if <code>a</code> is <code>false</code> ( <code>&amp;&amp;</code> will not evaluate <code>b</code>, <code>&amp;</code> will). Likewise, <code>a || b</code> can not be replaced with <code>a | b</code> if <code>b</code> is an expression that should not be evaluated if <code>a</code> is <code>true</code>.</p>\n\n<p>Using bitwise operators is more advantageous if the operands are variables than if the operands are comparisons:</p>\n\n<pre><code>bool a; double x, y, z;\na = x &gt; y &amp;&amp; z &lt; 5.0;\n</code></pre>\n\n<p>is optimal in most cases (unless you expect the <code>&amp;&amp;</code> expression to generate many branch mispredictions).</p>\n"},{"tags":[],"owner":{"account_id":4991025,"reputation":15651,"user_id":4013258,"display_name":"Surt"},"comment_count":0,"down_vote_count":2,"up_vote_count":896,"is_accepted":false,"score":894,"last_activity_date":1485862773,"creation_date":1444597518,"answer_id":33070112,"question_id":11227809,"body_markdown":"An official answer would be from\r\n\r\n 1. [Intel - Avoiding the Cost of Branch Misprediction][1]\r\n 2. [Intel - Branch and Loop Reorganization to Prevent Mispredicts][2]\r\n 3. [Scientific papers - branch prediction computer architecture][3]\r\n 4. Books: J.L. Hennessy, D.A. Patterson: Computer architecture: a quantitative approach\r\n 5. Articles in scientific publications: T.Y. Yeh, Y.N. Patt made a lot of these on branch predictions.\r\n\r\nYou can also see from this lovely [diagram][4] why the branch predictor gets confused.\r\n\r\n[![2-bit state diagram][5]][5]\r\n\r\nEach element in the original code is a random value\r\n\r\n    data[c] = std::rand() % 256;\r\n\r\nso the predictor will change sides as the `std::rand()` blow.\r\n\r\nOn the other hand, once it&#39;s sorted, the predictor will first move into a state of strongly not taken and when the values change to the high value the predictor will in three runs through change all the way from strongly not taken to strongly taken.\r\n\r\n  [1]: https://software.intel.com/en-us/articles/avoiding-the-cost-of-branch-misprediction\r\n  [2]: https://software.intel.com/en-us/articles/branch-and-loop-reorganization-to-prevent-mispredicts\r\n  [3]: https://scholar.google.com/scholar?q=branch%20prediction%20computer%20architecture&amp;hl=da&amp;as_sdt=0&amp;as_vis=1&amp;oi=scholart\r\n  [4]: https://en.wikipedia.org/wiki/Branch_predictor#/media/File:Branch_prediction_2bit_saturating_counter-dia.svg\r\n  [5]: https://i.stack.imgur.com/pBMV2.png\r\n** **\r\n\r\n\r\n\r\n\r\n\r\n","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>An official answer would be from</p>\n\n<ol>\n<li><a href=\"https://software.intel.com/en-us/articles/avoiding-the-cost-of-branch-misprediction\" rel=\"noreferrer\">Intel - Avoiding the Cost of Branch Misprediction</a></li>\n<li><a href=\"https://software.intel.com/en-us/articles/branch-and-loop-reorganization-to-prevent-mispredicts\" rel=\"noreferrer\">Intel - Branch and Loop Reorganization to Prevent Mispredicts</a></li>\n<li><a href=\"https://scholar.google.com/scholar?q=branch%20prediction%20computer%20architecture&amp;hl=da&amp;as_sdt=0&amp;as_vis=1&amp;oi=scholart\" rel=\"noreferrer\">Scientific papers - branch prediction computer architecture</a></li>\n<li>Books: J.L. Hennessy, D.A. Patterson: Computer architecture: a quantitative approach</li>\n<li>Articles in scientific publications: T.Y. Yeh, Y.N. Patt made a lot of these on branch predictions.</li>\n</ol>\n\n<p>You can also see from this lovely <a href=\"https://en.wikipedia.org/wiki/Branch_predictor#/media/File:Branch_prediction_2bit_saturating_counter-dia.svg\" rel=\"noreferrer\">diagram</a> why the branch predictor gets confused.</p>\n\n<p><a href=\"https://i.stack.imgur.com/pBMV2.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/pBMV2.png\" alt=\"2-bit state diagram\"></a></p>\n\n<p>Each element in the original code is a random value</p>\n\n<pre><code>data[c] = std::rand() % 256;\n</code></pre>\n\n<p>so the predictor will change sides as the <code>std::rand()</code> blow.</p>\n\n<p>On the other hand, once it's sorted, the predictor will first move into a state of strongly not taken and when the values change to the high value the predictor will in three runs through change all the way from strongly not taken to strongly taken.</p>\n\n<hr>\n"},{"comments":[{"owner":{"account_id":24885,"reputation":30828,"user_id":63550,"accept_rate":78,"display_name":"Peter Mortensen"},"score":7,"creation_date":1521204439,"post_id":41603849,"comment_id":85643214,"body_markdown":"That is a very interesting article (in fact, I have just read all of it), but how does it answer the question?","body":"That is a very interesting article (in fact, I have just read all of it), but how does it answer the question?"},{"owner":{"account_id":296548,"reputation":6442,"user_id":601567,"accept_rate":75,"display_name":"ForeverLearning"},"score":5,"creation_date":1521214636,"post_id":41603849,"comment_id":85650402,"body_markdown":"@PeterMortensen I am a bit flummoxed by your question. For example here is one relevant line from that piece:\n\n`When the input is unsorted, all the rest of the loop takes substantial time. But with sorted input, the processor is somehow able to spend not just less time in the body of the loop, meaning the buckets at offsets 0x18 and 0x1C, but vanishingly little time on the mechanism of looping.`\n\nAuthor is trying to discuss profiling in the context of code posted here and in the process trying to explain why the sorted case is so much more faster.","body":"@PeterMortensen I am a bit flummoxed by your question. For example here is one relevant line from that piece:  <code>When the input is unsorted, all the rest of the loop takes substantial time. But with sorted input, the processor is somehow able to spend not just less time in the body of the loop, meaning the buckets at offsets 0x18 and 0x1C, but vanishingly little time on the mechanism of looping.</code>  Author is trying to discuss profiling in the context of code posted here and in the process trying to explain why the sorted case is so much more faster."}],"tags":[],"owner":{"account_id":296548,"reputation":6442,"user_id":601567,"accept_rate":75,"display_name":"ForeverLearning"},"comment_count":2,"down_vote_count":4,"up_vote_count":448,"is_accepted":false,"score":444,"last_activity_date":1610293840,"creation_date":1484185828,"answer_id":41603849,"question_id":11227809,"body_markdown":"This question has already been answered excellently many times over. Still I&#39;d like to draw the group&#39;s attention to yet another interesting analysis.\r\n\r\nRecently this example (modified very slightly) was also used as a way to demonstrate how a piece of code can be profiled within the program itself on Windows. Along the way, the author also shows how to use the results to determine where the code is spending most of its time in both the sorted &amp; unsorted case. Finally the piece also shows how to use a little known feature of the HAL (Hardware Abstraction Layer) to determine just how much branch misprediction is happening in the unsorted case.\r\n\r\nThe link is here:\r\n[**A Demonstration of Self-Profiling**](//www.geoffchappell.com/studies/windows/km/ntoskrnl/api/ex/profile/demo.htm)","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>This question has already been answered excellently many times over. Still I'd like to draw the group's attention to yet another interesting analysis.</p>\n<p>Recently this example (modified very slightly) was also used as a way to demonstrate how a piece of code can be profiled within the program itself on Windows. Along the way, the author also shows how to use the results to determine where the code is spending most of its time in both the sorted &amp; unsorted case. Finally the piece also shows how to use a little known feature of the HAL (Hardware Abstraction Layer) to determine just how much branch misprediction is happening in the unsorted case.</p>\n<p>The link is here:\n<a href=\"//www.geoffchappell.com/studies/windows/km/ntoskrnl/api/ex/profile/demo.htm\" rel=\"noreferrer\"><strong>A Demonstration of Self-Profiling</strong></a></p>\n"},{"tags":[],"owner":{"account_id":7086416,"reputation":101239,"user_id":5423108,"display_name":"Alireza"},"comment_count":0,"down_vote_count":2,"up_vote_count":496,"is_accepted":false,"score":494,"last_activity_date":1683739673,"creation_date":1497786043,"answer_id":44614591,"question_id":11227809,"body_markdown":"That&#39;s for sure!...\r\n\r\n**Branch prediction** makes the logic run slower, because of the switching which happens in your code! It&#39;s like you are going a straight street or a street with a lot of turnings, for sure the straight one is going to be done quicker!...\r\n\r\nIf the array is sorted, your condition is false at the first step: `data[c] &gt;= 128`, then becomes a true value for the whole way to the end of the street. That&#39;s how you get to the end of the logic faster. On the other hand, using an unsorted array, you need a lot of turning and processing which make your code run slower for sure...\r\n\r\nLook at the image I created for you below. Which street is going to be finished faster?\r\n\r\n[![Branch Prediction][1]][1]\r\n\r\nSo programmatically, **branch prediction** causes the process to be slower...\r\n\r\nAlso at the end, it&#39;s good to know we have two kinds of branch predictions that each is going to affect your code differently:\r\n\r\n **1. Static**\r\n\r\n **2. Dynamic**\r\n\r\n[![Branch Prediction][2]][2]\r\n\r\nSee also [this document from Intel](https://web.archive.org/web/20100315172026/http://software.intel.com/en-us/articles/branch-and-loop-reorganization-to-prevent-mispredicts/), which says:\r\n&gt; Static branch prediction is used by the microprocessor the first time\r\n&gt; a conditional branch is encountered, and dynamic branch prediction is\r\n&gt; used for succeeding executions of the conditional branch code.\r\n&gt;\r\n&gt; In order to effectively write your code to take advantage of these\r\n&gt; rules, when writing **if-else** or **switch** statements, check the most\r\n&gt; common cases first and work progressively down to the least common.\r\n&gt; Loops do not necessarily require any special ordering of code for\r\n&gt; static branch prediction, as only the condition of the loop iterator\r\n&gt; is normally used.\r\n\r\n  [1]: https://i.stack.imgur.com/cSmCa.jpg\r\n  [2]: https://i.stack.imgur.com/ZfhDu.jpg\r\n\r\n","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>That's for sure!...</p>\n<p><strong>Branch prediction</strong> makes the logic run slower, because of the switching which happens in your code! It's like you are going a straight street or a street with a lot of turnings, for sure the straight one is going to be done quicker!...</p>\n<p>If the array is sorted, your condition is false at the first step: <code>data[c] &gt;= 128</code>, then becomes a true value for the whole way to the end of the street. That's how you get to the end of the logic faster. On the other hand, using an unsorted array, you need a lot of turning and processing which make your code run slower for sure...</p>\n<p>Look at the image I created for you below. Which street is going to be finished faster?</p>\n<p><a href=\"https://i.stack.imgur.com/cSmCa.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/cSmCa.jpg\" alt=\"Branch Prediction\" /></a></p>\n<p>So programmatically, <strong>branch prediction</strong> causes the process to be slower...</p>\n<p>Also at the end, it's good to know we have two kinds of branch predictions that each is going to affect your code differently:</p>\n<p><strong>1. Static</strong></p>\n<p><strong>2. Dynamic</strong></p>\n<p><a href=\"https://i.stack.imgur.com/ZfhDu.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/ZfhDu.jpg\" alt=\"Branch Prediction\" /></a></p>\n<p>See also <a href=\"https://web.archive.org/web/20100315172026/http://software.intel.com/en-us/articles/branch-and-loop-reorganization-to-prevent-mispredicts/\" rel=\"noreferrer\">this document from Intel</a>, which says:</p>\n<blockquote>\n<p>Static branch prediction is used by the microprocessor the first time\na conditional branch is encountered, and dynamic branch prediction is\nused for succeeding executions of the conditional branch code.</p>\n<p>In order to effectively write your code to take advantage of these\nrules, when writing <strong>if-else</strong> or <strong>switch</strong> statements, check the most\ncommon cases first and work progressively down to the least common.\nLoops do not necessarily require any special ordering of code for\nstatic branch prediction, as only the condition of the loop iterator\nis normally used.</p>\n</blockquote>\n"},{"comments":[{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":2,"creation_date":1581307668,"post_id":45503985,"comment_id":106374699,"body_markdown":"*While flushing pipelines is super fast*  Not really.  It&#39;s fast compared to a cache miss all the way to DRAM, but on a modern high-performance x86 (like Intel Sandybridge-family) it&#39;s about a dozen cycles.  Although fast recovery does allow it to avoid waiting for all older independent instructions to reach retirement before starting recovery, you still lose a lot of front-end cycles on a mispredict.  [What exactly happens when a skylake CPU mispredicts a branch?](//stackoverflow.com/q/50984007).  (And each cycle can be about 4 instructions of work.)  Bad for high-throughput code.","body":"<i>While flushing pipelines is super fast</i>  Not really.  It&#39;s fast compared to a cache miss all the way to DRAM, but on a modern high-performance x86 (like Intel Sandybridge-family) it&#39;s about a dozen cycles.  Although fast recovery does allow it to avoid waiting for all older independent instructions to reach retirement before starting recovery, you still lose a lot of front-end cycles on a mispredict.  <a href=\"//stackoverflow.com/q/50984007\">What exactly happens when a skylake CPU mispredicts a branch?</a>.  (And each cycle can be about 4 instructions of work.)  Bad for high-throughput code."}],"tags":[],"owner":{"account_id":8730423,"reputation":14290,"user_id":6530695,"accept_rate":98,"display_name":"Tony Tannous"},"comment_count":1,"down_vote_count":2,"up_vote_count":313,"is_accepted":false,"score":311,"last_activity_date":1521203445,"creation_date":1501841232,"answer_id":45503985,"question_id":11227809,"body_markdown":"**Branch-prediction gain!**\n\nIt is important to understand that branch misprediction doesn&#39;t slow down programs. The cost of a missed prediction is just as if branch prediction didn&#39;t exist and you waited for the evaluation of the expression to decide what code to run (further explanation in the next paragraph).\n\n    if (expression)\n    {\n        // Run 1\n    } else {\n        // Run 2\n    }\n\nWhenever there&#39;s an `if-else` \\ `switch` statement, the expression has to be evaluated to determine which block should be executed. In the assembly code generated by the compiler, conditional [branch][1] instructions are inserted.\n\nA branch instruction can cause a computer to begin executing a different instruction sequence and thus deviate from its default behavior of executing instructions in order (i.e. if the expression is false, the program skips the code of the `if` block) depending on some condition, which is the expression evaluation in our case.\n\nThat being said, the compiler tries to predict the outcome prior to it being actually evaluated. It will fetch instructions from the `if` block, and if the expression turns out to be true, then wonderful! We gained the time it took to evaluate it and made progress in the code; if not then we are running the wrong code, the pipeline is flushed, and the correct block is run.\n\n### Visualization:\n\nLet&#39;s say you need to pick route 1 or route 2. Waiting for your partner to check the map, you have stopped at ## and waited, or you could just pick route1 and if you were lucky (route 1 is the correct route), then great you didn&#39;t have to wait for your partner to check the map (you saved the time it would have taken him to check the map), otherwise you will just turn back.\n\nWhile flushing pipelines is super fast, nowadays taking this gamble is worth it. Predicting sorted data or a data that changes slowly is always easier and better than predicting fast changes.\n\n\n     O      Route 1  /-------------------------------\n    /|\\             /\n     |  ---------##/\n    / \\            \\\n                    \\\n            Route 2  \\--------------------------------\n\n  [1]: https://en.wikipedia.org/wiki/Branch_(computer_science)\n\n","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p><strong>Branch-prediction gain!</strong></p>\n<p>It is important to understand that branch misprediction doesn't slow down programs. The cost of a missed prediction is just as if branch prediction didn't exist and you waited for the evaluation of the expression to decide what code to run (further explanation in the next paragraph).</p>\n<pre><code>if (expression)\n{\n    // Run 1\n} else {\n    // Run 2\n}\n</code></pre>\n<p>Whenever there's an <code>if-else</code> \\ <code>switch</code> statement, the expression has to be evaluated to determine which block should be executed. In the assembly code generated by the compiler, conditional <a href=\"https://en.wikipedia.org/wiki/Branch_(computer_science)\" rel=\"noreferrer\">branch</a> instructions are inserted.</p>\n<p>A branch instruction can cause a computer to begin executing a different instruction sequence and thus deviate from its default behavior of executing instructions in order (i.e. if the expression is false, the program skips the code of the <code>if</code> block) depending on some condition, which is the expression evaluation in our case.</p>\n<p>That being said, the compiler tries to predict the outcome prior to it being actually evaluated. It will fetch instructions from the <code>if</code> block, and if the expression turns out to be true, then wonderful! We gained the time it took to evaluate it and made progress in the code; if not then we are running the wrong code, the pipeline is flushed, and the correct block is run.</p>\n<h3>Visualization:</h3>\n<p>Let's say you need to pick route 1 or route 2. Waiting for your partner to check the map, you have stopped at ## and waited, or you could just pick route1 and if you were lucky (route 1 is the correct route), then great you didn't have to wait for your partner to check the map (you saved the time it would have taken him to check the map), otherwise you will just turn back.</p>\n<p>While flushing pipelines is super fast, nowadays taking this gamble is worth it. Predicting sorted data or a data that changes slowly is always easier and better than predicting fast changes.</p>\n<pre><code> O      Route 1  /-------------------------------\n/|\\             /\n |  ---------##/\n/ \\            \\\n                \\\n        Route 2  \\--------------------------------\n</code></pre>\n"},{"comments":[{"owner":{"account_id":1907209,"reputation":1595,"user_id":1734032,"display_name":"mckenzm"},"score":9,"creation_date":1564377256,"post_id":47141245,"comment_id":100995393,"body_markdown":"Almost as good as the Intel marketing animations, and they were obsessed not just with branch prediction but out of order execution, both strategies being &quot;speculative&quot;. Reading ahead in memory and storage (sequential pre-fetch to buffer) is also speculative. It all adds up.","body":"Almost as good as the Intel marketing animations, and they were obsessed not just with branch prediction but out of order execution, both strategies being &quot;speculative&quot;. Reading ahead in memory and storage (sequential pre-fetch to buffer) is also speculative. It all adds up."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":8,"creation_date":1581307399,"post_id":47141245,"comment_id":106374648,"body_markdown":"@mckenzm: out-of-order speculative exec makes branch prediction even more valuable; as well as hiding fetch/decode bubbles, branch prediction + speculative exec removes control dependencies from critical path latency.  Code inside or after an `if()` block can execute *before* the branch condition is known.  Or for a search loop like `strlen` or `memchr`, interations can overlap.  If you had to wait for the match-or-not result to be known before running any of the next iteration, you&#39;d bottleneck on cache load + ALU latency instead of throughput.","body":"@mckenzm: out-of-order speculative exec makes branch prediction even more valuable; as well as hiding fetch/decode bubbles, branch prediction + speculative exec removes control dependencies from critical path latency.  Code inside or after an <code>if()</code> block can execute <i>before</i> the branch condition is known.  Or for a search loop like <code>strlen</code> or <code>memchr</code>, interations can overlap.  If you had to wait for the match-or-not result to be known before running any of the next iteration, you&#39;d bottleneck on cache load + ALU latency instead of throughput."},{"owner":{"account_id":12415846,"reputation":628,"user_id":9045408,"display_name":"Justin Meskan"},"score":5,"creation_date":1593562749,"post_id":47141245,"comment_id":110823751,"body_markdown":"Did you make the example app in JavaFX?","body":"Did you make the example app in JavaFX?"},{"owner":{"account_id":4116853,"reputation":10757,"user_id":3378204,"accept_rate":91,"display_name":"Eugene"},"score":4,"creation_date":1593566091,"post_id":47141245,"comment_id":110824362,"body_markdown":"@HannaMcquaig No, it&#39;s made by Swing. The code is available at https://github.com/Eugene-Mark/branch-predictor-demo.","body":"@HannaMcquaig No, it&#39;s made by Swing. The code is available at <a href=\"https://github.com/Eugene-Mark/branch-predictor-demo\" rel=\"nofollow noreferrer\">github.com/Eugene-Mark/branch-predictor-demo</a>."}],"tags":[],"owner":{"account_id":4116853,"reputation":10757,"user_id":3378204,"accept_rate":91,"display_name":"Eugene"},"comment_count":4,"down_vote_count":1,"up_vote_count":407,"is_accepted":false,"score":406,"last_activity_date":1581300329,"creation_date":1509984916,"answer_id":47141245,"question_id":11227809,"body_markdown":"As what has already been mentioned by others, what behind the mystery is [Branch Predictor][1]. \r\n\r\nI&#39;m not trying to add something but explaining the concept in another way. \r\nThere is a concise introduction on the wiki which contains text and diagram.\r\nI do like the explanation below which uses a diagram to elaborate the Branch Predictor intuitively.\r\n\r\n&gt; In computer architecture, a branch predictor is a\r\n&gt; digital circuit that tries to guess which way a branch (e.g. an\r\n&gt; if-then-else structure) will go before this is known for sure. The\r\n&gt; purpose of the branch predictor is to improve the flow in the\r\n&gt; instruction pipeline. Branch predictors play a critical role in\r\n&gt; achieving high effective performance in many modern pipelined\r\n&gt; microprocessor architectures such as x86.\r\n&gt; \r\n&gt; Two-way branching is usually implemented with a conditional jump\r\n&gt; instruction. A conditional jump can either be &quot;not taken&quot; and continue\r\n&gt; execution with the first branch of code which follows immediately\r\n&gt; after the conditional jump, or it can be &quot;taken&quot; and jump to a\r\n&gt; different place in program memory where the second branch of code is\r\n&gt; stored. It is not known for certain whether a conditional jump will be\r\n&gt; taken or not taken until the condition has been calculated and the\r\n&gt; conditional jump has passed the execution stage in the instruction\r\n&gt; pipeline (see fig. 1).\r\n\r\n\r\n\r\n [![figure 1][2]][2]\r\n\r\nBased on the described scenario, I have written an animation demo to show how instructions are executed in a pipeline in different situations.\r\n\r\n 1. Without the Branch Predictor. \r\n\r\n&gt;  Without branch prediction, the processor would have to wait until the\r\n&gt; conditional jump instruction has passed the execute stage before the\r\n&gt; next instruction can enter the fetch stage in the pipeline.\r\n\r\nThe example contains three instructions and the first one is a conditional jump instruction. The latter two instructions can go into the pipeline until the conditional jump instruction is executed. \r\n\r\n[![without branch predictor][3]][3]\r\n\r\nIt will take 9 clock cycles for 3 instructions to be completed.\r\n\r\n 2. Use Branch Predictor and don&#39;t take a conditional jump. Let&#39;s assume that the predict is **not** taking the conditional jump.\r\n\r\n[![enter image description here][4]][4]\r\n\r\nIt will take 7 clock cycles for 3 instructions to be completed.\r\n\r\n 3. Use Branch Predictor and take a conditional jump. Let&#39;s assume that the predict is **not** taking the conditional jump.\r\n\r\n[![enter image description here][5]][5]\r\n\r\nIt will take 9 clock cycles for 3 instructions to be completed.\r\n\r\n&gt; The time that is wasted in case of a branch misprediction is equal to\r\n&gt; the number of stages in the pipeline from the fetch stage to the\r\n&gt; execute stage. Modern microprocessors tend to have quite long\r\n&gt; pipelines so that the misprediction delay is between 10 and 20 clock\r\n&gt; cycles. As a result, making a pipeline longer increases the need for a\r\n&gt; more advanced branch predictor.\r\n\r\nAs you can see, it seems we don&#39;t have a reason not to use Branch Predictor.\r\n\r\nIt&#39;s quite a simple demo that clarifies the very basic part of Branch Predictor. If those gifs are annoying, please feel free to remove them from the answer and visitors can also get the live demo source code from [BranchPredictorDemo][6]\r\n\r\n\r\n  [1]: https://en.wikipedia.org/wiki/Branch_predictor\r\n  [2]: https://i.stack.imgur.com/unxnb.png\r\n  [3]: https://i.stack.imgur.com/GMFQ6.gif\r\n  [4]: https://i.stack.imgur.com/Ms5p1.gif\r\n  [5]: https://i.stack.imgur.com/HIpG3.gif\r\n  [6]: https://github.com/Eugene-Mark/BranchPredictorDemo","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>As what has already been mentioned by others, what behind the mystery is <a href=\"https://en.wikipedia.org/wiki/Branch_predictor\" rel=\"noreferrer\">Branch Predictor</a>. </p>\n\n<p>I'm not trying to add something but explaining the concept in another way. \nThere is a concise introduction on the wiki which contains text and diagram.\nI do like the explanation below which uses a diagram to elaborate the Branch Predictor intuitively.</p>\n\n<blockquote>\n  <p>In computer architecture, a branch predictor is a\n  digital circuit that tries to guess which way a branch (e.g. an\n  if-then-else structure) will go before this is known for sure. The\n  purpose of the branch predictor is to improve the flow in the\n  instruction pipeline. Branch predictors play a critical role in\n  achieving high effective performance in many modern pipelined\n  microprocessor architectures such as x86.</p>\n  \n  <p>Two-way branching is usually implemented with a conditional jump\n  instruction. A conditional jump can either be \"not taken\" and continue\n  execution with the first branch of code which follows immediately\n  after the conditional jump, or it can be \"taken\" and jump to a\n  different place in program memory where the second branch of code is\n  stored. It is not known for certain whether a conditional jump will be\n  taken or not taken until the condition has been calculated and the\n  conditional jump has passed the execution stage in the instruction\n  pipeline (see fig. 1).</p>\n</blockquote>\n\n<p><a href=\"https://i.stack.imgur.com/unxnb.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/unxnb.png\" alt=\"figure 1\"></a></p>\n\n<p>Based on the described scenario, I have written an animation demo to show how instructions are executed in a pipeline in different situations.</p>\n\n<ol>\n<li>Without the Branch Predictor. </li>\n</ol>\n\n<blockquote>\n  <p>Without branch prediction, the processor would have to wait until the\n  conditional jump instruction has passed the execute stage before the\n  next instruction can enter the fetch stage in the pipeline.</p>\n</blockquote>\n\n<p>The example contains three instructions and the first one is a conditional jump instruction. The latter two instructions can go into the pipeline until the conditional jump instruction is executed. </p>\n\n<p><a href=\"https://i.stack.imgur.com/GMFQ6.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/GMFQ6.gif\" alt=\"without branch predictor\"></a></p>\n\n<p>It will take 9 clock cycles for 3 instructions to be completed.</p>\n\n<ol start=\"2\">\n<li>Use Branch Predictor and don't take a conditional jump. Let's assume that the predict is <strong>not</strong> taking the conditional jump.</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/Ms5p1.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Ms5p1.gif\" alt=\"enter image description here\"></a></p>\n\n<p>It will take 7 clock cycles for 3 instructions to be completed.</p>\n\n<ol start=\"3\">\n<li>Use Branch Predictor and take a conditional jump. Let's assume that the predict is <strong>not</strong> taking the conditional jump.</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/HIpG3.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/HIpG3.gif\" alt=\"enter image description here\"></a></p>\n\n<p>It will take 9 clock cycles for 3 instructions to be completed.</p>\n\n<blockquote>\n  <p>The time that is wasted in case of a branch misprediction is equal to\n  the number of stages in the pipeline from the fetch stage to the\n  execute stage. Modern microprocessors tend to have quite long\n  pipelines so that the misprediction delay is between 10 and 20 clock\n  cycles. As a result, making a pipeline longer increases the need for a\n  more advanced branch predictor.</p>\n</blockquote>\n\n<p>As you can see, it seems we don't have a reason not to use Branch Predictor.</p>\n\n<p>It's quite a simple demo that clarifies the very basic part of Branch Predictor. If those gifs are annoying, please feel free to remove them from the answer and visitors can also get the live demo source code from <a href=\"https://github.com/Eugene-Mark/BranchPredictorDemo\" rel=\"noreferrer\">BranchPredictorDemo</a></p>\n"},{"comments":[{"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"score":3,"creation_date":1541507309,"post_id":47457772,"comment_id":93233390,"body_markdown":"Right, but the setup cost of sorting the array is O(N log N), so breaking early doesn&#39;t help you if the only reason you are sorting the array is to be able to break early. If, however, you have other reasons to pre-sort the array, then yes, this is valuable.","body":"Right, but the setup cost of sorting the array is O(N log N), so breaking early doesn&#39;t help you if the only reason you are sorting the array is to be able to break early. If, however, you have other reasons to pre-sort the array, then yes, this is valuable."},{"owner":{"account_id":255796,"reputation":48503,"user_id":536086,"accept_rate":90,"display_name":"Yochai Timmer"},"score":1,"creation_date":1551270202,"post_id":47457772,"comment_id":96577845,"body_markdown":"Depends how many times you sort the data compared to how many times you loop on it. The sort in this example is just an example, it doesn&#39;t have to be just before the loop","body":"Depends how many times you sort the data compared to how many times you loop on it. The sort in this example is just an example, it doesn&#39;t have to be just before the loop"},{"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"score":3,"creation_date":1551356894,"post_id":47457772,"comment_id":96616030,"body_markdown":"Yes, that&#39;s exactly the point I made in my first comment :-) You say &quot;The branch prediction will miss only once.&quot; But you are not counting the O(N log N) branch prediction misses inside the sort algorithm, which is actually greater than the O(N) branch prediction misses in the unsorted case. So you would need to use the entirety of the sorted data O(log N) times to break even (probably actually closer to O(10 log N), depending on the sort algorithm, e.g. for quicksort, due to cache misses -- mergesort is more cache-coherent, so you would need closer to O(2 log N) usages to break even.)","body":"Yes, that&#39;s exactly the point I made in my first comment :-) You say &quot;The branch prediction will miss only once.&quot; But you are not counting the O(N log N) branch prediction misses inside the sort algorithm, which is actually greater than the O(N) branch prediction misses in the unsorted case. So you would need to use the entirety of the sorted data O(log N) times to break even (probably actually closer to O(10 log N), depending on the sort algorithm, e.g. for quicksort, due to cache misses -- mergesort is more cache-coherent, so you would need closer to O(2 log N) usages to break even.)"},{"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"score":1,"creation_date":1551357288,"post_id":47457772,"comment_id":96616273,"body_markdown":"One significant optimization though would be to do only &quot;half a quicksort&quot;, sorting only items less than the target pivot value of 127 (assuming everything less than *or equal to* the pivot is sorted after the pivot). Once you reach the pivot, sum the elements before the pivot. This would run in O(N) startup time rather than O(N log N), although there will still be a lot of branch prediction misses, probably of the order of O(5 N) based on the numbers I gave before, since it&#39;s half a quicksort.","body":"One significant optimization though would be to do only &quot;half a quicksort&quot;, sorting only items less than the target pivot value of 127 (assuming everything less than <i>or equal to</i> the pivot is sorted after the pivot). Once you reach the pivot, sum the elements before the pivot. This would run in O(N) startup time rather than O(N log N), although there will still be a lot of branch prediction misses, probably of the order of O(5 N) based on the numbers I gave before, since it&#39;s half a quicksort."},{"owner":{"account_id":10541,"reputation":5244,"user_id":19974,"accept_rate":100,"display_name":"Jason Short"},"score":0,"creation_date":1657045418,"post_id":47457772,"comment_id":128714705,"body_markdown":"Came here looking for this exact answer.  Early abort is the main reason to sort.  Limit the search space entirely.  In my testing it was 2x faster again by being able to stop looking much earlier in the loop.","body":"Came here looking for this exact answer.  Early abort is the main reason to sort.  Limit the search space entirely.  In my testing it was 2x faster again by being able to stop looking much earlier in the loop."}],"tags":[],"owner":{"account_id":255796,"reputation":48503,"user_id":536086,"accept_rate":90,"display_name":"Yochai Timmer"},"comment_count":5,"down_vote_count":4,"up_vote_count":229,"is_accepted":false,"score":225,"last_activity_date":1551779920,"creation_date":1511447309,"answer_id":47457772,"question_id":11227809,"body_markdown":"Besides the fact that the branch prediction may slow you down, a sorted array has another advantage:   \r\n\r\nYou can have a stop condition instead of just checking the value, this way you only loop over the relevant data, and ignore the rest.   \r\nThe branch prediction will miss only once.\r\n\r\n\r\n\r\n     // sort backwards (higher values first), may be in some other part of the code\r\n     std::sort(data, data + arraySize, std::greater&lt;int&gt;());\r\n\r\n     for (unsigned c = 0; c &lt; arraySize; ++c) {\r\n           if (data[c] &lt; 128) {\r\n                  break;\r\n           }\r\n           sum += data[c];               \r\n     }","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>Besides the fact that the branch prediction may slow you down, a sorted array has another advantage:   </p>\n\n<p>You can have a stop condition instead of just checking the value, this way you only loop over the relevant data, and ignore the rest.<br>\nThe branch prediction will miss only once.</p>\n\n<pre><code> // sort backwards (higher values first), may be in some other part of the code\n std::sort(data, data + arraySize, std::greater&lt;int&gt;());\n\n for (unsigned c = 0; c &lt; arraySize; ++c) {\n       if (data[c] &lt; 128) {\n              break;\n       }\n       sum += data[c];               \n }\n</code></pre>\n"},{"tags":[],"owner":{"account_id":11544512,"reputation":2696,"user_id":8459055,"display_name":"omkaartg"},"comment_count":0,"down_vote_count":18,"up_vote_count":227,"is_accepted":false,"score":209,"last_activity_date":1610294342,"creation_date":1512667709,"answer_id":47700573,"question_id":11227809,"body_markdown":"Sorted arrays are processed faster than an unsorted array, due to a phenomena called branch prediction.\r\n\r\nThe branch predictor is a digital circuit (in computer architecture) trying to predict which way a branch will go, improving the flow in the instruction pipeline. The circuit/computer predicts the next step and executes it.\r\n\r\nMaking a wrong prediction leads to going back to the previous step, and executing with another prediction. Assuming the prediction is correct, the code will continue to the next step. A wrong prediction results in repeating the same step, until a correct prediction occurs.\r\n\r\nThe answer to your question is very simple.\r\n\r\nIn an unsorted array, the computer makes multiple predictions, leading to an increased chance of errors.\r\nWhereas, in a sorted array, the computer makes fewer predictions, reducing the chance of errors.\r\nMaking more predictions requires more time.\r\n\r\nSorted Array: Straight Road\r\n```none\r\n____________________________________________________________________________________\r\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\nTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\r\n```\r\nUnsorted Array: Curved Road\r\n\r\n    ______   ________\r\n    |     |__|\r\n\r\n\r\nBranch prediction: Guessing/predicting which road is straight and following it without checking\r\n\r\n    ___________________________________________ Straight road\r\n     |_________________________________________|Longer road\r\n\r\nAlthough both the roads reach the same destination, the straight road is shorter, and the other is longer. If then you choose the other by mistake, there is no turning back, and so you will waste some extra time if you choose the longer road. This is similar to what happens in the computer, and I hope this helped you understand better.\r\n\r\n---\r\n\r\nAlso I want to cite [@Simon_Weaver](/u/16940) from the comments:\r\n&gt; It doesn’t make fewer predictions - it makes fewer incorrect predictions. It still has to predict for each time through the loop...","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>Sorted arrays are processed faster than an unsorted array, due to a phenomena called branch prediction.</p>\n<p>The branch predictor is a digital circuit (in computer architecture) trying to predict which way a branch will go, improving the flow in the instruction pipeline. The circuit/computer predicts the next step and executes it.</p>\n<p>Making a wrong prediction leads to going back to the previous step, and executing with another prediction. Assuming the prediction is correct, the code will continue to the next step. A wrong prediction results in repeating the same step, until a correct prediction occurs.</p>\n<p>The answer to your question is very simple.</p>\n<p>In an unsorted array, the computer makes multiple predictions, leading to an increased chance of errors.\nWhereas, in a sorted array, the computer makes fewer predictions, reducing the chance of errors.\nMaking more predictions requires more time.</p>\n<p>Sorted Array: Straight Road</p>\n<pre class=\"lang-none prettyprint-override\"><code>____________________________________________________________________________________\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n</code></pre>\n<p>Unsorted Array: Curved Road</p>\n<pre><code>______   ________\n|     |__|\n</code></pre>\n<p>Branch prediction: Guessing/predicting which road is straight and following it without checking</p>\n<pre><code>___________________________________________ Straight road\n |_________________________________________|Longer road\n</code></pre>\n<p>Although both the roads reach the same destination, the straight road is shorter, and the other is longer. If then you choose the other by mistake, there is no turning back, and so you will waste some extra time if you choose the longer road. This is similar to what happens in the computer, and I hope this helped you understand better.</p>\n<hr />\n<p>Also I want to cite <a href=\"/u/16940\">@Simon_Weaver</a> from the comments:</p>\n<blockquote>\n<p>It doesn’t make fewer predictions - it makes fewer incorrect predictions. It still has to predict for each time through the loop...</p>\n</blockquote>\n"},{"comments":[{"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"score":4,"creation_date":1526404014,"post_id":47942152,"comment_id":87727753,"body_markdown":"The other innovation in ARM is the addition of the S instruction suffix, also optional on (almost) all instructions, which if absent, prevents instructions from changing status bits (with the exception of the CMP instruction, whose job is to set status bits, so it doesn&#39;t need the S suffix). This allows you to avoid CMP instructions in many cases, as long as the comparison is with zero or similar (eg. SUBS R0, R0, #1 will set the Z (Zero) bit when R0 reaches zero). Conditionals and the S suffix incur zero overhead. It&#39;s quite a beautiful ISA.","body":"The other innovation in ARM is the addition of the S instruction suffix, also optional on (almost) all instructions, which if absent, prevents instructions from changing status bits (with the exception of the CMP instruction, whose job is to set status bits, so it doesn&#39;t need the S suffix). This allows you to avoid CMP instructions in many cases, as long as the comparison is with zero or similar (eg. SUBS R0, R0, #1 will set the Z (Zero) bit when R0 reaches zero). Conditionals and the S suffix incur zero overhead. It&#39;s quite a beautiful ISA."},{"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"score":4,"creation_date":1526404102,"post_id":47942152,"comment_id":87727802,"body_markdown":"Not adding the S suffix allows you to have several conditional instructions in a row without worrying that one of them might change the status bits, which might otherwise have the side effect of skipping the rest of the conditional instructions.","body":"Not adding the S suffix allows you to have several conditional instructions in a row without worrying that one of them might change the status bits, which might otherwise have the side effect of skipping the rest of the conditional instructions."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":2,"creation_date":1582284859,"post_id":47942152,"comment_id":106733423,"body_markdown":"Note that the OP is *not* including the time to sort in their measurement.  It&#39;s probably an overall loss to sort first before running a branch x86 loop, too, even though the non-sorted case makes the loop run a lot slower.  But sorting a big array requires a *lot* of work.","body":"Note that the OP is <i>not</i> including the time to sort in their measurement.  It&#39;s probably an overall loss to sort first before running a branch x86 loop, too, even though the non-sorted case makes the loop run a lot slower.  But sorting a big array requires a <i>lot</i> of work."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":3,"creation_date":1582285008,"post_id":47942152,"comment_id":106733504,"body_markdown":"BTW, you could save an instruction in the loop by indexing relative to the end of the array.  Before the loop, set up `R2 = data + arraySize`, then start with `R1 = -arraySize`.  The bottom of the loop becomes `adds r1, r1, #1` / `bnz inner_loop`.  Compilers don&#39;t use this optimization for some reason :/  But anyway, predicated execution of the add is not fundamentally different in this case from what you can do with branchless code on other ISAs, like x86 `cmov`.  Although it&#39;s not as nice: [gcc optimization flag -O3 makes code slower than -O2](//stackoverflow.com/q/28875325)","body":"BTW, you could save an instruction in the loop by indexing relative to the end of the array.  Before the loop, set up <code>R2 = data + arraySize</code>, then start with <code>R1 = -arraySize</code>.  The bottom of the loop becomes <code>adds r1, r1, #1</code> / <code>bnz inner_loop</code>.  Compilers don&#39;t use this optimization for some reason :/  But anyway, predicated execution of the add is not fundamentally different in this case from what you can do with branchless code on other ISAs, like x86 <code>cmov</code>.  Although it&#39;s not as nice: <a href=\"//stackoverflow.com/q/28875325\">gcc optimization flag -O3 makes code slower than -O2</a>"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":3,"creation_date":1582285220,"post_id":47942152,"comment_id":106733620,"body_markdown":"(ARM predicated execution truly NOPs the instruction, so you can even use it on loads or stores that would fault, unlike x86 `cmov` with a memory source operand.  Most ISAs, including AArch64, only have ALU select operations.  So ARM predication can be powerful, and usable more efficiently than branchless code on most ISAs.)","body":"(ARM predicated execution truly NOPs the instruction, so you can even use it on loads or stores that would fault, unlike x86 <code>cmov</code> with a memory source operand.  Most ISAs, including AArch64, only have ALU select operations.  So ARM predication can be powerful, and usable more efficiently than branchless code on most ISAs.)"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1662120711,"post_id":47942152,"comment_id":129938412,"body_markdown":"Also, all modern ISAs except maybe RISC-V have ways to do this branchlessly, and even  RISC-V without extension B can do an ALU select with compare / sub 1 / AND to zero an element or not.  And many ISAs have SIMD instructions, like ARM NEON or x86 SSE2, that can do this branchlessly 4 elements at a time.  *[Why is processing an unsorted array the same speed as processing a sorted array with modern x86-64 clang?](https://stackoverflow.com/q/66521344)* shows clang vectorizes, unlike Java or the compiler used when this question was posted.","body":"Also, all modern ISAs except maybe RISC-V have ways to do this branchlessly, and even  RISC-V without extension B can do an ALU select with compare / sub 1 / AND to zero an element or not.  And many ISAs have SIMD instructions, like ARM NEON or x86 SSE2, that can do this branchlessly 4 elements at a time.  <i><a href=\"https://stackoverflow.com/q/66521344\">Why is processing an unsorted array the same speed as processing a sorted array with modern x86-64 clang?</a></i> shows clang vectorizes, unlike Java or the compiler used when this question was posted."},{"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"score":0,"creation_date":1662234546,"post_id":47942152,"comment_id":129960944,"body_markdown":"@PeterCordes thanks, good info. Although that does require a powerful compiler to rewrite the code into vectorized form, as you point out -- and as I understand it, even if the compiler can do this successfully in a wide range of useful cases, it&#39;s uncomputable in the general case to find all valid vectorization transforms, since it&#39;s a code equivalence problem.","body":"@PeterCordes thanks, good info. Although that does require a powerful compiler to rewrite the code into vectorized form, as you point out -- and as I understand it, even if the compiler can do this successfully in a wide range of useful cases, it&#39;s uncomputable in the general case to find all valid vectorization transforms, since it&#39;s a code equivalence problem."}],"tags":[],"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"comment_count":7,"down_vote_count":2,"up_vote_count":273,"is_accepted":false,"score":271,"last_activity_date":1603233212,"creation_date":1513948385,"answer_id":47942152,"question_id":11227809,"body_markdown":"On ARM, there is no branch needed, because every instruction has a 4-bit condition field, which tests (at zero cost) any of [16 different different conditions](https://community.arm.com/developer/ip-products/processors/b/processors-ip-blog/posts/condition-codes-1-condition-flags-and-codes) that may arise in the Processor Status Register, and if the condition on an instruction is false, the instruction is skipped. This eliminates the need for short branches, and there would be no branch prediction hit for this algorithm. &lt;b&gt;Therefore, the sorted version of this algorithm would run slower than the unsorted version on ARM, because of the extra overhead of sorting.&lt;/b&gt;\r\n\r\nThe inner loop for this algorithm would look something like the following in ARM assembly language:\r\n\r\n&lt;!-- language: lang-js --&gt;\r\n\r\n    MOV R0, #0   // R0 = sum = 0\r\n    MOV R1, #0   // R1 = c = 0\r\n    ADR R2, data // R2 = addr of data array (put this instruction outside outer loop)\r\n    .inner_loop  // Inner loop branch label\r\n        LDRB R3, [R2, R1]   // R3 = data[c]\r\n        CMP R3, #128        // compare R3 to 128\r\n        ADDGE R0, R0, R3    // if R3 &gt;= 128, then sum += data[c] -- no branch needed!\r\n        ADD R1, R1, #1      // c++\r\n        CMP R1, #arraySize  // compare c to arraySize\r\n        BLT inner_loop      // Branch to inner_loop if c &lt; arraySize\r\n\r\n***But this is actually part of a bigger picture:***\r\n\r\n`CMP` opcodes always update the status bits in the Processor Status Register (PSR), because that is their purpose, but most other instructions do not touch the PSR unless you add an optional `S` suffix to the instruction, specifying that the PSR should be updated based on the result of the instruction. **Just like the 4-bit condition suffix, being able to execute instructions without affecting the PSR is a mechanism that reduces the need for branches on ARM, and also facilitates out of order dispatch at the hardware level**, because after performing some operation X that updates the status bits, subsequently (or in parallel) you can do a bunch of other work that explicitly should not affect (or be affected by) the status bits, then you can test the state of the status bits set earlier by X.\r\n\r\nThe condition testing field and the optional &quot;set status bit&quot; field can be combined, for example:\r\n\r\n* `ADD R1, R2, R3` performs `R1 = R2 + R3` without updating any status bits.\r\n* `ADDGE R1, R2, R3` performs the same operation only if a previous instruction that affected the status bits resulted in a Greater than or Equal condition.\r\n* `ADDS R1, R2, R3` performs the addition and then updates the `N`, `Z`, `C` and `V` flags in the Processor Status Register based on whether the result was Negative, Zero, Carried (for unsigned addition), or oVerflowed (for signed addition).\r\n* `ADDSGE R1, R2, R3` performs the addition only if the `GE` test is true, and then subsequently updates the status bits based on the result of the addition.\r\n\r\nMost processor architectures do not have this ability to specify whether or not the status bits should be updated for a given operation, which can necessitate writing additional code to save and later restore status bits, or may require additional branches, or may limit the processor&#39;s out of order execution efficiency: one of the side effects of most CPU instruction set architectures forcibly updating status bits after most instructions is that it is much harder to tease apart which instructions can be run in parallel without interfering with each other. Updating status bits has side effects, therefore has a linearizing effect on code. **ARM&#39;s ability to mix and match branch-free condition testing on any instruction with the option to either update or not update the status bits after any instruction is extremely powerful, for both assembly language programmers and compilers, and produces very efficient code.**\r\n\r\nWhen you don&#39;t have to branch, you can avoid the time cost of flushing the pipeline for what would otherwise be short branches, and you can avoid the design complexity of many forms of speculative evalution. The performance impact of the initial naive imlementations of the mitigations for many recently discovered processor vulnerabilities (Spectre etc.) shows you just how much the performance of modern processors depends upon complex speculative evaluation logic. With a short pipeline and the dramatically reduced need for branching, ARM just doesn&#39;t need to rely on speculative evaluation as much as CISC processors. (Of course high-end ARM implementations do include speculative evaluation, but it&#39;s a smaller part of the performance story.)\r\n\r\nIf you have ever wondered why ARM has been so phenomenally successful, the brilliant effectiveness and interplay of these two mechanisms (combined with another mechanism that lets you &quot;barrel shift&quot; left or right one of the two arguments of any arithmetic operator or offset memory access operator at zero additional cost) are a big part of the story, because they are some of the greatest sources of the ARM architecture&#39;s efficiency. The brilliance of the original designers of the ARM ISA back in 1983, Steve Furber and Roger (now Sophie) Wilson, cannot be overstated.","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>On ARM, there is no branch needed, because every instruction has a 4-bit condition field, which tests (at zero cost) any of <a href=\"https://community.arm.com/developer/ip-products/processors/b/processors-ip-blog/posts/condition-codes-1-condition-flags-and-codes\" rel=\"noreferrer\">16 different different conditions</a> that may arise in the Processor Status Register, and if the condition on an instruction is false, the instruction is skipped. This eliminates the need for short branches, and there would be no branch prediction hit for this algorithm. <b>Therefore, the sorted version of this algorithm would run slower than the unsorted version on ARM, because of the extra overhead of sorting.</b></p>\n<p>The inner loop for this algorithm would look something like the following in ARM assembly language:</p>\n<pre class=\"lang-js prettyprint-override\"><code>MOV R0, #0   // R0 = sum = 0\nMOV R1, #0   // R1 = c = 0\nADR R2, data // R2 = addr of data array (put this instruction outside outer loop)\n.inner_loop  // Inner loop branch label\n    LDRB R3, [R2, R1]   // R3 = data[c]\n    CMP R3, #128        // compare R3 to 128\n    ADDGE R0, R0, R3    // if R3 &gt;= 128, then sum += data[c] -- no branch needed!\n    ADD R1, R1, #1      // c++\n    CMP R1, #arraySize  // compare c to arraySize\n    BLT inner_loop      // Branch to inner_loop if c &lt; arraySize\n</code></pre>\n<p><em><strong>But this is actually part of a bigger picture:</strong></em></p>\n<p><code>CMP</code> opcodes always update the status bits in the Processor Status Register (PSR), because that is their purpose, but most other instructions do not touch the PSR unless you add an optional <code>S</code> suffix to the instruction, specifying that the PSR should be updated based on the result of the instruction. <strong>Just like the 4-bit condition suffix, being able to execute instructions without affecting the PSR is a mechanism that reduces the need for branches on ARM, and also facilitates out of order dispatch at the hardware level</strong>, because after performing some operation X that updates the status bits, subsequently (or in parallel) you can do a bunch of other work that explicitly should not affect (or be affected by) the status bits, then you can test the state of the status bits set earlier by X.</p>\n<p>The condition testing field and the optional &quot;set status bit&quot; field can be combined, for example:</p>\n<ul>\n<li><code>ADD R1, R2, R3</code> performs <code>R1 = R2 + R3</code> without updating any status bits.</li>\n<li><code>ADDGE R1, R2, R3</code> performs the same operation only if a previous instruction that affected the status bits resulted in a Greater than or Equal condition.</li>\n<li><code>ADDS R1, R2, R3</code> performs the addition and then updates the <code>N</code>, <code>Z</code>, <code>C</code> and <code>V</code> flags in the Processor Status Register based on whether the result was Negative, Zero, Carried (for unsigned addition), or oVerflowed (for signed addition).</li>\n<li><code>ADDSGE R1, R2, R3</code> performs the addition only if the <code>GE</code> test is true, and then subsequently updates the status bits based on the result of the addition.</li>\n</ul>\n<p>Most processor architectures do not have this ability to specify whether or not the status bits should be updated for a given operation, which can necessitate writing additional code to save and later restore status bits, or may require additional branches, or may limit the processor's out of order execution efficiency: one of the side effects of most CPU instruction set architectures forcibly updating status bits after most instructions is that it is much harder to tease apart which instructions can be run in parallel without interfering with each other. Updating status bits has side effects, therefore has a linearizing effect on code. <strong>ARM's ability to mix and match branch-free condition testing on any instruction with the option to either update or not update the status bits after any instruction is extremely powerful, for both assembly language programmers and compilers, and produces very efficient code.</strong></p>\n<p>When you don't have to branch, you can avoid the time cost of flushing the pipeline for what would otherwise be short branches, and you can avoid the design complexity of many forms of speculative evalution. The performance impact of the initial naive imlementations of the mitigations for many recently discovered processor vulnerabilities (Spectre etc.) shows you just how much the performance of modern processors depends upon complex speculative evaluation logic. With a short pipeline and the dramatically reduced need for branching, ARM just doesn't need to rely on speculative evaluation as much as CISC processors. (Of course high-end ARM implementations do include speculative evaluation, but it's a smaller part of the performance story.)</p>\n<p>If you have ever wondered why ARM has been so phenomenally successful, the brilliant effectiveness and interplay of these two mechanisms (combined with another mechanism that lets you &quot;barrel shift&quot; left or right one of the two arguments of any arithmetic operator or offset memory access operator at zero additional cost) are a big part of the story, because they are some of the greatest sources of the ARM architecture's efficiency. The brilliance of the original designers of the ARM ISA back in 1983, Steve Furber and Roger (now Sophie) Wilson, cannot be overstated.</p>\n"},{"comments":[{"owner":{"account_id":3683805,"reputation":8445,"user_id":3950982,"display_name":"Luke Hutchison"},"score":8,"creation_date":1551356309,"post_id":53689911,"comment_id":96615671,"body_markdown":"I don&#39;t really see how this proves anything? The only thing you have shown is that &quot;not doing all the work of sorting the whole array takes less time than sorting the whole array&quot;. Your claim that this &quot;also runs fastest&quot; is very architecture-dependent. See my answer about how this works on ARM. PS you could make your code faster on non-ARM architectures by putting the summation inside the 200-element block loop, sorting in reverse, and then using Yochai Timmer&#39;s suggestion of breaking once you get an out-of range value. That way each 200-element block summation can be terminated early.","body":"I don&#39;t really see how this proves anything? The only thing you have shown is that &quot;not doing all the work of sorting the whole array takes less time than sorting the whole array&quot;. Your claim that this &quot;also runs fastest&quot; is very architecture-dependent. See my answer about how this works on ARM. PS you could make your code faster on non-ARM architectures by putting the summation inside the 200-element block loop, sorting in reverse, and then using Yochai Timmer&#39;s suggestion of breaking once you get an out-of range value. That way each 200-element block summation can be terminated early."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1576248293,"post_id":53689911,"comment_id":104848977,"body_markdown":"If you just want to implement the algorithm efficiently over unsorted data, you would do that operation branchlessly (and with SIMD, e.g. with x86 `pcmpgtb` to find elements with their high bit set, then AND to zero smaller elements).  Spending any time actually sorting chunks would be slower.  A branchless version would have data-independent performance, also proving that the cost came from branch misprediction.  Or just use performance counters to observe that directly, like Skylake `int_misc.clear_resteer_cycles` or `int_misc.recovery_cycles` to count front-end idle cycles from mispredicts","body":"If you just want to implement the algorithm efficiently over unsorted data, you would do that operation branchlessly (and with SIMD, e.g. with x86 <code>pcmpgtb</code> to find elements with their high bit set, then AND to zero smaller elements).  Spending any time actually sorting chunks would be slower.  A branchless version would have data-independent performance, also proving that the cost came from branch misprediction.  Or just use performance counters to observe that directly, like Skylake <code>int_misc.clear_resteer_cycles</code> or <code>int_misc.recovery_cycles</code> to count front-end idle cycles from mispredicts"},{"owner":{"account_id":2657091,"reputation":3210,"user_id":2297550,"accept_rate":40,"display_name":"user2297550"},"score":2,"creation_date":1585896266,"post_id":53689911,"comment_id":107930122,"body_markdown":"Both comments above seem to ignore the general algorithmic issues and complexity, in favor of advocating specialized hardware with special machine instructions. I find the first one particularly petty in that it blithely dismisses the important general insights in this answer in blind favor of specialized machine instructions.","body":"Both comments above seem to ignore the general algorithmic issues and complexity, in favor of advocating specialized hardware with special machine instructions. I find the first one particularly petty in that it blithely dismisses the important general insights in this answer in blind favor of specialized machine instructions."},{"owner":{"account_id":2657091,"reputation":3210,"user_id":2297550,"accept_rate":40,"display_name":"user2297550"},"score":1,"creation_date":1624125055,"post_id":53689911,"comment_id":120275132,"body_markdown":"Also note that specialized hardware instructions do not help if the computation within the `if` is more complicated than an simple addition, which is quite likely in the general case. Therefore, this answer is unique in offering a general solution that is still `O(n)`","body":"Also note that specialized hardware instructions do not help if the computation within the <code>if</code> is more complicated than an simple addition, which is quite likely in the general case. Therefore, this answer is unique in offering a general solution that is still <code>O(n)</code>"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1650591912,"post_id":53689911,"comment_id":127160594,"body_markdown":"Just for the record, since our previous comments have been nuked, I don&#39;t think there&#39;s anything to gain in *overall* performance by spending time (partially) sorting, unless you&#39;re artificially repeating the loop over the array like in this microbenchmark.  Then yes, this piecewise sort gets close to the benefit of a full sort (e.g. 2.4s for this vs. 1.7s for a full sort on Skylake, vs. 10.9s for no sort before doing 100k passes.  If you use `g++ -Os -Wa,-mbranches-within-32B-boundaries` to make branchy asm in the first place instead of a normal build).","body":"Just for the record, since our previous comments have been nuked, I don&#39;t think there&#39;s anything to gain in <i>overall</i> performance by spending time (partially) sorting, unless you&#39;re artificially repeating the loop over the array like in this microbenchmark.  Then yes, this piecewise sort gets close to the benefit of a full sort (e.g. 2.4s for this vs. 1.7s for a full sort on Skylake, vs. 10.9s for no sort before doing 100k passes.  If you use <code>g++ -Os -Wa,-mbranches-within-32B-boundaries</code> to make branchy asm in the first place instead of a normal build)."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":0,"creation_date":1650592056,"post_id":53689911,"comment_id":127160613,"body_markdown":"For *one* pass of the inner loop over the array, it would be even faster to just do it, not to sort first.  Even partial sorting is only worth it if you can amortize the benefit over multiple passes over the array.  That is O(n), but still costs significant time to do comparison-based sorting even in small chunks, branching on each element multiple times.  As this says, *The assumption by other answers that one needs to sort the data is not correct.* - you don&#39;t *need* to do any sorting at all if you care about *overall* time taken, without being able to do sorting outside the timed region.","body":"For <i>one</i> pass of the inner loop over the array, it would be even faster to just do it, not to sort first.  Even partial sorting is only worth it if you can amortize the benefit over multiple passes over the array.  That is O(n), but still costs significant time to do comparison-based sorting even in small chunks, branching on each element multiple times.  As this says, <i>The assumption by other answers that one needs to sort the data is not correct.</i> - you don&#39;t <i>need</i> to do any sorting at all if you care about <i>overall</i> time taken, without being able to do sorting outside the timed region."},{"owner":{"account_id":2657091,"reputation":3210,"user_id":2297550,"accept_rate":40,"display_name":"user2297550"},"score":0,"creation_date":1650616971,"post_id":53689911,"comment_id":127165904,"body_markdown":"For any users reading this, the above two comments add nothing material beyond the first four, and constitute persistent trolling by a user whose numerous earlier comments on this same answer were thankfully deleted by mods. This is the **only** answer with an `O(n)` solution that works **in general** on any machine architecture and for any computation not just summation. Apparently, this simple fact cannot be digested or comprehended despite Herculean earlier attempts.","body":"For any users reading this, the above two comments add nothing material beyond the first four, and constitute persistent trolling by a user whose numerous earlier comments on this same answer were thankfully deleted by mods. This is the <b>only</b> answer with an <code>O(n)</code> solution that works <b>in general</b> on any machine architecture and for any computation not just summation. Apparently, this simple fact cannot be digested or comprehended despite Herculean earlier attempts."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":0,"creation_date":1650630594,"post_id":53689911,"comment_id":127170686,"body_markdown":"Commenting out the sorting entirely keeps the whole thing O(n).  *That&#39;s* the appropriate comparison baseline for an O(n) approach that spends time preprocessing the array to make one pass of a branchy loop faster, of course not an O(n log n) sort.","body":"Commenting out the sorting entirely keeps the whole thing O(n).  <i>That&#39;s</i> the appropriate comparison baseline for an O(n) approach that spends time preprocessing the array to make one pass of a branchy loop faster, of course not an O(n log n) sort."},{"owner":{"account_id":2657091,"reputation":3210,"user_id":2297550,"accept_rate":40,"display_name":"user2297550"},"score":0,"creation_date":1650633602,"post_id":53689911,"comment_id":127171845,"body_markdown":"For any users reading this, the above **three and counting** comments add nothing material beyond the first four comments on this answer, and constitute persistent trolling by a user whose numerous earlier comments on this same answer were thankfully deleted by mods. This is the **only** answer with an `O(n)` solution that works **in general** on any machine architecture and for any computation not just summation. Apparently, this simple fact cannot be digested or comprehended despite Herculean earlier attempts.","body":"For any users reading this, the above <b>three and counting</b> comments add nothing material beyond the first four comments on this answer, and constitute persistent trolling by a user whose numerous earlier comments on this same answer were thankfully deleted by mods. This is the <b>only</b> answer with an <code>O(n)</code> solution that works <b>in general</b> on any machine architecture and for any computation not just summation. Apparently, this simple fact cannot be digested or comprehended despite Herculean earlier attempts."}],"tags":[],"owner":{"account_id":2657091,"reputation":3210,"user_id":2297550,"accept_rate":40,"display_name":"user2297550"},"comment_count":9,"down_vote_count":11,"up_vote_count":130,"is_accepted":false,"score":119,"last_activity_date":1562040497,"creation_date":1544336297,"answer_id":53689911,"question_id":11227809,"body_markdown":"The assumption by other answers that one needs to sort the data is not correct.\r\n\r\nThe following code does not sort the entire array, but only 200-element segments of it, and thereby runs the fastest.\r\n\r\nSorting only k-element sections completes the pre-processing in linear time, `O(n)`, rather than the `O(n.log(n))` time needed to sort the entire array.\r\n\r\n    #include &lt;algorithm&gt;\r\n    #include &lt;ctime&gt;\r\n    #include &lt;iostream&gt;\r\n    \r\n    int main() {\r\n        int data[32768]; const int l = sizeof data / sizeof data[0];\r\n    \r\n        for (unsigned c = 0; c &lt; l; ++c)\r\n            data[c] = std::rand() % 256;\r\n\r\n        // sort 200-element segments, not the whole array\r\n        for (unsigned c = 0; c + 200 &lt;= l; c += 200)\r\n            std::sort(&amp;data[c], &amp;data[c + 200]);\r\n    \r\n        clock_t start = clock();\r\n        long long sum = 0;\r\n    \r\n        for (unsigned i = 0; i &lt; 100000; ++i) {\r\n            for (unsigned c = 0; c &lt; sizeof data / sizeof(int); ++c) {\r\n                if (data[c] &gt;= 128)\r\n                    sum += data[c];\r\n            }\r\n        }\r\n    \r\n        std::cout &lt;&lt; static_cast&lt;double&gt;(clock() - start) / CLOCKS_PER_SEC &lt;&lt; std::endl;\r\n        std::cout &lt;&lt; &quot;sum = &quot; &lt;&lt; sum &lt;&lt; std::endl;\r\n    }\r\n\r\nThis also &quot;proves&quot; that it has nothing to do with any algorithmic issue such as sort order, and it is indeed branch prediction.","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>The assumption by other answers that one needs to sort the data is not correct.</p>\n\n<p>The following code does not sort the entire array, but only 200-element segments of it, and thereby runs the fastest.</p>\n\n<p>Sorting only k-element sections completes the pre-processing in linear time, <code>O(n)</code>, rather than the <code>O(n.log(n))</code> time needed to sort the entire array.</p>\n\n<pre><code>#include &lt;algorithm&gt;\n#include &lt;ctime&gt;\n#include &lt;iostream&gt;\n\nint main() {\n    int data[32768]; const int l = sizeof data / sizeof data[0];\n\n    for (unsigned c = 0; c &lt; l; ++c)\n        data[c] = std::rand() % 256;\n\n    // sort 200-element segments, not the whole array\n    for (unsigned c = 0; c + 200 &lt;= l; c += 200)\n        std::sort(&amp;data[c], &amp;data[c + 200]);\n\n    clock_t start = clock();\n    long long sum = 0;\n\n    for (unsigned i = 0; i &lt; 100000; ++i) {\n        for (unsigned c = 0; c &lt; sizeof data / sizeof(int); ++c) {\n            if (data[c] &gt;= 128)\n                sum += data[c];\n        }\n    }\n\n    std::cout &lt;&lt; static_cast&lt;double&gt;(clock() - start) / CLOCKS_PER_SEC &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"sum = \" &lt;&lt; sum &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>This also \"proves\" that it has nothing to do with any algorithmic issue such as sort order, and it is indeed branch prediction.</p>\n"},{"comments":[{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1618439395,"post_id":58385294,"comment_id":118605070,"body_markdown":"This seems to be missing the point of the question, and is answering whether sorting itself is faster with already-sorted arrays.  This is less surprising because as this answer points out, there&#39;s less work to be done (with most sort algorithms other than merge-sort), on top of the branch-prediction effect.  The actual question factors out this effect and is only timing a conditional increment.","body":"This seems to be missing the point of the question, and is answering whether sorting itself is faster with already-sorted arrays.  This is less surprising because as this answer points out, there&#39;s less work to be done (with most sort algorithms other than merge-sort), on top of the branch-prediction effect.  The actual question factors out this effect and is only timing a conditional increment."}],"tags":[],"owner":{"account_id":928316,"reputation":57662,"user_id":2011147,"display_name":"Selcuk"},"comment_count":1,"down_vote_count":2,"up_vote_count":112,"is_accepted":false,"score":110,"last_activity_date":1610294575,"creation_date":1571096080,"answer_id":58385294,"question_id":11227809,"body_markdown":"*[Bjarne Stroustrup&#39;s Answer](//stackoverflow.blog/2019/10/11/c-creator-bjarne-stroustrup-answers-our-top-five-c-questions/) to this question:*\r\n\r\nThat sounds like an interview question. Is it true? How would you know? It is a bad idea to answer questions about efficiency without first doing some measurements, so it is important to know how to measure.\r\n\r\nSo, I tried with a vector of a million integers and got:\r\n```none\r\nAlready sorted    32995 milliseconds\r\nShuffled          125944 milliseconds\r\n\r\nAlready sorted    18610 milliseconds\r\nShuffled          133304 milliseconds\r\n\r\nAlready sorted    17942 milliseconds\r\nShuffled          107858 milliseconds\r\n```\r\n\r\nI ran that a few times to be sure. Yes, the phenomenon is real. My key code was:\r\n```c++\r\nvoid run(vector&lt;int&gt;&amp; v, const string&amp; label)\r\n{\r\n    auto t0 = system_clock::now();\r\n    sort(v.begin(), v.end());\r\n    auto t1 = system_clock::now();\r\n    cout &lt;&lt; label\r\n         &lt;&lt; duration_cast&lt;microseconds&gt;(t1 — t0).count()\r\n         &lt;&lt; &quot; milliseconds\\n&quot;;\r\n}\r\n\r\nvoid tst()\r\n{\r\n    vector&lt;int&gt; v(1&#39;000&#39;000);\r\n    iota(v.begin(), v.end(), 0);\r\n    run(v, &quot;already sorted &quot;);\r\n    std::shuffle(v.begin(), v.end(), std::mt19937{ std::random_device{}() });\r\n    run(v, &quot;shuffled    &quot;);\r\n}\r\n```\r\n\r\nAt least the phenomenon is real with this compiler, standard library, and optimizer settings. Different implementations can and do give different answers. In fact, someone did do a more systematic study (a quick web search will find it) and most implementations show that effect.\r\n\r\nOne reason is branch prediction: the key operation in the sort algorithm is `“if(v[i] &lt; pivot]) …”` or equivalent. For a sorted sequence that test is always true whereas, for a random sequence, the branch chosen varies randomly.\r\n\r\nAnother reason is that when the vector is already sorted, we never need to move elements to their correct position. The effect of these little details is the factor of five or six that we saw.\r\n\r\nQuicksort (and sorting in general) is a complex study that has attracted some of the greatest minds of computer science. A good sort function is a result of both choosing a good algorithm and paying attention to hardware performance in its implementation.\r\n\r\nIf you want to write efficient code, you need to know a bit about machine architecture.","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p><em><a href=\"//stackoverflow.blog/2019/10/11/c-creator-bjarne-stroustrup-answers-our-top-five-c-questions/\">Bjarne Stroustrup's Answer</a> to this question:</em></p>\n<p>That sounds like an interview question. Is it true? How would you know? It is a bad idea to answer questions about efficiency without first doing some measurements, so it is important to know how to measure.</p>\n<p>So, I tried with a vector of a million integers and got:</p>\n<pre class=\"lang-none prettyprint-override\"><code>Already sorted    32995 milliseconds\nShuffled          125944 milliseconds\n\nAlready sorted    18610 milliseconds\nShuffled          133304 milliseconds\n\nAlready sorted    17942 milliseconds\nShuffled          107858 milliseconds\n</code></pre>\n<p>I ran that a few times to be sure. Yes, the phenomenon is real. My key code was:</p>\n<pre class=\"lang-cpp prettyprint-override\"><code>void run(vector&lt;int&gt;&amp; v, const string&amp; label)\n{\n    auto t0 = system_clock::now();\n    sort(v.begin(), v.end());\n    auto t1 = system_clock::now();\n    cout &lt;&lt; label\n         &lt;&lt; duration_cast&lt;microseconds&gt;(t1 — t0).count()\n         &lt;&lt; &quot; milliseconds\\n&quot;;\n}\n\nvoid tst()\n{\n    vector&lt;int&gt; v(1'000'000);\n    iota(v.begin(), v.end(), 0);\n    run(v, &quot;already sorted &quot;);\n    std::shuffle(v.begin(), v.end(), std::mt19937{ std::random_device{}() });\n    run(v, &quot;shuffled    &quot;);\n}\n</code></pre>\n<p>At least the phenomenon is real with this compiler, standard library, and optimizer settings. Different implementations can and do give different answers. In fact, someone did do a more systematic study (a quick web search will find it) and most implementations show that effect.</p>\n<p>One reason is branch prediction: the key operation in the sort algorithm is <code>“if(v[i] &lt; pivot]) …”</code> or equivalent. For a sorted sequence that test is always true whereas, for a random sequence, the branch chosen varies randomly.</p>\n<p>Another reason is that when the vector is already sorted, we never need to move elements to their correct position. The effect of these little details is the factor of five or six that we saw.</p>\n<p>Quicksort (and sorting in general) is a complex study that has attracted some of the greatest minds of computer science. A good sort function is a result of both choosing a good algorithm and paying attention to hardware performance in its implementation.</p>\n<p>If you want to write efficient code, you need to know a bit about machine architecture.</p>\n"},{"comments":[{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":4,"creation_date":1576247362,"post_id":58531294,"comment_id":104848500,"body_markdown":"The instructions stay hot in the CPU&#39;s L1 instruction cache regardless of mispredicts.  The problem is fetching them into the *pipeline* in the right order, before the immediately-previous instructions have decoded and finished executing.","body":"The instructions stay hot in the CPU&#39;s L1 instruction cache regardless of mispredicts.  The problem is fetching them into the <i>pipeline</i> in the right order, before the immediately-previous instructions have decoded and finished executing."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":2,"creation_date":1647614325,"post_id":58531294,"comment_id":126421814,"body_markdown":"Also, in a simple CPU that has an &quot;instruction register&quot;, it definitely always needs to read each instruction into the IR as part of executing it.  The last paragraph of this answer is very distorted from how CPUs really work.  Some CPUs with a loop buffer may be able to lock a sequence of instructions down into a loop to avoid even re-fetching from L1i cache, as long as they continue to execute the same way, but that&#39;s usually minor (e.g. in Intel Skylake the microcode update disabling the LSD didn&#39;t hurt much), just getting a little bit more value out of correct branch prediction.","body":"Also, in a simple CPU that has an &quot;instruction register&quot;, it definitely always needs to read each instruction into the IR as part of executing it.  The last paragraph of this answer is very distorted from how CPUs really work.  Some CPUs with a loop buffer may be able to lock a sequence of instructions down into a loop to avoid even re-fetching from L1i cache, as long as they continue to execute the same way, but that&#39;s usually minor (e.g. in Intel Skylake the microcode update disabling the LSD didn&#39;t hurt much), just getting a little bit more value out of correct branch prediction."},{"owner":{"account_id":4724602,"reputation":1626,"user_id":3821643,"display_name":"hatirlatici"},"score":1,"creation_date":1647900244,"post_id":58531294,"comment_id":126483396,"body_markdown":"The paper gives a general idea of how it handles fetching coordinated data as instruction from the o(n) perspective, also it was written in the early 90s so none of the cutting-edge memory/register designs did not exist at that time. The modern CPU cache designs and algorithms can be found in multiple papers for a benchmark, one of them might be \nhttps://ieeexplore.ieee.org/document/1027060?arnumber=1027060","body":"The paper gives a general idea of how it handles fetching coordinated data as instruction from the o(n) perspective, also it was written in the early 90s so none of the cutting-edge memory/register designs did not exist at that time. The modern CPU cache designs and algorithms can be found in multiple papers for a benchmark, one of them might be  <a href=\"https://ieeexplore.ieee.org/document/1027060?arnumber=1027060\" rel=\"nofollow noreferrer\">ieeexplore.ieee.org/document/1027060?arnumber=1027060</a>"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1647908684,"post_id":58531294,"comment_id":126485018,"body_markdown":"I&#39;m not talking about what the linked paper says, I&#39;m talking about the sentences in your actual answer, specifically the final paragraph.  (The paper in your answer was published in 1993, and mentions superscalar CPUs and future directions of cpu architecture, so out-of-order exec was on the horizon, and it&#39;s definitely assuming parallel fetch and decode of multiple instructions.  In fact that&#39;s the whole point of their proposal; seeing through multiple branches per clock cycle in a wider design, fetching them from L1i cache into the pipeline.  Current CPUs still don&#39;t do that.)","body":"I&#39;m not talking about what the linked paper says, I&#39;m talking about the sentences in your actual answer, specifically the final paragraph.  (The paper in your answer was published in 1993, and mentions superscalar CPUs and future directions of cpu architecture, so out-of-order exec was on the horizon, and it&#39;s definitely assuming parallel fetch and decode of multiple instructions.  In fact that&#39;s the whole point of their proposal; seeing through multiple branches per clock cycle in a wider design, fetching them from L1i cache into the pipeline.  Current CPUs still don&#39;t do that.)"}],"tags":[],"owner":{"account_id":4724602,"reputation":1626,"user_id":3821643,"display_name":"hatirlatici"},"comment_count":4,"down_vote_count":2,"up_vote_count":103,"is_accepted":false,"score":101,"last_activity_date":1648059145,"creation_date":1571866540,"answer_id":58531294,"question_id":11227809,"body_markdown":"This question is rooted in *branch prediction models* on CPUs. I&#39;d recommend reading this paper:\r\n\r\n[**Increasing the Instruction Fetch Rate via Multiple Branch Prediction and a Branch Address Cache**][1]  (But real CPUs these days still don&#39;t make multiple taken branch-predictions per clock cycle, except for Haswell and later [effectively unrolling tiny loops in its loop buffer][2].  Modern CPUs can predict multiple branches not-taken to make use of their fetches in large contiguous blocks.)\r\n\r\nWhen you have sorted elements, branch prediction easily predicts correctly except right at the boundary, letting instructions flow through the CPU pipeline efficiently, without having to rewind and take the correct path on mispredictions.\r\n\r\n\r\n  [1]: https://pdfs.semanticscholar.org/5634/4be375cfed0f79cb9d009ac838682e1bace3.pdf\r\n  [2]: https://%20in%20tight%20loops%20using%20a%20loop%20buffer.","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>This question is rooted in <em>branch prediction models</em> on CPUs. I'd recommend reading this paper:</p>\n<p><a href=\"https://pdfs.semanticscholar.org/5634/4be375cfed0f79cb9d009ac838682e1bace3.pdf\" rel=\"noreferrer\"><strong>Increasing the Instruction Fetch Rate via Multiple Branch Prediction and a Branch Address Cache</strong></a>  (But real CPUs these days still don't make multiple taken branch-predictions per clock cycle, except for Haswell and later <a href=\"https://%20in%20tight%20loops%20using%20a%20loop%20buffer.\" rel=\"noreferrer\">effectively unrolling tiny loops in its loop buffer</a>.  Modern CPUs can predict multiple branches not-taken to make use of their fetches in large contiguous blocks.)</p>\n<p>When you have sorted elements, branch prediction easily predicts correctly except right at the boundary, letting instructions flow through the CPU pipeline efficiently, without having to rewind and take the correct path on mispredictions.</p>\n"},{"comments":[{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":5,"creation_date":1636109404,"post_id":69851522,"comment_id":123474693,"body_markdown":"The should be a change near the middle of the sorted train-track / path of execution, as the branch inside the loop is taken for the first ~half, not-taken for the last ~half of the elements.  (Or vice versa.)  Also, what do the 5 different levels in the unsorted case mean?  It&#39;s a 2-way branch.","body":"The should be a change near the middle of the sorted train-track / path of execution, as the branch inside the loop is taken for the first ~half, not-taken for the last ~half of the elements.  (Or vice versa.)  Also, what do the 5 different levels in the unsorted case mean?  It&#39;s a 2-way branch."}],"tags":[],"owner":{"account_id":23218571,"reputation":449,"user_id":17311156,"display_name":"Geek26"},"comment_count":1,"down_vote_count":5,"up_vote_count":34,"is_accepted":false,"score":29,"last_activity_date":1647582204,"creation_date":1636106703,"answer_id":69851522,"question_id":11227809,"body_markdown":"*An answer for quick and simple understanding (read the others for more details)*  \r\n\r\nThis concept is called **branch prediction**\r\n\r\nBranch prediction is an optimization technique that predicts the path the code will take before it is known with certainty. This is important because during the code execution, the machine prefetches several code statements and stores them in the pipeline. \r\n\r\nThe problem arises in conditional branching, where there are two possible paths or parts of the code that can be executed. \r\n\r\nWhen the prediction was true, the optimization technique worked out. \r\n\r\nWhen the prediction was false, to explain it in a simple way, the code statement stored in the pipeline gets proved wrong and the actual code has to be completely reloaded, which takes up a lot of time.\r\n\r\nAs common sense suggests, predictions of something sorted are way more accurate than predictions of something unsorted.\r\n\r\nbranch prediction visualisation:\r\n\r\nsorted                        \r\n[![sorted][1]][1] \r\nunsorted\r\n[![unsorted][2]][2]\r\n\r\n   \r\n\r\n\r\n  [1]: https://i.stack.imgur.com/BhphM.png\r\n  [2]: https://i.stack.imgur.com/2Z7Ct.png","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p><em>An answer for quick and simple understanding (read the others for more details)</em></p>\n<p>This concept is called <strong>branch prediction</strong></p>\n<p>Branch prediction is an optimization technique that predicts the path the code will take before it is known with certainty. This is important because during the code execution, the machine prefetches several code statements and stores them in the pipeline.</p>\n<p>The problem arises in conditional branching, where there are two possible paths or parts of the code that can be executed.</p>\n<p>When the prediction was true, the optimization technique worked out.</p>\n<p>When the prediction was false, to explain it in a simple way, the code statement stored in the pipeline gets proved wrong and the actual code has to be completely reloaded, which takes up a lot of time.</p>\n<p>As common sense suggests, predictions of something sorted are way more accurate than predictions of something unsorted.</p>\n<p>branch prediction visualisation:</p>\n<p>sorted<br />\n<a href=\"https://i.stack.imgur.com/BhphM.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/BhphM.png\" alt=\"sorted\" /></a>\nunsorted\n<a href=\"https://i.stack.imgur.com/2Z7Ct.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/2Z7Ct.png\" alt=\"unsorted\" /></a></p>\n"}],"owner":{"account_id":31692,"reputation":496794,"user_id":87234,"accept_rate":100,"display_name":"GManNickG"},"comment_count":10,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":1851694,"favorite_count":0,"down_vote_count":98,"up_vote_count":27260,"accepted_answer_id":11227902,"answer_count":25,"score":27162,"last_activity_date":1701123268,"creation_date":1340805096,"question_id":11227809,"body_markdown":"In this C++ code, sorting the data (*before* the timed region) makes the primary loop ~6x faster:\r\n\r\n```c++\r\n#include &lt;algorithm&gt;\r\n#include &lt;ctime&gt;\r\n#include &lt;iostream&gt;\r\n\r\nint main()\r\n{\r\n\t// Generate data\r\n\tconst unsigned arraySize = 32768;\r\n\tint data[arraySize];\r\n\r\n\tfor (unsigned c = 0; c &lt; arraySize; ++c)\r\n\t\tdata[c] = std::rand() % 256;\r\n\r\n\t// !!! With this, the next loop runs faster.\r\n\tstd::sort(data, data + arraySize);\r\n\r\n\t// Test\r\n\tclock_t start = clock();\r\n\tlong long sum = 0;\r\n\tfor (unsigned i = 0; i &lt; 100000; ++i)\r\n\t{\r\n\t\tfor (unsigned c = 0; c &lt; arraySize; ++c)\r\n\t\t{\t// Primary loop.\r\n\t\t\tif (data[c] &gt;= 128)\r\n\t\t\t\tsum += data[c];\r\n\t\t}\r\n\t}\r\n\r\n\tdouble elapsedTime = static_cast&lt;double&gt;(clock()-start) / CLOCKS_PER_SEC;\r\n\r\n\tstd::cout &lt;&lt; elapsedTime &lt;&lt; &#39;\\n&#39;;\r\n    std::cout &lt;&lt; &quot;sum = &quot; &lt;&lt; sum &lt;&lt; &#39;\\n&#39;;\r\n}\r\n```\r\n\r\n- Without `std::sort(data, data + arraySize);`, the code runs in 11.54 seconds.\r\n- With the sorted data, the code runs in 1.93 seconds.\r\n\r\n\r\n(Sorting itself takes more time than this one pass over the array, so it&#39;s not actually worth doing if we needed to calculate this for an unknown array.)\r\n\r\n---\r\n\r\nInitially, I thought this might be just a language or compiler anomaly, so I tried Java:\r\n\r\n```java\r\nimport java.util.Arrays;\r\nimport java.util.Random;\r\n\r\npublic class Main\r\n{\r\n\tpublic static void main(String[] args)\r\n\t{\r\n\t\t// Generate data\r\n\t\tint arraySize = 32768;\r\n\t\tint data[] = new int[arraySize];\r\n\r\n\t\tRandom rnd = new Random(0);\r\n\t\tfor (int c = 0; c &lt; arraySize; ++c)\r\n\t\t    data[c] = rnd.nextInt() % 256;\r\n\r\n\t\t// !!! With this, the next loop runs faster\r\n\t\tArrays.sort(data);\r\n\r\n\t\t// Test\r\n\t\tlong start = System.nanoTime();\r\n\t\tlong sum = 0;\r\n\t\tfor (int i = 0; i &lt; 100000; ++i)\r\n\t\t{\r\n\t\t\tfor (int c = 0; c &lt; arraySize; ++c)\r\n\t\t\t{  \t// Primary loop.\r\n\t\t\t\tif (data[c] &gt;= 128)\r\n\t\t\t\t\tsum += data[c];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tSystem.out.println((System.nanoTime() - start) / 1000000000.0);\r\n\t\tSystem.out.println(&quot;sum = &quot; + sum);\r\n\t}\r\n}\r\n```\r\n\r\nWith a similar but less extreme result.\r\n\r\n---\r\n\r\nMy first thought was that sorting brings the data into the [cache](https://en.wikipedia.org/wiki/CPU_cache), but that&#39;s silly because the array was just generated.\r\n\r\n- What is going on?\r\n- Why is processing a sorted array faster than processing an unsorted array?\r\n\r\nThe code is summing up some independent terms, so the order should not matter.\r\n\r\n---\r\n\r\n**Related / follow-up Q&amp;As** about the same effect with different/later compilers and options:\r\n\r\n* https://stackoverflow.com/q/66521344\r\n* https://stackoverflow.com/q/28875325","title":"Why is processing a sorted array faster than processing an unsorted array?","body":"<p>In this C++ code, sorting the data (<em>before</em> the timed region) makes the primary loop ~6x faster:</p>\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;algorithm&gt;\n#include &lt;ctime&gt;\n#include &lt;iostream&gt;\n\nint main()\n{\n    // Generate data\n    const unsigned arraySize = 32768;\n    int data[arraySize];\n\n    for (unsigned c = 0; c &lt; arraySize; ++c)\n        data[c] = std::rand() % 256;\n\n    // !!! With this, the next loop runs faster.\n    std::sort(data, data + arraySize);\n\n    // Test\n    clock_t start = clock();\n    long long sum = 0;\n    for (unsigned i = 0; i &lt; 100000; ++i)\n    {\n        for (unsigned c = 0; c &lt; arraySize; ++c)\n        {   // Primary loop.\n            if (data[c] &gt;= 128)\n                sum += data[c];\n        }\n    }\n\n    double elapsedTime = static_cast&lt;double&gt;(clock()-start) / CLOCKS_PER_SEC;\n\n    std::cout &lt;&lt; elapsedTime &lt;&lt; '\\n';\n    std::cout &lt;&lt; &quot;sum = &quot; &lt;&lt; sum &lt;&lt; '\\n';\n}\n</code></pre>\n<ul>\n<li>Without <code>std::sort(data, data + arraySize);</code>, the code runs in 11.54 seconds.</li>\n<li>With the sorted data, the code runs in 1.93 seconds.</li>\n</ul>\n<p>(Sorting itself takes more time than this one pass over the array, so it's not actually worth doing if we needed to calculate this for an unknown array.)</p>\n<hr />\n<p>Initially, I thought this might be just a language or compiler anomaly, so I tried Java:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.util.Arrays;\nimport java.util.Random;\n\npublic class Main\n{\n    public static void main(String[] args)\n    {\n        // Generate data\n        int arraySize = 32768;\n        int data[] = new int[arraySize];\n\n        Random rnd = new Random(0);\n        for (int c = 0; c &lt; arraySize; ++c)\n            data[c] = rnd.nextInt() % 256;\n\n        // !!! With this, the next loop runs faster\n        Arrays.sort(data);\n\n        // Test\n        long start = System.nanoTime();\n        long sum = 0;\n        for (int i = 0; i &lt; 100000; ++i)\n        {\n            for (int c = 0; c &lt; arraySize; ++c)\n            {   // Primary loop.\n                if (data[c] &gt;= 128)\n                    sum += data[c];\n            }\n        }\n\n        System.out.println((System.nanoTime() - start) / 1000000000.0);\n        System.out.println(&quot;sum = &quot; + sum);\n    }\n}\n</code></pre>\n<p>With a similar but less extreme result.</p>\n<hr />\n<p>My first thought was that sorting brings the data into the <a href=\"https://en.wikipedia.org/wiki/CPU_cache\" rel=\"noreferrer\">cache</a>, but that's silly because the array was just generated.</p>\n<ul>\n<li>What is going on?</li>\n<li>Why is processing a sorted array faster than processing an unsorted array?</li>\n</ul>\n<p>The code is summing up some independent terms, so the order should not matter.</p>\n<hr />\n<p><strong>Related / follow-up Q&amp;As</strong> about the same effect with different/later compilers and options:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/66521344\">Why is processing an unsorted array the same speed as processing a sorted array with modern x86-64 clang?</a></li>\n<li><a href=\"https://stackoverflow.com/q/28875325\">gcc optimization flag -O3 makes code slower than -O2</a></li>\n</ul>\n"},{"tags":["java","web-services"],"comments":[{"owner":{"account_id":10098519,"reputation":5323,"user_id":7463126,"display_name":"Alan Bateman"},"score":0,"creation_date":1546679907,"post_id":54032558,"comment_id":94935693,"body_markdown":"I think JAX-WS uses the thread context class loader when trying to load the JAX-WS implementation so it might be useful to get its value (Thread.currentThread().getContextClassLoader) when trying to debug this.","body":"I think JAX-WS uses the thread context class loader when trying to load the JAX-WS implementation so it might be useful to get its value (Thread.currentThread().getContextClassLoader) when trying to debug this."},{"owner":{"account_id":4462612,"reputation":980,"user_id":3631003,"accept_rate":50,"display_name":"Bob Brown"},"score":0,"creation_date":1546759363,"post_id":54032558,"comment_id":94952468,"body_markdown":"That&#39;s an idea...I had stuff working until I tried putting the webservice calls into CallableFutures. Interestingly, they are working OK inside plain Futures...so this may not be a real thing.","body":"That&#39;s an idea...I had stuff working until I tried putting the webservice calls into CallableFutures. Interestingly, they are working OK inside plain Futures...so this may not be a real thing."},{"owner":{"account_id":3482547,"reputation":887,"user_id":7783416,"accept_rate":80,"display_name":"user2914191"},"score":0,"creation_date":1555305985,"post_id":54032558,"comment_id":98049802,"body_markdown":"anyone got an answer for this? legacy 3rd party jars dont work in jdk 11","body":"anyone got an answer for this? legacy 3rd party jars dont work in jdk 11"},{"owner":{"account_id":10748228,"reputation":155,"user_id":7908713,"display_name":"KraftDurchBlumen"},"score":0,"creation_date":1613996876,"post_id":54032558,"comment_id":117240440,"body_markdown":"There seems to be some progress, see https://github.com/eclipse-ee4j/jax-ws-api/issues/90","body":"There seems to be some progress, see <a href=\"https://github.com/eclipse-ee4j/jax-ws-api/issues/90\" rel=\"nofollow noreferrer\">github.com/eclipse-ee4j/jax-ws-api/issues/90</a>"}],"answers":[{"comments":[{"owner":{"account_id":4462612,"reputation":980,"user_id":3631003,"accept_rate":50,"display_name":"Bob Brown"},"score":1,"creation_date":1558009191,"post_id":56147772,"comment_id":98963276,"body_markdown":"Well, RI 2.3.2 is now out under the eclipse foundation &#39;umbrella&#39; (https://projects.eclipse.org/projects/ee4j.jaxws). I wonder if this has improved anything. I can&#39;t find meaningful release notes, however....","body":"Well, RI 2.3.2 is now out under the eclipse foundation &#39;umbrella&#39; (<a href=\"https://projects.eclipse.org/projects/ee4j.jaxws\" rel=\"nofollow noreferrer\">projects.eclipse.org/projects/ee4j.jaxws</a>). I wonder if this has improved anything. I can&#39;t find meaningful release notes, however...."},{"owner":{"account_id":1525586,"reputation":151,"user_id":1424124,"display_name":"Mark"},"score":0,"creation_date":1635846792,"post_id":56147772,"comment_id":123395626,"body_markdown":"RT 3.0.1 is out as of writing but this broke everything for me as it upgraded glassfish to be incompatible with other components, had to delete my gradle cache to get back where I was!","body":"RT 3.0.1 is out as of writing but this broke everything for me as it upgraded glassfish to be incompatible with other components, had to delete my gradle cache to get back where I was!"}],"tags":[],"owner":{"account_id":2106056,"reputation":890,"user_id":1872360,"accept_rate":88,"display_name":"runholen"},"comment_count":2,"down_vote_count":1,"up_vote_count":46,"is_accepted":false,"score":45,"last_activity_date":1557918089,"creation_date":1557918089,"answer_id":56147772,"question_id":54032558,"body_markdown":"I got the exact same error calling soap-webservices in java11.\r\nI finally got it to work in my testproject by adding the following dependency to pom.xml\r\n    \r\n    &lt;dependency&gt;\r\n        &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\r\n        &lt;artifactId&gt;rt&lt;/artifactId&gt;\r\n\t    &lt;version&gt;2.3.1&lt;/version&gt;\r\n\t&lt;/dependency&gt;\r\nAs my production environment is not converted to maven yet, I then found out that I needed these jar-files on the classpath:\r\n    \r\n    jaxb-runtime-2.3.1.jar\r\n    jaxws-api-2.3.1.jar\r\n    javax.xml.soap-api-1.4.0.jar\r\n    rt-2.3.1.jar\r\n    streambuffer-1.5.3.jar\r\n    policy-2.7.5.jar\r\n    stax-ex-1.8.jar\r\n    javax.jws-api-1.1.jar\r\n    saaj-impl-1.5.0.jar\r\n    gmbal-api-only-3.1.0-b001.jar ","title":"JDK 11; JAX-WS; Provider com.sun.xml.internal.ws.spi.ProviderImpl not found","body":"<p>I got the exact same error calling soap-webservices in java11.\nI finally got it to work in my testproject by adding the following dependency to pom.xml</p>\n\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\n    &lt;artifactId&gt;rt&lt;/artifactId&gt;\n    &lt;version&gt;2.3.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n\n<p>As my production environment is not converted to maven yet, I then found out that I needed these jar-files on the classpath:</p>\n\n<pre><code>jaxb-runtime-2.3.1.jar\njaxws-api-2.3.1.jar\njavax.xml.soap-api-1.4.0.jar\nrt-2.3.1.jar\nstreambuffer-1.5.3.jar\npolicy-2.7.5.jar\nstax-ex-1.8.jar\njavax.jws-api-1.1.jar\nsaaj-impl-1.5.0.jar\ngmbal-api-only-3.1.0-b001.jar \n</code></pre>\n"},{"tags":[],"owner":{"account_id":16647754,"reputation":430,"user_id":12031603,"display_name":"Splioo"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1585785286,"creation_date":1585785286,"answer_id":60982167,"question_id":54032558,"body_markdown":"I got the same error as well. From a Spring application I called an OSGI bundle which did a SOAP request. Right before the call within that OSGI bundle a class loader switch solved the problem.\r\n\r\nUse the classloader from your SOAP Service class and reset the classloader after the call.\r\n\r\n```\r\n    final ClassLoader targetClassLoader = ServiceXY.class.getClassLoader();\r\n    final Thread currentThread = Thread.currentThread();\r\n    final ClassLoader contextClassLoader = currentThread.getContextClassLoader();\r\n    try {\r\n           currentThread.setContextClassLoader(targetClassLoader);\r\n           //here call your Service \r\n    } finally {\r\n           currentThread.setContextClassLoader(contextClassLoader);\r\n    }\r\n```\r\nJEE libs have been removed with Java 9, JEE-specific libs / implementations must now be made available by the application via thirdparty libraries - e.g. jaxws-api.jar and jaxws-rt.jar. This code of JEE libs often still expects to be part of the jre system library and with that of the application classloader - but it isn&#39;t anymore. So if service classloader ```ServiceXY.class.getClassLoader()``` and your application classloader ```Thread.currentThread().getContextClassLoader()``` are different you need to switch for the request. ","title":"JDK 11; JAX-WS; Provider com.sun.xml.internal.ws.spi.ProviderImpl not found","body":"<p>I got the same error as well. From a Spring application I called an OSGI bundle which did a SOAP request. Right before the call within that OSGI bundle a class loader switch solved the problem.</p>\n\n<p>Use the classloader from your SOAP Service class and reset the classloader after the call.</p>\n\n<pre><code>    final ClassLoader targetClassLoader = ServiceXY.class.getClassLoader();\n    final Thread currentThread = Thread.currentThread();\n    final ClassLoader contextClassLoader = currentThread.getContextClassLoader();\n    try {\n           currentThread.setContextClassLoader(targetClassLoader);\n           //here call your Service \n    } finally {\n           currentThread.setContextClassLoader(contextClassLoader);\n    }\n</code></pre>\n\n<p>JEE libs have been removed with Java 9, JEE-specific libs / implementations must now be made available by the application via thirdparty libraries - e.g. jaxws-api.jar and jaxws-rt.jar. This code of JEE libs often still expects to be part of the jre system library and with that of the application classloader - but it isn't anymore. So if service classloader <code>ServiceXY.class.getClassLoader()</code> and your application classloader <code>Thread.currentThread().getContextClassLoader()</code> are different you need to switch for the request. </p>\n"},{"comments":[{"owner":{"account_id":8512883,"reputation":101,"user_id":6382385,"display_name":"Patricio Fernandez"},"score":0,"creation_date":1646931970,"post_id":70451777,"comment_id":126251560,"body_markdown":"thanks this solution helped me","body":"thanks this solution helped me"}],"tags":[],"owner":{"account_id":216352,"reputation":888,"user_id":471554,"display_name":"ZooMMX"},"comment_count":1,"down_vote_count":0,"up_vote_count":15,"is_accepted":false,"score":15,"last_activity_date":1640188490,"creation_date":1640188490,"answer_id":70451777,"question_id":54032558,"body_markdown":"I worked this out with this artifact:\r\n\r\n    &lt;dependency&gt;\r\n        &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\r\n        &lt;artifactId&gt;jaxws-rt&lt;/artifactId&gt;\r\n        &lt;version&gt;2.3.5&lt;/version&gt;\r\n    &lt;/dependency&gt;\r\n\r\nor gradle\r\n    \r\n    implementation &#39;com.sun.xml.ws:jaxws-rt:2.3.5&#39;\r\n\r\nYou can check other versions and which artifacts depends this one here: https://mvnrepository.com/artifact/com.sun.xml.ws/jaxws-rt/2.3.5 .","title":"JDK 11; JAX-WS; Provider com.sun.xml.internal.ws.spi.ProviderImpl not found","body":"<p>I worked this out with this artifact:</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\n    &lt;artifactId&gt;jaxws-rt&lt;/artifactId&gt;\n    &lt;version&gt;2.3.5&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>or gradle</p>\n<pre><code>implementation 'com.sun.xml.ws:jaxws-rt:2.3.5'\n</code></pre>\n<p>You can check other versions and which artifacts depends this one here: <a href=\"https://mvnrepository.com/artifact/com.sun.xml.ws/jaxws-rt/2.3.5\" rel=\"noreferrer\">https://mvnrepository.com/artifact/com.sun.xml.ws/jaxws-rt/2.3.5</a> .</p>\n"},{"tags":[],"owner":{"account_id":9427779,"reputation":336,"user_id":7012221,"display_name":"Abhishek"},"comment_count":0,"down_vote_count":0,"up_vote_count":3,"is_accepted":false,"score":3,"last_activity_date":1667580982,"creation_date":1667580982,"answer_id":74320506,"question_id":54032558,"body_markdown":"After going through lots of official documents and methods of trial and error, we finally found the correct configuration, which is as as follows,\r\n\r\nAdd below dependancy in .pom file,\r\n\r\n\r\n\t\t&lt;dependency&gt;\r\n\t\t\t&lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\r\n\t\t\t&lt;artifactId&gt;jaxws-ri&lt;/artifactId&gt;\r\n\t\t\t&lt;version&gt;2.3.2&lt;/version&gt;\r\n\t\t\t&lt;type&gt;pom&lt;/type&gt;\r\n\t\t&lt;/dependency&gt;\r\n\t\t&lt;dependency&gt;\r\n\t\t\t&lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\r\n\t\t\t&lt;artifactId&gt;rt&lt;/artifactId&gt;\r\n\t\t\t&lt;version&gt;2.3.2&lt;/version&gt;\r\n\t\t&lt;/dependency&gt;\r\n \r\n\r\nTo include JAR responsible for loading these classes into restart classloader (used in spring-devtools), update /src/main/resources/META-INF/spring-devtools.properties like below,\r\n\r\n\r\nrestart.include.jax=/jaxws-rt.*\\.jar","title":"JDK 11; JAX-WS; Provider com.sun.xml.internal.ws.spi.ProviderImpl not found","body":"<p>After going through lots of official documents and methods of trial and error, we finally found the correct configuration, which is as as follows,</p>\n<p>Add below dependancy in .pom file,</p>\n<pre><code>    &lt;dependency&gt;\n        &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\n        &lt;artifactId&gt;jaxws-ri&lt;/artifactId&gt;\n        &lt;version&gt;2.3.2&lt;/version&gt;\n        &lt;type&gt;pom&lt;/type&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\n        &lt;artifactId&gt;rt&lt;/artifactId&gt;\n        &lt;version&gt;2.3.2&lt;/version&gt;\n    &lt;/dependency&gt;\n</code></pre>\n<p>To include JAR responsible for loading these classes into restart classloader (used in spring-devtools), update /src/main/resources/META-INF/spring-devtools.properties like below,</p>\n<p>restart.include.jax=/jaxws-rt.*.jar</p>\n"},{"tags":[],"owner":{"account_id":28903733,"reputation":41,"user_id":22138107,"display_name":"Sir Codes Alot"},"comment_count":0,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1687858634,"creation_date":1687858634,"answer_id":76563523,"question_id":54032558,"body_markdown":"I had the same issue.\r\nI later found out that having moved from javax packages to jakarta packages you will also have to import the correct dependencies. At the time of this comment the latest is 4.0.1. However, I think any version from 3.0.1 should work with Jakarta.\r\nYou will need to import:\r\n```\r\n    &lt;dependency&gt;\r\n        &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\r\n        &lt;artifactId&gt;rt&lt;/artifactId&gt;\r\n        &lt;version&gt;4.0.1&lt;/version&gt;\r\n    &lt;/dependency&gt;\r\n```","title":"JDK 11; JAX-WS; Provider com.sun.xml.internal.ws.spi.ProviderImpl not found","body":"<p>I had the same issue.\nI later found out that having moved from javax packages to jakarta packages you will also have to import the correct dependencies. At the time of this comment the latest is 4.0.1. However, I think any version from 3.0.1 should work with Jakarta.\nYou will need to import:</p>\n<pre><code>    &lt;dependency&gt;\n        &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;\n        &lt;artifactId&gt;rt&lt;/artifactId&gt;\n        &lt;version&gt;4.0.1&lt;/version&gt;\n    &lt;/dependency&gt;\n</code></pre>\n"},{"tags":[],"owner":{"account_id":26985233,"reputation":1,"user_id":20548997,"display_name":"Yuhong He"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1695387515,"creation_date":1695387515,"answer_id":77157828,"question_id":54032558,"body_markdown":"For me, I need @WebService annotation in the code. And I got the same error in Java 11 with jakarta.jws.WebMethod. I tried all the solutions above, but not working for me.\r\n\r\nThen I shifted to Java 8 and used javax.jws.WebMethod. It is working.","title":"JDK 11; JAX-WS; Provider com.sun.xml.internal.ws.spi.ProviderImpl not found","body":"<p>For me, I need @WebService annotation in the code. And I got the same error in Java 11 with jakarta.jws.WebMethod. I tried all the solutions above, but not working for me.</p>\n<p>Then I shifted to Java 8 and used javax.jws.WebMethod. It is working.</p>\n"},{"tags":[],"owner":{"account_id":2120573,"reputation":11,"user_id":1883903,"display_name":"Miguel Angel Bautista"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701123251,"creation_date":1701123251,"answer_id":77560235,"question_id":54032558,"body_markdown":"Another solution is to replace javax.xml.ws with jakarta.xml.ws:\r\n\r\n    implementation &#39;jakarta.xml.ws:jakarta.xml.ws-api:4.0.1&#39;\r\n\r\n \r\nreplace all the imports and if you have this remove it:\r\n\r\n    System.setProperty(&quot;javax.xml.ws.spi.Provider&quot;, &quot;com.sun.xml.ws.spi.ProviderImpl&quot;)\r\n\r\n\r\n","title":"JDK 11; JAX-WS; Provider com.sun.xml.internal.ws.spi.ProviderImpl not found","body":"<p>Another solution is to replace javax.xml.ws with jakarta.xml.ws:</p>\n<pre><code>implementation 'jakarta.xml.ws:jakarta.xml.ws-api:4.0.1'\n</code></pre>\n<p>replace all the imports and if you have this remove it:</p>\n<pre><code>System.setProperty(&quot;javax.xml.ws.spi.Provider&quot;, &quot;com.sun.xml.ws.spi.ProviderImpl&quot;)\n</code></pre>\n"}],"owner":{"account_id":4462612,"reputation":980,"user_id":3631003,"accept_rate":50,"display_name":"Bob Brown"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":72185,"favorite_count":0,"down_vote_count":0,"up_vote_count":49,"answer_count":7,"score":49,"last_activity_date":1701123251,"creation_date":1546570357,"question_id":54032558,"body_markdown":"I Need to access legacy SOAP webservices in JDK 11. But I am suffering &quot;ProviderImpl not found.&quot;\r\n\r\nThe JDK 11 implementation is: zulu11.2.3-jdk11.0.1-win_x64.\r\n\r\nIn my build.gradle, I have the following dependency:\r\n\r\n    compile group: &#39;com.sun.xml.ws&#39;, name: &#39;jaxws-rt&#39;, version: &#39;2.3.1&#39;, ext: &#39;pom&#39;, { force = true }\r\n\r\nMy WAR file&#39;s WEB-INF/lib\r\n contains\r\n[![enter image description here][1]][1]\r\n\r\n\r\nI am seeing:\r\n\r\n    javax.xml.ws.WebServiceException: Provider com.sun.xml.internal.ws.spi.ProviderImpl not found\r\n    \tat javax.xml.ws.spi.FactoryFinder$1.createException(FactoryFinder.java:61) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.FactoryFinder$1.createException(FactoryFinder.java:58) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.ServiceLoaderUtil.newInstance(ServiceLoaderUtil.java:103) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.FactoryFinder.find(FactoryFinder.java:112) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.Provider.provider(Provider.java:96) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.Service.&lt;init&gt;(Service.java:112) ~[jaxws-api-2.3.1.jar:na]\r\n\r\nFollowing https://github.com/javaee/metro-jax-ws/issues/1247 I have tried setting:\r\n\r\n-Djavax.xml.ws.spi.Provider=com.sun.xml.ws.spi.ProviderImpl\r\n\r\nBut I still get:\r\n\r\n    javax.xml.ws.WebServiceException: Provider com.sun.xml.ws.spi.ProviderImpl not found\r\n    \tat javax.xml.ws.spi.FactoryFinder$1.createException(FactoryFinder.java:61) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.FactoryFinder$1.createException(FactoryFinder.java:58) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.ServiceLoaderUtil.newInstance(ServiceLoaderUtil.java:103) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.FactoryFinder.fromSystemProperty(FactoryFinder.java:122) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.FactoryFinder.find(FactoryFinder.java:99) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.Provider.provider(Provider.java:96) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.Service.&lt;init&gt;(Service.java:112) ~[jaxws-api-2.3.1.jar:na]\r\n    \t...\r\n    Caused by: java.lang.ClassNotFoundException: com.sun.xml.ws.spi.ProviderImpl\r\n    \tat java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:583) ~[na:na]\r\n    \tat java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178) ~[na:na]\r\n    \tat java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521) ~[na:na]\r\n    \tat javax.xml.ws.spi.ServiceLoaderUtil.nullSafeLoadClass(ServiceLoaderUtil.java:90) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.ServiceLoaderUtil.safeLoadClass(ServiceLoaderUtil.java:123) ~[jaxws-api-2.3.1.jar:na]\r\n    \tat javax.xml.ws.spi.ServiceLoaderUtil.newInstance(ServiceLoaderUtil.java:101) ~[jaxws-api-2.3.1.jar:na]\r\n    \t... 22 common frames omitted\r\n\r\n\r\nI have verified that com.sun.xml.ws.spi.ProviderImpl IS available:\r\n\r\n[![enter image description here][2]][2]\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/mBsKL.png\r\n  [2]: https://i.stack.imgur.com/cU52u.png\r\n\r\nIs there a known working example of this combination available &quot;out there&quot;?\r\n\r\n\r\nThoughts/suggestions gratefully accepted.","title":"JDK 11; JAX-WS; Provider com.sun.xml.internal.ws.spi.ProviderImpl not found","body":"<p>I Need to access legacy SOAP webservices in JDK 11. But I am suffering \"ProviderImpl not found.\"</p>\n\n<p>The JDK 11 implementation is: zulu11.2.3-jdk11.0.1-win_x64.</p>\n\n<p>In my build.gradle, I have the following dependency:</p>\n\n<pre><code>compile group: 'com.sun.xml.ws', name: 'jaxws-rt', version: '2.3.1', ext: 'pom', { force = true }\n</code></pre>\n\n<p>My WAR file's WEB-INF/lib\n contains\n<a href=\"https://i.stack.imgur.com/mBsKL.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/mBsKL.png\" alt=\"enter image description here\"></a></p>\n\n<p>I am seeing:</p>\n\n<pre><code>javax.xml.ws.WebServiceException: Provider com.sun.xml.internal.ws.spi.ProviderImpl not found\n    at javax.xml.ws.spi.FactoryFinder$1.createException(FactoryFinder.java:61) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.FactoryFinder$1.createException(FactoryFinder.java:58) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.ServiceLoaderUtil.newInstance(ServiceLoaderUtil.java:103) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.FactoryFinder.find(FactoryFinder.java:112) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.Provider.provider(Provider.java:96) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.Service.&lt;init&gt;(Service.java:112) ~[jaxws-api-2.3.1.jar:na]\n</code></pre>\n\n<p>Following <a href=\"https://github.com/javaee/metro-jax-ws/issues/1247\" rel=\"noreferrer\">https://github.com/javaee/metro-jax-ws/issues/1247</a> I have tried setting:</p>\n\n<p>-Djavax.xml.ws.spi.Provider=com.sun.xml.ws.spi.ProviderImpl</p>\n\n<p>But I still get:</p>\n\n<pre><code>javax.xml.ws.WebServiceException: Provider com.sun.xml.ws.spi.ProviderImpl not found\n    at javax.xml.ws.spi.FactoryFinder$1.createException(FactoryFinder.java:61) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.FactoryFinder$1.createException(FactoryFinder.java:58) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.ServiceLoaderUtil.newInstance(ServiceLoaderUtil.java:103) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.FactoryFinder.fromSystemProperty(FactoryFinder.java:122) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.FactoryFinder.find(FactoryFinder.java:99) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.Provider.provider(Provider.java:96) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.Service.&lt;init&gt;(Service.java:112) ~[jaxws-api-2.3.1.jar:na]\n    ...\nCaused by: java.lang.ClassNotFoundException: com.sun.xml.ws.spi.ProviderImpl\n    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:583) ~[na:na]\n    at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178) ~[na:na]\n    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521) ~[na:na]\n    at javax.xml.ws.spi.ServiceLoaderUtil.nullSafeLoadClass(ServiceLoaderUtil.java:90) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.ServiceLoaderUtil.safeLoadClass(ServiceLoaderUtil.java:123) ~[jaxws-api-2.3.1.jar:na]\n    at javax.xml.ws.spi.ServiceLoaderUtil.newInstance(ServiceLoaderUtil.java:101) ~[jaxws-api-2.3.1.jar:na]\n    ... 22 common frames omitted\n</code></pre>\n\n<p>I have verified that com.sun.xml.ws.spi.ProviderImpl IS available:</p>\n\n<p><a href=\"https://i.stack.imgur.com/cU52u.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/cU52u.png\" alt=\"enter image description here\"></a></p>\n\n<p>Is there a known working example of this combination available \"out there\"?</p>\n\n<p>Thoughts/suggestions gratefully accepted.</p>\n"},{"tags":["java","hadoop","parquet","avro"],"owner":{"account_id":10012783,"reputation":23,"user_id":7405139,"display_name":"Anil"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":36,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"answer_count":0,"score":1,"last_activity_date":1701123150,"creation_date":1700152153,"question_id":77496508,"body_markdown":"I am trying to generate some parquet files from my POJO classes. I am mostly successful in that but AvroWriter is giving me a failure when I try to save a list of custom POJO object. \r\n\r\n```\r\n try {\r\n     ParquetWriter&lt;GenericRecord&gt; writer = writerMap.computeIfAbsent(separator, pWriter -&gt; {\r\n         try {\r\n             return AvroParquetWriter\r\n                    .&lt;GenericRecord&gt;builder(path)\r\n                    .withSchema(schema)\r\n                    .withWriteMode(ParquetFileWriter.Mode.OVERWRITE)\r\n                    .withConf(config)\r\n                    .withValidation(false)\r\n                    .withPageWriteChecksumEnabled(false)\r\n                    .withDictionaryEncoding(false)\r\n                    .withCompressionCodec(CompressionCodecName.SNAPPY)\r\n                    .build();\r\n         } catch (IOException e) {\r\n             throw new RuntimeException(&quot;Error creating Parquet writer&quot;, e);\r\n         }\r\n     });\r\n\r\n     writer.write(convertToGenericRecord(item, schema));\r\n } catch (Exception ex) {\r\n     log.error(&quot;Exception while writing to parquet file&quot;, ex);\r\n }\r\n```\r\n\r\n\r\n\r\nThis is my Schema:\r\n```\r\n public static Schema getServiceOrdersJsonSchema2() {\r\n     Schema arraySchema = SchemaBuilder.array()\r\n               .items(SchemaBuilder.record(&quot;ServiceOrderJson&quot;)\r\n               .namespace(&quot;ServiceOrders&quot;)\r\n               .fields()\r\n                   .name(&quot;value1&quot;).type().stringType().noDefault()\r\n                   .name(&quot;value2&quot;).type().stringType().noDefault()\r\n                   .name(&quot;value3&quot;).type().longType().noDefault()\r\n                   .name(&quot;value4&quot;).type().stringType().noDefault()\r\n                   .name(&quot;value5&quot;).type().booleanType().noDefault()\r\n               .endRecord());\r\n    return arraySchema;\r\n}\r\n```\r\n\r\nThis is my POJO class:\r\n```\r\npublic class ServiceOrderJson {\r\n    public String value1;\r\n    public String value2;\r\n    public long value3;\r\n    public String value4;\r\n    public Boolean value5;\r\n}\r\n```\r\n\r\nStackTrace:\r\n\r\n    java.lang.ArrayIndexOutOfBoundsException: Index 3 out of bounds for length 3\r\n    \tat org.apache.parquet.io.MessageColumnIO$MessageColumnIORecordConsumer.addBinary(MessageColumnIO.java:476) ~[parquet-column-1.13.1.jar:1.13.1]\r\n    \tat org.apache.parquet.avro.AvroWriteSupport.writeValueWithoutConversion(AvroWriteSupport.java:362) ~[parquet-avro-1.13.1.jar:1.13.1]\r\n    \tat org.apache.parquet.avro.AvroWriteSupport.writeValue(AvroWriteSupport.java:291) ~[parquet-avro-1.13.1.jar:1.13.1]\r\n    \tat org.apache.parquet.avro.AvroWriteSupport.writeRecordFields(AvroWriteSupport.java:204) ~[parquet-avro-1.13.1.jar:1.13.1]\r\n    \tat org.apache.parquet.avro.AvroWriteSupport.write(AvroWriteSupport.java:178) ~[parquet-avro-1.13.1.jar:1.13.1]\r\n    \tat org.apache.parquet.hadoop.InternalParquetRecordWriter.write(InternalParquetRecordWriter.java:138) ~[parquet-hadoop-1.13.1.jar:1.13.1]\r\n    \tat org.apache.parquet.hadoop.ParquetWriter.write(ParquetWriter.java:310) ~[parquet-hadoop-1.13.1.jar:1.13.1]\r\n    \tat com.mbti.cddm.analyticsintegration.writer.ParquetItemWriter.generateParquetFiles(ParquetItemWriter.java:123) ~[classes/:na]\r\n\r\nI was expecting that Array is going to be recognized and written into a file.","title":"Apache Parquet Writer throws ArrayIndexOutOfBoundsException when writing Avro","body":"<p>I am trying to generate some parquet files from my POJO classes. I am mostly successful in that but AvroWriter is giving me a failure when I try to save a list of custom POJO object.</p>\n<pre><code> try {\n     ParquetWriter&lt;GenericRecord&gt; writer = writerMap.computeIfAbsent(separator, pWriter -&gt; {\n         try {\n             return AvroParquetWriter\n                    .&lt;GenericRecord&gt;builder(path)\n                    .withSchema(schema)\n                    .withWriteMode(ParquetFileWriter.Mode.OVERWRITE)\n                    .withConf(config)\n                    .withValidation(false)\n                    .withPageWriteChecksumEnabled(false)\n                    .withDictionaryEncoding(false)\n                    .withCompressionCodec(CompressionCodecName.SNAPPY)\n                    .build();\n         } catch (IOException e) {\n             throw new RuntimeException(&quot;Error creating Parquet writer&quot;, e);\n         }\n     });\n\n     writer.write(convertToGenericRecord(item, schema));\n } catch (Exception ex) {\n     log.error(&quot;Exception while writing to parquet file&quot;, ex);\n }\n</code></pre>\n<p>This is my Schema:</p>\n<pre><code> public static Schema getServiceOrdersJsonSchema2() {\n     Schema arraySchema = SchemaBuilder.array()\n               .items(SchemaBuilder.record(&quot;ServiceOrderJson&quot;)\n               .namespace(&quot;ServiceOrders&quot;)\n               .fields()\n                   .name(&quot;value1&quot;).type().stringType().noDefault()\n                   .name(&quot;value2&quot;).type().stringType().noDefault()\n                   .name(&quot;value3&quot;).type().longType().noDefault()\n                   .name(&quot;value4&quot;).type().stringType().noDefault()\n                   .name(&quot;value5&quot;).type().booleanType().noDefault()\n               .endRecord());\n    return arraySchema;\n}\n</code></pre>\n<p>This is my POJO class:</p>\n<pre><code>public class ServiceOrderJson {\n    public String value1;\n    public String value2;\n    public long value3;\n    public String value4;\n    public Boolean value5;\n}\n</code></pre>\n<p>StackTrace:</p>\n<pre><code>java.lang.ArrayIndexOutOfBoundsException: Index 3 out of bounds for length 3\n    at org.apache.parquet.io.MessageColumnIO$MessageColumnIORecordConsumer.addBinary(MessageColumnIO.java:476) ~[parquet-column-1.13.1.jar:1.13.1]\n    at org.apache.parquet.avro.AvroWriteSupport.writeValueWithoutConversion(AvroWriteSupport.java:362) ~[parquet-avro-1.13.1.jar:1.13.1]\n    at org.apache.parquet.avro.AvroWriteSupport.writeValue(AvroWriteSupport.java:291) ~[parquet-avro-1.13.1.jar:1.13.1]\n    at org.apache.parquet.avro.AvroWriteSupport.writeRecordFields(AvroWriteSupport.java:204) ~[parquet-avro-1.13.1.jar:1.13.1]\n    at org.apache.parquet.avro.AvroWriteSupport.write(AvroWriteSupport.java:178) ~[parquet-avro-1.13.1.jar:1.13.1]\n    at org.apache.parquet.hadoop.InternalParquetRecordWriter.write(InternalParquetRecordWriter.java:138) ~[parquet-hadoop-1.13.1.jar:1.13.1]\n    at org.apache.parquet.hadoop.ParquetWriter.write(ParquetWriter.java:310) ~[parquet-hadoop-1.13.1.jar:1.13.1]\n    at com.mbti.cddm.analyticsintegration.writer.ParquetItemWriter.generateParquetFiles(ParquetItemWriter.java:123) ~[classes/:na]\n</code></pre>\n<p>I was expecting that Array is going to be recognized and written into a file.</p>\n"},{"tags":["java","swing","jtable","jradiobutton"],"comments":[{"owner":{"account_id":3329749,"reputation":8669,"user_id":2798955,"accept_rate":28,"display_name":"Bruce"},"score":0,"creation_date":1437548409,"post_id":31555980,"comment_id":51069006,"body_markdown":"what you have tried so far?","body":"what you have tried so far?"},{"owner":{"account_id":969721,"reputation":344527,"user_id":992484,"accept_rate":60,"display_name":"MadProgrammer"},"score":0,"creation_date":1437548562,"post_id":31555980,"comment_id":51069088,"body_markdown":"You need to evaluate the value of `sex` to a `boolean` (`true`/`false`) which can the be set to the `JRadioButton` via `isSelected`.  You might also like to have a look at [How to Use the ButtonGroup Component](https://docs.oracle.com/javase/tutorial/uiswing/components/buttongroup.html)","body":"You need to evaluate the value of <code>sex</code> to a <code>boolean</code> (<code>true</code>/<code>false</code>) which can the be set to the <code>JRadioButton</code> via <code>isSelected</code>.  You might also like to have a look at <a href=\"https://docs.oracle.com/javase/tutorial/uiswing/components/buttongroup.html\" rel=\"nofollow noreferrer\">How to Use the ButtonGroup Component</a>"},{"owner":{"account_id":969721,"reputation":344527,"user_id":992484,"accept_rate":60,"display_name":"MadProgrammer"},"score":0,"creation_date":1437548660,"post_id":31555980,"comment_id":51069141,"body_markdown":"Some idea of the structure of the `Student` class would be helpful","body":"Some idea of the structure of the <code>Student</code> class would be helpful"},{"owner":{"account_id":937730,"reputation":1823,"user_id":966347,"accept_rate":96,"display_name":"NovusMobile"},"score":0,"creation_date":1437549225,"post_id":31555980,"comment_id":51069463,"body_markdown":"possible duplicate of [Radio button not posting value to MySQL database](http://stackoverflow.com/questions/4770199/radio-button-not-posting-value-to-mysql-database)","body":"possible duplicate of <a href=\"http://stackoverflow.com/questions/4770199/radio-button-not-posting-value-to-mysql-database\">Radio button not posting value to MySQL database</a>"},{"owner":{"account_id":6651843,"reputation":105,"user_id":5133578,"accept_rate":0,"display_name":"STEPHEN YAO"},"score":0,"creation_date":1437620871,"post_id":31555980,"comment_id":51109291,"body_markdown":"Thank you guys! but I&#39;m stuck in that radiobutton I can&#39;t set it based on database","body":"Thank you guys! but I&#39;m stuck in that radiobutton I can&#39;t set it based on database"}],"answers":[{"comments":[{"owner":{"account_id":6651843,"reputation":105,"user_id":5133578,"accept_rate":0,"display_name":"STEPHEN YAO"},"score":0,"creation_date":1437576980,"post_id":31556347,"comment_id":51088867,"body_markdown":"Thank you sir for your help! But I need to set my radio button automatically based from the database","body":"Thank you sir for your help! But I need to set my radio button automatically based from the database"}],"tags":[],"owner":{"account_id":6457339,"reputation":1080,"user_id":5002284,"display_name":"dly"},"comment_count":1,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1437549476,"creation_date":1437549476,"answer_id":31556347,"question_id":31555980,"body_markdown":"        String gender = &quot;male&quot; \r\n        // this comes from db - since we don&#39;t know the structure this is a plain guess.\r\n        \r\n        if (gender.equals(&quot;male&quot;) {\r\n            rbtMale.setSelected(true); \r\n        } else {\r\n            rbtFemale.setSelected(true); \r\n        } \r\n\r\n\r\nAnd like MadProgrammer said, you will need a `ButtonGroup` and `add` all relevant buttons to it.\r\n\r\n    private final ButtonGroup genderButtons = new ButtonGroup();\r\n    genderButtons.add(rbtMale);\r\n    genderButtons.add(rbtFemale);\r\n\r\n\r\n","title":"How to set the Radio Button based on the value fetched from the database","body":"<pre><code>    String gender = \"male\" \n    // this comes from db - since we don't know the structure this is a plain guess.\n\n    if (gender.equals(\"male\") {\n        rbtMale.setSelected(true); \n    } else {\n        rbtFemale.setSelected(true); \n    } \n</code></pre>\n\n<p>And like MadProgrammer said, you will need a <code>ButtonGroup</code> and <code>add</code> all relevant buttons to it.</p>\n\n<pre><code>private final ButtonGroup genderButtons = new ButtonGroup();\ngenderButtons.add(rbtMale);\ngenderButtons.add(rbtFemale);\n</code></pre>\n"},{"tags":[],"owner":{"account_id":4825208,"reputation":1874,"user_id":3894826,"display_name":"A.Aleem11"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1509754843,"creation_date":1509754843,"answer_id":47106084,"question_id":31555980,"body_markdown":"I&#39;ve worked with same kinda solution in my work I am generating radiobutton with database values and showing them in java dialog.\r\n\r\nWe have a values from database stored in list like below:\r\n\r\n&gt; List Titles; //This is a list containing your database values\r\n\r\nFirst count the values of this list elements: \r\n\r\n&gt;    int list_count=Titles.size();\r\n\r\nNow to proceed with radio function first we need to convert list elements into array like below:\r\n\r\n    String[] col = new String[list_count]; //created an array with limit of list count values\r\n\tfor(int i=0; i &lt; list_count; i++){ \r\n    col[i]=Titles.get(i).toString(); // add values of list into array with loop\r\n\t}\r\n\r\nBelow is the function that is creating radio buttons with database array we created above:\r\n\r\n \r\n\r\n     public String get_key(int list_count, String[] col){\r\n\r\n       JRadioButton jb[] = new JRadioButton[col.length]; //Create Radion button array\r\n\r\n       ButtonGroup rb = new ButtonGroup(); //Group Radio Button\r\n\r\n       JPanel panel = new JPanel( new GridLayout(0, 1) ); //Set layout of radion button to display each after other\r\n\r\n       JScrollPane sp = new JScrollPane(panel); // Create a scrollpane to put all these radio button on that\r\n\r\n       GridBagLayout gridbag = new GridBagLayout(); //Layout for scrollpane\r\n        \r\n    sp.setViewportBorder(BorderFactory.createBevelBorder(BevelBorder.LOWERED)); //bordre for scrollpane\r\n\r\n        List&lt;Component&gt; q = new ArrayList&lt;&gt;(); // q is a component to store and display each radio button\r\n\r\n        JLabel h1=new JLabel(&quot;Select a value&quot;); //put a heading on top of jpanel before radio button\r\n\r\n        h1.setFont(new Font(&quot;Serif&quot;, Font.BOLD, 18)); // set heading text\r\n\r\n        panel.add(h1); //add heading on top of jpanel\r\n\r\n        panel.setBorder(new EmptyBorder(10, 10, 10, 10)); //set panel border to padding each radio button\r\n\r\n        for(int i=0; i &lt; list_count; i++){ \r\n\r\n         jb[i]=new JRadioButton(col[i]); //create radion button dynamacially &quot;col[i]&quot; is the value of each radio\r\n\r\n         rb.add(jb[i]); //it is important also to put all radio in a group we created so only one element should be selected\r\n\r\n         panel.add(jb[i]); // add all radio on jpanel\r\n\r\n            }\r\n    \r\n    sp.setPreferredSize( new Dimension( 350, 300 ) ); //set size of scrollpane\r\n\r\n    int act=JOptionPane.showConfirmDialog(null, sp, &quot;Select Primary Key&quot;,JOptionPane.OK_CANCEL_OPTION,JOptionPane.PLAIN_MESSAGE); //add and show scrollpane in dialog\r\n    \r\n    }\r\n\r\nCalling this function with parameter values we created first &quot;list_count&quot; &amp; &quot;col&quot;:\r\n\r\n    get_key(list_count, col);","title":"How to set the Radio Button based on the value fetched from the database","body":"<p>I've worked with same kinda solution in my work I am generating radiobutton with database values and showing them in java dialog.</p>\n\n<p>We have a values from database stored in list like below:</p>\n\n<blockquote>\n  <p>List Titles; //This is a list containing your database values</p>\n</blockquote>\n\n<p>First count the values of this list elements: </p>\n\n<blockquote>\n  <p>int list_count=Titles.size();</p>\n</blockquote>\n\n<p>Now to proceed with radio function first we need to convert list elements into array like below:</p>\n\n<pre><code>String[] col = new String[list_count]; //created an array with limit of list count values\nfor(int i=0; i &lt; list_count; i++){ \ncol[i]=Titles.get(i).toString(); // add values of list into array with loop\n}\n</code></pre>\n\n<p>Below is the function that is creating radio buttons with database array we created above:</p>\n\n<pre><code> public String get_key(int list_count, String[] col){\n\n   JRadioButton jb[] = new JRadioButton[col.length]; //Create Radion button array\n\n   ButtonGroup rb = new ButtonGroup(); //Group Radio Button\n\n   JPanel panel = new JPanel( new GridLayout(0, 1) ); //Set layout of radion button to display each after other\n\n   JScrollPane sp = new JScrollPane(panel); // Create a scrollpane to put all these radio button on that\n\n   GridBagLayout gridbag = new GridBagLayout(); //Layout for scrollpane\n\nsp.setViewportBorder(BorderFactory.createBevelBorder(BevelBorder.LOWERED)); //bordre for scrollpane\n\n    List&lt;Component&gt; q = new ArrayList&lt;&gt;(); // q is a component to store and display each radio button\n\n    JLabel h1=new JLabel(\"Select a value\"); //put a heading on top of jpanel before radio button\n\n    h1.setFont(new Font(\"Serif\", Font.BOLD, 18)); // set heading text\n\n    panel.add(h1); //add heading on top of jpanel\n\n    panel.setBorder(new EmptyBorder(10, 10, 10, 10)); //set panel border to padding each radio button\n\n    for(int i=0; i &lt; list_count; i++){ \n\n     jb[i]=new JRadioButton(col[i]); //create radion button dynamacially \"col[i]\" is the value of each radio\n\n     rb.add(jb[i]); //it is important also to put all radio in a group we created so only one element should be selected\n\n     panel.add(jb[i]); // add all radio on jpanel\n\n        }\n\nsp.setPreferredSize( new Dimension( 350, 300 ) ); //set size of scrollpane\n\nint act=JOptionPane.showConfirmDialog(null, sp, \"Select Primary Key\",JOptionPane.OK_CANCEL_OPTION,JOptionPane.PLAIN_MESSAGE); //add and show scrollpane in dialog\n\n}\n</code></pre>\n\n<p>Calling this function with parameter values we created first \"list_count\" &amp; \"col\":</p>\n\n<pre><code>get_key(list_count, col);\n</code></pre>\n"},{"tags":[],"owner":{"account_id":14454476,"reputation":1,"user_id":10441088,"display_name":"Karshanguna R"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1538406208,"creation_date":1538401603,"answer_id":52592565,"question_id":31555980,"body_markdown":"Create a `Student.java` class to get particular table value from database.\r\nIn the current form `AddStudent` create a function call as `getStudentList` to fill the GUI form with database data to particular id.\r\n\r\n        public ArrayList&lt;Student&gt; getStudentList() {\r\n        ArrayList&lt;Student&gt; studentList = new ArrayList&lt;&gt;();\r\n        conn = DbConnection.ConnectDb();\r\n        String selectQuery = &quot;SELECT * FROM student&quot;;\r\n        \r\n        try {\r\n            PreparedStatement pst = conn.prepareStatement();\r\n            ResultSet rs = pst.executeQuery();\r\n            Donor donor;\r\n            \r\n            while(rs.next()) {\r\n                student = new Student(rs.getString(&quot;id&quot;),\r\n                rs.getString(&quot;gender&quot;));\r\n                studentList.add(student);\r\n            }\r\n        \r\n        } catch (SQLException ex) {\r\n            Logger.getLogger(Student.class.getName()).log(Level.SEVERE, null, ex);\r\n        }\r\n        return studentList; \r\n    }\r\n\r\nAfter create a function called `showStudent` to show the particular data value to called id.(In below code `male,female` are the checkbox values)\r\n\r\n        public void showStudent(int index) throws ParseException {\r\n        if(getStudentList().get(index).getGender().equals(&quot;male&quot;)) {\r\n                    male.setSelected(true);\r\n                    female.setSelected(false);\r\n                    gender = &quot;male&quot;;\r\n                }\r\n                else {\r\n                    female.setSelected(true);\r\n                    male.setSelected(false);\r\n                    gender = &quot;female&quot;;\r\n                }\r\n        }\r\n\r\nSet action to the `jbutton`, When get value id from `jtextfield` then fill the checkbox in particular gender value.\r\n","title":"How to set the Radio Button based on the value fetched from the database","body":"<p>Create a <code>Student.java</code> class to get particular table value from database.\nIn the current form <code>AddStudent</code> create a function call as <code>getStudentList</code> to fill the GUI form with database data to particular id.</p>\n\n<pre><code>    public ArrayList&lt;Student&gt; getStudentList() {\n    ArrayList&lt;Student&gt; studentList = new ArrayList&lt;&gt;();\n    conn = DbConnection.ConnectDb();\n    String selectQuery = \"SELECT * FROM student\";\n\n    try {\n        PreparedStatement pst = conn.prepareStatement();\n        ResultSet rs = pst.executeQuery();\n        Donor donor;\n\n        while(rs.next()) {\n            student = new Student(rs.getString(\"id\"),\n            rs.getString(\"gender\"));\n            studentList.add(student);\n        }\n\n    } catch (SQLException ex) {\n        Logger.getLogger(Student.class.getName()).log(Level.SEVERE, null, ex);\n    }\n    return studentList; \n}\n</code></pre>\n\n<p>After create a function called <code>showStudent</code> to show the particular data value to called id.(In below code <code>male,female</code> are the checkbox values)</p>\n\n<pre><code>    public void showStudent(int index) throws ParseException {\n    if(getStudentList().get(index).getGender().equals(\"male\")) {\n                male.setSelected(true);\n                female.setSelected(false);\n                gender = \"male\";\n            }\n            else {\n                female.setSelected(true);\n                male.setSelected(false);\n                gender = \"female\";\n            }\n    }\n</code></pre>\n\n<p>Set action to the <code>jbutton</code>, When get value id from <code>jtextfield</code> then fill the checkbox in particular gender value.</p>\n"}],"owner":{"account_id":6651843,"reputation":105,"user_id":5133578,"accept_rate":0,"display_name":"STEPHEN YAO"},"comment_count":5,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":17073,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":3,"score":0,"last_activity_date":1701122565,"creation_date":1437548276,"question_id":31555980,"body_markdown":" I have a `JTable` filled with data about `students (student id, name...)`, and when I select a row from a table, the form opens and its field need to be filled with same values (eg. if Johny Bravo was selected from the table.\r\n\r\nThen his name should be shown in text filed Name on the form, I did like this `txtfieldName.setText(student.getName)`.\r\n\r\nMy question is how do I set my `Radio button` automatically (my radio button is Male or Female) when I clicked the field.\r\n\r\n    enter code here\r\n\r\n    tableGuest.addMouseListener(new MouseAdapter() {\r\n\tpublic void mouseClicked(MouseEvent e) {\r\n\t\ttry{\r\n\t\t\tint row = tableGuest.getSelectedRow();\r\n\t\t\tString guestEdit=(tableGuest.getModel().getValueAt(row,     0).toString());\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\tString query = &quot;Select guest_id,guest_fname,guest_lname,guest_contact,guest_age,guest_gender,guest_address,guest_email from guest_tbl where guest_id= &#39;&quot;+guestEdit+&quot;&#39;&quot;;\r\n\t\t\t\r\n\t\tPreparedStatement pst = con.prepareStatement(query);\r\n\t\tResultSet rs = pst.executeQuery();\r\n\t\t\t\t\t\r\n\t\tbuttonGroupEdit.add(rdbtnMaleEdit);\r\n\t\tbuttonGroupEdit.add(rdbtnFemaleEdit);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\twhile(rs.next())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tString genderEdit=rs.getString(&quot;guest_gender&quot;);\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(genderEdit.equals(&quot;Male&quot;))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t rdbtnMaleEdit.setSelected(true); \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(genderEdit.equals(&quot;Female&quot;))\r\n                        {\r\n                             rdbtnFemaleEdit.setSelected(true);\r\n                        }\r\n                        else\r\n                        {\r\n                        JOptionPane.showMessageDialog(null, &quot;error !&quot;);\r\n                        }\r\n\r\n\r\n\t\t\t\t\t\ttfEditFname.setText(rs.getString(&quot;guest_fname&quot;));\r\n\t\t\t\t\t\ttfEditLname.setText(rs.getString(&quot;guest_lname&quot;));\r\n\t\t\t\t\t\ttfEditEmail.setText(rs.getString(&quot;guest_email&quot;));\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\ttfEditContact.setText(rs.getString(&quot;guest_contact&quot;))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpst.close();\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t}catch(Exception ex){\r\n\t\t\t\t\tex.printStackTrace();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t});\r\n","title":"How to set the Radio Button based on the value fetched from the database","body":"<p>I have a <code>JTable</code> filled with data about <code>students (student id, name...)</code>, and when I select a row from a table, the form opens and its field need to be filled with same values (eg. if Johny Bravo was selected from the table.</p>\n\n<p>Then his name should be shown in text filed Name on the form, I did like this <code>txtfieldName.setText(student.getName)</code>.</p>\n\n<p>My question is how do I set my <code>Radio button</code> automatically (my radio button is Male or Female) when I clicked the field.</p>\n\n<pre><code>enter code here\n\ntableGuest.addMouseListener(new MouseAdapter() {\npublic void mouseClicked(MouseEvent e) {\n    try{\n        int row = tableGuest.getSelectedRow();\n        String guestEdit=(tableGuest.getModel().getValueAt(row,     0).toString());\n\n\n        String query = \"Select guest_id,guest_fname,guest_lname,guest_contact,guest_age,guest_gender,guest_address,guest_email from guest_tbl where guest_id= '\"+guestEdit+\"'\";\n\n    PreparedStatement pst = con.prepareStatement(query);\n    ResultSet rs = pst.executeQuery();\n\n    buttonGroupEdit.add(rdbtnMaleEdit);\n    buttonGroupEdit.add(rdbtnFemaleEdit);\n\n\n                while(rs.next())\n                {\n                    String genderEdit=rs.getString(\"guest_gender\"); \n\n                    if(genderEdit.equals(\"Male\"))\n                    {\n                         rdbtnMaleEdit.setSelected(true); \n                    }\n                    else if(genderEdit.equals(\"Female\"))\n                    {\n                         rdbtnFemaleEdit.setSelected(true);\n                    }\n                    else\n                    {\n                    JOptionPane.showMessageDialog(null, \"error !\");\n                    }\n\n\n                    tfEditFname.setText(rs.getString(\"guest_fname\"));\n                    tfEditLname.setText(rs.getString(\"guest_lname\"));\n                    tfEditEmail.setText(rs.getString(\"guest_email\"));\n\n                    tfEditContact.setText(rs.getString(\"guest_contact\"))\n                }\n                pst.close();\n\n\n            }catch(Exception ex){\n                ex.printStackTrace();\n            }\n\n        }\n    });\n</code></pre>\n"},{"tags":["java","android","kotlin","rx-java","rx-java2"],"comments":[{"owner":{"account_id":1353955,"reputation":2623,"user_id":1292745,"display_name":"gpunto"},"score":0,"creation_date":1701123094,"post_id":77559889,"comment_id":136733955,"body_markdown":"You can have a `PublishSubject&lt;Unit&gt;` that just signals that you need to fetch data. Then you `concatMap` or `switchMap` it by `remoteDataSource.fetchLatestData()`. You then take the resulting observable and `combineLatest` with `localDataSource`. So `combineLatest(local, subject.concatMap { remote.fetch }) { …`","body":"You can have a <code>PublishSubject&lt;Unit&gt;</code> that just signals that you need to fetch data. Then you <code>concatMap</code> or <code>switchMap</code> it by <code>remoteDataSource.fetchLatestData()</code>. You then take the resulting observable and <code>combineLatest</code> with <code>localDataSource</code>. So <code>combineLatest(local, subject.concatMap { remote.fetch }) { …</code>"}],"answers":[{"tags":[],"owner":{"account_id":16796825,"reputation":1274,"user_id":12143126,"display_name":"Mikhail Guliaev"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1701122531,"creation_date":1701120169,"answer_id":77560010,"question_id":77559889,"body_markdown":"I&#39;ve managed to fix my problem by changing a way to subscribe to the `Observable`, which fetches data from the API. Now I created a new subscriber, end emit data to the `BehaviorSubject` manually. I&#39;m not satisfied with the solution, but nothing better came to my mind:\r\n\r\n    private fun fetchLatestData() {\r\n        disposables += remoteDataSource.fetchLatestData()\r\n            .subscribeOn(Schedulers.io())\r\n            .subscribe({\r\n                remoteDataObservable.onNext(it)\r\n            }, {})\r\n    }\r\n    ","title":"Combine 2 data sources in RxJava with possibility to fetch new data from 1 of the observables","body":"<p>I've managed to fix my problem by changing a way to subscribe to the <code>Observable</code>, which fetches data from the API. Now I created a new subscriber, end emit data to the <code>BehaviorSubject</code> manually. I'm not satisfied with the solution, but nothing better came to my mind:</p>\n<pre><code>private fun fetchLatestData() {\n    disposables += remoteDataSource.fetchLatestData()\n        .subscribeOn(Schedulers.io())\n        .subscribe({\n            remoteDataObservable.onNext(it)\n        }, {})\n}\n</code></pre>\n"},{"comments":[{"owner":{"account_id":16796825,"reputation":1274,"user_id":12143126,"display_name":"Mikhail Guliaev"},"score":0,"creation_date":1701121146,"post_id":77560069,"comment_id":136733679,"body_markdown":"Thanks for the answer! Indeed, it would work, it&#39;s something similar that I wrote above. Here I see a problem, that if your DataSource have multiple subscribers, which are observing data and call fetchLatestData, it would be a mess, and we&#39;ll get an inconsistent state.","body":"Thanks for the answer! Indeed, it would work, it&#39;s something similar that I wrote above. Here I see a problem, that if your DataSource have multiple subscribers, which are observing data and call fetchLatestData, it would be a mess, and we&#39;ll get an inconsistent state."},{"owner":{"account_id":27825993,"reputation":51,"user_id":21245418,"display_name":"rarespalasan"},"score":0,"creation_date":1701121344,"post_id":77560069,"comment_id":136733705,"body_markdown":"With your approach, you would need to always dispose the previous subscription, or else, whenever you&#39;ll call fetchLatestData, you would subscribe again to a new Observable and have leaks","body":"With your approach, you would need to always dispose the previous subscription, or else, whenever you&#39;ll call fetchLatestData, you would subscribe again to a new Observable and have leaks"},{"owner":{"account_id":16796825,"reputation":1274,"user_id":12143126,"display_name":"Mikhail Guliaev"},"score":0,"creation_date":1701122521,"post_id":77560069,"comment_id":136733858,"body_markdown":"Sure, thanks for noticing! I just didn&#39;t add it to my answer. Have done it now","body":"Sure, thanks for noticing! I just didn&#39;t add it to my answer. Have done it now"}],"tags":[],"owner":{"account_id":27825993,"reputation":51,"user_id":21245418,"display_name":"rarespalasan"},"comment_count":3,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1701120833,"creation_date":1701120833,"answer_id":77560069,"question_id":77559889,"body_markdown":"The problem I see is that your `fetchLatestData` method returns an `Observable`. I would suggest having something like this:\r\n```kotlin\r\n@HiltViewModel\r\nclass MyViewModel @Inject constructor(\r\n    private val remoteDataSource: RemoteDataSource,\r\n    private val localDataSource: LocalDataSource,\r\n) {\r\n\r\n    init {\r\n        disposables += Observable.combineLatest(\r\n            localDataSource.getData(),\r\n            remoteDataSource.data,\r\n            { local, remote -&gt;\r\n                local.plus(remote)\r\n            }\r\n        )\r\n            .subscribeOn(Schedulers.io())\r\n            .observeOn(AndroidSchedulers.mainThread())\r\n            .subscribe {\r\n                displayList(it)\r\n            }\r\n        fetchLatestData()\r\n    }\r\n\r\n    fun onPullToRefresh() {\r\n        fetchLatestData()\r\n    }\r\n    \r\n    private fun fetchLatestData() {\r\n        remoteDataSource.fetchLatestData()\r\n    }\r\n```\r\n\r\nYour `RemoteDataSource` class would look something like this:\r\n\r\n```kotlin\r\nclass RemoteDataSource {\r\n\r\n    val data: BehaviorSubject&lt;List&lt;Data&gt;&gt;\r\n\r\n    fun fetchLatestData() {\r\n        // request the data from remote\r\n        data.onNext(newFetchedData)\r\n    }\r\n}\r\n```","title":"Combine 2 data sources in RxJava with possibility to fetch new data from 1 of the observables","body":"<p>The problem I see is that your <code>fetchLatestData</code> method returns an <code>Observable</code>. I would suggest having something like this:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>@HiltViewModel\nclass MyViewModel @Inject constructor(\n    private val remoteDataSource: RemoteDataSource,\n    private val localDataSource: LocalDataSource,\n) {\n\n    init {\n        disposables += Observable.combineLatest(\n            localDataSource.getData(),\n            remoteDataSource.data,\n            { local, remote -&gt;\n                local.plus(remote)\n            }\n        )\n            .subscribeOn(Schedulers.io())\n            .observeOn(AndroidSchedulers.mainThread())\n            .subscribe {\n                displayList(it)\n            }\n        fetchLatestData()\n    }\n\n    fun onPullToRefresh() {\n        fetchLatestData()\n    }\n    \n    private fun fetchLatestData() {\n        remoteDataSource.fetchLatestData()\n    }\n</code></pre>\n<p>Your <code>RemoteDataSource</code> class would look something like this:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>class RemoteDataSource {\n\n    val data: BehaviorSubject&lt;List&lt;Data&gt;&gt;\n\n    fun fetchLatestData() {\n        // request the data from remote\n        data.onNext(newFetchedData)\n    }\n}\n</code></pre>\n"}],"owner":{"account_id":16796825,"reputation":1274,"user_id":12143126,"display_name":"Mikhail Guliaev"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":41,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"accepted_answer_id":77560010,"answer_count":2,"score":1,"last_activity_date":1701122531,"creation_date":1701118574,"question_id":77559889,"body_markdown":"I&#39;m currently working on an Android app where I&#39;m using RxJava in a ViewModel to handle data from both a local Room database and a remote API (Retrofit). I have implemented a pull-to-refresh feature, and in the `onRefresh` method, I&#39;m currently creating a new observable to fetch data from the remote API.\r\n\r\nThe problem is I want the combined observable to be triggered when user does pull-to-refresh, but it&#39;s not triggered. \r\n\r\nWhat may be the issue?\r\n\r\n    @HiltViewModel\r\n    class MyViewModel @Inject constructor(\r\n        private val remoteDataSource: RemoteDataSource,\r\n        private val localDataSource: LocalDataSource,\r\n    ) {\r\n    \r\n        private val remoteDataObservable = BehaviorSubject.createDefault&lt;List&lt;Data&gt;&gt;(emptyList())\r\n    \r\n        init {\r\n            disposables += Observable.combineLatest(\r\n                localDataSource.getData(),\r\n                remoteDataObservable,\r\n                { local, remote -&gt;\r\n                    local.plus(remote)\r\n                }\r\n            )\r\n                .subscribeOn(Schedulers.io())\r\n                .observeOn(AndroidSchedulers.mainThread())\r\n                .subscribe {\r\n                    displayList(it)\r\n                }\r\n            fetchLatestData()\r\n        }\r\n    \r\n        fun onPullToRefresh() {\r\n            fetchLatestData()\r\n        }\r\n        \r\n        private fun fetchLatestData() {\r\n            remoteDataSource.fetchLatestData()\r\n                .subscribeOn(Schedulers.io())\r\n                .subscribe(remoteDataObservable)\r\n        }\r\n    \r\n        private fun displayList(list: List&lt;Data&gt;) {\r\n            // Display list\r\n        }\r\n    \r\n    }","title":"Combine 2 data sources in RxJava with possibility to fetch new data from 1 of the observables","body":"<p>I'm currently working on an Android app where I'm using RxJava in a ViewModel to handle data from both a local Room database and a remote API (Retrofit). I have implemented a pull-to-refresh feature, and in the <code>onRefresh</code> method, I'm currently creating a new observable to fetch data from the remote API.</p>\n<p>The problem is I want the combined observable to be triggered when user does pull-to-refresh, but it's not triggered.</p>\n<p>What may be the issue?</p>\n<pre><code>@HiltViewModel\nclass MyViewModel @Inject constructor(\n    private val remoteDataSource: RemoteDataSource,\n    private val localDataSource: LocalDataSource,\n) {\n\n    private val remoteDataObservable = BehaviorSubject.createDefault&lt;List&lt;Data&gt;&gt;(emptyList())\n\n    init {\n        disposables += Observable.combineLatest(\n            localDataSource.getData(),\n            remoteDataObservable,\n            { local, remote -&gt;\n                local.plus(remote)\n            }\n        )\n            .subscribeOn(Schedulers.io())\n            .observeOn(AndroidSchedulers.mainThread())\n            .subscribe {\n                displayList(it)\n            }\n        fetchLatestData()\n    }\n\n    fun onPullToRefresh() {\n        fetchLatestData()\n    }\n    \n    private fun fetchLatestData() {\n        remoteDataSource.fetchLatestData()\n            .subscribeOn(Schedulers.io())\n            .subscribe(remoteDataObservable)\n    }\n\n    private fun displayList(list: List&lt;Data&gt;) {\n        // Display list\n    }\n\n}\n</code></pre>\n"},{"tags":["java","gradle","push-notification","pem","web-push"],"answers":[{"comments":[{"owner":{"account_id":155430,"reputation":11446,"user_id":372076,"display_name":"Pedro Loureiro"},"score":5,"creation_date":1616960928,"post_id":52479032,"comment_id":118160114,"body_markdown":"`-x signArchives` means don&#39;t execute the signing. While this solves the error, it doesn&#39;t achieve what the OP asked (how do I configure a signatory).","body":"<code>-x signArchives</code> means don&#39;t execute the signing. While this solves the error, it doesn&#39;t achieve what the OP asked (how do I configure a signatory)."}],"tags":[],"owner":{"account_id":9951181,"reputation":710,"user_id":7363751,"accept_rate":71,"display_name":"Harish Karthick"},"comment_count":1,"down_vote_count":14,"up_vote_count":10,"is_accepted":false,"score":-4,"last_activity_date":1616668673,"creation_date":1537790690,"answer_id":52479032,"question_id":49273023,"body_markdown":"Found solution here https://github.com/jaegertracing/jaeger-client-java/issues/202 \r\nUse the below command.\r\n&gt; ./gradlew assemble -x signArchives\r\n\r\n","title":"Gradle build configured signatory","body":"<p>Found solution here <a href=\"https://github.com/jaegertracing/jaeger-client-java/issues/202\" rel=\"nofollow noreferrer\">https://github.com/jaegertracing/jaeger-client-java/issues/202</a>\nUse the below command.</p>\n<blockquote>\n<p>./gradlew assemble -x signArchives</p>\n</blockquote>\n"},{"tags":[],"owner":{"account_id":146433,"reputation":50504,"user_id":356895,"accept_rate":66,"display_name":"JJD"},"comment_count":0,"down_vote_count":1,"up_vote_count":13,"is_accepted":false,"score":12,"last_activity_date":1632044649,"creation_date":1618518882,"answer_id":67115705,"question_id":49273023,"body_markdown":"Quoting the [Signing plugin documentation][1] you should be able to resolve the error when you provide the expected GPG variables in the *gradle.properties* file in your *HOME* directory:\r\n\r\n&lt;!-- language-all: lang-groovy --&gt;\r\n\r\n    # File location: ~/.gradle/gradle.properties - see https://docs.gradle.org/current/userguide/directory_layout.html\r\n    signing.keyId=24875D73\r\n    signing.password=secret\r\n    signing.secretKeyRingFile=/Users/me/.gnupg/secring.gpg\r\n\r\nGradle resp. the Signing plugin will automatically pick them up in the build process.\r\n\r\n\r\n  [1]: https://docs.gradle.org/current/userguide/signing_plugin.html#sec:signatory_credentials","title":"Gradle build configured signatory","body":"<p>Quoting the <a href=\"https://docs.gradle.org/current/userguide/signing_plugin.html#sec:signatory_credentials\" rel=\"noreferrer\">Signing plugin documentation</a> you should be able to resolve the error when you provide the expected GPG variables in the <em>gradle.properties</em> file in your <em>HOME</em> directory:</p>\n\n<pre class=\"lang-groovy prettyprint-override\"><code># File location: ~/.gradle/gradle.properties - see https://docs.gradle.org/current/userguide/directory_layout.html\nsigning.keyId=24875D73\nsigning.password=secret\nsigning.secretKeyRingFile=/Users/me/.gnupg/secring.gpg\n</code></pre>\n<p>Gradle resp. the Signing plugin will automatically pick them up in the build process.</p>\n"},{"tags":[],"owner":{"account_id":7300157,"reputation":3873,"user_id":7937498,"display_name":"Itoun"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1627081806,"creation_date":1627081806,"answer_id":68505785,"question_id":49273023,"body_markdown":"I got the same problem and it was because of several things:  \r\n**I didn&#39;t distribute the gpg key to any server;  \r\nI was using inMemory to sign and I shouldn&#39;t**\r\n\r\nthe link of the complete answer with build.gradle file and gradle.properties file: https://stackoverflow.com/a/68505768/7937498","title":"Gradle build configured signatory","body":"<p>I got the same problem and it was because of several things:<br />\n<strong>I didn't distribute the gpg key to any server;<br />\nI was using inMemory to sign and I shouldn't</strong></p>\n<p>the link of the complete answer with build.gradle file and gradle.properties file: <a href=\"https://stackoverflow.com/a/68505768/7937498\">https://stackoverflow.com/a/68505768/7937498</a></p>\n"},{"tags":[],"owner":{"account_id":179293,"reputation":15713,"user_id":411846,"accept_rate":80,"display_name":"centic"},"comment_count":0,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1701121816,"creation_date":1638351373,"answer_id":70181905,"question_id":49273023,"body_markdown":"Another option that does not require a special command-line option is to add the following in your `build.gradle.kts`:\r\n\r\n    signing {\r\n        setRequired {\r\n            // signing is only required if the artifacts are to be published\r\n            gradle.taskGraph.allTasks.any { it.equals( PublishToMavenRepository) }\r\n        }\r\n        ....\r\n\r\nSee e.g. https://github.com/Vampire/command-framework/blob/master/buildSrc/src/main/kotlin/net/kautler/publishing.gradle.kts#L157\r\n\r\nOr Groovy (`build.gradle`):\r\n\r\n    signing {\r\n        required {\r\n            // signing is only required if the artifacts are to be published\r\n            gradle.taskGraph.hasTask(&quot;publishToMavenRepository&quot;)\r\n        }\r\n        ....\r\n","title":"Gradle build configured signatory","body":"<p>Another option that does not require a special command-line option is to add the following in your <code>build.gradle.kts</code>:</p>\n<pre><code>signing {\n    setRequired {\n        // signing is only required if the artifacts are to be published\n        gradle.taskGraph.allTasks.any { it.equals( PublishToMavenRepository) }\n    }\n    ....\n</code></pre>\n<p>See e.g. <a href=\"https://github.com/Vampire/command-framework/blob/master/buildSrc/src/main/kotlin/net/kautler/publishing.gradle.kts#L157\" rel=\"nofollow noreferrer\">https://github.com/Vampire/command-framework/blob/master/buildSrc/src/main/kotlin/net/kautler/publishing.gradle.kts#L157</a></p>\n<p>Or Groovy (<code>build.gradle</code>):</p>\n<pre><code>signing {\n    required {\n        // signing is only required if the artifacts are to be published\n        gradle.taskGraph.hasTask(&quot;publishToMavenRepository&quot;)\n    }\n    ....\n</code></pre>\n"}],"owner":{"account_id":3336633,"reputation":383,"user_id":2804023,"accept_rate":75,"display_name":"Daniel Freeman"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":9941,"favorite_count":0,"down_vote_count":0,"up_vote_count":17,"answer_count":4,"score":17,"last_activity_date":1701121816,"creation_date":1521016749,"question_id":49273023,"body_markdown":"I&#39;m looking at the [webpush-java][1] code.  I run into a problem attempting to build the project using gradle.  (I&#39;m a gradle newbie).\r\n\r\n&gt;    :signArchives FAILED\r\n&gt; \r\n&gt;    FAILURE: Build failed with an exception.\r\n&gt; \r\n&gt;    * What went wrong:    Execution failed for task &#39;:signArchives&#39;.   \r\n&gt; Cannot perform signing task &#39;:signArchives&#39; because it has no\r\n&gt; configured signatory\r\n\r\nI guess that I need to configure a signatory.  How do I do that?\r\n\r\n\r\n  [1]: https://github.com/web-push-libs/webpush-java","title":"Gradle build configured signatory","body":"<p>I'm looking at the <a href=\"https://github.com/web-push-libs/webpush-java\" rel=\"noreferrer\">webpush-java</a> code.  I run into a problem attempting to build the project using gradle.  (I'm a gradle newbie).</p>\n\n<blockquote>\n  <p>:signArchives FAILED</p>\n  \n  <p>FAILURE: Build failed with an exception.</p>\n  \n  <ul>\n  <li>What went wrong:    Execution failed for task ':signArchives'.<br>\n  Cannot perform signing task ':signArchives' because it has no\n  configured signatory</li>\n  </ul>\n</blockquote>\n\n<p>I guess that I need to configure a signatory.  How do I do that?</p>\n"},{"tags":["java","servlets","connection","timeout"],"owner":{"account_id":52561,"reputation":1633,"user_id":157080,"accept_rate":71,"display_name":"John"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":31,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"answer_count":0,"score":-1,"last_activity_date":1701121745,"creation_date":1701108847,"question_id":77559086,"body_markdown":"I&#39;m having a problem with a Java servlet that that fetches 3rd-party web content.\r\n\r\nMy website gathers weather data from 3rd-party web servers.\r\nFor 3rd-party web servers that support CORS, I just fetch the data directly in the browser client using javascript.\r\nFor 3rd-party web servers that *don&#39;t* support CORS, I use a workaround: first I talk to my own servlet, which fetches the 3rd-party data and stores it in a temp file, and then I serve the temp file.\r\n\r\nRecently, I&#39;ve started to experience failures with URLs that don&#39;t support CORS, and thus are fetched using my servlet:\r\n\r\nExample URLs that fail in prod:\r\n- https://weather.gc.ca/rss/city/pe-5_e.xml\r\n- https://dd.weather.gc.ca/radar/PRECIPET/GIF/CASGO/\r\n\r\nThe stack trace occurs in my servlet code here:\r\n\r\nhttps://github.com/johanley/astro/blob/master/WEB-INF/classes/astro/WebPageFetcher.java#L116\r\n\r\n**In prod only**, the connection times out. Example from the log:\r\n\r\n27-Nov-2023 00:32:00.295 SEVERE [ajp-nio-127.0.0.1-33027-exec-4] astro.WebPageFetcher.webFetch2 Cannot open connection to https://dd.weather.gc.ca/radar/PRECIPET/GIF/CASGO/ \r\n\r\nNote that \r\n- **prod fails, but running locally does not**\r\n- there have been no recent changes in my servlet code\r\n- prod: Tomcat 9.0.82, using JDK 13.0.2\r\n- local: Tomcat 9.0.41, using JDK 13.33 \r\n\r\n\r\nWhat could cause this servlet code to fail in prod, but succeed when run locally?\r\n\r\n  [1]: http://astronomytonight.net\r\n  [2]: https://github.com/johanley/astro/blob/master/WEB-INF/classes/astro/WebPageFetcher.java#L78","title":"Java servlet fails to fetch data from 3rd party web servers","body":"<p>I'm having a problem with a Java servlet that that fetches 3rd-party web content.</p>\n<p>My website gathers weather data from 3rd-party web servers.\nFor 3rd-party web servers that support CORS, I just fetch the data directly in the browser client using javascript.\nFor 3rd-party web servers that <em>don't</em> support CORS, I use a workaround: first I talk to my own servlet, which fetches the 3rd-party data and stores it in a temp file, and then I serve the temp file.</p>\n<p>Recently, I've started to experience failures with URLs that don't support CORS, and thus are fetched using my servlet:</p>\n<p>Example URLs that fail in prod:</p>\n<ul>\n<li><a href=\"https://weather.gc.ca/rss/city/pe-5_e.xml\" rel=\"nofollow noreferrer\">https://weather.gc.ca/rss/city/pe-5_e.xml</a></li>\n<li><a href=\"https://dd.weather.gc.ca/radar/PRECIPET/GIF/CASGO/\" rel=\"nofollow noreferrer\">https://dd.weather.gc.ca/radar/PRECIPET/GIF/CASGO/</a></li>\n</ul>\n<p>The stack trace occurs in my servlet code here:</p>\n<p><a href=\"https://github.com/johanley/astro/blob/master/WEB-INF/classes/astro/WebPageFetcher.java#L116\" rel=\"nofollow noreferrer\">https://github.com/johanley/astro/blob/master/WEB-INF/classes/astro/WebPageFetcher.java#L116</a></p>\n<p><strong>In prod only</strong>, the connection times out. Example from the log:</p>\n<p>27-Nov-2023 00:32:00.295 SEVERE [ajp-nio-127.0.0.1-33027-exec-4] astro.WebPageFetcher.webFetch2 Cannot open connection to <a href=\"https://dd.weather.gc.ca/radar/PRECIPET/GIF/CASGO/\" rel=\"nofollow noreferrer\">https://dd.weather.gc.ca/radar/PRECIPET/GIF/CASGO/</a></p>\n<p>Note that</p>\n<ul>\n<li><strong>prod fails, but running locally does not</strong></li>\n<li>there have been no recent changes in my servlet code</li>\n<li>prod: Tomcat 9.0.82, using JDK 13.0.2</li>\n<li>local: Tomcat 9.0.41, using JDK 13.33</li>\n</ul>\n<p>What could cause this servlet code to fail in prod, but succeed when run locally?</p>\n"},{"tags":["java","android","json","kotlin","gson"],"answers":[{"comments":[{"owner":{"account_id":26618117,"reputation":5,"user_id":20237223,"display_name":"Paulo Coutinho"},"score":0,"creation_date":1667698094,"post_id":74331785,"comment_id":131228376,"body_markdown":"Nice. It can be reified because JsonSerializer inherit from an interface, and interface cant have reified. How i can pass TypeToken as parameter, since JsonFunctionReturnValueData is a class available only for JsonSerializer. Basically, how to make JsonFunctionReturnValueData works with generic and Type?","body":"Nice. It can be reified because JsonSerializer inherit from an interface, and interface cant have reified. How i can pass TypeToken as parameter, since JsonFunctionReturnValueData is a class available only for JsonSerializer. Basically, how to make JsonFunctionReturnValueData works with generic and Type?"},{"owner":{"account_id":5384013,"reputation":6035,"user_id":4288506,"accept_rate":77,"display_name":"Marcono1234"},"score":0,"creation_date":1667950543,"post_id":74331785,"comment_id":131289648,"body_markdown":"@PauloCoutinho, if `JsonFunctionReturnValueData` is only available in that file you could create the type using [`TypeToken.getParameterized`](https://javadoc.io/doc/com.google.code.gson/gson/latest/com.google.gson/com/google/gson/reflect/TypeToken.html#getParameterized(java.lang.reflect.Type,java.lang.reflect.Type...)), for example: `TypeToken.getParameterized(JsonFunctionReturnValueData::class.java, ...)` But you still need to pass its type argument to that call somehow, for example as `TypeToken` and then call `TypeToken.getType()` and pass that as argument to `getParameterized`.","body":"@PauloCoutinho, if <code>JsonFunctionReturnValueData</code> is only available in that file you could create the type using <a href=\"https://javadoc.io/doc/com.google.code.gson/gson/latest/com.google.gson/com/google/gson/reflect/TypeToken.html#getParameterized(java.lang.reflect.Type,java.lang.reflect.Type...)\" rel=\"nofollow noreferrer\"><code>TypeToken.getParameterized</code></a>, for example: <code>TypeToken.getParameterized(JsonFunctionReturnValueData::clas&zwnj;&#8203;s.java, ...)</code> But you still need to pass its type argument to that call somehow, for example as <code>TypeToken</code> and then call <code>TypeToken.getType()</code> and pass that as argument to <code>getParameterized</code>."},{"owner":{"account_id":26618117,"reputation":5,"user_id":20237223,"display_name":"Paulo Coutinho"},"score":0,"creation_date":1668049212,"post_id":74331785,"comment_id":131315092,"body_markdown":"Thanks. It works. Can you check if it is correct or can be problematic in future? Only a review: https://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/client/RemoteClient.kt#L17-L18 and https://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/serializer/JsonSerializer.kt#L58-L70","body":"Thanks. It works. Can you check if it is correct or can be problematic in future? Only a review: <a href=\"https://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/client/RemoteClient.kt#L17-L18\" rel=\"nofollow noreferrer\">github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main&zwnj;&#8203;/&hellip;</a> and <a href=\"https://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/serializer/JsonSerializer.kt#L58-L70\" rel=\"nofollow noreferrer\">github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main&zwnj;&#8203;/&hellip;</a>"},{"owner":{"account_id":5384013,"reputation":6035,"user_id":4288506,"accept_rate":77,"display_name":"Marcono1234"},"score":0,"creation_date":1668113147,"post_id":74331785,"comment_id":131334060,"body_markdown":"@PauloCoutinho, I only had a short look at it, but to me that looks good.","body":"@PauloCoutinho, I only had a short look at it, but to me that looks good."}],"tags":[],"owner":{"account_id":5384013,"reputation":6035,"user_id":4288506,"accept_rate":77,"display_name":"Marcono1234"},"comment_count":4,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1701121014,"creation_date":1667685668,"answer_id":74331785,"question_id":74321188,"body_markdown":"The problem is that for your `decodeFunctionReturnValue` function the type parameter `T` is not `reified`. Therefore at runtime the `TypeToken` you are creating is actually &lt;code&gt;TypeToken&amp;lt;JsonFunctionReturnValueData&amp;lt;**Object**&amp;gt;&amp;gt;&lt;/code&gt;. When deserializing `Object`, Gson creates based on the JSON data standard objects, for a JSON object that is a Java `Map` (and Gson&#39;s internal implementation is `LinkedTreeMap`).\r\n\r\nSo if possible the solution would be to make the type parameter `T` here `reified` as well. If that is not possible, maybe the type can be passed as separate `TypeToken` parameter to the function.\r\n\r\n---\r\n\r\nFuture Gson versions (&gt; 2.10.1) will throw an exception when a `TypeToken` captures a type variable and will therefore allow you to indentify such issues earlier. The [Troubleshooting Guide](https://github.com/google/gson/blob/main/Troubleshooting.md#typetoken-type-variable) contains additional information and workarounds.","title":"Convert to custom class using GSON and Generics with Kotlin in XPLPC project","body":"<p>The problem is that for your <code>decodeFunctionReturnValue</code> function the type parameter <code>T</code> is not <code>reified</code>. Therefore at runtime the <code>TypeToken</code> you are creating is actually <code>TypeToken&lt;JsonFunctionReturnValueData&lt;<strong>Object</strong>&gt;&gt;</code>. When deserializing <code>Object</code>, Gson creates based on the JSON data standard objects, for a JSON object that is a Java <code>Map</code> (and Gson's internal implementation is <code>LinkedTreeMap</code>).</p>\n<p>So if possible the solution would be to make the type parameter <code>T</code> here <code>reified</code> as well. If that is not possible, maybe the type can be passed as separate <code>TypeToken</code> parameter to the function.</p>\n<hr />\n<p>Future Gson versions (&gt; 2.10.1) will throw an exception when a <code>TypeToken</code> captures a type variable and will therefore allow you to indentify such issues earlier. The <a href=\"https://github.com/google/gson/blob/main/Troubleshooting.md#typetoken-type-variable\" rel=\"nofollow noreferrer\">Troubleshooting Guide</a> contains additional information and workarounds.</p>\n"}],"owner":{"account_id":26618117,"reputation":5,"user_id":20237223,"display_name":"Paulo Coutinho"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":313,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":74331785,"answer_count":1,"score":0,"last_activity_date":1701121014,"creation_date":1667584522,"question_id":74321188,"body_markdown":"I have a problem that appear be simple, but im making something wrong.\r\n\r\nHow i can convert from a generic class with reified using GSON and Kotlin in my project called XPLPC?\r\n\r\nThe error is here:\r\nhttps://github.com/xplpc/xplpc/actions/runs/3395808126/jobs/5646151499#step:9:503\r\n\r\n```\r\ncom.xplpc.library.TodoTest &gt; singleItem[test(AVD) - 12] FAILED \r\n\tjava.lang.ClassCastException: com.google.gson.internal.LinkedTreeMap cannot be cast to com.xplpc.library.TodoTest$Todo\r\n\tat com.xplpc.library.TodoTest.singleItem(TodoTest.kt:44)\r\n```\r\n\r\nIt don&#39;t understand that i want convert to Todo class instead of LinkedTreeMap.\r\n\r\nThe code is here:\r\nhttps://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/serializer/JsonSerializer.kt#L66-L79\r\n\r\nAnd the code is called by this function:\r\nhttps://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/client/RemoteClient.kt#L14-L27\r\n\r\nBasically the code is:\r\n\r\n```\r\n// Part 1\r\nobject RemoteClient {\r\n    inline fun &lt;reified T&gt; call(request: Request, defValue: T? = null): T? {\r\n        try {\r\n            val data = PlatformProxy.call(request.data)\r\n            println(data)\r\n            return XPLPC.config.serializer.decodeFunctionReturnValue&lt;T&gt;(data)\r\n        } catch (e: Exception) {\r\n            Log.e(\r\n                Constants.LOG_GROUP,\r\n                &quot;[RemoteClient : call] Error when try to decode return value: ${e.message}&quot;\r\n            )\r\n        }\r\n\r\n        return defValue\r\n    }\r\n\r\n    inline fun &lt;reified T&gt; callAsync(request: Request, defValue: T? = null): Deferred&lt;T?&gt; {\r\n        return CoroutineScope(Dispatchers.IO).async {\r\n            return@async call&lt;T&gt;(request, defValue)\r\n        }\r\n    }\r\n}\r\n\r\n// Part 2\r\noverride fun &lt;T&gt; decodeFunctionReturnValue(data: String): T? {\r\n    try {\r\n        val type = object : TypeToken&lt;JsonFunctionReturnValueData&lt;T&gt;&gt;() {}.type\r\n        val gson = createGson()\r\n        return gson.fromJson&lt;JsonFunctionReturnValueData&lt;T&gt;&gt;(data, type).r\r\n    } catch (e: Exception) {\r\n        Log.e(\r\n            Constants.LOG_GROUP,\r\n            &quot;[JsonSerializer : decodeFunctionReturnValue] Error when parse json: ${e.message}&quot;\r\n        )\r\n    }\r\n\r\n    return null\r\n}\r\n```","title":"Convert to custom class using GSON and Generics with Kotlin in XPLPC project","body":"<p>I have a problem that appear be simple, but im making something wrong.</p>\n<p>How i can convert from a generic class with reified using GSON and Kotlin in my project called XPLPC?</p>\n<p>The error is here:\n<a href=\"https://github.com/xplpc/xplpc/actions/runs/3395808126/jobs/5646151499#step:9:503\" rel=\"nofollow noreferrer\">https://github.com/xplpc/xplpc/actions/runs/3395808126/jobs/5646151499#step:9:503</a></p>\n<pre><code>com.xplpc.library.TodoTest &gt; singleItem[test(AVD) - 12] FAILED \n    java.lang.ClassCastException: com.google.gson.internal.LinkedTreeMap cannot be cast to com.xplpc.library.TodoTest$Todo\n    at com.xplpc.library.TodoTest.singleItem(TodoTest.kt:44)\n</code></pre>\n<p>It don't understand that i want convert to Todo class instead of LinkedTreeMap.</p>\n<p>The code is here:\n<a href=\"https://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/serializer/JsonSerializer.kt#L66-L79\" rel=\"nofollow noreferrer\">https://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/serializer/JsonSerializer.kt#L66-L79</a></p>\n<p>And the code is called by this function:\n<a href=\"https://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/client/RemoteClient.kt#L14-L27\" rel=\"nofollow noreferrer\">https://github.com/xplpc/xplpc/blob/main/kotlin/lib/library/src/main/java/com/xplpc/client/RemoteClient.kt#L14-L27</a></p>\n<p>Basically the code is:</p>\n<pre><code>// Part 1\nobject RemoteClient {\n    inline fun &lt;reified T&gt; call(request: Request, defValue: T? = null): T? {\n        try {\n            val data = PlatformProxy.call(request.data)\n            println(data)\n            return XPLPC.config.serializer.decodeFunctionReturnValue&lt;T&gt;(data)\n        } catch (e: Exception) {\n            Log.e(\n                Constants.LOG_GROUP,\n                &quot;[RemoteClient : call] Error when try to decode return value: ${e.message}&quot;\n            )\n        }\n\n        return defValue\n    }\n\n    inline fun &lt;reified T&gt; callAsync(request: Request, defValue: T? = null): Deferred&lt;T?&gt; {\n        return CoroutineScope(Dispatchers.IO).async {\n            return@async call&lt;T&gt;(request, defValue)\n        }\n    }\n}\n\n// Part 2\noverride fun &lt;T&gt; decodeFunctionReturnValue(data: String): T? {\n    try {\n        val type = object : TypeToken&lt;JsonFunctionReturnValueData&lt;T&gt;&gt;() {}.type\n        val gson = createGson()\n        return gson.fromJson&lt;JsonFunctionReturnValueData&lt;T&gt;&gt;(data, type).r\n    } catch (e: Exception) {\n        Log.e(\n            Constants.LOG_GROUP,\n            &quot;[JsonSerializer : decodeFunctionReturnValue] Error when parse json: ${e.message}&quot;\n        )\n    }\n\n    return null\n}\n</code></pre>\n"},{"tags":["java","design-patterns","equals-operator"],"comments":[{"owner":{"account_id":13010,"reputation":6750,"user_id":25909,"accept_rate":87,"display_name":"flash"},"score":3,"creation_date":1349937983,"post_id":12833654,"comment_id":17362885,"body_markdown":"Have a look at this: http://www.artima.com/lejava/articles/equality.html","body":"Have a look at this: <a href=\"http://www.artima.com/lejava/articles/equality.html\" rel=\"nofollow noreferrer\">artima.com/lejava/articles/equality.html</a>"},{"owner":{"account_id":294406,"reputation":24602,"user_id":598289,"accept_rate":85,"display_name":"SJuan76"},"score":0,"creation_date":1349938257,"post_id":12833654,"comment_id":17362980,"body_markdown":"I was about to post the same link. Put special attention to #4, because it is often overlooked in other articles.","body":"I was about to post the same link. Put special attention to #4, because it is often overlooked in other articles."}],"answers":[{"tags":[],"owner":{"account_id":351195,"reputation":15829,"user_id":687514,"display_name":"Anders R. Bystrup"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1349938035,"creation_date":1349938035,"answer_id":12833731,"question_id":12833654,"body_markdown":"It is pretty much up to yourself to decide when two object are &quot;the same&quot; in a certain sense... Should they be equal when they contain the same data (perfectly valid usecase) or more strictly when they are the same physical object in memory (also valid) or just the same row in a DB when compared in a clustered environment?\r\n\r\nJust remember to also override `.hashCode()` or you&#39;re in for a world of hurt :-)\r\n\r\n(Also, good article suggestions from @Andreas and @flash.)\r\n\r\nCheers,","title":"Implementation equals() method design pattern","body":"<p>It is pretty much up to yourself to decide when two object are \"the same\" in a certain sense... Should they be equal when they contain the same data (perfectly valid usecase) or more strictly when they are the same physical object in memory (also valid) or just the same row in a DB when compared in a clustered environment?</p>\n\n<p>Just remember to also override <code>.hashCode()</code> or you're in for a world of hurt :-)</p>\n\n<p>(Also, good article suggestions from @Andreas and @flash.)</p>\n\n<p>Cheers,</p>\n"},{"tags":[],"owner":{"account_id":1764995,"reputation":36209,"user_id":1611055,"accept_rate":91,"display_name":"Andreas Fester"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1349938043,"creation_date":1349938043,"answer_id":12833734,"question_id":12833654,"body_markdown":"Maybe this helps: [Implementing equals][1]. Especially be aware of the close relationship betweeen hashcode() and equals(). Other than that, I suppose the concrete implementation of equals() really depends on your class design, means when do you treat two objects equal.\r\n\r\n  [1]: http://www.javapractices.com/topic/TopicAction.do?Id=17","title":"Implementation equals() method design pattern","body":"<p>Maybe this helps: <a href=\"http://www.javapractices.com/topic/TopicAction.do?Id=17\" rel=\"nofollow\">Implementing equals</a>. Especially be aware of the close relationship betweeen hashcode() and equals(). Other than that, I suppose the concrete implementation of equals() really depends on your class design, means when do you treat two objects equal.</p>\n"},{"tags":[],"owner":{"account_id":1885169,"reputation":34027,"user_id":1704529,"display_name":"Yogendra Singh"},"comment_count":0,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1349938086,"creation_date":1349938086,"answer_id":12833742,"question_id":12833654,"body_markdown":"Not sure about your expectation. `equals()` is meant for defining your criteria of comparing two **different** objects of your class for equality.  \r\n\r\nIn general, you compare each attribute one by one but its very much possible and supported that you do the comparison using fewer selected attributes only. ","title":"Implementation equals() method design pattern","body":"<p>Not sure about your expectation. <code>equals()</code> is meant for defining your criteria of comparing two <strong>different</strong> objects of your class for equality.  </p>\n\n<p>In general, you compare each attribute one by one but its very much possible and supported that you do the comparison using fewer selected attributes only. </p>\n"},{"comments":[{"owner":{"account_id":437352,"reputation":19077,"user_id":824987,"accept_rate":56,"display_name":"Amit Deshpande"},"score":0,"creation_date":1349939087,"post_id":12833749,"comment_id":17363292,"body_markdown":"It would be more helpful for him if you explain more on how to customize equals() and hashcode(), toString() method generation in eclipse.","body":"It would be more helpful for him if you explain more on how to customize equals() and hashcode(), toString() method generation in eclipse."},{"owner":{"account_id":234754,"reputation":5730,"user_id":501113,"accept_rate":90,"display_name":"chaotic3quilibrium"},"score":0,"creation_date":1676402056,"post_id":12833749,"comment_id":133128818,"body_markdown":"While I default to using the code generated by my IDE (Intellij), I immediately refactor the generated `equals()` method to bring it up-to-date with later versions of Java (14+): https://stackoverflow.com/a/75402885/501113","body":"While I default to using the code generated by my IDE (Intellij), I immediately refactor the generated <code>equals()</code> method to bring it up-to-date with later versions of Java (14+): <a href=\"https://stackoverflow.com/a/75402885/501113\">stackoverflow.com/a/75402885/501113</a>"}],"tags":[],"owner":{"account_id":1064228,"reputation":16042,"user_id":1065180,"accept_rate":92,"display_name":"Nandkumar Tekale"},"comment_count":2,"down_vote_count":0,"up_vote_count":4,"is_accepted":true,"score":4,"last_activity_date":1349938135,"creation_date":1349938135,"answer_id":12833749,"question_id":12833654,"body_markdown":"Generally to implement equals() method, what I do is : I generate those from Eclipse as Eclipse can generate hashCode, toString and equals() methods very well.","title":"Implementation equals() method design pattern","body":"<p>Generally to implement equals() method, what I do is : I generate those from Eclipse as Eclipse can generate hashCode, toString and equals() methods very well.</p>\n"},{"comments":[{"owner":{"account_id":143589,"reputation":1483,"user_id":352035,"display_name":"AutomatedMike"},"score":1,"creation_date":1349938883,"post_id":12833849,"comment_id":17363219,"body_markdown":"if obj is null then the instanceof test will fail - so you can trim this down even more :)","body":"if obj is null then the instanceof test will fail - so you can trim this down even more :)"}],"tags":[],"owner":{"account_id":1926913,"reputation":95,"user_id":1737117,"display_name":"dvsander"},"comment_count":1,"down_vote_count":1,"up_vote_count":4,"is_accepted":false,"score":3,"last_activity_date":1349938464,"creation_date":1349938464,"answer_id":12833849,"question_id":12833654,"body_markdown":"I always use following code:\r\n\r\n    if (null == obj) return false;\r\n    if (this == obj) return true;\r\n    if (!(object instanceof MyClass)) return false;\r\n    MyClass that = (MyClass) obj;\r\n    EqualsBuilder eb = new EqualsBuilder();\r\n    eb.append(this.businessKey, that.businessKey);\r\n    return eb.isEquals();\r\n\r\n...\r\n\r\nI never use technical keys like sequences or pk&#39;s, always business fields.\r\nTherefore I don&#39;t believe this can be made generic but must be made specific to any given Class.","title":"Implementation equals() method design pattern","body":"<p>I always use following code:</p>\n\n<pre><code>if (null == obj) return false;\nif (this == obj) return true;\nif (!(object instanceof MyClass)) return false;\nMyClass that = (MyClass) obj;\nEqualsBuilder eb = new EqualsBuilder();\neb.append(this.businessKey, that.businessKey);\nreturn eb.isEquals();\n</code></pre>\n\n<p>...</p>\n\n<p>I never use technical keys like sequences or pk's, always business fields.\nTherefore I don't believe this can be made generic but must be made specific to any given Class.</p>\n"},{"comments":[{"owner":{"account_id":234754,"reputation":5730,"user_id":501113,"accept_rate":90,"display_name":"chaotic3quilibrium"},"score":0,"creation_date":1676402169,"post_id":12833894,"comment_id":133128845,"body_markdown":"There is a well-known contract regarding implementing `equals()` outlined in the book by Joshua Bloch, &quot;Effective Java, Third Edition&quot;. And there are even newer more effective implementations based on Java 14+: https://stackoverflow.com/a/75402885/501113","body":"There is a well-known contract regarding implementing <code>equals()</code> outlined in the book by Joshua Bloch, &quot;Effective Java, Third Edition&quot;. And there are even newer more effective implementations based on Java 14+: <a href=\"https://stackoverflow.com/a/75402885/501113\">stackoverflow.com/a/75402885/501113</a>"}],"tags":[],"owner":{"account_id":1344625,"reputation":3248,"user_id":1285615,"accept_rate":55,"display_name":"sakthisundar"},"comment_count":1,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1349938672,"creation_date":1349938672,"answer_id":12833894,"question_id":12833654,"body_markdown":"Look at what [Java Language Specification][1] got to say.\r\n\r\n&gt;  `equals` method just defines the notion of object equality\r\n\r\nApart from that there is no design pattern involved in designing this method. The truth is that `equals` method is already designed by Java language designers and you can only make use of the design. If you are not confident of how to write your own equals method, consider taking the help of IDE&#39;s like eclipse which does the job for you.\r\n\r\n\r\n  [1]: http://docs.oracle.com/javase/specs/jls/se7/html/jls-4.html#jls-4.3.2","title":"Implementation equals() method design pattern","body":"<p>Look at what <a href=\"http://docs.oracle.com/javase/specs/jls/se7/html/jls-4.html#jls-4.3.2\" rel=\"nofollow\">Java Language Specification</a> got to say.</p>\n\n<blockquote>\n  <p><code>equals</code> method just defines the notion of object equality</p>\n</blockquote>\n\n<p>Apart from that there is no design pattern involved in designing this method. The truth is that <code>equals</code> method is already designed by Java language designers and you can only make use of the design. If you are not confident of how to write your own equals method, consider taking the help of IDE's like eclipse which does the job for you.</p>\n"},{"comments":[{"owner":{"account_id":1322512,"reputation":18477,"user_id":1268003,"accept_rate":82,"display_name":"Martin Andersson"},"score":1,"creation_date":1694677667,"post_id":75402885,"comment_id":135923305,"body_markdown":"The JEP you refer to is using `instanceof` inside the equals method of a **final** class. \n I am assuming your example class is not, and so you add the `getClass()` check. TBH, adding both in the same equals method is almost painful to read. And I don&#39;t personally find that the &quot;double-nested fluent&quot; style easier to read, for this example at least, which is an opinion that could be influenced by all the redundant parenthesis you add.","body":"The JEP you refer to is using <code>instanceof</code> inside the equals method of a <b>final</b> class.   I am assuming your example class is not, and so you add the <code>getClass()</code> check. TBH, adding both in the same equals method is almost painful to read. And I don&#39;t personally find that the &quot;double-nested fluent&quot; style easier to read, for this example at least, which is an opinion that could be influenced by all the redundant parenthesis you add."},{"owner":{"account_id":234754,"reputation":5730,"user_id":501113,"accept_rate":90,"display_name":"chaotic3quilibrium"},"score":0,"creation_date":1694785405,"post_id":75402885,"comment_id":135940800,"body_markdown":"Agreed regarding `final`. And from what I can tell given your JPA/Hibernate answer, I tend to agree with ALL of your thinking in this area. I do get the fluent style is not for everyone. I am coming from Scala, so it reads so much cleaner than the traditional Java stuff I used to do in Java myself (been doing Java since 1996), before I began using Scala as my primary language in 2014. I&#39;ve been back in Java now for a year. Hence, my answer. Old me prior to Scala wouldn&#39;t have liked the fluent functional style.","body":"Agreed regarding <code>final</code>. And from what I can tell given your JPA/Hibernate answer, I tend to agree with ALL of your thinking in this area. I do get the fluent style is not for everyone. I am coming from Scala, so it reads so much cleaner than the traditional Java stuff I used to do in Java myself (been doing Java since 1996), before I began using Scala as my primary language in 2014. I&#39;ve been back in Java now for a year. Hence, my answer. Old me prior to Scala wouldn&#39;t have liked the fluent functional style."},{"owner":{"account_id":1322512,"reputation":18477,"user_id":1268003,"accept_rate":82,"display_name":"Martin Andersson"},"score":1,"creation_date":1695478856,"post_id":75402885,"comment_id":136031342,"body_markdown":"hahahaha yes, isn&#39;t marvelous, how programming is based on so much emotions after all &#128514; And I like it. We all just have to remind ourselves that our opinion today is not what it was yesterday, and it may very well change tomorrow. Over the years, certain elements of my programming style has changed a numerous amount of times, some times back and forth &#128514;","body":"hahahaha yes, isn&#39;t marvelous, how programming is based on so much emotions after all 😂 And I like it. We all just have to remind ourselves that our opinion today is not what it was yesterday, and it may very well change tomorrow. Over the years, certain elements of my programming style has changed a numerous amount of times, some times back and forth 😂"}],"tags":[],"owner":{"account_id":234754,"reputation":5730,"user_id":501113,"accept_rate":90,"display_name":"chaotic3quilibrium"},"comment_count":3,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701121005,"creation_date":1675966946,"answer_id":75402885,"question_id":12833654,"body_markdown":"Regarding adding `equals` and `hashCode` for **JPA/Hibernate entities**, please see this [StackOverflow Answer][1]. \r\n\r\n----------\r\n\r\nThe code pattern recommended below depends upon the new `instanceof` pattern matching functionality released for **preview in Java 14** (2020/Mar/17), and then **fully released in Java 16** (2021/Mar/16).\r\n\r\n----------\r\n\r\nI really dislike seeing explicit uses of `true` and `false`, especially when they fall directly out of evaluated logic.\r\n\r\nSo, I am not at all fond of the default code pattern generated by my IDE (IntelliJ) when overriding and implementing `equals()` in my classes.\r\n\r\nIt looks like this:\r\n```java\r\n//Legacy laden pattern produced by IntelliJ code generator\r\npublic boolean equals(Object o) {\r\n  if (this == o) {\r\n    return true;\r\n  }\r\n  if (o == null || getClass() != o.getClass()) {\r\n    return false;\r\n  }\r\n  EqualsExampleClass that = (EqualsExampleClass) o;\r\n  return Objects.equals(stringy, that.stringy)\r\n      &amp;&amp; (inty == that.inty)\r\n      &amp;&amp; Objects.equals(bigIntegery, that.bigIntegery)\r\n      &amp;&amp; (booleany == that.booleany);\r\n}\r\n```\r\n\r\nEncouraged by [Oracle JEP 394][2] for the `instanceof` pattern matching, I&#39;ve refactored the above code to look like this:\r\n```java\r\n//Modern flowing fluent style\r\n@Override\r\npublic boolean equals(Object o) {\r\n  return (this == o) ||\r\n      ((o instanceof EqualsExampleClass that)\r\n          &amp;&amp; (this.getClass() == that.getClass())\r\n          &amp;&amp; Objects.equals(this.stringy, that.stringy)\r\n          &amp;&amp; (this.inty == that.inty)\r\n          &amp;&amp; Objects.equals(this.bigInt, that.bigInt)\r\n          &amp;&amp; (this.booleany == that.booleany));\r\n}\r\n```\r\nPer line execution details:\r\n\r\n1. `(this == o)` - checks for literally the same instance\r\n2. `(o instanceof EqualsExampleClass that)` - check to make sure `o` is not `null`, `o` is an instance of this class (or an descendant), and if so, assign `o` to the narrowed type variable `that`\r\n3. `(this.getClass() == that.getClass())` - requires the comparison is to the exact same class (and not a descendant), and is optional if, and only if, the class is `final`\r\n4. `Objects.equals(this.stringy, that.stringy)` - is using `Objects.equals()` on references (not primitives) to ensure if either side returns a `null`, the comparison is made without throwing a `NullPointerException`\r\n\r\nI have found this code implementation pattern is considerably easier to functional flow read, analyze, reason about, and debug, during a refactoring pass.\r\n\r\n\r\n  [1]: https://stackoverflow.com/a/77091598/501113\r\n  [2]: https://openjdk.org/jeps/394","title":"Implementation equals() method design pattern","body":"<p>Regarding adding <code>equals</code> and <code>hashCode</code> for <strong>JPA/Hibernate entities</strong>, please see this <a href=\"https://stackoverflow.com/a/77091598/501113\">StackOverflow Answer</a>.</p>\n<hr />\n<p>The code pattern recommended below depends upon the new <code>instanceof</code> pattern matching functionality released for <strong>preview in Java 14</strong> (2020/Mar/17), and then <strong>fully released in Java 16</strong> (2021/Mar/16).</p>\n<hr />\n<p>I really dislike seeing explicit uses of <code>true</code> and <code>false</code>, especially when they fall directly out of evaluated logic.</p>\n<p>So, I am not at all fond of the default code pattern generated by my IDE (IntelliJ) when overriding and implementing <code>equals()</code> in my classes.</p>\n<p>It looks like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>//Legacy laden pattern produced by IntelliJ code generator\npublic boolean equals(Object o) {\n  if (this == o) {\n    return true;\n  }\n  if (o == null || getClass() != o.getClass()) {\n    return false;\n  }\n  EqualsExampleClass that = (EqualsExampleClass) o;\n  return Objects.equals(stringy, that.stringy)\n      &amp;&amp; (inty == that.inty)\n      &amp;&amp; Objects.equals(bigIntegery, that.bigIntegery)\n      &amp;&amp; (booleany == that.booleany);\n}\n</code></pre>\n<p>Encouraged by <a href=\"https://openjdk.org/jeps/394\" rel=\"nofollow noreferrer\">Oracle JEP 394</a> for the <code>instanceof</code> pattern matching, I've refactored the above code to look like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>//Modern flowing fluent style\n@Override\npublic boolean equals(Object o) {\n  return (this == o) ||\n      ((o instanceof EqualsExampleClass that)\n          &amp;&amp; (this.getClass() == that.getClass())\n          &amp;&amp; Objects.equals(this.stringy, that.stringy)\n          &amp;&amp; (this.inty == that.inty)\n          &amp;&amp; Objects.equals(this.bigInt, that.bigInt)\n          &amp;&amp; (this.booleany == that.booleany));\n}\n</code></pre>\n<p>Per line execution details:</p>\n<ol>\n<li><code>(this == o)</code> - checks for literally the same instance</li>\n<li><code>(o instanceof EqualsExampleClass that)</code> - check to make sure <code>o</code> is not <code>null</code>, <code>o</code> is an instance of this class (or an descendant), and if so, assign <code>o</code> to the narrowed type variable <code>that</code></li>\n<li><code>(this.getClass() == that.getClass())</code> - requires the comparison is to the exact same class (and not a descendant), and is optional if, and only if, the class is <code>final</code></li>\n<li><code>Objects.equals(this.stringy, that.stringy)</code> - is using <code>Objects.equals()</code> on references (not primitives) to ensure if either side returns a <code>null</code>, the comparison is made without throwing a <code>NullPointerException</code></li>\n</ol>\n<p>I have found this code implementation pattern is considerably easier to functional flow read, analyze, reason about, and debug, during a refactoring pass.</p>\n"}],"owner":{"account_id":937533,"reputation":4930,"user_id":966185,"accept_rate":81,"display_name":"Pavel"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":1969,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":12833749,"answer_count":7,"score":0,"last_activity_date":1701121005,"creation_date":1349937747,"question_id":12833654,"body_markdown":"Is there any design pattern (or idiom) that helps to implement `equals()` method in Java? &lt;br&gt;&lt;br&gt; That task is&#39;n so hard but in most cases it&#39;s about the same... That&#39;s why I guess that there is a pattern but I didn&#39;t find it.\r\n\r\n    UPDATE\r\n\r\nI chose the method: `generate equals() method in Eclipse` but... I found a good way (in AbstractList) to make that generated code better: \r\n\r\n    if (!(attributes ==null ? other.attributes==null : attributes.equals(other.attributes))) \r\n        return false; \r\n\r\ninstead of generated:\r\n\r\n    if (attributes == null) {\r\n    \t    if (other.attributes != null)\r\n    \t\treturn false;\r\n    \t} else if (!attributes.equals(other.attributes))\r\n    \t    return false;","title":"Implementation equals() method design pattern","body":"<p>Is there any design pattern (or idiom) that helps to implement <code>equals()</code> method in Java? <br><br> That task is'n so hard but in most cases it's about the same... That's why I guess that there is a pattern but I didn't find it.</p>\n\n<pre><code>UPDATE\n</code></pre>\n\n<p>I chose the method: <code>generate equals() method in Eclipse</code> but... I found a good way (in AbstractList) to make that generated code better: </p>\n\n<pre><code>if (!(attributes ==null ? other.attributes==null : attributes.equals(other.attributes))) \n    return false; \n</code></pre>\n\n<p>instead of generated:</p>\n\n<pre><code>if (attributes == null) {\n        if (other.attributes != null)\n        return false;\n    } else if (!attributes.equals(other.attributes))\n        return false;\n</code></pre>\n"},{"tags":["java","jpa","entitymanager"],"comments":[{"owner":{"account_id":5289146,"reputation":8128,"user_id":4222206,"display_name":"queeg"},"score":0,"creation_date":1701121528,"post_id":77560016,"comment_id":136733726,"body_markdown":"There is neither an entitymanager nor a call to merge visible in the given code.","body":"There is neither an entitymanager nor a call to merge visible in the given code."},{"owner":{"account_id":231721,"reputation":20460,"user_id":496099,"display_name":"Chris"},"score":0,"creation_date":1701270471,"post_id":77560016,"comment_id":136755232,"body_markdown":"The logic you&#39;ve posted doesn&#39;t make sense to me. Why stream and filter over actGPs when you&#39;ve just created a new empty list for it?","body":"The logic you&#39;ve posted doesn&#39;t make sense to me. Why stream and filter over actGPs when you&#39;ve just created a new empty list for it?"}],"owner":{"account_id":15601300,"reputation":1,"user_id":11255368,"display_name":"Zeinab Abbas"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":1,"is_answered":false,"view_count":12,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701120339,"creation_date":1701120233,"question_id":77560016,"body_markdown":"This code is giving an error &quot;Cannot merge an entity that has been removed&quot; \r\nInvoiceDetail has a list of ActGps\r\n\r\nthis code is a snippet code of a function in invoice detail \r\nit is trying to delete an entity where it not must be deleted \r\n\r\n\r\n     // initialize needed fields\r\n    \r\n    List&lt;ActGP&gt; oldActGPs = new ArrayList&lt;&gt;();\r\n    if (actGPs != null &amp;&amp; !actGPs.isEmpty())\r\n    \toldActGPs.addAll(actGPs);\r\n    actGPs = new ArrayList&lt;&gt;();\r\n    \r\n       // get actGP (if exists in visit and not canceled)\r\n    \t\t\t// if exist --&gt; reset fields (reset prices)\r\n    \t\t\t// else --&gt; create new ActGP\r\n    \t\t\tactGP = actGPs.stream().filter(agp -&gt; agp.getVGPId() == vgp.getId()).findAny().orElse(null);\r\n    \r\n    \t\t\tif (actGP == null) {\r\n    \t\t\t\t// case of adding a new act from departments OR add new GP in visit\r\n    \t\t\t\tactGP = createNewActGP(vgp, currAct);\r\n    \r\n    \t\t\t} else {\r\n    \t\t\t\t// actGP exists \r\n    \t\t\t\t// OR case when reCompute method called\r\n    \t\t\t\tactGP.resetPriceFields();\r\n    \t\t\t\tif (!oldActGPs.isEmpty())\r\n    \t\t\t\t\toldActGPs.remove(actGP); // after the for loop we will have in oldActGPs the actGP for canceled GPs\r\n    \t\t\t\tactGP.setGptId(0);\r\n    \t\t \t}\r\n    \r\n      if (!oldActGPs.isEmpty()) {\r\n    \t   for (ActGP a : oldActGPs) {\r\n    \t\t a.setInvoiceDetail(null); // removed from list ==&gt; should be deleted from DB\r\n            }\r\n         }\r\n\r\n","title":"cannot merge an entity that has been removed : actgp","body":"<p>This code is giving an error &quot;Cannot merge an entity that has been removed&quot;\nInvoiceDetail has a list of ActGps</p>\n<p>this code is a snippet code of a function in invoice detail\nit is trying to delete an entity where it not must be deleted</p>\n<pre><code> // initialize needed fields\n\nList&lt;ActGP&gt; oldActGPs = new ArrayList&lt;&gt;();\nif (actGPs != null &amp;&amp; !actGPs.isEmpty())\n    oldActGPs.addAll(actGPs);\nactGPs = new ArrayList&lt;&gt;();\n\n   // get actGP (if exists in visit and not canceled)\n            // if exist --&gt; reset fields (reset prices)\n            // else --&gt; create new ActGP\n            actGP = actGPs.stream().filter(agp -&gt; agp.getVGPId() == vgp.getId()).findAny().orElse(null);\n\n            if (actGP == null) {\n                // case of adding a new act from departments OR add new GP in visit\n                actGP = createNewActGP(vgp, currAct);\n\n            } else {\n                // actGP exists \n                // OR case when reCompute method called\n                actGP.resetPriceFields();\n                if (!oldActGPs.isEmpty())\n                    oldActGPs.remove(actGP); // after the for loop we will have in oldActGPs the actGP for canceled GPs\n                actGP.setGptId(0);\n            }\n\n  if (!oldActGPs.isEmpty()) {\n       for (ActGP a : oldActGPs) {\n         a.setInvoiceDetail(null); // removed from list ==&gt; should be deleted from DB\n        }\n     }\n</code></pre>\n"},{"tags":["java","javafx","metal","openjfx"],"comments":[{"owner":{"account_id":322981,"reputation":310755,"user_id":642706,"accept_rate":58,"display_name":"Basil Bourque"},"score":0,"creation_date":1691041210,"post_id":76825116,"comment_id":135437553,"body_markdown":"Related: [*Is this official description of the JavaFX architecture still valid today, a decade later?*](https://stackoverflow.com/q/76817114/642706)","body":"Related: <a href=\"https://stackoverflow.com/q/76817114/642706\"><i>Is this official description of the JavaFX architecture still valid today, a decade later?</i></a>"}],"answers":[{"tags":[],"owner":{"account_id":1180113,"reputation":152335,"user_id":1155209,"display_name":"jewelsea"},"comment_count":0,"down_vote_count":0,"up_vote_count":6,"is_accepted":true,"score":6,"last_activity_date":1701119895,"creation_date":1691046698,"answer_id":76825667,"question_id":76825116,"body_markdown":"No.  JavaFX, as of 20, does not use the Apple Metal API.  \r\n\r\nFor [hardware acceleration][1] on Mac, JavaFX uses [OpenGL ES2][2].  It can also fall back to a software renderer, but you have to force it to do that, it will use ES2 by default.\r\n\r\nThere is experimental proof of concept work using the Apple Metal API for JavaFX 3D rendering.  The implementation can be found in this pull request on the jfx-sandbox repository (this is not the mainline repository that is used for JavaFX releases):\r\n\r\n * [8295485: POC for JavaFX Metal - 3D][3]\r\n\r\nThe metal branch in the sandbox has a lot of fairly recent changes:\r\n\r\n * https://github.com/openjdk/jfx-sandbox/commits/metal\r\n\r\nPerhaps in the future, Metal support will be added to JavaFX.  \r\n\r\nIf you have further queries, raise the topic on the [openjfx-dev mailing list][4].\r\n\r\nMain issue tracker for JavaFX Metal support:\r\n\r\n * [JDK-8271024 JavaFX : Implement Metal Rendering Pipeline][5]\r\n\r\n----\r\nThe work done for Metal support on Mac for the JDK as part of [JEP 382][6], as far as I can tell, is only for the [Java2D][7] API.  The Java2D API (as far as I know) is not used by JavaFX, except perhaps to help with printing support.  The Java2D work to support metal can be used by AWT and Swing frameworks that are part of the core JDK.  JavaFX is no longer part of the JDK, so the JEP process does not apply to it.\r\n\r\n\r\n  [1]: https://en.wikipedia.org/wiki/Hardware_acceleration\r\n  [2]: https://en.wikipedia.org/wiki/OpenGL_ES\r\n  [3]: https://github.com/openjdk/jfx-sandbox/commit/c3c5aaadff468abdcec838d97ea18f0f26310079\r\n  [4]: https://mail.openjdk.org/mailman/listinfo/openjfx-dev\r\n  [5]: https://bugs.openjdk.org/browse/JDK-8271024\r\n  [6]: https://openjdk.org/jeps/382\r\n  [7]: https://en.wikipedia.org/wiki/Java_2D","title":"Does JavaFX use the new Metal-based rendering for Java on macOS?","body":"<p>No.  JavaFX, as of 20, does not use the Apple Metal API.</p>\n<p>For <a href=\"https://en.wikipedia.org/wiki/Hardware_acceleration\" rel=\"nofollow noreferrer\">hardware acceleration</a> on Mac, JavaFX uses <a href=\"https://en.wikipedia.org/wiki/OpenGL_ES\" rel=\"nofollow noreferrer\">OpenGL ES2</a>.  It can also fall back to a software renderer, but you have to force it to do that, it will use ES2 by default.</p>\n<p>There is experimental proof of concept work using the Apple Metal API for JavaFX 3D rendering.  The implementation can be found in this pull request on the jfx-sandbox repository (this is not the mainline repository that is used for JavaFX releases):</p>\n<ul>\n<li><a href=\"https://github.com/openjdk/jfx-sandbox/commit/c3c5aaadff468abdcec838d97ea18f0f26310079\" rel=\"nofollow noreferrer\">8295485: POC for JavaFX Metal - 3D</a></li>\n</ul>\n<p>The metal branch in the sandbox has a lot of fairly recent changes:</p>\n<ul>\n<li><a href=\"https://github.com/openjdk/jfx-sandbox/commits/metal\" rel=\"nofollow noreferrer\">https://github.com/openjdk/jfx-sandbox/commits/metal</a></li>\n</ul>\n<p>Perhaps in the future, Metal support will be added to JavaFX.</p>\n<p>If you have further queries, raise the topic on the <a href=\"https://mail.openjdk.org/mailman/listinfo/openjfx-dev\" rel=\"nofollow noreferrer\">openjfx-dev mailing list</a>.</p>\n<p>Main issue tracker for JavaFX Metal support:</p>\n<ul>\n<li><a href=\"https://bugs.openjdk.org/browse/JDK-8271024\" rel=\"nofollow noreferrer\">JDK-8271024 JavaFX : Implement Metal Rendering Pipeline</a></li>\n</ul>\n<hr />\n<p>The work done for Metal support on Mac for the JDK as part of <a href=\"https://openjdk.org/jeps/382\" rel=\"nofollow noreferrer\">JEP 382</a>, as far as I can tell, is only for the <a href=\"https://en.wikipedia.org/wiki/Java_2D\" rel=\"nofollow noreferrer\">Java2D</a> API.  The Java2D API (as far as I know) is not used by JavaFX, except perhaps to help with printing support.  The Java2D work to support metal can be used by AWT and Swing frameworks that are part of the core JDK.  JavaFX is no longer part of the JDK, so the JEP process does not apply to it.</p>\n"}],"owner":{"account_id":322981,"reputation":310755,"user_id":642706,"accept_rate":58,"display_name":"Basil Bourque"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":155,"favorite_count":0,"down_vote_count":0,"up_vote_count":4,"accepted_answer_id":76825667,"answer_count":1,"score":4,"last_activity_date":1701119895,"creation_date":1691040807,"question_id":76825116,"body_markdown":"Do the latest versions (19, 20, etc.) of JavaFX/[OpenJFX][1] use the new [*Metal*](https://en.wikipedia.org/wiki/Metal_(API)) rendering built for Java on macOS, supplanting OpenGL?  \r\n\r\n[*JEP 382: New macOS Rendering Pipeline*](https://openjdk.org/jeps/382)\r\n\r\nThat new pipeline became [the default in Java 19](https://www.oracle.com/java/technologies/javase/19-relnote-issues.html#JDK-8284378).\r\n\r\n\r\n  [1]: https://openjfx.io/","title":"Does JavaFX use the new Metal-based rendering for Java on macOS?","body":"<p>Do the latest versions (19, 20, etc.) of JavaFX/<a href=\"https://openjfx.io/\" rel=\"nofollow noreferrer\">OpenJFX</a> use the new <a href=\"https://en.wikipedia.org/wiki/Metal_(API)\" rel=\"nofollow noreferrer\"><em>Metal</em></a> rendering built for Java on macOS, supplanting OpenGL?</p>\n<p><a href=\"https://openjdk.org/jeps/382\" rel=\"nofollow noreferrer\"><em>JEP 382: New macOS Rendering Pipeline</em></a></p>\n<p>That new pipeline became <a href=\"https://www.oracle.com/java/technologies/javase/19-relnote-issues.html#JDK-8284378\" rel=\"nofollow noreferrer\">the default in Java 19</a>.</p>\n"},{"tags":["java","mapping","mapstruct"],"owner":{"account_id":18044315,"reputation":1227,"user_id":13115701,"display_name":"Paul Marcelin Bejan"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":21,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701119475,"creation_date":1701119475,"question_id":77559965,"body_markdown":"I have created a MapperConfig where I have a prototype of mapping method that can be used to inherit method-level mapping annotations.\r\n\r\n    @MapperConfig(componentModel = MappingConstants.ComponentModel.SPRING)\r\n    public interface EmployeeMapperConfig {\r\n    \r\n    \t@Named(&quot;fromRequestToDomain&quot;)\r\n    \t@Mapping(target = &quot;id&quot;, ignore = true)\r\n    \tEmployee fromSaveRequestToEntity(EmployeeSaveRequest saveRequest);\r\n    \t\r\n    }\r\n\r\nI have one mapper that maps single element DTO to ENTITY:\r\n\r\n    @Mapper(config = EmployeeMapperConfig.class)\r\n    public interface EmployeeSaveOneMapper {\r\n    \t\r\n    \t@InheritConfiguration\r\n    \tEmployee toDomain(EmployeeSaveRequest request);\r\n    \t\r\n    }\r\n\r\nbut what if I want to map a List of employee ?\r\n\r\nI have another mapper that maps multiple DTO to ENTITIES:\r\n\r\n    public interface EmployeeSaveManyMapper {\r\n    \t\r\n    \tList&lt;Employee&gt; toDomain(List&lt;EmployeeSaveRequest&gt; request);\r\n    \t\r\n    }\r\n\r\nhow can I inherit configuration for iterable mapping?\r\n\r\nI have tried with the following MapperConfig:\r\n\r\n    @MapperConfig(componentModel = MappingConstants.ComponentModel.SPRING)\r\n    public interface EmployeeMapperConfig {\r\n    \r\n    \t@Named(&quot;fromRequestToDomain&quot;)\r\n    \t@Mapping(target = &quot;id&quot;, ignore = true)\r\n    \tEmployee fromSaveRequestToEntity(EmployeeSaveRequest request);\r\n    \t\r\n    \t@IterableMapping(qualifiedByName = &quot;fromRequestToDomain&quot;)\r\n    \tList&lt;Employee&gt; fromSaveRequestsToEntities(Collection&lt;EmployeeSaveRequest&gt; saveRequests);\r\n    \t\r\n    }\r\n\r\nand the following mapper:\r\n\r\n    @Mapper(config = EmployeeMapperConfig.class)\r\n    public interface EmployeeSaveManyMapper {\r\n    \t\r\n        @InheritConfiguration\r\n    \tList&lt;Employee&gt; toDomain(List&lt;EmployeeSaveRequest&gt; request);\r\n    \t\r\n    }\r\n\r\nP.S. I know that I can do it by using the EmployeeSaveOneMapper, but I was looking for a solution using MapperConfig.\r\n\r\n    @Mapper(componentModel = MappingConstants.ComponentModel.SPRING, uses = EmployeeSaveOneMapper.class)\r\n    public interface EmployeeSaveManyMapper {\r\n    \t\r\n    \t@Override\r\n    \t@IterableMapping(qualifiedByName = &quot;fromRequestToDomain&quot;)\r\n    \tList&lt;Employee&gt; toDomain(List&lt;EmployeeSaveRequest&gt; request);\r\n    \t\r\n    }\r\n\r\n","title":"How to InheritConfiguration from prototype of mapping method of iterable types using Mapstruct?","body":"<p>I have created a MapperConfig where I have a prototype of mapping method that can be used to inherit method-level mapping annotations.</p>\n<pre><code>@MapperConfig(componentModel = MappingConstants.ComponentModel.SPRING)\npublic interface EmployeeMapperConfig {\n\n    @Named(&quot;fromRequestToDomain&quot;)\n    @Mapping(target = &quot;id&quot;, ignore = true)\n    Employee fromSaveRequestToEntity(EmployeeSaveRequest saveRequest);\n    \n}\n</code></pre>\n<p>I have one mapper that maps single element DTO to ENTITY:</p>\n<pre><code>@Mapper(config = EmployeeMapperConfig.class)\npublic interface EmployeeSaveOneMapper {\n    \n    @InheritConfiguration\n    Employee toDomain(EmployeeSaveRequest request);\n    \n}\n</code></pre>\n<p>but what if I want to map a List of employee ?</p>\n<p>I have another mapper that maps multiple DTO to ENTITIES:</p>\n<pre><code>public interface EmployeeSaveManyMapper {\n    \n    List&lt;Employee&gt; toDomain(List&lt;EmployeeSaveRequest&gt; request);\n    \n}\n</code></pre>\n<p>how can I inherit configuration for iterable mapping?</p>\n<p>I have tried with the following MapperConfig:</p>\n<pre><code>@MapperConfig(componentModel = MappingConstants.ComponentModel.SPRING)\npublic interface EmployeeMapperConfig {\n\n    @Named(&quot;fromRequestToDomain&quot;)\n    @Mapping(target = &quot;id&quot;, ignore = true)\n    Employee fromSaveRequestToEntity(EmployeeSaveRequest request);\n    \n    @IterableMapping(qualifiedByName = &quot;fromRequestToDomain&quot;)\n    List&lt;Employee&gt; fromSaveRequestsToEntities(Collection&lt;EmployeeSaveRequest&gt; saveRequests);\n    \n}\n</code></pre>\n<p>and the following mapper:</p>\n<pre><code>@Mapper(config = EmployeeMapperConfig.class)\npublic interface EmployeeSaveManyMapper {\n    \n    @InheritConfiguration\n    List&lt;Employee&gt; toDomain(List&lt;EmployeeSaveRequest&gt; request);\n    \n}\n</code></pre>\n<p>P.S. I know that I can do it by using the EmployeeSaveOneMapper, but I was looking for a solution using MapperConfig.</p>\n<pre><code>@Mapper(componentModel = MappingConstants.ComponentModel.SPRING, uses = EmployeeSaveOneMapper.class)\npublic interface EmployeeSaveManyMapper {\n    \n    @Override\n    @IterableMapping(qualifiedByName = &quot;fromRequestToDomain&quot;)\n    List&lt;Employee&gt; toDomain(List&lt;EmployeeSaveRequest&gt; request);\n    \n}\n</code></pre>\n"},{"tags":["java","oracle","jdbc","connection","timeout"],"comments":[{"owner":{"account_id":1110848,"reputation":3563,"user_id":1101332,"accept_rate":67,"display_name":"sasankad"},"score":0,"creation_date":1394579885,"post_id":22338598,"comment_id":33950015,"body_markdown":"how about setting &quot;DriverManager.setLoginTimeout()&quot; ?","body":"how about setting &quot;DriverManager.setLoginTimeout()&quot; ?"},{"owner":{"account_id":1966695,"reputation":631,"user_id":1766760,"accept_rate":56,"display_name":"user1766760"},"score":0,"creation_date":1394582461,"post_id":22338598,"comment_id":33950945,"body_markdown":"@sasankad I assumed `LoginTimeout` is different than &quot;idle timeout&quot;?","body":"@sasankad I assumed <code>LoginTimeout</code> is different than &quot;idle timeout&quot;?"}],"answers":[{"comments":[{"owner":{"account_id":1966695,"reputation":631,"user_id":1766760,"accept_rate":56,"display_name":"user1766760"},"score":0,"creation_date":1394582212,"post_id":22338788,"comment_id":33950872,"body_markdown":"Yes, I find myself asking the same question. Why and does it make sense for us to keep the connection open for so long (I personally don&#39;t think so... but I have some stuff I&#39;m not sure of - see my updates)","body":"Yes, I find myself asking the same question. Why and does it make sense for us to keep the connection open for so long (I personally don&#39;t think so... but I have some stuff I&#39;m not sure of - see my updates)"},{"owner":{"account_id":1966695,"reputation":631,"user_id":1766760,"accept_rate":56,"display_name":"user1766760"},"score":0,"creation_date":1394640520,"post_id":22338788,"comment_id":33982164,"body_markdown":"Sorry I re-read your response and see that my comment didn&#39;t exactly make sense.  I was echoing the question - Does it make sense for the connection to stay open for so long? (I was thinking no).  It&#39;s strange though; during that time, we keep the connection open while we actively query another DB thru a link (probably every min or so)... Also at this point, it seems to work w/ one user but not another without changing the code one bit.  The two user accounts supposedly both have unlimited resource as well... This is really strange.","body":"Sorry I re-read your response and see that my comment didn&#39;t exactly make sense.  I was echoing the question - Does it make sense for the connection to stay open for so long? (I was thinking no).  It&#39;s strange though; during that time, we keep the connection open while we actively query another DB thru a link (probably every min or so)... Also at this point, it seems to work w/ one user but not another without changing the code one bit.  The two user accounts supposedly both have unlimited resource as well... This is really strange."},{"owner":{"account_id":6228,"reputation":228269,"user_id":10397,"display_name":"Justin Cave"},"score":0,"creation_date":1394640644,"post_id":22338788,"comment_id":33982258,"body_markdown":"@user1766760 - Which database is the error coming from?  Are both users using the same database link with a fixed username &amp; password?  Or is each user using their personal credentials as part of the database link?","body":"@user1766760 - Which database is the error coming from?  Are both users using the same database link with a fixed username &amp; password?  Or is each user using their personal credentials as part of the database link?"},{"owner":{"account_id":1966695,"reputation":631,"user_id":1766760,"accept_rate":56,"display_name":"user1766760"},"score":0,"creation_date":1394643403,"post_id":22338788,"comment_id":33984282,"body_markdown":"AFAIK, the error happens from when we were about to execute a `CallableStatement` to our database to keep the DB link open. So I think the error is coming from us (I&#39;ll post the error msg above).  Each user has their own login, but accessing the same DB link behind the scenes.","body":"AFAIK, the error happens from when we were about to execute a <code>CallableStatement</code> to our database to keep the DB link open. So I think the error is coming from us (I&#39;ll post the error msg above).  Each user has their own login, but accessing the same DB link behind the scenes."}],"tags":[],"owner":{"account_id":6228,"reputation":228269,"user_id":10397,"display_name":"Justin Cave"},"comment_count":4,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1394580031,"creation_date":1394580031,"answer_id":22338788,"question_id":22338598,"body_markdown":"I&#39;m not sure that I understand the question you&#39;re asking.\r\n\r\nThe error you are getting indicates that the Oracle user that you are using to connect to the database has a profile configured (in Oracle) that limits the amount of time the connection can be idle.  Oracle is killing your connection when the connection remains idle too long.  Normally, the solution to this sort of problem would be to go to the DBA and ask for the idle time to be increased or to look through your code and see why the connection is open and unused for so long.  If you were using a connection pool (which it doesn&#39;t appear you are), it would make sense for some connections to remain open and idle for long periods of time.  Since it doesn&#39;t appear that you are using a connection pool, the question is whether it makes sense for the application to hold open the connection for long periods of time without doing anything.  If the application opens a connection when the user logs in at 9am and doesn&#39;t close it until the user shuts down at 5pm, it may make sense to adjust the `IDLE_TIME` setting for this user in the database.  Otherwise, you may want to investigate whether it makes logical sense for the application to hold open the database connection so long without doing something or whether the application can be modified to close the connection when it is no longer needed.","title":"JDBC Oracle Thin ORA-02396 Connection idle timeout","body":"<p>I'm not sure that I understand the question you're asking.</p>\n\n<p>The error you are getting indicates that the Oracle user that you are using to connect to the database has a profile configured (in Oracle) that limits the amount of time the connection can be idle.  Oracle is killing your connection when the connection remains idle too long.  Normally, the solution to this sort of problem would be to go to the DBA and ask for the idle time to be increased or to look through your code and see why the connection is open and unused for so long.  If you were using a connection pool (which it doesn't appear you are), it would make sense for some connections to remain open and idle for long periods of time.  Since it doesn't appear that you are using a connection pool, the question is whether it makes sense for the application to hold open the connection for long periods of time without doing anything.  If the application opens a connection when the user logs in at 9am and doesn't close it until the user shuts down at 5pm, it may make sense to adjust the <code>IDLE_TIME</code> setting for this user in the database.  Otherwise, you may want to investigate whether it makes logical sense for the application to hold open the database connection so long without doing something or whether the application can be modified to close the connection when it is no longer needed.</p>\n"}],"owner":{"account_id":1966695,"reputation":631,"user_id":1766760,"accept_rate":56,"display_name":"user1766760"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":11556,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"answer_count":1,"score":1,"last_activity_date":1701118890,"creation_date":1394579280,"question_id":22338598,"body_markdown":"I am supporting some legacy code and it&#39;s chugged along fine until recently.  I am looking for if there is a setting for JDBC Oracle thin connection where I can specify idle timeout via Java (no connection pooling)?  A lot of resources online refer to connection pooling... is it even possible in my case (to specify idle timeout, in a non-pooling situation)?  Or is idle time a setting on the specific DB user account?\r\n\r\n**Updates + Questions**\r\n\r\n1. I was able to log in as the user, and ran a query to try to find out resource limits. `select * from USER_RESOURCE_LIMITS;` However everything came back &quot;UNLIMITED&quot;.  Is it possible for another value (say from the JDBC connection) to override the &quot;UNLIMITED&quot;? \r\n\r\n2. So the job holds onto the connection, while we actively query another system via DB links for a good duration of ~2+ hours... Now, why would the idle timeout even come into play? \r\n\r\n**Update #2**\r\n\r\nWe switched to a different account (that has the same kind of DB link setup) and the job was able to finish like it did before. Which sort of points to something wonky with the Oracle user profile?  But like I said, querying `USER_RESOURCE_LIMITS` shows both users to have &quot;UNLIMITED&quot; idle time. DBA pretty confirmed that too.  What else could be causing this difference? \r\n\r\n**Update #3**\r\n\r\nStack trace and such.\r\n\r\n    java.sql.SQLException: ORA-02396: exceeded maximum idle time, please connect again\r\n    ORA-06512: at line 1\r\n\r\n        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:125)\r\n        at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:316)\r\n        at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:282)\r\n        at oracle.jdbc.driver.T4C8Oall.receive(T4C8Oall.java:639)\r\n        at oracle.jdbc.driver.T4CCallableStatement.doOall8(T4CCallableStatement.java:184)\r\n        at oracle.jdbc.driver.T4CCallableStatement.execute_for_rows(T4CCallableStatement.java:873)\r\n        at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1086)\r\n        at oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:2984)\r\n        at oracle.jdbc.driver.OraclePreparedStatement.execute(OraclePreparedStatement.java:3076)\r\n        at oracle.jdbc.driver.OracleCallableStatement.execute(OracleCallableStatement.java:4273)\r\n        at com.grocery.stand.Helper.getAccess(Helper.java:216)\r\n        at com.grocery.stand.fruitbasket.Dao.getPriceData(Dao.java:216)\r\n        at com.grocery.stand.fruitbasket.Dao.getPricees(Dao.java:183)\r\n        at com.grocery.stand.fruitbasket.UpdatePrice.updateAllFruitPrices(UpdatePrice.java:256)\r\n        at com.grocery.stand.fruitbasket.UpdatePrice.main(UpdatePrice.java:58)\r\n    SQL Exception while getting Data from SYSTEM_B\r\n    Exception while updating pricing : ORA-01012: not logged on\r\n\r\n    Exception in thread &quot;main&quot; java.sql.SQLException: ORA-01012: not logged on\r\n\r\n        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:125)\r\n        at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:316)\r\n        at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:277)\r\n        at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:272)\r\n        at oracle.jdbc.driver.T4C7Ocommoncall.receive(T4C7Ocommoncall.java:129)\r\n        at oracle.jdbc.driver.T4CConnection.do_rollback(T4CConnection.java:478)\r\n        at oracle.jdbc.driver.PhysicalConnection.rollback(PhysicalConnection.java:1045)\r\n        at com.grocery.stand.Helper.rollBack(Helper.java:75)\r\n        at com.grocery.stand.fruitbasket.UpdatePrice.updatePartNumbers(UpdatePrice.java:291)\r\n        at com.grocery.stand.fruitbasket.UpdatePrice.main(UpdatePrice.java:58)\r\n\r\n\r\n**Connection Code**\r\n\r\n        public  static Connection openConnection() throws SQLException {\r\n\r\n\r\n\t\tString userName = propBundle.getString(DB_UID);\r\n\t\tString password = propBundle.getString(DB_PWD);\r\n\t\tString url = propBundle.getString(DB_URL);\r\n\r\n\r\n\t\tConnection conn = null;\r\n\t\ttry {\r\n\t\t\tDriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver());\r\n\t\t\tconn = (Connection) DriverManager.getConnection(url, userName,\r\n\t\t\t\t\tpassword);\r\n\t\t\tconn.setAutoCommit(false);\r\n\t\t} catch (SQLException sqle) {\r\n\t\t\tsqle.printStackTrace(System.out);\r\n\t\t\tthrow sqle;\r\n\t\t}\r\n\t\treturn conn;\r\n\t}\r\n\r\n**Error occurs on line `execute()`**\r\n\r\n    public static void getSystemAccess(Connection dbConnection) throws SQLException {\r\n      try {\r\n          CallableStatement authStmt = null;\r\n          String authorize = &quot;CALL ABC.ACCESS_PROCEDURE@some_db_link()&quot;;\r\n          authStmt = dbConnection.prepareCall(authorize);\r\n          authStmt.execute();\r\n          authStmt.close();\r\n      } catch (SQLException sqle1) {\r\n          sqle1.printStackTrace();\r\n          throw new SQLException(sqle1.getMessage());\r\n      }\r\n    }\r\n","title":"JDBC Oracle Thin ORA-02396 Connection idle timeout","body":"<p>I am supporting some legacy code and it's chugged along fine until recently.  I am looking for if there is a setting for JDBC Oracle thin connection where I can specify idle timeout via Java (no connection pooling)?  A lot of resources online refer to connection pooling... is it even possible in my case (to specify idle timeout, in a non-pooling situation)?  Or is idle time a setting on the specific DB user account?</p>\n\n<p><strong>Updates + Questions</strong></p>\n\n<ol>\n<li><p>I was able to log in as the user, and ran a query to try to find out resource limits. <code>select * from USER_RESOURCE_LIMITS;</code> However everything came back \"UNLIMITED\".  Is it possible for another value (say from the JDBC connection) to override the \"UNLIMITED\"? </p></li>\n<li><p>So the job holds onto the connection, while we actively query another system via DB links for a good duration of ~2+ hours... Now, why would the idle timeout even come into play? </p></li>\n</ol>\n\n<p><strong>Update #2</strong></p>\n\n<p>We switched to a different account (that has the same kind of DB link setup) and the job was able to finish like it did before. Which sort of points to something wonky with the Oracle user profile?  But like I said, querying <code>USER_RESOURCE_LIMITS</code> shows both users to have \"UNLIMITED\" idle time. DBA pretty confirmed that too.  What else could be causing this difference? </p>\n\n<p><strong>Update #3</strong></p>\n\n<p>Stack trace and such.</p>\n\n<pre><code>java.sql.SQLException: ORA-02396: exceeded maximum idle time, please connect again\nORA-06512: at line 1\n\n    at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:125)\n    at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:316)\n    at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:282)\n    at oracle.jdbc.driver.T4C8Oall.receive(T4C8Oall.java:639)\n    at oracle.jdbc.driver.T4CCallableStatement.doOall8(T4CCallableStatement.java:184)\n    at oracle.jdbc.driver.T4CCallableStatement.execute_for_rows(T4CCallableStatement.java:873)\n    at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1086)\n    at oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:2984)\n    at oracle.jdbc.driver.OraclePreparedStatement.execute(OraclePreparedStatement.java:3076)\n    at oracle.jdbc.driver.OracleCallableStatement.execute(OracleCallableStatement.java:4273)\n    at com.grocery.stand.Helper.getAccess(Helper.java:216)\n    at com.grocery.stand.fruitbasket.Dao.getPriceData(Dao.java:216)\n    at com.grocery.stand.fruitbasket.Dao.getPricees(Dao.java:183)\n    at com.grocery.stand.fruitbasket.UpdatePrice.updateAllFruitPrices(UpdatePrice.java:256)\n    at com.grocery.stand.fruitbasket.UpdatePrice.main(UpdatePrice.java:58)\nSQL Exception while getting Data from SYSTEM_B\nException while updating pricing : ORA-01012: not logged on\n\nException in thread \"main\" java.sql.SQLException: ORA-01012: not logged on\n\n    at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:125)\n    at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:316)\n    at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:277)\n    at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:272)\n    at oracle.jdbc.driver.T4C7Ocommoncall.receive(T4C7Ocommoncall.java:129)\n    at oracle.jdbc.driver.T4CConnection.do_rollback(T4CConnection.java:478)\n    at oracle.jdbc.driver.PhysicalConnection.rollback(PhysicalConnection.java:1045)\n    at com.grocery.stand.Helper.rollBack(Helper.java:75)\n    at com.grocery.stand.fruitbasket.UpdatePrice.updatePartNumbers(UpdatePrice.java:291)\n    at com.grocery.stand.fruitbasket.UpdatePrice.main(UpdatePrice.java:58)\n</code></pre>\n\n<p><strong>Connection Code</strong></p>\n\n<pre><code>    public  static Connection openConnection() throws SQLException {\n\n\n    String userName = propBundle.getString(DB_UID);\n    String password = propBundle.getString(DB_PWD);\n    String url = propBundle.getString(DB_URL);\n\n\n    Connection conn = null;\n    try {\n        DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver());\n        conn = (Connection) DriverManager.getConnection(url, userName,\n                password);\n        conn.setAutoCommit(false);\n    } catch (SQLException sqle) {\n        sqle.printStackTrace(System.out);\n        throw sqle;\n    }\n    return conn;\n}\n</code></pre>\n\n<p><strong>Error occurs on line <code>execute()</code></strong></p>\n\n<pre><code>public static void getSystemAccess(Connection dbConnection) throws SQLException {\n  try {\n      CallableStatement authStmt = null;\n      String authorize = \"CALL ABC.ACCESS_PROCEDURE@some_db_link()\";\n      authStmt = dbConnection.prepareCall(authorize);\n      authStmt.execute();\n      authStmt.close();\n  } catch (SQLException sqle1) {\n      sqle1.printStackTrace();\n      throw new SQLException(sqle1.getMessage());\n  }\n}\n</code></pre>\n"},{"tags":["java","libgdx","project-reactor"],"owner":{"account_id":10596164,"reputation":41,"user_id":7804793,"display_name":"Ewan Arends"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":33,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701118616,"creation_date":1701118616,"question_id":77559894,"body_markdown":"I&#39;m currently working on a game in which the user can run spells, these spells can both require and supply input of certain POJO types, these I have depicted by ``ArgType&lt;T&gt;``. Rather than storing these requests *and* pre-supplied objects and then constantly checking for any matches I decided to make this entire system more dynamic, using project reactor;\r\nSpells now use this method in ``ArgumentRequestor`` to request &#39;arguments&#39;\r\n```java\r\npublic &lt;T&gt; Mono&lt;T&gt; get(ArgType&lt;T&gt; argType) {\r\n        if (!memoryReadQueue.isEmpty()) {\r\n            //(...)\r\n        }\r\n        Mono&lt;T&gt; mono;\r\n        mono = Mono.create(tMonoSink -&gt; inputRequestFluxSink.tryEmitNext(new ArgumentRequest&lt;T&gt;(argType, tMonoSink)));\r\n        return mono;\r\n    }\r\n```\r\n\r\nwith ``ArgumentRequest&lt;T&gt;`` being a simple record with an added boolean ``handled`` which keeps track of whether the request has been handled.\r\n\r\nThen to make the flux sink and its respective flux;\r\n```java\r\nprivate final Sinks.Many&lt;ArgumentRequest&gt; inputRequestFluxSink = Sinks.many().replay().limit(5, Duration.ofSeconds(3));\r\n\r\nprivate final Flux&lt;ArgumentRequest&gt; requestFlux = inputRequestFluxSink.asFlux();\r\n```\r\nIf any argument is provided, be it before or after being requested, it is submitted as follows;\r\n```java\r\nrequestor.getRequestFlux().filter(a -&gt; a.argType() == getSelectorType()).filter(argumentRequest1 -&gt; !argumentRequest1.isHandled()).take(1).subscribe(a -&gt; {\r\n            a.setHandled();\r\n            a.consumer().success(provided);\r\n        });\r\n```\r\nNow I have two spells: \r\n\r\n 1. one &#39;selector&#39; spell which submits a ``Vector2`` for the position of the mouse called ``MousePosSelector``\r\n 2. one spell which requests a ``Vector2`` instance called ``TeleportSpell``\r\n\r\nThe wanted behavior is as follows;\r\n\r\n - If the teleport spell is called before the selector, a new instance of ``ArgumentRequest`` is created and put into the flux, it will wait there in the ``repeat()`` queue for either three seconds or until it has been followed up by 5 new requests, the selector will then subscibe, and if on time will, through ``take(1)``, find this request and fulfill it, thus sending the Mono out to the teleport spell.\r\n- If the teleport spell is called after the selector, the selector will already have subscribed and will receive the ArgumentRequest directly.\r\n\r\n \r\nCurrently only the last scenario works, however, to double-check I&#39;ve run the following unit test. This emulates the first scenario with a 700 ms delay between calls.\r\n\r\n```java\r\n    @Test\r\n    void checkArguments() throws InterruptedException {\r\n        Random random = new Random();\r\n        for (int i = 0; i &lt; 10; i++) {\r\n            int x = random.nextInt();\r\n            int y = random.nextInt();\r\n            Mono&lt;Vector2&gt; mono = quantaMain.argumentRequestor.get(ArgumentRequestor.ArgType.VECTOR2);\r\n            AtomicBoolean flag = new AtomicBoolean(false);\r\n            mono.subscribe(vector2 -&gt; {\r\n                System.out.println(&quot;Vector found: X=&quot; + vector2.getX() + &quot;; Y=&quot; + vector2.getY());\r\n                Assertions.assertEquals(vector2.getX(), x);\r\n                Assertions.assertEquals(vector2.getY(), y);\r\n                flag.set(true);\r\n            });\r\n            Thread.sleep(700);\r\n            quantaMain.argumentRequestor.getRequestFlux().filter(a -&gt; a.argType() == ArgumentRequestor.ArgType.VECTOR2).filter(argumentRequest1 -&gt; !argumentRequest1.isHandled()).take(1).subscribe(argumentRequest -&gt; {\r\n                        argumentRequest.setHandled();\r\n                        argumentRequest.consumer().success(new Vector2(x, y));\r\n                    });\r\n            Assertions.assertTrue(flag.get());\r\n        }\r\n    }\r\n```\r\n\r\nIn this test case it works perfectly fine for any delay below 3000ms, this has only confused me further.\r\nSome observations:\r\n\r\n - This test is runned without initializing libGDX/LWJGL\r\n - The first situation does work when I wait for about a second or two\r\n - The first situation works the second time the selector spell is ran\r\n - If the first situation is executed a second time directly after a &#39;succesfull&#39; case with the selector being ran twice, the first situation only works after running the selector thrice.\r\n- If the first situation is then done again it requires the selector to be ran four times.\r\n\r\nDoes anyone know what I&#39;m doing wrong / could be going wrong with this code? Just some tips for debugging would be greatly appreciated, since I&#39;ve been stuck on this for a week now :(","title":"Reactor flux with replay not always working","body":"<p>I'm currently working on a game in which the user can run spells, these spells can both require and supply input of certain POJO types, these I have depicted by <code>ArgType&lt;T&gt;</code>. Rather than storing these requests <em>and</em> pre-supplied objects and then constantly checking for any matches I decided to make this entire system more dynamic, using project reactor;\nSpells now use this method in <code>ArgumentRequestor</code> to request 'arguments'</p>\n<pre class=\"lang-java prettyprint-override\"><code>public &lt;T&gt; Mono&lt;T&gt; get(ArgType&lt;T&gt; argType) {\n        if (!memoryReadQueue.isEmpty()) {\n            //(...)\n        }\n        Mono&lt;T&gt; mono;\n        mono = Mono.create(tMonoSink -&gt; inputRequestFluxSink.tryEmitNext(new ArgumentRequest&lt;T&gt;(argType, tMonoSink)));\n        return mono;\n    }\n</code></pre>\n<p>with <code>ArgumentRequest&lt;T&gt;</code> being a simple record with an added boolean <code>handled</code> which keeps track of whether the request has been handled.</p>\n<p>Then to make the flux sink and its respective flux;</p>\n<pre class=\"lang-java prettyprint-override\"><code>private final Sinks.Many&lt;ArgumentRequest&gt; inputRequestFluxSink = Sinks.many().replay().limit(5, Duration.ofSeconds(3));\n\nprivate final Flux&lt;ArgumentRequest&gt; requestFlux = inputRequestFluxSink.asFlux();\n</code></pre>\n<p>If any argument is provided, be it before or after being requested, it is submitted as follows;</p>\n<pre class=\"lang-java prettyprint-override\"><code>requestor.getRequestFlux().filter(a -&gt; a.argType() == getSelectorType()).filter(argumentRequest1 -&gt; !argumentRequest1.isHandled()).take(1).subscribe(a -&gt; {\n            a.setHandled();\n            a.consumer().success(provided);\n        });\n</code></pre>\n<p>Now I have two spells:</p>\n<ol>\n<li>one 'selector' spell which submits a <code>Vector2</code> for the position of the mouse called <code>MousePosSelector</code></li>\n<li>one spell which requests a <code>Vector2</code> instance called <code>TeleportSpell</code></li>\n</ol>\n<p>The wanted behavior is as follows;</p>\n<ul>\n<li>If the teleport spell is called before the selector, a new instance of <code>ArgumentRequest</code> is created and put into the flux, it will wait there in the <code>repeat()</code> queue for either three seconds or until it has been followed up by 5 new requests, the selector will then subscibe, and if on time will, through <code>take(1)</code>, find this request and fulfill it, thus sending the Mono out to the teleport spell.</li>\n<li>If the teleport spell is called after the selector, the selector will already have subscribed and will receive the ArgumentRequest directly.</li>\n</ul>\n<p>Currently only the last scenario works, however, to double-check I've run the following unit test. This emulates the first scenario with a 700 ms delay between calls.</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @Test\n    void checkArguments() throws InterruptedException {\n        Random random = new Random();\n        for (int i = 0; i &lt; 10; i++) {\n            int x = random.nextInt();\n            int y = random.nextInt();\n            Mono&lt;Vector2&gt; mono = quantaMain.argumentRequestor.get(ArgumentRequestor.ArgType.VECTOR2);\n            AtomicBoolean flag = new AtomicBoolean(false);\n            mono.subscribe(vector2 -&gt; {\n                System.out.println(&quot;Vector found: X=&quot; + vector2.getX() + &quot;; Y=&quot; + vector2.getY());\n                Assertions.assertEquals(vector2.getX(), x);\n                Assertions.assertEquals(vector2.getY(), y);\n                flag.set(true);\n            });\n            Thread.sleep(700);\n            quantaMain.argumentRequestor.getRequestFlux().filter(a -&gt; a.argType() == ArgumentRequestor.ArgType.VECTOR2).filter(argumentRequest1 -&gt; !argumentRequest1.isHandled()).take(1).subscribe(argumentRequest -&gt; {\n                        argumentRequest.setHandled();\n                        argumentRequest.consumer().success(new Vector2(x, y));\n                    });\n            Assertions.assertTrue(flag.get());\n        }\n    }\n</code></pre>\n<p>In this test case it works perfectly fine for any delay below 3000ms, this has only confused me further.\nSome observations:</p>\n<ul>\n<li>This test is runned without initializing libGDX/LWJGL</li>\n<li>The first situation does work when I wait for about a second or two</li>\n<li>The first situation works the second time the selector spell is ran</li>\n<li>If the first situation is executed a second time directly after a 'succesfull' case with the selector being ran twice, the first situation only works after running the selector thrice.</li>\n<li>If the first situation is then done again it requires the selector to be ran four times.</li>\n</ul>\n<p>Does anyone know what I'm doing wrong / could be going wrong with this code? Just some tips for debugging would be greatly appreciated, since I've been stuck on this for a week now :(</p>\n"},{"tags":["java","reactjs","spring","jboss","web.xml"],"comments":[{"owner":{"account_id":24440940,"reputation":3132,"user_id":18364656,"display_name":"Andrei Lisa"},"score":0,"creation_date":1701115688,"post_id":77559630,"comment_id":136732884,"body_markdown":"Can you share what you have and what you want to change it will more relevant ?","body":"Can you share what you have and what you want to change it will more relevant ?"}],"owner":{"account_id":27171213,"reputation":31,"user_id":20707849,"display_name":"Franco Moyano"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":22,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"answer_count":0,"score":1,"last_activity_date":1701118597,"creation_date":1701115489,"question_id":77559630,"body_markdown":"I have a Java app with a React app embbebed in the same maven project. I want to block specific routes from frontend (eg: examplehost.com/#/dashboard) with web.xml security constraints but I can&#39;t.\r\n\r\nNow I have an ingress role, assigned to all routes &quot;/*&quot;, so if you have this permission, you have access to all the entire app. I want to keep this role, but restricting another specific routes. Is it possible?\r\n\r\nsecurity constrant of ingress:\r\n\r\n    &lt;security-constraint&gt;\r\n    \t\t&lt;web-resource-collection&gt;\r\n    \t\t\t&lt;web-resource-name&gt;ROOT&lt;/web-resource-name&gt;\r\n    \t\t\t&lt;url-pattern&gt;/*&lt;/url-pattern&gt;\r\n    \t\t\t&lt;http-method&gt;GET&lt;/http-method&gt;\r\n    \t\t\t&lt;http-method&gt;POST&lt;/http-method&gt;\r\n    \t\t\t&lt;http-method&gt;PUT&lt;/http-method&gt;\r\n    \t\t\t&lt;http-method&gt;DELETE&lt;/http-method&gt;\r\n    \t\t&lt;/web-resource-collection&gt;\r\n    \t\t&lt;auth-constraint&gt;\r\n    \t\t\t&lt;role-name&gt;INGRESS_ROLE&lt;/role-name&gt;\r\n    \t\t&lt;/auth-constraint&gt;\r\n    \t&lt;/security-constraint&gt;\r\n    \r\n    \t&lt;security-role&gt;\r\n    \t\t&lt;description&gt;Permiso de acceso a la aplicaci&#243;n&lt;/description&gt;\r\n    \t\t&lt;role-name&gt;INGRESS_ROLE&lt;/role-name&gt;\r\n    \t&lt;/security-role&gt;\r\n\r\nIn words of chatGPT: Unfortunately, the security restrictions in the web.xml file are not directly applicable to URL fragments that include the # (hash) character. The URL fragment (everything after the #) is not sent to the server and is therefore not visible on the server side. The part after # is rendered only in the client&#39;s browser.","title":"Deny access to specfic route in web.xml - Java","body":"<p>I have a Java app with a React app embbebed in the same maven project. I want to block specific routes from frontend (eg: examplehost.com/#/dashboard) with web.xml security constraints but I can't.</p>\n<p>Now I have an ingress role, assigned to all routes &quot;/*&quot;, so if you have this permission, you have access to all the entire app. I want to keep this role, but restricting another specific routes. Is it possible?</p>\n<p>security constrant of ingress:</p>\n<pre><code>&lt;security-constraint&gt;\n        &lt;web-resource-collection&gt;\n            &lt;web-resource-name&gt;ROOT&lt;/web-resource-name&gt;\n            &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n            &lt;http-method&gt;GET&lt;/http-method&gt;\n            &lt;http-method&gt;POST&lt;/http-method&gt;\n            &lt;http-method&gt;PUT&lt;/http-method&gt;\n            &lt;http-method&gt;DELETE&lt;/http-method&gt;\n        &lt;/web-resource-collection&gt;\n        &lt;auth-constraint&gt;\n            &lt;role-name&gt;INGRESS_ROLE&lt;/role-name&gt;\n        &lt;/auth-constraint&gt;\n    &lt;/security-constraint&gt;\n\n    &lt;security-role&gt;\n        &lt;description&gt;Permiso de acceso a la aplicación&lt;/description&gt;\n        &lt;role-name&gt;INGRESS_ROLE&lt;/role-name&gt;\n    &lt;/security-role&gt;\n</code></pre>\n<p>In words of chatGPT: Unfortunately, the security restrictions in the web.xml file are not directly applicable to URL fragments that include the # (hash) character. The URL fragment (everything after the #) is not sent to the server and is therefore not visible on the server side. The part after # is rendered only in the client's browser.</p>\n"},{"tags":["java","multithreading","unit-testing","sockets","mockito"],"comments":[{"owner":{"account_id":1434179,"reputation":5113,"user_id":1355930,"display_name":"Ashley Frieze"},"score":1,"creation_date":1478421638,"post_id":40414930,"comment_id":68140905,"body_markdown":"mockServerSocket = mock(ServerSocket.class);     try when(mockServerSocket.accept()).thenReturn(mockTestClientSocket);    . . . mockTestClientSocket = mock(Socket.class);.... you are defining the client socket mock after you tell Mockito to return it. So the reference that&#39;s returned is not the one you expect. Reverse these two and try again.","body":"mockServerSocket = mock(ServerSocket.class);     try when(mockServerSocket.accept()).thenReturn(mockTestClientSoc&zwnj;&#8203;ket);    . . . mockTestClientSocket = mock(Socket.class);.... you are defining the client socket mock after you tell Mockito to return it. So the reference that&#39;s returned is not the one you expect. Reverse these two and try again."},{"owner":{"account_id":9443335,"reputation":15252,"user_id":7023245,"accept_rate":25,"display_name":"Timothy Truckle"},"score":0,"creation_date":1478427981,"post_id":40414930,"comment_id":68142270,"body_markdown":"I agree with @AshleyFrieze that this is your main problem, but if that still does not change the behavior of the mocked socket try the other syntax: ` doReturn(oStream).when(mockTestClientSocket ) .getOutputStream() ;` (mind the moved closing brace from behind the method call to before the dot.) when mocking abstract or real classes (and not interfaces) the `when().thenReturn()` form sometimes calls the real method and fakes the result. The `doReturn().when()` form does never call the real method.","body":"I agree with @AshleyFrieze that this is your main problem, but if that still does not change the behavior of the mocked socket try the other syntax: ` doReturn(oStream).when(mockTestClientSocket ) .getOutputStream() ;` (mind the moved closing brace from behind the method call to before the dot.) when mocking abstract or real classes (and not interfaces) the <code>when().thenReturn()</code> form sometimes calls the real method and fakes the result. The <code>doReturn().when()</code> form does never call the real method."},{"owner":{"account_id":97334,"reputation":1843,"user_id":264069,"accept_rate":86,"display_name":"Gunith D"},"score":0,"creation_date":1478490689,"post_id":40414930,"comment_id":68160565,"body_markdown":"Is this problem solved? I&#39;m asking since you have marked @nicholas&#39;s answer as accepted, but since the bounty is still open","body":"Is this problem solved? I&#39;m asking since you have marked @nicholas&#39;s answer as accepted, but since the bounty is still open"},{"owner":{"account_id":6407608,"reputation":1290,"user_id":4968294,"accept_rate":93,"display_name":"karobar"},"score":0,"creation_date":1478490942,"post_id":40414930,"comment_id":68160631,"body_markdown":"Yes, Nicolas&#39; answer was the advice I needed to get this test working. There&#39;s still a waiting period on the bounty award.","body":"Yes, Nicolas&#39; answer was the advice I needed to get this test working. There&#39;s still a waiting period on the bounty award."}],"answers":[{"tags":[],"owner":{"account_id":2269593,"reputation":43917,"user_id":1997376,"accept_rate":100,"display_name":"Nicolas Filotto"},"comment_count":0,"down_vote_count":0,"up_vote_count":6,"is_accepted":true,"score":6,"last_activity_date":1478459709,"creation_date":1478459709,"answer_id":40453432,"question_id":40414930,"body_markdown":"I could make your unit test pass by modifying 2 things in your code:\r\n\r\n### 1. Mock `mockServerSocket.accept()` properly\r\n\r\nUp to now, you mock `mockServerSocket.accept()` too early because `mockTestClientSocket` has not yet been set so it will return `null`, you need to set it first so your code should rather be:\r\n\r\n    mockServerSocket = mock(ServerSocket.class);\r\n    // Set it first\r\n    mockTestClientSocket = mock(Socket.class);\r\n\r\n    try {\r\n        // Then mock it\r\n        when(mockServerSocket.accept()).thenReturn(mockTestClientSocket);\r\n    } catch (IOException e) {\r\n        fail(e.getMessage());\r\n    }\r\n    ...\r\n\r\n### 2. Synchronize your threads properly\r\n\r\nAs you launch a dedicated thread to manage your client socket, you need to synchronize your threads in order to make sure that your message will be ready to be read.\r\n\r\n**To do this you could:**\r\n\r\n 1. Simplify your code by calling `reader.readLine()` but it is a **blocking** approach since your current thread will wait as long as it is needed for the other thread to write the line (the message here).\r\n\r\n*The code could be:*\r\n\r\n    BufferedReader reader = ...\r\n\r\n    String receivedMessage = reader.readLine();\r\n    assertEquals(&quot;Hello, world!&quot;, receivedMessage);\r\n    mockTestClientSocket.close();\r\n    connection.closeSocket();\r\n\r\n 2. Set a value for `TIMEOUT_TIME` big enough even exaggeratedly big to make sure that the other thread will be ready, so for example as it is a value in nanoseconds, you could set it to `30` seconds so to `30_000_000_000L`. If you don&#39;t set a value big enough, your test could be unstable in slow and/or overloaded and/or shared system such as server used for continuous integration.\r\n","title":"Mocking a server-client connection with Mockito","body":"<p>I could make your unit test pass by modifying 2 things in your code:</p>\n\n<h3>1. Mock <code>mockServerSocket.accept()</code> properly</h3>\n\n<p>Up to now, you mock <code>mockServerSocket.accept()</code> too early because <code>mockTestClientSocket</code> has not yet been set so it will return <code>null</code>, you need to set it first so your code should rather be:</p>\n\n<pre><code>mockServerSocket = mock(ServerSocket.class);\n// Set it first\nmockTestClientSocket = mock(Socket.class);\n\ntry {\n    // Then mock it\n    when(mockServerSocket.accept()).thenReturn(mockTestClientSocket);\n} catch (IOException e) {\n    fail(e.getMessage());\n}\n...\n</code></pre>\n\n<h3>2. Synchronize your threads properly</h3>\n\n<p>As you launch a dedicated thread to manage your client socket, you need to synchronize your threads in order to make sure that your message will be ready to be read.</p>\n\n<p><strong>To do this you could:</strong></p>\n\n<ol>\n<li>Simplify your code by calling <code>reader.readLine()</code> but it is a <strong>blocking</strong> approach since your current thread will wait as long as it is needed for the other thread to write the line (the message here).</li>\n</ol>\n\n<p><em>The code could be:</em></p>\n\n<pre><code>BufferedReader reader = ...\n\nString receivedMessage = reader.readLine();\nassertEquals(\"Hello, world!\", receivedMessage);\nmockTestClientSocket.close();\nconnection.closeSocket();\n</code></pre>\n\n<ol start=\"2\">\n<li>Set a value for <code>TIMEOUT_TIME</code> big enough even exaggeratedly big to make sure that the other thread will be ready, so for example as it is a value in nanoseconds, you could set it to <code>30</code> seconds so to <code>30_000_000_000L</code>. If you don't set a value big enough, your test could be unstable in slow and/or overloaded and/or shared system such as server used for continuous integration.</li>\n</ol>\n"}],"owner":{"account_id":6407608,"reputation":1290,"user_id":4968294,"accept_rate":93,"display_name":"karobar"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":19205,"favorite_count":0,"down_vote_count":0,"up_vote_count":11,"accepted_answer_id":40453432,"answer_count":1,"score":11,"last_activity_date":1701118258,"creation_date":1478230928,"question_id":40414930,"body_markdown":"# Introduction\r\nI&#39;m attempting to test a socket connection by sending a string from one thread to another, where server and client sockets are mocked with Mockito v1.9.5.\r\n\r\nHere&#39;s the test I&#39;m trying to run:\r\n\r\n    @Test\r\n    public void testConnection() {        \r\n        //associate a mock server socket with the TCP Connection\r\n        TcpSocketConnection connection = new TcpSocketConnection(mockServerSocket);\r\n        try {\r\n            //begin thread which listens for clients, then sends &quot;Hello, world&quot; to a connected\r\n            //client.\r\n            connection.listen();\r\n            BufferedReader reader = new BufferedReader(\r\n                new InputStreamReader(mockTestClientSocket.getInputStream(), DEFAULT_CHARSET)\r\n            );\r\n    \r\n            long startTime = System.nanoTime();\r\n            for (long interval = 0;\r\n                    interval &lt; TIMEOUT_TIME;\r\n                    interval = System.nanoTime() - startTime) {\r\n                if (reader.ready()) {\r\n                    String receivedMessage = reader.readLine();\r\n                    assertEquals(&quot;Hello, world!&quot;, receivedMessage);\r\n                    mockTestClientSocket.close();\r\n                    connection.closeSocket();\r\n                    return;\r\n                }\r\n            }\r\n            mockTestClientSocket.close();\r\n            connection.closeSocket();\r\n            fail(&quot;Failed to receive message.&quot;);\r\n        } catch (IOException e) {\r\n            fail(e.getMessage());\r\n        }\r\n    }\r\n\r\nThe test runs until `TIMEOUT_TIME` and then the assertion that fails is the `&quot;Failed to receive message.&quot;`\r\nI specify the behavior of the mocked objects here:\r\n\r\n    @Before\r\n    public void setup() {\r\n        mockServerSocket = mock(ServerSocket.class);\r\n        try {\r\n            when(mockServerSocket.accept()).thenReturn(mockTestClientSocket);\r\n        } catch (IOException e) {\r\n            fail(e.getMessage());\r\n        }\r\n\r\n        mockTestClientSocket = mock(Socket.class);\r\n        try {\r\n            PipedOutputStream oStream = new PipedOutputStream();\r\n            when(mockTestClientSocket.getOutputStream()).thenReturn(oStream);\r\n\r\n            PipedInputStream iStream = new PipedInputStream(oStream);\r\n            when(mockTestClientSocket.getInputStream()).thenReturn(iStream);\r\n\r\n            when(mockTestClientSocket.isClosed()).thenReturn(false);\r\n        } catch (IOException e) {\r\n            fail(e.getMessage());\r\n        }\r\n    }\r\n\r\nPart of what I&#39;m trying to test is the following `run()` within an inner class which is kicked off in the `connection.listen()`:\r\n\r\n    class InnerListenerClass implements Runnable {\r\n        @Override\r\n        public void run() {\r\n            try {\r\n                clientSocket = socket.accept();\r\n                writer = new OutputStreamWriter(\r\n                   clientSocket.getOutputStream(), DEFAULT_CHARSETNAME);\r\n                out = new PrintWriter(writer, true);\r\n                while (!clientSocket.isClosed()) {\r\n                    out.println(&quot;Hello, world!&quot;);\r\n                    Thread.sleep(MILLIS_BETWEEN_MESSAGES);\r\n                }\r\n            } catch (InterruptedException | IOException e) {\r\n                LOG.debug(e.getMessage());\r\n            }\r\n        }\r\n\r\n        public InnerListenerClass(final ServerSocket socket) {\r\n            this.socket = socket;\r\n        } \r\n    }\r\n  \r\nAnd here&#39;s a portion of the `TcpSocketConnection.java`:\r\n\r\n    class TcpSocketConnection() {\r\n        public TcpSocketConnection(final ServerSocket serverSocket) {\r\n            checkNotNull(serverSocket);\r\n            this.serverSocket = serverSocket;\r\n        }\r\n        ...\r\n        public final void listen() throws IOException {\r\n            listenerThread = new Thread(new InnerListenerClass(serverSocket));\r\n            listenerThread.start();\r\n        }\r\n        ...\r\n    }\r\n# How it works in my head\r\n\r\nI&#39;m going to attempt to step through the process of my test to add some extra context to this question. Starting at the beginning of `testConnection()`:\r\n\r\n    TcpSocketConnection connection = new TcpSocketConnection(mockServerSocket);\r\n\r\nThis creates a connection with a mocked ServerSocket associated with it. This creates a thread which kicks off with the following line:   \r\n    \r\n    clientSocket = socket.accept();\r\n\r\nsince `socket` above is a reference to `mockServerSocket`, Mockito knows to return a reference to a mock Socket called `mockTestClientSocket` because of this line:\r\n\r\n    when(mockServerSocket.accept()).thenReturn(mockTestClientSocket);\r\n\r\nNext is the line below: **_NOTE: I believe this is where my understanding and reality diverge, as I believe based on debugging that this thread is hanging on creating this OutputStreamWriter object. I haven&#39;t figured out why._**\r\n\r\n    writer = new OutputStreamWriter(clientSocket.getOutputStream(), DEFAULT_CHARSETNAME);\r\n\r\nMake a new `OutputStreamWriter` given an `OutputStream`. Mockito knows what the output stream of the mocked client socket should look like because of these lines in the `setup` section:\r\n\r\n    PipedOutputStream oStream = new PipedOutputStream();                 \r\n    when(mockTestClientSocket.getOutputStream()).thenReturn(oStream);\r\n\r\nAlso, because the `setup` happens before the test, we know that our InputStream has a reference to this OutputStream because of this line:\r\n\r\n    PipedInputStream iStream = new PipedInputStream(oStream);\r\n\r\nAccording to the documentation for this constructor, This _&quot;Creates a PipedInputStream so that it is connected to the piped output stream \\(oStream). Data bytes written to (oStream) will then be available as input from this stream.&quot;_\r\n\r\nThe while loop in `run()` begins and causes &quot;Hello, world!&quot; to be sent out the OutputStream (and also received by the InputStream).\r\nNext, we wrap up the inputStream nicely:\r\n\r\n    BufferedReader reader = new BufferedReader(new InputStreamReader(mockTestClientSocket.getInputStream(), DEFAULT_CHARSET)); \r\n\r\nBy the magic of Mockito, the `mockTestClientSocket.getInputStream()` call actually returns the `iStream` from earlier, because of the following line:    \r\n\r\n    when(mockTestClientSocket.getInputStream()).thenReturn(iStream);   \r\n\r\nSo now we have a reader with an input stream, and that input stream is hooked up to an output stream. That output stream is hooked up to a `PrintWriter` which is `println`ing &quot;Hello,world!&quot;s. However, the reader never seems to even get `ready()`.   \r\n\r\n# Question\r\n_Why is the created listener thread hanging during creation of an `OutputStreamWriter`, and how can my `Hello, World!` string get sent properly from mocked socket to mocked client?_","title":"Mocking a server-client connection with Mockito","body":"<h1>Introduction</h1>\n<p>I'm attempting to test a socket connection by sending a string from one thread to another, where server and client sockets are mocked with Mockito v1.9.5.</p>\n<p>Here's the test I'm trying to run:</p>\n<pre><code>@Test\npublic void testConnection() {        \n    //associate a mock server socket with the TCP Connection\n    TcpSocketConnection connection = new TcpSocketConnection(mockServerSocket);\n    try {\n        //begin thread which listens for clients, then sends &quot;Hello, world&quot; to a connected\n        //client.\n        connection.listen();\n        BufferedReader reader = new BufferedReader(\n            new InputStreamReader(mockTestClientSocket.getInputStream(), DEFAULT_CHARSET)\n        );\n\n        long startTime = System.nanoTime();\n        for (long interval = 0;\n                interval &lt; TIMEOUT_TIME;\n                interval = System.nanoTime() - startTime) {\n            if (reader.ready()) {\n                String receivedMessage = reader.readLine();\n                assertEquals(&quot;Hello, world!&quot;, receivedMessage);\n                mockTestClientSocket.close();\n                connection.closeSocket();\n                return;\n            }\n        }\n        mockTestClientSocket.close();\n        connection.closeSocket();\n        fail(&quot;Failed to receive message.&quot;);\n    } catch (IOException e) {\n        fail(e.getMessage());\n    }\n}\n</code></pre>\n<p>The test runs until <code>TIMEOUT_TIME</code> and then the assertion that fails is the <code>&quot;Failed to receive message.&quot;</code>\nI specify the behavior of the mocked objects here:</p>\n<pre><code>@Before\npublic void setup() {\n    mockServerSocket = mock(ServerSocket.class);\n    try {\n        when(mockServerSocket.accept()).thenReturn(mockTestClientSocket);\n    } catch (IOException e) {\n        fail(e.getMessage());\n    }\n\n    mockTestClientSocket = mock(Socket.class);\n    try {\n        PipedOutputStream oStream = new PipedOutputStream();\n        when(mockTestClientSocket.getOutputStream()).thenReturn(oStream);\n\n        PipedInputStream iStream = new PipedInputStream(oStream);\n        when(mockTestClientSocket.getInputStream()).thenReturn(iStream);\n\n        when(mockTestClientSocket.isClosed()).thenReturn(false);\n    } catch (IOException e) {\n        fail(e.getMessage());\n    }\n}\n</code></pre>\n<p>Part of what I'm trying to test is the following <code>run()</code> within an inner class which is kicked off in the <code>connection.listen()</code>:</p>\n<pre><code>class InnerListenerClass implements Runnable {\n    @Override\n    public void run() {\n        try {\n            clientSocket = socket.accept();\n            writer = new OutputStreamWriter(\n               clientSocket.getOutputStream(), DEFAULT_CHARSETNAME);\n            out = new PrintWriter(writer, true);\n            while (!clientSocket.isClosed()) {\n                out.println(&quot;Hello, world!&quot;);\n                Thread.sleep(MILLIS_BETWEEN_MESSAGES);\n            }\n        } catch (InterruptedException | IOException e) {\n            LOG.debug(e.getMessage());\n        }\n    }\n\n    public InnerListenerClass(final ServerSocket socket) {\n        this.socket = socket;\n    } \n}\n</code></pre>\n<p>And here's a portion of the <code>TcpSocketConnection.java</code>:</p>\n<pre><code>class TcpSocketConnection() {\n    public TcpSocketConnection(final ServerSocket serverSocket) {\n        checkNotNull(serverSocket);\n        this.serverSocket = serverSocket;\n    }\n    ...\n    public final void listen() throws IOException {\n        listenerThread = new Thread(new InnerListenerClass(serverSocket));\n        listenerThread.start();\n    }\n    ...\n}\n</code></pre>\n<h1>How it works in my head</h1>\n<p>I'm going to attempt to step through the process of my test to add some extra context to this question. Starting at the beginning of <code>testConnection()</code>:</p>\n<pre><code>TcpSocketConnection connection = new TcpSocketConnection(mockServerSocket);\n</code></pre>\n<p>This creates a connection with a mocked ServerSocket associated with it. This creates a thread which kicks off with the following line:</p>\n<pre><code>clientSocket = socket.accept();\n</code></pre>\n<p>since <code>socket</code> above is a reference to <code>mockServerSocket</code>, Mockito knows to return a reference to a mock Socket called <code>mockTestClientSocket</code> because of this line:</p>\n<pre><code>when(mockServerSocket.accept()).thenReturn(mockTestClientSocket);\n</code></pre>\n<p>Next is the line below: <strong><em>NOTE: I believe this is where my understanding and reality diverge, as I believe based on debugging that this thread is hanging on creating this OutputStreamWriter object. I haven't figured out why.</em></strong></p>\n<pre><code>writer = new OutputStreamWriter(clientSocket.getOutputStream(), DEFAULT_CHARSETNAME);\n</code></pre>\n<p>Make a new <code>OutputStreamWriter</code> given an <code>OutputStream</code>. Mockito knows what the output stream of the mocked client socket should look like because of these lines in the <code>setup</code> section:</p>\n<pre><code>PipedOutputStream oStream = new PipedOutputStream();                 \nwhen(mockTestClientSocket.getOutputStream()).thenReturn(oStream);\n</code></pre>\n<p>Also, because the <code>setup</code> happens before the test, we know that our InputStream has a reference to this OutputStream because of this line:</p>\n<pre><code>PipedInputStream iStream = new PipedInputStream(oStream);\n</code></pre>\n<p>According to the documentation for this constructor, This <em>&quot;Creates a PipedInputStream so that it is connected to the piped output stream (oStream). Data bytes written to (oStream) will then be available as input from this stream.&quot;</em></p>\n<p>The while loop in <code>run()</code> begins and causes &quot;Hello, world!&quot; to be sent out the OutputStream (and also received by the InputStream).\nNext, we wrap up the inputStream nicely:</p>\n<pre><code>BufferedReader reader = new BufferedReader(new InputStreamReader(mockTestClientSocket.getInputStream(), DEFAULT_CHARSET)); \n</code></pre>\n<p>By the magic of Mockito, the <code>mockTestClientSocket.getInputStream()</code> call actually returns the <code>iStream</code> from earlier, because of the following line:</p>\n<pre><code>when(mockTestClientSocket.getInputStream()).thenReturn(iStream);   \n</code></pre>\n<p>So now we have a reader with an input stream, and that input stream is hooked up to an output stream. That output stream is hooked up to a <code>PrintWriter</code> which is <code>println</code>ing &quot;Hello,world!&quot;s. However, the reader never seems to even get <code>ready()</code>.</p>\n<h1>Question</h1>\n<p><em>Why is the created listener thread hanging during creation of an <code>OutputStreamWriter</code>, and how can my <code>Hello, World!</code> string get sent properly from mocked socket to mocked client?</em></p>\n"},{"tags":["java"],"comments":[{"owner":{"account_id":31180,"reputation":29173,"user_id":85421,"display_name":"user85421"},"score":3,"creation_date":1701117922,"post_id":77559801,"comment_id":136733247,"body_markdown":"check the `main` method - it is just printing the input array, not the result - you want to print the array returned by `mergeSort()` || BTW posted code will probably fail if the array values are not unique (i.e. array contains duplicates)","body":"check the <code>main</code> method - it is just printing the input array, not the result - you want to print the array returned by <code>mergeSort()</code> || BTW posted code will probably fail if the array values are not unique (i.e. array contains duplicates)"}],"answers":[{"tags":[],"owner":{"account_id":22007364,"reputation":151,"user_id":16278120,"display_name":"Roophie"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1701118051,"creation_date":1701118051,"answer_id":77559854,"question_id":77559801,"body_markdown":"Try this:\r\n\r\n        int[] b = mergeSort(a);\r\n        System.out.println(Arrays.toString(b));\r\n\r\nThe reason is your merge method copies your data to new array for sorting and returns that new array,\r\nyou are not doing it `in place` ","title":"Recursive merge sort isn&#39;t sorting the array","body":"<p>Try this:</p>\n<pre><code>    int[] b = mergeSort(a);\n    System.out.println(Arrays.toString(b));\n</code></pre>\n<p>The reason is your merge method copies your data to new array for sorting and returns that new array,\nyou are not doing it <code>in place</code></p>\n"}],"owner":{"account_id":30007250,"reputation":1,"user_id":22995798,"display_name":"kim19"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":37,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701118051,"creation_date":1701117418,"question_id":77559801,"body_markdown":"I&#39;m trying to implement the merge sort algorithm using recursion. I&#39;m not sure what the issue with my code is. It returns the original array without sorting it.\r\n\r\n```\r\npublic static int[] mergeSort(int[] a) {\r\n        if(a.length &lt; 2){\r\n            return a;\r\n        }\r\n        int start = 0;\r\n        int middle = a.length / 2;\r\n        int end = a.length;\r\n        //split the array \r\n        int[] left = mergeSort(Arrays.copyOfRange(a, start, middle));\r\n        int[] right = mergeSort(Arrays.copyOfRange(a, middle, end));\r\n\r\n        //merge them\r\n        return merge(left, right);\r\n    }\r\n\r\n    public static int[] merge(int[] a, int[] b) {\r\n        int indexa = 0; int indexb = 0; int i =0;\r\n        //create new array with combined length\r\n        int[] c = new int[a.length + b.length];\r\n        //copy elements to new array while sorting it\r\n        while (indexa &lt; a.length &amp;&amp; indexb &lt; b.length) {\r\n            if (a[indexa] &lt; b[indexb]) {\r\n                c[i++] = a[indexa++];\r\n            } else if (a[indexa] &gt; b[indexb]){\r\n                c[i++] = b[indexb++];\r\n            }\r\n        }\r\n\r\n        //if one array is longer than the other copy remaining elements\r\n        while (indexa &lt; a.length) {\r\n                c[i++] = a[indexa++];\r\n\r\n        }\r\n        while (indexb &lt; b.length) {\r\n                c[i++] = b[indexb++];\r\n            }\r\n        return c;\r\n\r\n    }\r\n```\r\n\r\nHere&#39;s my main method as well\r\n\r\n```\r\npublic static void main(String[] args) {\r\n        int[] a = {2, 1, 3, 4, 9, 6, 7};\r\n        mergeSort(a);\r\n        System.out.println(Arrays.toString(a));\r\n\r\n\r\n    }\r\n```\r\n\r\nAny kind of help would be appreciated. Thank you!","title":"Recursive merge sort isn&#39;t sorting the array","body":"<p>I'm trying to implement the merge sort algorithm using recursion. I'm not sure what the issue with my code is. It returns the original array without sorting it.</p>\n<pre><code>public static int[] mergeSort(int[] a) {\n        if(a.length &lt; 2){\n            return a;\n        }\n        int start = 0;\n        int middle = a.length / 2;\n        int end = a.length;\n        //split the array \n        int[] left = mergeSort(Arrays.copyOfRange(a, start, middle));\n        int[] right = mergeSort(Arrays.copyOfRange(a, middle, end));\n\n        //merge them\n        return merge(left, right);\n    }\n\n    public static int[] merge(int[] a, int[] b) {\n        int indexa = 0; int indexb = 0; int i =0;\n        //create new array with combined length\n        int[] c = new int[a.length + b.length];\n        //copy elements to new array while sorting it\n        while (indexa &lt; a.length &amp;&amp; indexb &lt; b.length) {\n            if (a[indexa] &lt; b[indexb]) {\n                c[i++] = a[indexa++];\n            } else if (a[indexa] &gt; b[indexb]){\n                c[i++] = b[indexb++];\n            }\n        }\n\n        //if one array is longer than the other copy remaining elements\n        while (indexa &lt; a.length) {\n                c[i++] = a[indexa++];\n\n        }\n        while (indexb &lt; b.length) {\n                c[i++] = b[indexb++];\n            }\n        return c;\n\n    }\n</code></pre>\n<p>Here's my main method as well</p>\n<pre><code>public static void main(String[] args) {\n        int[] a = {2, 1, 3, 4, 9, 6, 7};\n        mergeSort(a);\n        System.out.println(Arrays.toString(a));\n\n\n    }\n</code></pre>\n<p>Any kind of help would be appreciated. Thank you!</p>\n"},{"tags":["java","spring","spring-boot","prometheus","spring-micrometer"],"answers":[{"comments":[{"owner":{"account_id":18586978,"reputation":2220,"user_id":15000097,"display_name":"Georgii Lvov"},"score":0,"creation_date":1700737255,"post_id":76460290,"comment_id":136692479,"body_markdown":"could you give an example pls?","body":"could you give an example pls?"},{"owner":{"account_id":6878179,"reputation":4558,"user_id":5285908,"display_name":"Amith Kumar"},"score":0,"creation_date":1701117711,"post_id":76460290,"comment_id":136733200,"body_markdown":"@GeorgiiLvov - I have added the link to the github source code since the medium blog is behind a paywall for medium non-members.","body":"@GeorgiiLvov - I have added the link to the github source code since the medium blog is behind a paywall for medium non-members."}],"tags":[],"owner":{"account_id":6878179,"reputation":4558,"user_id":5285908,"display_name":"Amith Kumar"},"comment_count":2,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701117624,"creation_date":1686603538,"answer_id":76460290,"question_id":73374978,"body_markdown":"You can use the `@NewSpan` annotation. This way will have the full controller execution time as well as break down of the @Async service execution time.\r\n\r\n**NOTE:**\r\n&lt;br&gt;\r\nWith Spring Boot 3.1.0 and Micrometer 1.10.0+, you can follow this [blog](https://medium.com/@amithkumarg/micrometer-tracing-in-spring-boot-context-propagation-for-async-scheduled-newspan-b80f4f4b2c9f) which guides you with the minimum setup required to enable Micrometer annotations with Spring Boot.\r\n\r\nThese [Medium](https://medium.com/) blog(s) are behind a paywall. If you are not already a member, no need to (pay) signup, you can directly find the source code here.\r\n\r\nhttps://github.com/amithkumarg/springboot-otel-micrometer-jaeger","title":"How to use Micrometer to measure the duration of an async method called from a controller method","body":"<p>You can use the <code>@NewSpan</code> annotation. This way will have the full controller execution time as well as break down of the @Async service execution time.</p>\n<p><strong>NOTE:</strong>\n<br>\nWith Spring Boot 3.1.0 and Micrometer 1.10.0+, you can follow this <a href=\"https://medium.com/@amithkumarg/micrometer-tracing-in-spring-boot-context-propagation-for-async-scheduled-newspan-b80f4f4b2c9f\" rel=\"nofollow noreferrer\">blog</a> which guides you with the minimum setup required to enable Micrometer annotations with Spring Boot.</p>\n<p>These <a href=\"https://medium.com/\" rel=\"nofollow noreferrer\">Medium</a> blog(s) are behind a paywall. If you are not already a member, no need to (pay) signup, you can directly find the source code here.</p>\n<p><a href=\"https://github.com/amithkumarg/springboot-otel-micrometer-jaeger\" rel=\"nofollow noreferrer\">https://github.com/amithkumarg/springboot-otel-micrometer-jaeger</a></p>\n"}],"owner":{"account_id":18586978,"reputation":2220,"user_id":15000097,"display_name":"Georgii Lvov"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":573,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"answer_count":1,"score":1,"last_activity_date":1701117624,"creation_date":1660657276,"question_id":73374978,"body_markdown":"I have to measure the full time of the request, that comes into controller and then the async method is executed  of some service:\r\n\r\n    @RestController\r\n    public class HelloController {\r\n    \r\n        @Autowired\r\n        private SomeService someService;\r\n    \r\n\r\n        @GetMapping(&quot;/async&quot;)\r\n        @Timed(value = &quot;async.method.time&quot;, description = &quot;Time taken to execute async method&quot;)\r\n        public void async() throws InterruptedException {\r\n            Thread.sleep(2000);\r\n    \r\n            someService.executeAsync();\r\n        }\r\n    }\r\n\r\n    @Service\r\n    public class SomeService {\r\n    \r\n        @Async\r\n        public void executeAsync() throws InterruptedException {\r\n            Thread.sleep(2000);\r\n            System.out.println(&quot;Async execution done!&quot;);\r\n        }\r\n    }\r\n\r\nActually, if I put the `@Timed` annotation above the async service method, then it will be measured correct, but I would like to measure the time with controller method too. How can I achieve this using Micrometer?\r\n\r\nThanks in advance!","title":"How to use Micrometer to measure the duration of an async method called from a controller method","body":"<p>I have to measure the full time of the request, that comes into controller and then the async method is executed  of some service:</p>\n<pre><code>@RestController\npublic class HelloController {\n\n    @Autowired\n    private SomeService someService;\n\n\n    @GetMapping(&quot;/async&quot;)\n    @Timed(value = &quot;async.method.time&quot;, description = &quot;Time taken to execute async method&quot;)\n    public void async() throws InterruptedException {\n        Thread.sleep(2000);\n\n        someService.executeAsync();\n    }\n}\n\n@Service\npublic class SomeService {\n\n    @Async\n    public void executeAsync() throws InterruptedException {\n        Thread.sleep(2000);\n        System.out.println(&quot;Async execution done!&quot;);\n    }\n}\n</code></pre>\n<p>Actually, if I put the <code>@Timed</code> annotation above the async service method, then it will be measured correct, but I would like to measure the time with controller method too. How can I achieve this using Micrometer?</p>\n<p>Thanks in advance!</p>\n"},{"tags":["java","spring","hibernate"],"comments":[{"owner":{"account_id":9531412,"reputation":2010,"user_id":7082956,"display_name":"Valerij Dobler"},"score":0,"creation_date":1701118881,"post_id":77559808,"comment_id":136733378,"body_markdown":"Why do you want to have a bidirectional mapping Film &lt;-&gt; User?","body":"Why do you want to have a bidirectional mapping Film &lt;-&gt; User?"},{"owner":{"account_id":9531412,"reputation":2010,"user_id":7082956,"display_name":"Valerij Dobler"},"score":0,"creation_date":1701119011,"post_id":77559808,"comment_id":136733401,"body_markdown":"I would think that Films don&#39;t need to hold the whole user to it. Maybe should have a Reservation that references a Film and the User by both of their ID.","body":"I would think that Films don&#39;t need to hold the whole user to it. Maybe should have a Reservation that references a Film and the User by both of their ID."},{"owner":{"account_id":30007105,"reputation":1,"user_id":22995702,"display_name":"Fatia"},"score":0,"creation_date":1701120899,"post_id":77559808,"comment_id":136733649,"body_markdown":"@ValerijDobler, I have a UserFilm class that has Film and User objects that refer to an ID, but I didn&#39;t know how to use it if I could make a many-to-many relationship.\nI will try to do it.","body":"@ValerijDobler, I have a UserFilm class that has Film and User objects that refer to an ID, but I didn&#39;t know how to use it if I could make a many-to-many relationship. I will try to do it."},{"owner":{"account_id":1434762,"reputation":22772,"user_id":1356423,"accept_rate":65,"display_name":"Alan Hay"},"score":0,"creation_date":1701124658,"post_id":77559808,"comment_id":136734150,"body_markdown":"You need to remove the join table from one side and use mappedby. https://docs.jboss.org/hibernate/core/3.6/reference/en-US/html_single/#collections-bidirectional","body":"You need to remove the join table from one side and use mappedby. <a href=\"https://docs.jboss.org/hibernate/core/3.6/reference/en-US/html_single/#collections-bidirectional\" rel=\"nofollow noreferrer\">docs.jboss.org/hibernate/core/3.6/reference/en-US/html_singl&zwnj;&#8203;e/&hellip;</a>"}],"owner":{"account_id":30007105,"reputation":1,"user_id":22995702,"display_name":"Fatia"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":59,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701117528,"creation_date":1701117528,"question_id":77559808,"body_markdown":"I&#39;m learning the Spring framework and doing the server side of the project. I have the following problem:\r\n\r\nI have User and Film entities. They have a many-to-many relationship, that is, a User can select several Films, and a Film can be selected by several Users. When adding a new Film to List&lt;Film&gt; films in User, or deleting it from this list, when using userRepository.save(user) hibernate deletes all films of this user from the user_film table, and inserts a new list. Please tell me how it is possible to add or delete only the film that was added/deleted by request?\r\n\r\nHere is part of the code for the Film collection in User:\r\n```\r\n    @ManyToMany(cascade = CascadeType.ALL)\r\n    @JoinTable(\r\n            name = &quot;user_film&quot;,\r\n            joinColumns = @JoinColumn(name = &quot;uf_user_id&quot;),\r\n            inverseJoinColumns = @JoinColumn(name = &quot;uf_film_id&quot;)\r\n    )\r\n    private List&lt;Film&gt; films;\r\n\r\n    public List&lt;Film&gt; getFilms() {\r\n        return films;\r\n    }\r\n\r\n    public void setFilms(List&lt;Film&gt; films) {\r\n        this.films = films;\r\n    }\r\n```\r\n\r\nHere is part of the code for the User collection in Film:\r\n```\r\n    @ManyToMany(cascade = CascadeType.ALL)\r\n    @JsonIgnore\r\n    @JoinTable(\r\n            name = &quot;user_film&quot;,\r\n            joinColumns = @JoinColumn(name = &quot;uf_film_id&quot;),\r\n            inverseJoinColumns = @JoinColumn(name = &quot;uf_user_id&quot;)\r\n    )\r\n    private List&lt;User&gt; users;\r\n\r\n    public List&lt;User&gt; getUsers() {\r\n        return users;\r\n    }\r\n\r\n    public void setUsers(List&lt;User&gt; users) {\r\n        this.users = users;\r\n    }\r\n```\r\nHere is the code for the functions that add and remove collection elements and store it in the database:\r\n```\r\n    @Transactional\r\n    public UserModel addLikedFilm(Long user_id, Long film_id) {\r\n        Optional&lt;User&gt; foundedUser = userRepository.findById(user_id);\r\n        if(foundedUser.isEmpty()){\r\n            throw new UserNotFoundException(&quot;User not found, wrong ID: &quot; + user_id);\r\n        }\r\n        User user = foundedUser.get();\r\n\r\n        Optional&lt;Film&gt; foundedFilm = filmRepository.findById(film_id);\r\n        if(foundedFilm.isEmpty()){\r\n            throw new FilmNotFoundException(&quot;Film not found, wrong ID: &quot; + film_id);\r\n        }\r\n        Film film = foundedFilm.get();\r\n\r\n        user.getFilms().add(film);\r\n        userRepository.save(user);\r\n\r\n        return UserModel.toModel(user);\r\n    }\r\n\r\n    @Transactional\r\n    public UserModel deleteLikedFilm(Long user_id, Long film_id) {\r\n        Optional&lt;User&gt; foundedUser = userRepository.findById(user_id);\r\n        if(foundedUser.isEmpty()){\r\n            throw new UserNotFoundException(&quot;User not found, wrong ID: &quot; + user_id);\r\n        }\r\n        User user = foundedUser.get();\r\n\r\n        Optional&lt;Film&gt; foundedFilm = filmRepository.findById(film_id);\r\n        if(foundedFilm.isEmpty()){\r\n            throw new FilmNotFoundException(&quot;Film not found, wrong ID: &quot; + film_id);\r\n        }\r\n        Film film = foundedFilm.get();\r\n\r\n        user.getFilms().remove(film);\r\n        userRepository.save(user);\r\n\r\n        return UserModel.toModel(user);\r\n    }\r\n\r\n```\r\nAfter adding 3 films with id 1, 2 and 3 on request, I get this:\r\nAdding film 1:\r\n```\r\nHibernate: select u1_0.user_id,u1_0.birthday,u1_0.gender,case when u1_0.is_admin = 1 then true else false end,u1_0.password,u1_0.registration_date,u1_0.user_email,u1_0.user_name from user u1_0 where u1_0.user_id=?\r\nHibernate: select f1_0.film_id,f1_0.film_desc,f1_0.film_duration_minutes,f1_0.film_imdb_rating,f1_0.film_link,f1_0.film_name,f1_0.film_year,f1_0.image from film f1_0 where f1_0.film_id=?\r\nHibernate: select f1_0.uf_user_id,f1_1.film_id,f1_1.film_desc,f1_1.film_duration_minutes,f1_1.film_imdb_rating,f1_1.film_link,f1_1.film_name,f1_1.film_year,f1_1.image from user_film f1_0 join film f1_1 on f1_1.film_id=f1_0.uf_film_id where f1_0.uf_user_id=?\r\nHibernate: select g1_0.ufg_user_id,g1_1.genre_id,g1_1.genre_name from user_favorite_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.ufg_genre_id where g1_0.ufg_user_id=?\r\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\r\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\r\n```\r\nAdding film 2:\r\n```\r\nHibernate: select u1_0.user_id,u1_0.birthday,u1_0.gender,case when u1_0.is_admin = 1 then true else false end,u1_0.password,u1_0.registration_date,u1_0.user_email,u1_0.user_name from user u1_0 where u1_0.user_id=?\r\nHibernate: select f1_0.film_id,f1_0.film_desc,f1_0.film_duration_minutes,f1_0.film_imdb_rating,f1_0.film_link,f1_0.film_name,f1_0.film_year,f1_0.image from film f1_0 where f1_0.film_id=?\r\nHibernate: select f1_0.uf_user_id,f1_1.film_id,f1_1.film_desc,f1_1.film_duration_minutes,f1_1.film_imdb_rating,f1_1.film_link,f1_1.film_name,f1_1.film_year,f1_1.image from user_film f1_0 join film f1_1 on f1_1.film_id=f1_0.uf_film_id where f1_0.uf_user_id=?\r\nHibernate: select g1_0.ufg_user_id,g1_1.genre_id,g1_1.genre_name from user_favorite_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.ufg_genre_id where g1_0.ufg_user_id=?\r\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\r\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\r\nHibernate: delete from user_film where uf_user_id=?\r\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\r\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\r\n```\r\nAdding film 3:\r\n```\r\nHibernate: select u1_0.user_id,u1_0.birthday,u1_0.gender,case when u1_0.is_admin = 1 then true else false end,u1_0.password,u1_0.registration_date,u1_0.user_email,u1_0.user_name from user u1_0 where u1_0.user_id=?\r\nHibernate: select f1_0.film_id,f1_0.film_desc,f1_0.film_duration_minutes,f1_0.film_imdb_rating,f1_0.film_link,f1_0.film_name,f1_0.film_year,f1_0.image from film f1_0 where f1_0.film_id=?\r\nHibernate: select f1_0.uf_user_id,f1_1.film_id,f1_1.film_desc,f1_1.film_duration_minutes,f1_1.film_imdb_rating,f1_1.film_link,f1_1.film_name,f1_1.film_year,f1_1.image from user_film f1_0 join film f1_1 on f1_1.film_id=f1_0.uf_film_id where f1_0.uf_user_id=?\r\nHibernate: select g1_0.ufg_user_id,g1_1.genre_id,g1_1.genre_name from user_favorite_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.ufg_genre_id where g1_0.ufg_user_id=?\r\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\r\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\r\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\r\nHibernate: delete from user_film where uf_user_id=?\r\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\r\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\r\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\r\n\r\n```\r\n\r\n\r\nI tried changing the cascade type and using EntityManager to save. Maybe I misunderstood something and used it incorrectly, but nothing worked for me.","title":"Before saving a new record, Hibernate deletes all the records of this collection in the database, and then overwrites the new one","body":"<p>I'm learning the Spring framework and doing the server side of the project. I have the following problem:</p>\n<p>I have User and Film entities. They have a many-to-many relationship, that is, a User can select several Films, and a Film can be selected by several Users. When adding a new Film to List films in User, or deleting it from this list, when using userRepository.save(user) hibernate deletes all films of this user from the user_film table, and inserts a new list. Please tell me how it is possible to add or delete only the film that was added/deleted by request?</p>\n<p>Here is part of the code for the Film collection in User:</p>\n<pre><code>    @ManyToMany(cascade = CascadeType.ALL)\n    @JoinTable(\n            name = &quot;user_film&quot;,\n            joinColumns = @JoinColumn(name = &quot;uf_user_id&quot;),\n            inverseJoinColumns = @JoinColumn(name = &quot;uf_film_id&quot;)\n    )\n    private List&lt;Film&gt; films;\n\n    public List&lt;Film&gt; getFilms() {\n        return films;\n    }\n\n    public void setFilms(List&lt;Film&gt; films) {\n        this.films = films;\n    }\n</code></pre>\n<p>Here is part of the code for the User collection in Film:</p>\n<pre><code>    @ManyToMany(cascade = CascadeType.ALL)\n    @JsonIgnore\n    @JoinTable(\n            name = &quot;user_film&quot;,\n            joinColumns = @JoinColumn(name = &quot;uf_film_id&quot;),\n            inverseJoinColumns = @JoinColumn(name = &quot;uf_user_id&quot;)\n    )\n    private List&lt;User&gt; users;\n\n    public List&lt;User&gt; getUsers() {\n        return users;\n    }\n\n    public void setUsers(List&lt;User&gt; users) {\n        this.users = users;\n    }\n</code></pre>\n<p>Here is the code for the functions that add and remove collection elements and store it in the database:</p>\n<pre><code>    @Transactional\n    public UserModel addLikedFilm(Long user_id, Long film_id) {\n        Optional&lt;User&gt; foundedUser = userRepository.findById(user_id);\n        if(foundedUser.isEmpty()){\n            throw new UserNotFoundException(&quot;User not found, wrong ID: &quot; + user_id);\n        }\n        User user = foundedUser.get();\n\n        Optional&lt;Film&gt; foundedFilm = filmRepository.findById(film_id);\n        if(foundedFilm.isEmpty()){\n            throw new FilmNotFoundException(&quot;Film not found, wrong ID: &quot; + film_id);\n        }\n        Film film = foundedFilm.get();\n\n        user.getFilms().add(film);\n        userRepository.save(user);\n\n        return UserModel.toModel(user);\n    }\n\n    @Transactional\n    public UserModel deleteLikedFilm(Long user_id, Long film_id) {\n        Optional&lt;User&gt; foundedUser = userRepository.findById(user_id);\n        if(foundedUser.isEmpty()){\n            throw new UserNotFoundException(&quot;User not found, wrong ID: &quot; + user_id);\n        }\n        User user = foundedUser.get();\n\n        Optional&lt;Film&gt; foundedFilm = filmRepository.findById(film_id);\n        if(foundedFilm.isEmpty()){\n            throw new FilmNotFoundException(&quot;Film not found, wrong ID: &quot; + film_id);\n        }\n        Film film = foundedFilm.get();\n\n        user.getFilms().remove(film);\n        userRepository.save(user);\n\n        return UserModel.toModel(user);\n    }\n\n</code></pre>\n<p>After adding 3 films with id 1, 2 and 3 on request, I get this:\nAdding film 1:</p>\n<pre><code>Hibernate: select u1_0.user_id,u1_0.birthday,u1_0.gender,case when u1_0.is_admin = 1 then true else false end,u1_0.password,u1_0.registration_date,u1_0.user_email,u1_0.user_name from user u1_0 where u1_0.user_id=?\nHibernate: select f1_0.film_id,f1_0.film_desc,f1_0.film_duration_minutes,f1_0.film_imdb_rating,f1_0.film_link,f1_0.film_name,f1_0.film_year,f1_0.image from film f1_0 where f1_0.film_id=?\nHibernate: select f1_0.uf_user_id,f1_1.film_id,f1_1.film_desc,f1_1.film_duration_minutes,f1_1.film_imdb_rating,f1_1.film_link,f1_1.film_name,f1_1.film_year,f1_1.image from user_film f1_0 join film f1_1 on f1_1.film_id=f1_0.uf_film_id where f1_0.uf_user_id=?\nHibernate: select g1_0.ufg_user_id,g1_1.genre_id,g1_1.genre_name from user_favorite_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.ufg_genre_id where g1_0.ufg_user_id=?\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\n</code></pre>\n<p>Adding film 2:</p>\n<pre><code>Hibernate: select u1_0.user_id,u1_0.birthday,u1_0.gender,case when u1_0.is_admin = 1 then true else false end,u1_0.password,u1_0.registration_date,u1_0.user_email,u1_0.user_name from user u1_0 where u1_0.user_id=?\nHibernate: select f1_0.film_id,f1_0.film_desc,f1_0.film_duration_minutes,f1_0.film_imdb_rating,f1_0.film_link,f1_0.film_name,f1_0.film_year,f1_0.image from film f1_0 where f1_0.film_id=?\nHibernate: select f1_0.uf_user_id,f1_1.film_id,f1_1.film_desc,f1_1.film_duration_minutes,f1_1.film_imdb_rating,f1_1.film_link,f1_1.film_name,f1_1.film_year,f1_1.image from user_film f1_0 join film f1_1 on f1_1.film_id=f1_0.uf_film_id where f1_0.uf_user_id=?\nHibernate: select g1_0.ufg_user_id,g1_1.genre_id,g1_1.genre_name from user_favorite_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.ufg_genre_id where g1_0.ufg_user_id=?\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\nHibernate: delete from user_film where uf_user_id=?\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\n</code></pre>\n<p>Adding film 3:</p>\n<pre><code>Hibernate: select u1_0.user_id,u1_0.birthday,u1_0.gender,case when u1_0.is_admin = 1 then true else false end,u1_0.password,u1_0.registration_date,u1_0.user_email,u1_0.user_name from user u1_0 where u1_0.user_id=?\nHibernate: select f1_0.film_id,f1_0.film_desc,f1_0.film_duration_minutes,f1_0.film_imdb_rating,f1_0.film_link,f1_0.film_name,f1_0.film_year,f1_0.image from film f1_0 where f1_0.film_id=?\nHibernate: select f1_0.uf_user_id,f1_1.film_id,f1_1.film_desc,f1_1.film_duration_minutes,f1_1.film_imdb_rating,f1_1.film_link,f1_1.film_name,f1_1.film_year,f1_1.image from user_film f1_0 join film f1_1 on f1_1.film_id=f1_0.uf_film_id where f1_0.uf_user_id=?\nHibernate: select g1_0.ufg_user_id,g1_1.genre_id,g1_1.genre_name from user_favorite_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.ufg_genre_id where g1_0.ufg_user_id=?\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\nHibernate: select g1_0.fg_film_id,g1_1.genre_id,g1_1.genre_name from film_genre g1_0 join genre g1_1 on g1_1.genre_id=g1_0.fg_genre_id where g1_0.fg_film_id=?\nHibernate: delete from user_film where uf_user_id=?\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\nHibernate: insert into user_film (uf_user_id,uf_film_id) values (?,?)\n\n</code></pre>\n<p>I tried changing the cascade type and using EntityManager to save. Maybe I misunderstood something and used it incorrectly, but nothing worked for me.</p>\n"},{"tags":["java","spring","netbeans","wildfly"],"owner":{"account_id":30007295,"reputation":1,"user_id":22995832,"display_name":"Anon_4"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":1,"is_answered":false,"view_count":15,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"answer_count":0,"score":-1,"last_activity_date":1701117188,"creation_date":1701117188,"question_id":77559775,"body_markdown":"I have been experiencing a little issue for deploying my Restful API in Springboot. Using Netbeans IDE 19 and Java 17. I haven&#39;t figured out why after deploying successfully my .war file into WildFly 30, it only retrieves &quot;Forbidden&quot;. Has someone experienced this before?\r\n\r\nI&#39;m using Microsoft SQL Server as my DB software. \r\n\r\nCheers!\r\n\r\nI have tried modifying the .pom file, adding dependencies, configuring the server in Netbeans. ","title":"Forbidden Error Deploying Web App in Netbeans, Wildfly and Microsoft SQL Server","body":"<p>I have been experiencing a little issue for deploying my Restful API in Springboot. Using Netbeans IDE 19 and Java 17. I haven't figured out why after deploying successfully my .war file into WildFly 30, it only retrieves &quot;Forbidden&quot;. Has someone experienced this before?</p>\n<p>I'm using Microsoft SQL Server as my DB software.</p>\n<p>Cheers!</p>\n<p>I have tried modifying the .pom file, adding dependencies, configuring the server in Netbeans.</p>\n"},{"tags":["java","mockito"],"comments":[{"owner":{"account_id":8909811,"reputation":2612,"user_id":6650475,"display_name":"Andrew S"},"score":1,"creation_date":1701117949,"post_id":77559724,"comment_id":136733252,"body_markdown":"Looks like a duplicate of [this](https://stackoverflow.com/questions/14970516/use-mockito-to-mock-some-methods-but-not-others).","body":"Looks like a duplicate of <a href=\"https://stackoverflow.com/questions/14970516/use-mockito-to-mock-some-methods-but-not-others\">this</a>."},{"owner":{"account_id":149941,"reputation":2907,"user_id":362792,"display_name":"Hitobat"},"score":0,"creation_date":1701121604,"post_id":77559724,"comment_id":136733739,"body_markdown":"I&#39;d suggest using a mockito spy instead of a mock. The link Andrew S posted has some examples.","body":"I&#39;d suggest using a mockito spy instead of a mock. The link Andrew S posted has some examples."},{"owner":{"account_id":1535561,"reputation":7664,"user_id":1431720,"accept_rate":89,"display_name":"Robert"},"score":0,"creation_date":1701122783,"post_id":77559724,"comment_id":136733905,"body_markdown":"I would try very hard to not do that. You should mock the dependencies, but never the code under test. It&#39;s too easy, by accident, to mock something instead of actually testing it. Use of mocking frameworks is IMHO also a code smell. Clearly the code was not written test-first or at least with testing in mind, and now you&#39;re in a poorly designed code base where testing is hard. I&#39;d try to refactor, which of course is also hard cause you don&#39;t have tests to tell you if you break something. Be careful and good luck. :-)","body":"I would try very hard to not do that. You should mock the dependencies, but never the code under test. It&#39;s too easy, by accident, to mock something instead of actually testing it. Use of mocking frameworks is IMHO also a code smell. Clearly the code was not written test-first or at least with testing in mind, and now you&#39;re in a poorly designed code base where testing is hard. I&#39;d try to refactor, which of course is also hard cause you don&#39;t have tests to tell you if you break something. Be careful and good luck. :-)"}],"answers":[{"comments":[{"owner":{"account_id":8909811,"reputation":2612,"user_id":6650475,"display_name":"Andrew S"},"score":0,"creation_date":1701117922,"post_id":77559766,"comment_id":136733248,"body_markdown":"That would also mock `methodToTest()`.","body":"That would also mock <code>methodToTest()</code>."}],"tags":[],"owner":{"account_id":23611897,"reputation":334,"user_id":17646774,"display_name":"Marco Balo"},"comment_count":1,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1701117100,"creation_date":1701117100,"answer_id":77559766,"question_id":77559724,"body_markdown":"```java\r\nMyClass mock = Mockito.mock(MyClass.class);\r\nMockito.when(mock.methodToTest()).thenReturn(...);\r\n```","title":"Mock a method from a class that is under testing","body":"<pre class=\"lang-java prettyprint-override\"><code>MyClass mock = Mockito.mock(MyClass.class);\nMockito.when(mock.methodToTest()).thenReturn(...);\n</code></pre>\n"}],"owner":{"account_id":25445737,"reputation":1,"user_id":19247968,"display_name":"Joe Spark"},"comment_count":3,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":59,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701117100,"creation_date":1701116577,"question_id":77559724,"body_markdown":"I want to use Mockito to mock a method from a class which is under testing. This method is called in the method which I want to test. How can I do that?\r\n```\r\npublic class MyClass {\r\n    public String dependencyMethod() {\r\n        // Some implementation\r\n        return &quot;actual_result&quot;;\r\n    }\r\n\r\n    public String methodToTest() {\r\n        String result = dependencyMethod();\r\n        // Some other implementation using result\r\n        return result;\r\n    }\r\n}\r\n```\r\n\r\n```\r\nimport org.junit.Test;\r\nimport static org.junit.Assert.assertEquals;\r\nimport static org.mockito.Mockito.*;\r\n\r\npublic class TestMyClass {\r\n\r\n    @Test\r\n    public void testMethodToTest() {\r\n       // TODO: Write implementation here\r\n    }\r\n}\r\n```\r\n","title":"Mock a method from a class that is under testing","body":"<p>I want to use Mockito to mock a method from a class which is under testing. This method is called in the method which I want to test. How can I do that?</p>\n<pre><code>public class MyClass {\n    public String dependencyMethod() {\n        // Some implementation\n        return &quot;actual_result&quot;;\n    }\n\n    public String methodToTest() {\n        String result = dependencyMethod();\n        // Some other implementation using result\n        return result;\n    }\n}\n</code></pre>\n<pre><code>import org.junit.Test;\nimport static org.junit.Assert.assertEquals;\nimport static org.mockito.Mockito.*;\n\npublic class TestMyClass {\n\n    @Test\n    public void testMethodToTest() {\n       // TODO: Write implementation here\n    }\n}\n</code></pre>\n"},{"tags":["java","maven"],"comments":[{"owner":{"account_id":1479533,"reputation":689,"user_id":1389221,"accept_rate":60,"display_name":"Krishnanunni P V"},"score":0,"creation_date":1488868917,"post_id":42641823,"comment_id":72410802,"body_markdown":"Please show your warnings","body":"Please show your warnings"},{"owner":{"account_id":4427703,"reputation":3041,"user_id":3605712,"accept_rate":97,"display_name":"Malakai"},"score":0,"creation_date":1488868969,"post_id":42641823,"comment_id":72410837,"body_markdown":"agree with @KrishnanunniPV","body":"agree with @KrishnanunniPV"},{"owner":{"account_id":5547905,"reputation":715,"user_id":4401990,"accept_rate":67,"display_name":"Grzesiek"},"score":0,"creation_date":1488868983,"post_id":42641823,"comment_id":72410843,"body_markdown":"Are you using a Linux or windows?","body":"Are you using a Linux or windows?"},{"owner":{"account_id":10402833,"reputation":111,"user_id":7670574,"display_name":"Russell Yu"},"score":0,"creation_date":1488869241,"post_id":42641823,"comment_id":72410972,"body_markdown":"I&#39;m using a windows.  The warnings are just like &quot;The value of the local variable a is not used&quot;, I know how to avoid these warnings, however, I just wanna print the warning on the console.","body":"I&#39;m using a windows.  The warnings are just like &quot;The value of the local variable a is not used&quot;, I know how to avoid these warnings, however, I just wanna print the warning on the console."}],"answers":[{"tags":[],"owner":{"account_id":60491,"reputation":8054,"user_id":180650,"accept_rate":80,"display_name":"Vitaliy"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701116861,"creation_date":1488869171,"answer_id":42641907,"question_id":42641823,"body_markdown":"I am guessing you are using the compiler plugin. Have you tried the tag [&lt;showWarnings&gt;][1]?\r\n\r\n\r\n  [1]: https://maven.apache.org/plugins/maven-compiler-plugin/compile-mojo.html#showWarnings","title":"Maven How to show warnings of codes when compiling","body":"<p>I am guessing you are using the compiler plugin. Have you tried the tag <a href=\"https://maven.apache.org/plugins/maven-compiler-plugin/compile-mojo.html#showWarnings\" rel=\"nofollow noreferrer\"></a>?</p>\n"},{"tags":[],"owner":{"account_id":1479533,"reputation":689,"user_id":1389221,"accept_rate":60,"display_name":"Krishnanunni P V"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1488869943,"creation_date":1488869943,"answer_id":42642118,"question_id":42641823,"body_markdown":"Use the maven compiler plugin in your pom.xml:\r\n    \r\n    &lt;build&gt;\r\n        &lt;plugins&gt;\r\n            &lt;plugin&gt;\r\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\r\n                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\r\n                &lt;configuration&gt;\r\n                    &lt;skipTests&gt;false&lt;/skipTests&gt;\r\n                &lt;/configuration&gt;\r\n            &lt;/plugin&gt;\r\n            &lt;plugin&gt;\r\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\r\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\r\n                &lt;configuration&gt;\r\n                    &lt;compilerArgument&gt;-Xlint:all&lt;/compilerArgument&gt;\r\n                &lt;/configuration&gt;\r\n            &lt;/plugin&gt;\r\n        &lt;/plugins&gt;\r\n    &lt;/build&gt;","title":"Maven How to show warnings of codes when compiling","body":"<p>Use the maven compiler plugin in your pom.xml:</p>\n\n<pre><code>&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n            &lt;configuration&gt;\n                &lt;skipTests&gt;false&lt;/skipTests&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n            &lt;configuration&gt;\n                &lt;compilerArgument&gt;-Xlint:all&lt;/compilerArgument&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>\n"},{"tags":[],"owner":{"account_id":1939636,"reputation":28467,"user_id":1746118,"accept_rate":95,"display_name":"Naman"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1488870481,"creation_date":1488870481,"answer_id":42642262,"question_id":42641823,"body_markdown":"To get to see detailed logs in maven you can use the command line option \r\n\r\n&gt;  **-X**, **--debug**     Produce execution debug output\r\n\r\ne.g this can be used as\r\n\r\n    mvn clean install -X\r\n\r\nAlso if what you want to get in the logs is the compiler warnings (*The value of the local variable a is not used*). You can try modifying your project&#39;s `pom.xml` with the following - \r\n\r\n    ...\r\n    &lt;build&gt;\r\n        &lt;plugins&gt;\r\n            &lt;plugin&gt;\r\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\r\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\r\n                &lt;version&gt;3.6.1&lt;/version&gt;\r\n                &lt;configuration&gt;\r\n                   &lt;source&gt;1.8&lt;/source&gt;\r\n                   &lt;target&gt;1.8&lt;/target&gt;\r\n                   &lt;showWarnings&gt;true&lt;/showWarnings&gt;\r\n                &lt;/configuration&gt;\r\n           &lt;/plugin&gt;\r\n           ... other plugins\r\n        &lt;/plugins&gt;\r\n    &lt;/build&gt;\r\n","title":"Maven How to show warnings of codes when compiling","body":"<p>To get to see detailed logs in maven you can use the command line option </p>\n\n<blockquote>\n  <p><strong>-X</strong>, <strong>--debug</strong>     Produce execution debug output</p>\n</blockquote>\n\n<p>e.g this can be used as</p>\n\n<pre><code>mvn clean install -X\n</code></pre>\n\n<p>Also if what you want to get in the logs is the compiler warnings (<em>The value of the local variable a is not used</em>). You can try modifying your project's <code>pom.xml</code> with the following - </p>\n\n<pre><code>...\n&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n            &lt;version&gt;3.6.1&lt;/version&gt;\n            &lt;configuration&gt;\n               &lt;source&gt;1.8&lt;/source&gt;\n               &lt;target&gt;1.8&lt;/target&gt;\n               &lt;showWarnings&gt;true&lt;/showWarnings&gt;\n            &lt;/configuration&gt;\n       &lt;/plugin&gt;\n       ... other plugins\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>\n"},{"tags":[],"owner":{"account_id":515883,"reputation":4966,"user_id":1128668,"accept_rate":54,"display_name":"GlenPeterson"},"comment_count":0,"down_vote_count":0,"up_vote_count":6,"is_accepted":false,"score":6,"last_activity_date":1534253014,"creation_date":1534253014,"answer_id":51842574,"question_id":42641823,"body_markdown":"With maven 3.3.9, using the maven-compiler-plugin and Java 1.8, you need a `&lt;configuration&gt;` section like the following:\r\n\r\n    &lt;plugin&gt;\r\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\r\n        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\r\n        &lt;version&gt;3.8.0&lt;/version&gt;\r\n        &lt;executions&gt;\r\n            &lt;execution&gt;\r\n                &lt;id&gt;compile&lt;/id&gt;\r\n                &lt;phase&gt;compile&lt;/phase&gt;\r\n                &lt;goals&gt;\r\n                    &lt;goal&gt;compile&lt;/goal&gt;\r\n                &lt;/goals&gt;\r\n            &lt;/execution&gt;\r\n            &lt;execution&gt;\r\n                &lt;id&gt;testCompile&lt;/id&gt;\r\n                &lt;phase&gt;test-compile&lt;/phase&gt;\r\n                &lt;goals&gt;\r\n                    &lt;goal&gt;testCompile&lt;/goal&gt;\r\n                &lt;/goals&gt;\r\n            &lt;/execution&gt;\r\n        &lt;/executions&gt;\r\n        &lt;configuration&gt;\r\n            &lt;compilerArgument&gt;-Xlint:all&lt;/compilerArgument&gt;\r\n            &lt;showWarnings&gt;true&lt;/showWarnings&gt;\r\n            &lt;showDeprecation&gt;true&lt;/showDeprecation&gt;\r\n        &lt;/configuration&gt;\r\n    &lt;/plugin&gt;\r\n\r\nI got this answer from here when none of the above worked for me: http://frequal.com/java/EnableWarningsInMaven.html","title":"Maven How to show warnings of codes when compiling","body":"<p>With maven 3.3.9, using the maven-compiler-plugin and Java 1.8, you need a <code>&lt;configuration&gt;</code> section like the following:</p>\n\n<pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n    &lt;version&gt;3.8.0&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;compile&lt;/id&gt;\n            &lt;phase&gt;compile&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;compile&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n        &lt;execution&gt;\n            &lt;id&gt;testCompile&lt;/id&gt;\n            &lt;phase&gt;test-compile&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;testCompile&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n    &lt;configuration&gt;\n        &lt;compilerArgument&gt;-Xlint:all&lt;/compilerArgument&gt;\n        &lt;showWarnings&gt;true&lt;/showWarnings&gt;\n        &lt;showDeprecation&gt;true&lt;/showDeprecation&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;\n</code></pre>\n\n<p>I got this answer from here when none of the above worked for me: <a href=\"http://frequal.com/java/EnableWarningsInMaven.html\" rel=\"noreferrer\">http://frequal.com/java/EnableWarningsInMaven.html</a></p>\n"},{"comments":[{"owner":{"account_id":3758602,"reputation":10072,"user_id":3124333,"accept_rate":100,"display_name":"SiKing"},"score":0,"creation_date":1700681706,"post_id":52760066,"comment_id":136685805,"body_markdown":"In my Eclipse I see about 1000+ warnings. But this shows none of them. You also need the `-Xlint:all` as shown in [answer by Glen](https://stackoverflow.com/a/51842574/3124333).","body":"In my Eclipse I see about 1000+ warnings. But this shows none of them. You also need the <code>-Xlint:all</code> as shown in <a href=\"https://stackoverflow.com/a/51842574/3124333\">answer by Glen</a>."}],"tags":[],"owner":{"account_id":954257,"reputation":851,"user_id":979839,"accept_rate":20,"display_name":"Lusk116"},"comment_count":1,"down_vote_count":0,"up_vote_count":12,"is_accepted":false,"score":12,"last_activity_date":1543485518,"creation_date":1539260795,"answer_id":52760066,"question_id":42641823,"body_markdown":"&gt; **`&lt;showDeprecation&gt;`**\t\r\n&gt; Sets whether to show source locations where deprecated APIs are used.\r\n&gt;\r\n&gt; - Default value is: `false`\r\n&gt; - User property is: `maven.compiler.showDeprecation`\r\n&gt; \r\n&gt; **`&lt;showWarnings&gt;`**\t\r\n&gt; Set to `true` to show compilation warnings.\r\n&gt;\r\n&gt; - Default value is: `false`\r\n&gt; - User property is: `maven.compiler.showWarnings`\r\n&gt;\r\n&gt; -- [Maven Doku](https://maven.apache.org/plugins/maven-compiler-plugin/compile-mojo.html)\r\n\r\nAs simple as `mvn clean install -Dmaven.compiler.showDeprecation=true -Dmaven.compiler.showWarnings=true` all in one line.\r\n\r\nYou could even remove the `=true` part because, when you add a maven parameter with `-D` it automatically sets its value to `true`, if not set to something else.","title":"Maven How to show warnings of codes when compiling","body":"<blockquote>\n  <p><strong><code>&lt;showDeprecation&gt;</code></strong><br>\n  Sets whether to show source locations where deprecated APIs are used.</p>\n  \n  <ul>\n  <li>Default value is: <code>false</code></li>\n  <li>User property is: <code>maven.compiler.showDeprecation</code></li>\n  </ul>\n  \n  <p><strong><code>&lt;showWarnings&gt;</code></strong><br>\n  Set to <code>true</code> to show compilation warnings.</p>\n  \n  <ul>\n  <li>Default value is: <code>false</code></li>\n  <li>User property is: <code>maven.compiler.showWarnings</code></li>\n  </ul>\n  \n  <p>-- <a href=\"https://maven.apache.org/plugins/maven-compiler-plugin/compile-mojo.html\" rel=\"noreferrer\">Maven Doku</a></p>\n</blockquote>\n\n<p>As simple as <code>mvn clean install -Dmaven.compiler.showDeprecation=true -Dmaven.compiler.showWarnings=true</code> all in one line.</p>\n\n<p>You could even remove the <code>=true</code> part because, when you add a maven parameter with <code>-D</code> it automatically sets its value to <code>true</code>, if not set to something else.</p>\n"}],"owner":{"account_id":10402833,"reputation":111,"user_id":7670574,"display_name":"Russell Yu"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":10514,"favorite_count":0,"down_vote_count":0,"up_vote_count":11,"answer_count":5,"score":11,"last_activity_date":1701116861,"creation_date":1488868824,"question_id":42641823,"body_markdown":"I&#39;m using maven to build a new project. There are some warnings in my codes which are underlined by yellow line. I wish maven could report these warnings in console. How can I accomplish that? Can I just add some parameters in the command such as  mvn -XXX clean compile?","title":"Maven How to show warnings of codes when compiling","body":"<p>I'm using maven to build a new project. There are some warnings in my codes which are underlined by yellow line. I wish maven could report these warnings in console. How can I accomplish that? Can I just add some parameters in the command such as  mvn -XXX clean compile?</p>\n"},{"tags":["java","itunes","data-formats"],"answers":[{"comments":[{"owner":{"account_id":102918,"reputation":710,"user_id":275970,"display_name":"CHiRo79"},"score":3,"creation_date":1271239712,"post_id":2622870,"comment_id":2650452,"body_markdown":"iTunes Library have an XML counterpart, as you mentioned. But that file is for information to 3er developers pruporses.\nWhat I want to do is modify the ITL file so iTunes get my changes. For example, change a path of a file, increment the track count indicator, etc...","body":"iTunes Library have an XML counterpart, as you mentioned. But that file is for information to 3er developers pruporses. What I want to do is modify the ITL file so iTunes get my changes. For example, change a path of a file, increment the track count indicator, etc..."},{"owner":{"account_id":200852,"reputation":5789,"user_id":446936,"accept_rate":76,"display_name":"gogogadgetinternet"},"score":0,"creation_date":1359991303,"post_id":2622870,"comment_id":20539594,"body_markdown":"Have you had any luck CHiRo79?  I&#39;m 14 and just starting out with programming... would love to do something with my music for final projec!!!","body":"Have you had any luck CHiRo79?  I&#39;m 14 and just starting out with programming... would love to do something with my music for final projec!!!"},{"owner":{"account_id":8620,"reputation":22142,"user_id":15619,"accept_rate":91,"display_name":"Riduidel"},"score":0,"creation_date":1359994306,"post_id":2622870,"comment_id":20541287,"body_markdown":"@user446936 Look at the acceped answer (the one with the green check) regarding the titl library.","body":"@user446936 Look at the acceped answer (the one with the green check) regarding the titl library."}],"tags":[],"owner":{"account_id":8620,"reputation":22142,"user_id":15619,"accept_rate":91,"display_name":"Riduidel"},"comment_count":3,"down_vote_count":2,"up_vote_count":0,"is_accepted":false,"score":-2,"last_activity_date":1271083249,"creation_date":1271083249,"answer_id":2622870,"question_id":2622690,"body_markdown":"Most of the time, Apple folks uses preferences list format (or its XML counterpart). As an example, it is the case for iPoho Library file. I have had success parsing this file using [commons configuration][1] in the past. Maybe you could try it.\r\n\r\n\r\n  [1]: http://commons.apache.org/configuration/","title":"ITL (iTunes Library) Format","body":"<p>Most of the time, Apple folks uses preferences list format (or its XML counterpart). As an example, it is the case for iPoho Library file. I have had success parsing this file using <a href=\"http://commons.apache.org/configuration/\" rel=\"nofollow noreferrer\">commons configuration</a> in the past. Maybe you could try it.</p>\n"},{"comments":[{"owner":{"account_id":102918,"reputation":710,"user_id":275970,"display_name":"CHiRo79"},"score":0,"creation_date":1274564162,"post_id":2888005,"comment_id":2938187,"body_markdown":"Thanks! it doesn&#39;t work 100% with my library, but is a very good starting point.","body":"Thanks! it doesn&#39;t work 100% with my library, but is a very good starting point."}],"tags":[],"owner":{"account_id":69084,"reputation":96,"user_id":201211,"display_name":"htalvitie"},"comment_count":1,"down_vote_count":0,"up_vote_count":7,"is_accepted":true,"score":7,"last_activity_date":1701116672,"creation_date":1274530082,"answer_id":2888005,"question_id":2622690,"body_markdown":"There is an open source project called *titl* that sounds exactly what you&#39;re looking for.\r\n\r\nThe repository is here: https://github.com/josephw/titl","title":"ITL (iTunes Library) Format","body":"<p>There is an open source project called <em>titl</em> that sounds exactly what you're looking for.</p>\n<p>The repository is here: <a href=\"https://github.com/josephw/titl\" rel=\"nofollow noreferrer\">https://github.com/josephw/titl</a></p>\n"},{"tags":[],"owner":{"account_id":111681,"reputation":13319,"user_id":1480018,"accept_rate":87,"display_name":"Paul Taylor"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1374581120,"creation_date":1374581120,"answer_id":17809754,"question_id":2622690,"body_markdown":"iTunes has an api that you can use to inform iTunes of changes without having to modifying the iTunes ITL file directly. On OSX you can use Applescript, on Windows a DLL that Ive manipulate using Jacob and Java","title":"ITL (iTunes Library) Format","body":"<p>iTunes has an api that you can use to inform iTunes of changes without having to modifying the iTunes ITL file directly. On OSX you can use Applescript, on Windows a DLL that Ive manipulate using Jacob and Java</p>\n"}],"owner":{"account_id":102918,"reputation":710,"user_id":275970,"display_name":"CHiRo79"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":9628,"favorite_count":0,"down_vote_count":1,"up_vote_count":13,"accepted_answer_id":2888005,"answer_count":3,"score":12,"last_activity_date":1701116672,"creation_date":1271081641,"question_id":2622690,"body_markdown":"I&#180;m developing a Java solution for manage an iTunes Library (ITL file). The ITL format is a propietary one.\r\nI&#39;m looking for an implementation or a documentation about ITL format but Google can&#39;t find anything useful.\r\n\r\nDoes anyone have experience about that? Where to find more information?\r\n\r\nThanks in advance.","title":"ITL (iTunes Library) Format","body":"<p>I´m developing a Java solution for manage an iTunes Library (ITL file). The ITL format is a propietary one.\nI'm looking for an implementation or a documentation about ITL format but Google can't find anything useful.</p>\n\n<p>Does anyone have experience about that? Where to find more information?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["java","gradle","javapackager"],"answers":[{"tags":[],"owner":{"account_id":27664854,"reputation":153,"user_id":21116910,"display_name":"Alexander Gorodilov"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701116523,"creation_date":1701029801,"answer_id":77553344,"question_id":77549567,"body_markdown":"I have changed the icon directly in the Gradle cached library.\r\n\r\nThe JavaPackager works correct but the icon in the directory only seems to be unchanged (with the cup of coffee). \r\nWhen I copy/move the content of the build directory in a new directory - the icon of the .EXE changes its picture.\r\nAll I need is to transfer the build content in an another folder to see the right result.","title":"Can not set the icon for my videogame which is packaged using JavaPackager","body":"<p>I have changed the icon directly in the Gradle cached library.</p>\n<p>The JavaPackager works correct but the icon in the directory only seems to be unchanged (with the cup of coffee).\nWhen I copy/move the content of the build directory in a new directory - the icon of the .EXE changes its picture.\nAll I need is to transfer the build content in an another folder to see the right result.</p>\n"}],"owner":{"account_id":27664854,"reputation":153,"user_id":21116910,"display_name":"Alexander Gorodilov"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":27,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701116523,"creation_date":1700945521,"question_id":77549567,"body_markdown":"I&#39;m trying to deploy my videogame using [JavaPackager][1]. It works but the default icon of the aplication can not be changed. It is always a cup of coffee. I have tried also JPackage - it works with my icon without problems. What can be wrong? \r\nMy deployment Gradle-script:\r\n\r\n    task packageMyApp(type: io.github.fvarrui.javapackager.gradle.PackageTask, dependsOn: build) {    \r\n        mainClass = mainClassName\r\n        organizationName = &quot;NAME&quot;\r\n        organizationUrl = &quot;HOMEPAGE&quot;\r\n        organizationEmail = &quot;EMAIL&quot;\r\n        generateInstaller = false;    \r\n        bundleJre = true    \r\n        displayName = &quot;TITLE NAME&quot;\r\n        url = &#39;PAGE&#39;\r\n        administratorRequired = false\r\n        platform = &quot;windows&quot;\r\n    ]\r\n\r\n        winConfig {\r\n            System.out.println(&quot;Exported for Windows&quot;)\r\n            File file = (new File(&#39;Build&#39; + File.separator + &#39;Girl_of_war_deployment_master.ico&#39;))\r\n            boolean exists = file.exists();\r\n            if (exists) {            \r\n                System.out.println(&quot;Icon file exists&quot;)\r\n            }\r\n            try {\r\n                if (exists) {\r\n                    winConfig.setIcoFile(file);\r\n                }\r\n            }\r\n            catch (Exception e){\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n\r\nI receive the next exception:\r\n\r\n&gt; Execution failed for task &#39;:packageMyApp&#39;.\r\n&gt; java.lang.Exception: Build\\Girl_of_war_deployment_master.ico * \r\nTry:\r\n&gt; Run with --stacktrace option to get the stack trace.\r\n&gt; Run with --info or --debug option to get more log output.\r\n&gt; Run with --scan to get full insights.\r\n&gt; Get more help at https://help.gradle.org.\r\n\r\nWhat can be wrong? Meybe there are another &quot;dirty&quot; methods to change the default icon of the  JavaPackager?\r\n\r\n\r\n  [1]: https://github.com/fvarrui/JavaPackager","title":"Can not set the icon for my videogame which is packaged using JavaPackager","body":"<p>I'm trying to deploy my videogame using <a href=\"https://github.com/fvarrui/JavaPackager\" rel=\"nofollow noreferrer\">JavaPackager</a>. It works but the default icon of the aplication can not be changed. It is always a cup of coffee. I have tried also JPackage - it works with my icon without problems. What can be wrong?\nMy deployment Gradle-script:</p>\n<pre><code>task packageMyApp(type: io.github.fvarrui.javapackager.gradle.PackageTask, dependsOn: build) {    \n    mainClass = mainClassName\n    organizationName = &quot;NAME&quot;\n    organizationUrl = &quot;HOMEPAGE&quot;\n    organizationEmail = &quot;EMAIL&quot;\n    generateInstaller = false;    \n    bundleJre = true    \n    displayName = &quot;TITLE NAME&quot;\n    url = 'PAGE'\n    administratorRequired = false\n    platform = &quot;windows&quot;\n]\n\n    winConfig {\n        System.out.println(&quot;Exported for Windows&quot;)\n        File file = (new File('Build' + File.separator + 'Girl_of_war_deployment_master.ico'))\n        boolean exists = file.exists();\n        if (exists) {            \n            System.out.println(&quot;Icon file exists&quot;)\n        }\n        try {\n            if (exists) {\n                winConfig.setIcoFile(file);\n            }\n        }\n        catch (Exception e){\n            e.printStackTrace();\n        }\n    }\n</code></pre>\n<p>I receive the next exception:</p>\n<blockquote>\n<p>Execution failed for task ':packageMyApp'.\njava.lang.Exception: Build\\Girl_of_war_deployment_master.ico *\nTry:\nRun with --stacktrace option to get the stack trace.\nRun with --info or --debug option to get more log output.\nRun with --scan to get full insights.\nGet more help at <a href=\"https://help.gradle.org\" rel=\"nofollow noreferrer\">https://help.gradle.org</a>.</p>\n</blockquote>\n<p>What can be wrong? Meybe there are another &quot;dirty&quot; methods to change the default icon of the  JavaPackager?</p>\n"},{"tags":["java","android","android-ndk","java-native-interface","jnienv"],"comments":[{"owner":{"account_id":2567288,"reputation":20415,"user_id":2226988,"display_name":"Tom Blodget"},"score":0,"creation_date":1511732340,"post_id":47496433,"comment_id":81958282,"body_markdown":"`jshort *` is castable to `short *` Do the native functions expect the `short *` to be valid after they return? BTW—`GetShortArrayElements` should be followed by `ReleaseShortArrayElements`.","body":"<code>jshort *</code> is castable to <code>short *</code> Do the native functions expect the <code>short *</code> to be valid after they return? BTW—<code>GetShortArrayElements</code> should be followed by <code>ReleaseShortArrayElements</code>."},{"owner":{"display_name":"user4408652"},"score":0,"creation_date":1511732794,"post_id":47496433,"comment_id":81958403,"body_markdown":"@TomBlodget thanks for the reply, please post it as an answer","body":"@TomBlodget thanks for the reply, please post it as an answer"}],"answers":[{"tags":[],"owner":{"account_id":6814076,"reputation":12697,"user_id":5295429,"display_name":"Oo.oO"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1701115904,"creation_date":1511766200,"answer_id":47505462,"question_id":47496433,"body_markdown":"Take a look here:\r\n\r\nhttps://github.com/mkowsiak/jnicookbook/tree/master/recipes/recipeNo012\r\n\r\nYou can find there sample where `jshort*` is used in code as `short*`. You can do that because of `typdef` statements inside `jni.h`:\r\n\r\n    typedef unsigned char   jboolean;\r\n    typedef unsigned short  jchar;\r\n    typedef short           jshort;\r\n    typedef float           jfloat;\r\n    typedef double          jdouble;\r\n\r\nThis way, you can simply use `jshort` as new name for `short` \r\n\r\n    JNIEXPORT void JNICALL Java_recipeNo012_PassArray_passShortArray\r\n      (JNIEnv *env, jclass obj, jshortArray array) {\r\n     \r\n      /* get size of the array */\r\n      jsize len = (*env)-&gt;GetArrayLength(env, array);\r\n     \r\n      /* get the body of array; it will be referecende by C pointer */\r\n      jshort *body = (*env)-&gt;GetShortArrayElements(env, array, 0);\r\n     \r\n      /* do some stuff */\r\n      for(int i=0; i &lt; len; i++) {\r\n        printf(&quot;Short value: %hd\\n&quot;, body[i]);\r\n      }\r\n      /* release body when you decide it is no longer needed */\r\n      (*env)-&gt;ReleaseShortArrayElements(env, array, body, 0);\r\n    }\r\n\r\nYou can always double check how types are defined here: `jni.h` and `$PLATFORM/jni_md.h` inside JDK directory.\r\n\r\nIt&#39;s also good to keep this one handy:\r\n\r\nhttps://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/types.html\r\n\r\nOne remark! Note that arrays &gt;= 2D are managed completely different way.","title":"The right way to convert Jni Type to Native type","body":"<p>Take a look here:</p>\n<p><a href=\"https://github.com/mkowsiak/jnicookbook/tree/master/recipes/recipeNo012\" rel=\"nofollow noreferrer\">https://github.com/mkowsiak/jnicookbook/tree/master/recipes/recipeNo012</a></p>\n<p>You can find there sample where <code>jshort*</code> is used in code as <code>short*</code>. You can do that because of <code>typdef</code> statements inside <code>jni.h</code>:</p>\n<pre><code>typedef unsigned char   jboolean;\ntypedef unsigned short  jchar;\ntypedef short           jshort;\ntypedef float           jfloat;\ntypedef double          jdouble;\n</code></pre>\n<p>This way, you can simply use <code>jshort</code> as new name for <code>short</code></p>\n<pre><code>JNIEXPORT void JNICALL Java_recipeNo012_PassArray_passShortArray\n  (JNIEnv *env, jclass obj, jshortArray array) {\n \n  /* get size of the array */\n  jsize len = (*env)-&gt;GetArrayLength(env, array);\n \n  /* get the body of array; it will be referecende by C pointer */\n  jshort *body = (*env)-&gt;GetShortArrayElements(env, array, 0);\n \n  /* do some stuff */\n  for(int i=0; i &lt; len; i++) {\n    printf(&quot;Short value: %hd\\n&quot;, body[i]);\n  }\n  /* release body when you decide it is no longer needed */\n  (*env)-&gt;ReleaseShortArrayElements(env, array, body, 0);\n}\n</code></pre>\n<p>You can always double check how types are defined here: <code>jni.h</code> and <code>$PLATFORM/jni_md.h</code> inside JDK directory.</p>\n<p>It's also good to keep this one handy:</p>\n<p><a href=\"https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/types.html\" rel=\"nofollow noreferrer\">https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/types.html</a></p>\n<p>One remark! Note that arrays &gt;= 2D are managed completely different way.</p>\n"}],"owner":{"display_name":"user4408652"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":1237,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701115904,"creation_date":1511701453,"question_id":47496433,"body_markdown":"I have the following function defined in my native library \r\n\r\n    JNIEXPORT jshortArray JNICALL\r\n    Java_net_example_android_library_audio_AudioFilter_process(\r\n            JNIEnv *env, jobject instance, jshortArray readBuffer_) {\r\n\r\nAs you can see I am passing `jshortarray`\r\n\r\nI have some native functions that accept `short*` as a parameter. \r\n\r\nSo I wonder, how can I convert `jshortarray` into a native one. \r\n\r\nIs there any right way to do this ? \r\n\r\nOr I should do something like that \r\n\r\n    int input_size = env-&gt;GetArrayLength(readBuffer_);\r\n    short input[input_size];\r\n    jshort *inputArray = env-&gt;GetShortArrayElements(readBuffer_, 0);\r\n    for (int i = 0; i &lt; input_size; i++) {\r\n        input[i] = inputArray[i];\r\n    }\r\n\r\nThanks ","title":"The right way to convert Jni Type to Native type","body":"<p>I have the following function defined in my native library </p>\n\n<pre><code>JNIEXPORT jshortArray JNICALL\nJava_net_example_android_library_audio_AudioFilter_process(\n        JNIEnv *env, jobject instance, jshortArray readBuffer_) {\n</code></pre>\n\n<p>As you can see I am passing <code>jshortarray</code></p>\n\n<p>I have some native functions that accept <code>short*</code> as a parameter. </p>\n\n<p>So I wonder, how can I convert <code>jshortarray</code> into a native one. </p>\n\n<p>Is there any right way to do this ? </p>\n\n<p>Or I should do something like that </p>\n\n<pre><code>int input_size = env-&gt;GetArrayLength(readBuffer_);\nshort input[input_size];\njshort *inputArray = env-&gt;GetShortArrayElements(readBuffer_, 0);\nfor (int i = 0; i &lt; input_size; i++) {\n    input[i] = inputArray[i];\n}\n</code></pre>\n\n<p>Thanks </p>\n"},{"tags":["java","scala","shell"],"comments":[{"owner":{"account_id":9727861,"reputation":2565,"user_id":7214091,"display_name":"Gast&#243;n Schabas"},"score":4,"creation_date":1701116260,"post_id":77559666,"comment_id":136732969,"body_markdown":"it says that you are using `scala 2.10.5` (a really old version of scala) and `jdk 11`. it&#39;s not even listed in [scala jdk compatibility](https://docs.scala-lang.org/overviews/jdk-compatibility/overview.html). Not sure which version is being used in the tutorial, but scala `2.13.x` and `3.3.x` are the active ones today","body":"it says that you are using <code>scala 2.10.5</code> (a really old version of scala) and <code>jdk 11</code>. it&#39;s not even listed in <a href=\"https://docs.scala-lang.org/overviews/jdk-compatibility/overview.html\" rel=\"nofollow noreferrer\">scala jdk compatibility</a>. Not sure which version is being used in the tutorial, but scala <code>2.13.x</code> and <code>3.3.x</code> are the active ones today"},{"owner":{"account_id":20706372,"reputation":101,"user_id":15204150,"display_name":"liath"},"score":2,"creation_date":1701129862,"post_id":77559666,"comment_id":136734719,"body_markdown":"Using waybackmachine I found that JDK 11 requires minimum scala version of 2.10.7. If you or tutorial insist on using 2.10.5 you should try changing Java version. Sorry if this sounds pretentious but have you checked your PATH and JAVA_HOME?\n\nAlso since you&#39;re looking for simpler ways that will-just-work(tm) you could always just install IntelliJ Idea - it allows you to configure/download both JDK and Scala for a newly created project although I&#39;m not sure how this will fit with what tutorial wants you to do","body":"Using waybackmachine I found that JDK 11 requires minimum scala version of 2.10.7. If you or tutorial insist on using 2.10.5 you should try changing Java version. Sorry if this sounds pretentious but have you checked your PATH and JAVA_HOME?  Also since you&#39;re looking for simpler ways that will-just-work(tm) you could always just install IntelliJ Idea - it allows you to configure/download both JDK and Scala for a newly created project although I&#39;m not sure how this will fit with what tutorial wants you to do"},{"owner":{"account_id":338172,"reputation":634,"user_id":666886,"display_name":"philwalk"},"score":0,"creation_date":1701199313,"post_id":77559666,"comment_id":136745032,"body_markdown":"It would be helpful to see the exact command line you used to start your session.","body":"It would be helpful to see the exact command line you used to start your session."}],"owner":{"account_id":30007095,"reputation":1,"user_id":22995694,"display_name":"Andi0905"},"comment_count":3,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":1,"is_answered":false,"view_count":30,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701115864,"creation_date":1701115864,"question_id":77559666,"body_markdown":"\r\n```\r\nWelcome to Scala version 2.10.5 (OpenJDK 64-Bit Server VM, Java 11.0.17).\r\nType in expressions to have them evaluated.\r\nType :help for more information.\r\n\r\nscala&gt; [init] error: error while loading package, Missing dependency &#39;object java.lang.Object in compiler mirror&#39;, required by C:\\PROGRA~2\\scala\\bin\\..\\lib\\scala-library.jar(scala/package.class)\r\n[init] error: error while loading package, Missing dependency &#39;object java.lang.Object in compiler mirror&#39;, required by C:\\PROGRA~2\\scala\\bin\\..\\lib\\scala-library.jar(scala/runtime/package.class)\r\n\r\nFailed to initialize compiler: object java.lang.Object in compiler mirror not found.\r\n** Note that as of 2.8 scala does not assume use of the java classpath.\r\n** For the old behavior pass -usejavacp to scala, or if using a Settings\r\n** object programatically, settings.usejavacp.value = true.\r\n\r\n\r\nFailed to initialize the REPL due to an unexpected error.\r\nThis is a bug, please, report it along with the error diagnostics printed below.\r\njava.lang.NullPointerException\r\n        at scala.tools.nsc.interpreter.ExprTyper$codeParser$.applyRule(ExprTyper.scala:24)\r\n        at scala.tools.nsc.interpreter.ExprTyper$codeParser$.stmts(ExprTyper.scala:35)\r\n        at scala.tools.nsc.interpreter.ExprTyper$$anonfun$parse$2.apply(ExprTyper.scala:43)\r\n        at scala.tools.nsc.interpreter.ExprTyper$$anonfun$parse$2.apply(ExprTyper.scala:42)\r\n        at scala.tools.nsc.reporters.Reporter.withIncompleteHandler(Reporter.scala:51)\r\n        at scala.tools.nsc.interpreter.ExprTyper$class.parse(ExprTyper.scala:42)\r\n        at scala.tools.nsc.interpreter.IMain$exprTyper$.parse(IMain.scala:1074)\r\n        at scala.tools.nsc.interpreter.IMain.parse(IMain.scala:1078)\r\n        at scala.tools.nsc.interpreter.IMain$$anonfun$showCodeIfDebugging$1.apply(IMain.scala:1168)\r\n        at scala.tools.nsc.interpreter.IMain$$anonfun$showCodeIfDebugging$1.apply(IMain.scala:1168)\r\n        at scala.tools.nsc.interpreter.IMain.beSilentDuring(IMain.scala:238)\r\n        at scala.tools.nsc.interpreter.IMain.showCodeIfDebugging(IMain.scala:1168)\r\n        at scala.tools.nsc.interpreter.IMain$ReadEvalPrint.compileAndSaveRun(IMain.scala:800)\r\n        at scala.tools.nsc.interpreter.IMain$ReadEvalPrint.compile(IMain.scala:761)\r\n        at scala.tools.nsc.interpreter.IMain.bind(IMain.scala:618)\r\n        at scala.tools.nsc.interpreter.IMain.bind(IMain.scala:661)\r\n        at scala.tools.nsc.interpreter.IMain$$anonfun$quietBind$1.apply(IMain.scala:660)\r\n        at scala.tools.nsc.interpreter.IMain$$anonfun$quietBind$1.apply(IMain.scala:660)\r\n        at scala.tools.nsc.interpreter.IMain.beQuietDuring(IMain.scala:232)\r\n        at scala.tools.nsc.interpreter.IMain.quietBind(IMain.scala:660)\r\n        at scala.tools.nsc.interpreter.ILoop$$anonfun$process$1$$anonfun$apply$mcZ$sp$2.apply$mcV$sp(ILoop.scala:853)\r\n        at scala.tools.nsc.interpreter.ILoopInit$class.runThunks(ILoopInit.scala:122)\r\n        at scala.tools.nsc.interpreter.ILoop.runThunks(ILoop.scala:42)\r\n        at scala.tools.nsc.interpreter.ILoopInit$class.postInitialization(ILoopInit.scala:95)\r\n        at scala.tools.nsc.interpreter.ILoop.postInitialization(ILoop.scala:42)\r\n        at scala.tools.nsc.interpreter.ILoopInit$$anonfun$createAsyncListener$1.apply$mcV$sp(ILoopInit.scala:63)\r\n        at scala.tools.nsc.interpreter.ILoopInit$$anonfun$createAsyncListener$1.apply(ILoopInit.scala:60)\r\n        at scala.tools.nsc.interpreter.ILoopInit$$anonfun$createAsyncListener$1.apply(ILoopInit.scala:60)\r\n        at scala.tools.nsc.io.package$$anon$3.call(package.scala:40)\r\n        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n        at java.base/java.lang.Thread.run(Thread.java:829)\r\n```\r\n\r\n\r\n\r\n\r\nI`m doing a Udemy course and tried to run Scala but it didn`t work.\r\nMaybe someone finds an solution and can help me.\r\nI installed Java 8 but it still didn`t run properly.\r\nIt tells me that I`m using Java 11 but I have no clue why?\r\nIs there a better and simpler way to install Scala that does work for sure?\r\nJust tell me","title":"Error try to run scala but it didn`t work","body":"<pre><code>Welcome to Scala version 2.10.5 (OpenJDK 64-Bit Server VM, Java 11.0.17).\nType in expressions to have them evaluated.\nType :help for more information.\n\nscala&gt; [init] error: error while loading package, Missing dependency 'object java.lang.Object in compiler mirror', required by C:\\PROGRA~2\\scala\\bin\\..\\lib\\scala-library.jar(scala/package.class)\n[init] error: error while loading package, Missing dependency 'object java.lang.Object in compiler mirror', required by C:\\PROGRA~2\\scala\\bin\\..\\lib\\scala-library.jar(scala/runtime/package.class)\n\nFailed to initialize compiler: object java.lang.Object in compiler mirror not found.\n** Note that as of 2.8 scala does not assume use of the java classpath.\n** For the old behavior pass -usejavacp to scala, or if using a Settings\n** object programatically, settings.usejavacp.value = true.\n\n\nFailed to initialize the REPL due to an unexpected error.\nThis is a bug, please, report it along with the error diagnostics printed below.\njava.lang.NullPointerException\n        at scala.tools.nsc.interpreter.ExprTyper$codeParser$.applyRule(ExprTyper.scala:24)\n        at scala.tools.nsc.interpreter.ExprTyper$codeParser$.stmts(ExprTyper.scala:35)\n        at scala.tools.nsc.interpreter.ExprTyper$$anonfun$parse$2.apply(ExprTyper.scala:43)\n        at scala.tools.nsc.interpreter.ExprTyper$$anonfun$parse$2.apply(ExprTyper.scala:42)\n        at scala.tools.nsc.reporters.Reporter.withIncompleteHandler(Reporter.scala:51)\n        at scala.tools.nsc.interpreter.ExprTyper$class.parse(ExprTyper.scala:42)\n        at scala.tools.nsc.interpreter.IMain$exprTyper$.parse(IMain.scala:1074)\n        at scala.tools.nsc.interpreter.IMain.parse(IMain.scala:1078)\n        at scala.tools.nsc.interpreter.IMain$$anonfun$showCodeIfDebugging$1.apply(IMain.scala:1168)\n        at scala.tools.nsc.interpreter.IMain$$anonfun$showCodeIfDebugging$1.apply(IMain.scala:1168)\n        at scala.tools.nsc.interpreter.IMain.beSilentDuring(IMain.scala:238)\n        at scala.tools.nsc.interpreter.IMain.showCodeIfDebugging(IMain.scala:1168)\n        at scala.tools.nsc.interpreter.IMain$ReadEvalPrint.compileAndSaveRun(IMain.scala:800)\n        at scala.tools.nsc.interpreter.IMain$ReadEvalPrint.compile(IMain.scala:761)\n        at scala.tools.nsc.interpreter.IMain.bind(IMain.scala:618)\n        at scala.tools.nsc.interpreter.IMain.bind(IMain.scala:661)\n        at scala.tools.nsc.interpreter.IMain$$anonfun$quietBind$1.apply(IMain.scala:660)\n        at scala.tools.nsc.interpreter.IMain$$anonfun$quietBind$1.apply(IMain.scala:660)\n        at scala.tools.nsc.interpreter.IMain.beQuietDuring(IMain.scala:232)\n        at scala.tools.nsc.interpreter.IMain.quietBind(IMain.scala:660)\n        at scala.tools.nsc.interpreter.ILoop$$anonfun$process$1$$anonfun$apply$mcZ$sp$2.apply$mcV$sp(ILoop.scala:853)\n        at scala.tools.nsc.interpreter.ILoopInit$class.runThunks(ILoopInit.scala:122)\n        at scala.tools.nsc.interpreter.ILoop.runThunks(ILoop.scala:42)\n        at scala.tools.nsc.interpreter.ILoopInit$class.postInitialization(ILoopInit.scala:95)\n        at scala.tools.nsc.interpreter.ILoop.postInitialization(ILoop.scala:42)\n        at scala.tools.nsc.interpreter.ILoopInit$$anonfun$createAsyncListener$1.apply$mcV$sp(ILoopInit.scala:63)\n        at scala.tools.nsc.interpreter.ILoopInit$$anonfun$createAsyncListener$1.apply(ILoopInit.scala:60)\n        at scala.tools.nsc.interpreter.ILoopInit$$anonfun$createAsyncListener$1.apply(ILoopInit.scala:60)\n        at scala.tools.nsc.io.package$$anon$3.call(package.scala:40)\n        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n        at java.base/java.lang.Thread.run(Thread.java:829)\n</code></pre>\n<p>I<code>m doing a Udemy course and tried to run Scala but it didn</code>t work.\nMaybe someone finds an solution and can help me.\nI installed Java 8 but it still didn<code>t run properly. It tells me that I</code>m using Java 11 but I have no clue why?\nIs there a better and simpler way to install Scala that does work for sure?\nJust tell me</p>\n"},{"tags":["java","android","android-service"],"comments":[{"owner":{"account_id":322981,"reputation":310755,"user_id":642706,"accept_rate":58,"display_name":"Basil Bourque"},"score":0,"creation_date":1701123195,"post_id":77559421,"comment_id":136733969,"body_markdown":"If your app is targeting Android specifically, add a mention in your title and/or body. That might significantly impact the answers.","body":"If your app is targeting Android specifically, add a mention in your title and/or body. That might significantly impact the answers."}],"answers":[{"tags":[],"owner":{"account_id":1790714,"reputation":91128,"user_id":1631193,"accept_rate":71,"display_name":"Gabe Sechan"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701115685,"creation_date":1701115685,"answer_id":77559649,"question_id":77559421,"body_markdown":"First off-  Services and Threads have nothing to do with each other.  Services are not asyncronous in Android.  They&#39;re just contexts object that exist without being the foreground app of the phone.  They can create threads to do things, but there is no requirement for them to do so, they do not do so by default, and their lifecycle methods all run on the main thread.  So the question doesn&#39;t make sense to begin with.\r\n\r\nSecondly-  Android should never be used to run a server.  The entire OS is optimized around not allowing long lived background processes.  Non-foreground services are not allowed to run more than 2 minutes, and foreground processes can still be killed at any time for resources.  So a client-server architecture is generally a bad fit for Android as a whole.","title":"Should I implement different services for each thread or should I put all inside one service?","body":"<p>First off-  Services and Threads have nothing to do with each other.  Services are not asyncronous in Android.  They're just contexts object that exist without being the foreground app of the phone.  They can create threads to do things, but there is no requirement for them to do so, they do not do so by default, and their lifecycle methods all run on the main thread.  So the question doesn't make sense to begin with.</p>\n<p>Secondly-  Android should never be used to run a server.  The entire OS is optimized around not allowing long lived background processes.  Non-foreground services are not allowed to run more than 2 minutes, and foreground processes can still be killed at any time for resources.  So a client-server architecture is generally a bad fit for Android as a whole.</p>\n"}],"owner":{"account_id":14643421,"reputation":13,"user_id":22760557,"display_name":"juvor"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":23,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701115685,"creation_date":1701112971,"question_id":77559421,"body_markdown":"My question if it is good practice to have multiple services for different types of threads.\r\nFor instance, let&#39;s say my app offers two type of features: to either host a server on the device or to simply be a client.\r\nSo, I would have ServerThread and ClientThread.\r\nI implemented two service ServerService and ClientService and run the relative thread.\r\nBy having two services of course I could potentially let the user to start both the server service and client service.\r\nOr would be preferable to basically have all one service and maybe with checkboxes on let the user decide what kind of content (thread) there will be inside that service.\r\n","title":"Should I implement different services for each thread or should I put all inside one service?","body":"<p>My question if it is good practice to have multiple services for different types of threads.\nFor instance, let's say my app offers two type of features: to either host a server on the device or to simply be a client.\nSo, I would have ServerThread and ClientThread.\nI implemented two service ServerService and ClientService and run the relative thread.\nBy having two services of course I could potentially let the user to start both the server service and client service.\nOr would be preferable to basically have all one service and maybe with checkboxes on let the user decide what kind of content (thread) there will be inside that service.</p>\n"},{"tags":["java","amazon-s3","bioinformatics","nextflow"],"comments":[{"owner":{"account_id":209503,"reputation":22800,"user_id":460557,"accept_rate":100,"display_name":"Jorge Campos"},"score":0,"creation_date":1701115611,"post_id":77559373,"comment_id":136732870,"body_markdown":"Only thing I can think of here is that the file names contains colon which are outside of S3 list of safe characters and needs to be handled in a special way: https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-keys.html maybe nextflow (which im not familiar with) uses the same rules for file names","body":"Only thing I can think of here is that the file names contains colon which are outside of S3 list of safe characters and needs to be handled in a special way: <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-keys.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/AmazonS3/latest/userguide/object-keys.ht&zwnj;&#8203;ml</a> maybe nextflow (which im not familiar with) uses the same rules for file names"}],"owner":{"account_id":22381113,"reputation":1,"user_id":16594672,"display_name":"AWS Guru"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":57,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701115394,"creation_date":1701112320,"question_id":77559373,"body_markdown":"I&#39;m encountering an error while running a Nextflow process. The specific error message is related to the S3 file system provider and the file attribute view. I&#39;m trying to run a sample dataset with the following parameters. \r\n\r\n`nextflow run nf-core/scrnaseq -r dev -input https://raw.githubusercontent.com/nf-core/test-datasets/scrnaseq/samplesheet-2-0.csv --outdir ./results --genome GRCh37.`\r\n\r\n```lang-none\r\n[b0/8284b8] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:INPUT_CHECK:SAMPLESHEET_CHECK (samplesheet-2-0.csv) [100%] 1 of 1, failed: 1 ✔\r\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:FASTQC_CHECK:FASTQC                                 -\r\n[4e/588c5d] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:GTF_GENE_FILTER (genome.fa)                         [100%] 1 of 1, failed: 1 ✔\r\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:SCRNASEQ_ALEVIN:SIMPLEAF_INDEX                      -\r\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:SCRNASEQ_ALEVIN:SIMPLEAF_QUANT                      -\r\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:SCRNASEQ_ALEVIN:ALEVINQC                            -\r\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:MTX_CONVERSION:MTX_TO_H5AD                          -\r\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:MTX_CONVERSION:CONCAT_H5AD                          -\r\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:MTX_CONVERSION:MTX_TO_SEURAT                        -\r\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:CUSTOM_DUMPSOFTWAREVERSIONS                         -\r\n[82/3a47a6] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:MULTIQC                                             [100%] 1 of 1, failed: 1 ✘\r\nERROR ~ Error executing process &gt; &#39;NFCORE_SCRNASEQ:SCRNASEQ:MULTIQC&#39;\r\n\r\nCaused by:\r\n  Not a valid S3 file system provider file attribute view: java.nio.file.attribute.BasicWithKeyFileAttributeView\r\n\r\n\r\n -- Check &#39;.nextflow.log&#39; file for details\r\n\r\n\r\n-[nf-core/scrnaseq] Pipeline completed with errors-\r\n```\r\n\r\nI am trying to run the Nextflow pipeline in the Sagemaker Jupyter Notebook Instance and running its processes in the AWS Batch jobs. \r\n\r\nNextflow version: 23.10.0\r\nJava version: 21.0.1","title":"Nextflow Error: Not a valid S3 file system provider file attribute view: java.nio.file.attribute.BasicWithKeyFileAttributeView","body":"<p>I'm encountering an error while running a Nextflow process. The specific error message is related to the S3 file system provider and the file attribute view. I'm trying to run a sample dataset with the following parameters.</p>\n<p><code>nextflow run nf-core/scrnaseq -r dev -input https://raw.githubusercontent.com/nf-core/test-datasets/scrnaseq/samplesheet-2-0.csv --outdir ./results --genome GRCh37.</code></p>\n<pre class=\"lang-none prettyprint-override\"><code>[b0/8284b8] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:INPUT_CHECK:SAMPLESHEET_CHECK (samplesheet-2-0.csv) [100%] 1 of 1, failed: 1 ✔\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:FASTQC_CHECK:FASTQC                                 -\n[4e/588c5d] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:GTF_GENE_FILTER (genome.fa)                         [100%] 1 of 1, failed: 1 ✔\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:SCRNASEQ_ALEVIN:SIMPLEAF_INDEX                      -\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:SCRNASEQ_ALEVIN:SIMPLEAF_QUANT                      -\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:SCRNASEQ_ALEVIN:ALEVINQC                            -\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:MTX_CONVERSION:MTX_TO_H5AD                          -\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:MTX_CONVERSION:CONCAT_H5AD                          -\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:MTX_CONVERSION:MTX_TO_SEURAT                        -\n[-        ] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:CUSTOM_DUMPSOFTWAREVERSIONS                         -\n[82/3a47a6] process &gt; NFCORE_SCRNASEQ:SCRNASEQ:MULTIQC                                             [100%] 1 of 1, failed: 1 ✘\nERROR ~ Error executing process &gt; 'NFCORE_SCRNASEQ:SCRNASEQ:MULTIQC'\n\nCaused by:\n  Not a valid S3 file system provider file attribute view: java.nio.file.attribute.BasicWithKeyFileAttributeView\n\n\n -- Check '.nextflow.log' file for details\n\n\n-[nf-core/scrnaseq] Pipeline completed with errors-\n</code></pre>\n<p>I am trying to run the Nextflow pipeline in the Sagemaker Jupyter Notebook Instance and running its processes in the AWS Batch jobs.</p>\n<p>Nextflow version: 23.10.0\nJava version: 21.0.1</p>\n"},{"tags":["java","liferay","portlet","liferay-7","liferay-ide"],"comments":[{"owner":{"account_id":372682,"reputation":22461,"user_id":721855,"display_name":"aled"},"score":0,"creation_date":1701114867,"post_id":77559306,"comment_id":136732762,"body_markdown":"It seems that the documentation already provides the answer. Please read [How to Ask](https://stackoverflow.com/help/how-to-ask).","body":"It seems that the documentation already provides the answer. Please read <a href=\"https://stackoverflow.com/help/how-to-ask\">How to Ask</a>."}],"answers":[{"comments":[{"owner":{"account_id":30006704,"reputation":1,"user_id":22995411,"display_name":"Eric Olsen"},"score":0,"creation_date":1701211663,"post_id":77559591,"comment_id":136746973,"body_markdown":"Thank you Olaf for your advice. I did manage to get my workspace working.","body":"Thank you Olaf for your advice. I did manage to get my workspace working."}],"tags":[],"owner":{"account_id":7701,"reputation":47163,"user_id":13447,"accept_rate":100,"display_name":"Olaf Kock"},"comment_count":1,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701114935,"creation_date":1701114935,"answer_id":77559591,"question_id":77559306,"body_markdown":"You have the option between Liferay Workspace (an opinionated gradle), pure gradle, or maven.\r\n\r\nMy recommendation is to go with Liferay Workspace. You can see a comparison of the three options in [Liferay&#39;s blade samples][1]. Though looking at it, the pure gradle option might be gone by now.\r\n\r\nYou mention Developer Studio: It should offer to create a Liferay Workspace. And then you&#39;d create your modules in the workspace. You can also run your server from there.\r\n\r\nAs you&#39;re used to the older versions: If possible, go with the modularized features (e.g. OSGi based), or even better look up the new &quot;Client Extensions&quot;, as they&#39;re a lot more lightweight and easier to maintain than server-slide plugins and the old WAR style plugins.\r\n\r\n\r\n  [1]: https://github.com/liferay/liferay-blade-samples/","title":"Liferay 7.4 development using SDK","body":"<p>You have the option between Liferay Workspace (an opinionated gradle), pure gradle, or maven.</p>\n<p>My recommendation is to go with Liferay Workspace. You can see a comparison of the three options in <a href=\"https://github.com/liferay/liferay-blade-samples/\" rel=\"nofollow noreferrer\">Liferay's blade samples</a>. Though looking at it, the pure gradle option might be gone by now.</p>\n<p>You mention Developer Studio: It should offer to create a Liferay Workspace. And then you'd create your modules in the workspace. You can also run your server from there.</p>\n<p>As you're used to the older versions: If possible, go with the modularized features (e.g. OSGi based), or even better look up the new &quot;Client Extensions&quot;, as they're a lot more lightweight and easier to maintain than server-slide plugins and the old WAR style plugins.</p>\n"}],"owner":{"account_id":30006704,"reputation":1,"user_id":22995411,"display_name":"Eric Olsen"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":1,"is_answered":false,"view_count":19,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701114935,"creation_date":1701111446,"question_id":77559306,"body_markdown":"SO I am getting back into portlet and service development using Liferay. I have Liferay Portal 7.4 up and running and the Eclipse Development Studio. Is there an SDK I need to download like older versions?\r\nWhen I try to develop a portlet, it asks for the SDK. Any help appreciated.\r\n\r\n\r\n\r\nInstalled 7.4 portal on linux  - up and running. \r\nEclipse Liferay studio - need Liferay SDK or whatever they require for 7.4","title":"Liferay 7.4 development using SDK","body":"<p>SO I am getting back into portlet and service development using Liferay. I have Liferay Portal 7.4 up and running and the Eclipse Development Studio. Is there an SDK I need to download like older versions?\nWhen I try to develop a portlet, it asks for the SDK. Any help appreciated.</p>\n<p>Installed 7.4 portal on linux  - up and running.\nEclipse Liferay studio - need Liferay SDK or whatever they require for 7.4</p>\n"},{"tags":["java","jira-rest-api","jira-rest-java-api"],"comments":[{"owner":{"account_id":16953592,"reputation":19,"user_id":12262555,"display_name":"Kanchikatkar"},"score":0,"creation_date":1623690659,"post_id":67721760,"comment_id":120145106,"body_markdown":"I used FieldInput it worked for me.","body":"I used FieldInput it worked for me."}],"answers":[{"comments":[{"owner":{"account_id":16953592,"reputation":19,"user_id":12262555,"display_name":"Kanchikatkar"},"score":0,"creation_date":1623690797,"post_id":67974526,"comment_id":120145160,"body_markdown":"Using FieldInput for assignee but using accountId of assignee.","body":"Using FieldInput for assignee but using accountId of assignee."}],"tags":[],"owner":{"account_id":16953592,"reputation":19,"user_id":12262555,"display_name":"Kanchikatkar"},"comment_count":1,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1623690743,"creation_date":1623690743,"answer_id":67974526,"question_id":67721760,"body_markdown":"\r\n    public JiraRestClient getJiraRestClient()\r\n\t   {\r\n\t\treturn new AsynchronousJiraRestClientFactory().createWithBasicHttpAuthentication(getJiraUri(), JIRA_USERNAME, JIRA_PASSWORD);\r\n\t   }\r\n\r\n\tpublic URI getJiraUri()\r\n\t{\r\n\t\treturn URI.create(JIRA_URL);\r\n\t}\t\t\r\n\r\n//loadConnectionProperties();\r\n\t\trestClient = getJiraRestClient();\r\n\r\n\t\tBasicProject project = null;\r\n\t\tIssueType issueType = null;\r\n\t\tIssueInputBuilder builder = null;\r\n\t\ttry\r\n\t\t{\r\n\t\t\tfinal Iterable&lt;BasicProject&gt; projects = restClient.getProjectClient().getAllProjects().claim();\r\n\r\n\t\t\tfor(BasicProject projectStr : projects)\r\n\t\t\t{\r\n\t\t\t\tif(projectStr.getKey().equalsIgnoreCase(PROJECT_KEY))\r\n\t\t\t\t{\r\n\t\t\t\t\tproject = projectStr;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tPromise&lt;Project&gt; projectType = restClient.getProjectClient().getProject(PROJECT_KEY);\r\n\r\n\t\t\tfor(IssueType type : (projectType.get()).getIssueTypes())\r\n\t\t\t{\r\n\t\t\t\tif(type.getName().equalsIgnoreCase(Issue_Type))\r\n\t\t\t\t{\r\n\t\t\t\t\tissueType = type;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbuilder = new IssueInputBuilder(project, issueType, issueDTO.getIssueSummery());\r\n\t\t\tbuilder.setProject(project);\r\n\t\t\tbuilder.setDescription(issueDTO.getIssueDescription());\r\n\t\t\tbuilder.setPriorityId(1L);\r\n\t\t\t***builder.setFieldInput(new FieldInput(&quot;assignee&quot;, ComplexIssueInputFieldValue.with(&quot;accountId&quot;, &quot;557058:0fa57746-30a2-498c-9e34-9306679d0be7&quot;)));***\r\n\r\n\t\t\tIssueInput input = builder.build();\r\n\r\n\t\t\tIssueRestClient client = restClient.getIssueClient();\r\n\t\t\tBasicIssue issue = client.createIssue(input).claim();\r\n\r\n\t\t\tSystem.out.println(issue.getKey());\r\n\t\t\tLOG.error(&quot;Jira Created for  &quot; + issueDTO.getIssueSummery() + &quot; ID is :: &quot; + issue.getKey());\r\n\r\n\t\t}\r\n\t\tcatch(Exception e)\r\n\t\t{\r\n\t\t\te.printStackTrace();\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t","title":"setAssignee not working while adding Jira Issue","body":"<pre><code>public JiraRestClient getJiraRestClient()\n   {\n    return new AsynchronousJiraRestClientFactory().createWithBasicHttpAuthentication(getJiraUri(), JIRA_USERNAME, JIRA_PASSWORD);\n   }\n\npublic URI getJiraUri()\n{\n    return URI.create(JIRA_URL);\n}       \n</code></pre>\n<p>//loadConnectionProperties();\nrestClient = getJiraRestClient();</p>\n<pre><code>    BasicProject project = null;\n    IssueType issueType = null;\n    IssueInputBuilder builder = null;\n    try\n    {\n        final Iterable&lt;BasicProject&gt; projects = restClient.getProjectClient().getAllProjects().claim();\n\n        for(BasicProject projectStr : projects)\n        {\n            if(projectStr.getKey().equalsIgnoreCase(PROJECT_KEY))\n            {\n                project = projectStr;\n            }\n        }\n\n        Promise&lt;Project&gt; projectType = restClient.getProjectClient().getProject(PROJECT_KEY);\n\n        for(IssueType type : (projectType.get()).getIssueTypes())\n        {\n            if(type.getName().equalsIgnoreCase(Issue_Type))\n            {\n                issueType = type;\n            }\n        }\n\n        builder = new IssueInputBuilder(project, issueType, issueDTO.getIssueSummery());\n        builder.setProject(project);\n        builder.setDescription(issueDTO.getIssueDescription());\n        builder.setPriorityId(1L);\n        ***builder.setFieldInput(new FieldInput(&quot;assignee&quot;, ComplexIssueInputFieldValue.with(&quot;accountId&quot;, &quot;557058:0fa57746-30a2-498c-9e34-9306679d0be7&quot;)));***\n\n        IssueInput input = builder.build();\n\n        IssueRestClient client = restClient.getIssueClient();\n        BasicIssue issue = client.createIssue(input).claim();\n\n        System.out.println(issue.getKey());\n        LOG.error(&quot;Jira Created for  &quot; + issueDTO.getIssueSummery() + &quot; ID is :: &quot; + issue.getKey());\n\n    }\n    catch(Exception e)\n    {\n        e.printStackTrace();\n        return false;\n    }\n\n    return true;\n</code></pre>\n"}],"owner":{"account_id":16953592,"reputation":19,"user_id":12262555,"display_name":"Kanchikatkar"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":528,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":67974526,"answer_count":1,"score":0,"last_activity_date":1701114870,"creation_date":1622117139,"question_id":67721760,"body_markdown":"I created Jira issue by using jira library \r\n\r\n    &lt;dependency&gt;\r\n\t\t&lt;groupId&gt;com.atlassian.jira&lt;/groupId&gt;\r\n\t\t&lt;artifactId&gt;jira-rest-java-client-app&lt;/artifactId&gt;\r\n\t\t&lt;version&gt;5.2.1&lt;/version&gt;\r\n    &lt;/dependency&gt;\r\n\r\nBut while creating I am not able to set Assignee or AssigneeName for created JiraIssue.\r\n\r\nThis is my code\r\n\r\n            BasicUser user = projectType.get().getLead();\r\n\t\t\tSystem.out.println(user.getDisplayName());\r\n\t\t\tbuilder = new IssueInputBuilder(project, issueType, issueDTO.getIssueSummery());\r\n\t\t\tbuilder.setProject(project);\r\n\t\t\tbuilder.setDescription(issueDTO.getIssueDescription());\r\n\t\t\tIssueInput input = builder.build();\r\n\t\t\tIssueRestClient client = restClient.getIssueClient();\r\n\t\t\tBasicIssue issue = client.createIssue(input).claim();\r\n\t\t\t//input = IssueInput.createWithFields(new FieldInput(IssueFieldId.ASSIGNEE_FIELD, ComplexIssueInputFieldValue.with(&quot;name&quot;, &quot;Wraplive User&quot;)));\r\n\t\t\tbuilder.setPriorityId(1L);\r\n\t\t\tbuilder.setAssigneeName(&quot;Wraplive User&quot;);\r\n\t\t\tIssueInput issueInput = builder.build();\r\n\t\t\tclient.updateIssue(issue.getKey(), issueInput);\r\n\r\n\r\n\r\nI tried builder.setAssignee(user);  // here it sets AssigneeName as Project lead  which I don&#39;t require, I want to set another user or logged in username.\r\n\r\nCan anyone help me where I am going wrong?\r\n\r\nI tried with FieldInput which is commented in above code.","title":"setAssignee not working while adding Jira Issue","body":"<p>I created Jira issue by using jira library</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.atlassian.jira&lt;/groupId&gt;\n    &lt;artifactId&gt;jira-rest-java-client-app&lt;/artifactId&gt;\n    &lt;version&gt;5.2.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>But while creating I am not able to set Assignee or AssigneeName for created JiraIssue.</p>\n<p>This is my code</p>\n<pre><code>        BasicUser user = projectType.get().getLead();\n        System.out.println(user.getDisplayName());\n        builder = new IssueInputBuilder(project, issueType, issueDTO.getIssueSummery());\n        builder.setProject(project);\n        builder.setDescription(issueDTO.getIssueDescription());\n        IssueInput input = builder.build();\n        IssueRestClient client = restClient.getIssueClient();\n        BasicIssue issue = client.createIssue(input).claim();\n        //input = IssueInput.createWithFields(new FieldInput(IssueFieldId.ASSIGNEE_FIELD, ComplexIssueInputFieldValue.with(&quot;name&quot;, &quot;Wraplive User&quot;)));\n        builder.setPriorityId(1L);\n        builder.setAssigneeName(&quot;Wraplive User&quot;);\n        IssueInput issueInput = builder.build();\n        client.updateIssue(issue.getKey(), issueInput);\n</code></pre>\n<p>I tried builder.setAssignee(user);  // here it sets AssigneeName as Project lead  which I don't require, I want to set another user or logged in username.</p>\n<p>Can anyone help me where I am going wrong?</p>\n<p>I tried with FieldInput which is commented in above code.</p>\n"},{"tags":["java","spring","unit-testing","testing"],"comments":[{"owner":{"account_id":3116234,"reputation":9296,"user_id":2636929,"display_name":"Stultuske"},"score":1,"creation_date":1627304917,"post_id":68530411,"comment_id":121112816,"body_markdown":"what is the code you ommitted? chances are, you can test that something in that block is called 0 times, if you use a mock","body":"what is the code you ommitted? chances are, you can test that something in that block is called 0 times, if you use a mock"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627305421,"post_id":68530411,"comment_id":121113041,"body_markdown":"No, it is called in this test method, there is no problem on that side.","body":"No, it is called in this test method, there is no problem on that side."},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627305429,"post_id":68530411,"comment_id":121113047,"body_markdown":"@Stultuske Any idea?","body":"@Stultuske Any idea?"},{"owner":{"account_id":319873,"reputation":87612,"user_id":637853,"accept_rate":50,"display_name":"Thomas"},"score":0,"creation_date":1627305483,"post_id":68530411,"comment_id":121113072,"body_markdown":"As Stultuske wrote you could try to verify that nothing changed when you call that method with an empty list (and that it actually doesn&#39;t break) - it all depends on what the omitted code is doing. If that part cannot be tested, the only thing you could do is verify an empty list doesn&#39;t break the test. Besides that, I would create a new test method if you&#39;re explicitly testing that case. Don&#39;t mix test cases as this will be harder to track.","body":"As Stultuske wrote you could try to verify that nothing changed when you call that method with an empty list (and that it actually doesn&#39;t break) - it all depends on what the omitted code is doing. If that part cannot be tested, the only thing you could do is verify an empty list doesn&#39;t break the test. Besides that, I would create a new test method if you&#39;re explicitly testing that case. Don&#39;t mix test cases as this will be harder to track."},{"owner":{"account_id":3116234,"reputation":9296,"user_id":2636929,"display_name":"Stultuske"},"score":0,"creation_date":1627305915,"post_id":68530411,"comment_id":121113267,"body_markdown":"@Henry did you actually understand my comment?","body":"@Henry did you actually understand my comment?"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627305972,"post_id":68530411,"comment_id":121113291,"body_markdown":"I added the test method. Any idea?","body":"I added the test method. Any idea?"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627306187,"post_id":68530411,"comment_id":121113390,"body_markdown":"@Stultuske Amigo? Are you there?","body":"@Stultuske Amigo? Are you there?"},{"owner":{"account_id":3116234,"reputation":9296,"user_id":2636929,"display_name":"Stultuske"},"score":0,"creation_date":1627306446,"post_id":68530411,"comment_id":121113508,"body_markdown":"I wasn&#39;t talking about the test method, I&#39;m talking about the code you &quot;omitted&quot; in the code you are testing","body":"I wasn&#39;t talking about the test method, I&#39;m talking about the code you &quot;omitted&quot; in the code you are testing"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627306709,"post_id":68530411,"comment_id":121113620,"body_markdown":"@Stultuske Ok, I also added the other part of the `demoMethod`. I hope there is no missing part remains.","body":"@Stultuske Ok, I also added the other part of the <code>demoMethod</code>. I hope there is no missing part remains."},{"owner":{"account_id":13356749,"reputation":95,"user_id":9640017,"display_name":"vineetvdubey"},"score":0,"creation_date":1627306941,"post_id":68530411,"comment_id":121113738,"body_markdown":"@Henry Can you also specify the unit testing framework you are using? JUnit? Mockito? etc?","body":"@Henry Can you also specify the unit testing framework you are using? JUnit? Mockito? etc?"},{"owner":{"account_id":3116234,"reputation":9296,"user_id":2636929,"display_name":"Stultuske"},"score":0,"creation_date":1627307386,"post_id":68530411,"comment_id":121113971,"body_markdown":"you can mock priceService, and check that it is called 0 times","body":"you can mock priceService, and check that it is called 0 times"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627307417,"post_id":68530411,"comment_id":121113983,"body_markdown":"@Stultuske Yes, but how? Any example pls?","body":"@Stultuske Yes, but how? Any example pls?"},{"owner":{"account_id":3116234,"reputation":9296,"user_id":2636929,"display_name":"Stultuske"},"score":0,"creation_date":1627307504,"post_id":68530411,"comment_id":121114017,"body_markdown":"https://www.baeldung.com/mockito-series","body":"<a href=\"https://www.baeldung.com/mockito-series\" rel=\"nofollow noreferrer\">baeldung.com/mockito-series</a>"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627309904,"post_id":68530411,"comment_id":121115147,"body_markdown":"Thanks a lot, actıually I already look at [this](https://www.baeldung.com/mockito-verify) page. But I am really confused and did not find a proper example. Because I need to check if there is a zero interaction if the list is empty. Any example pls?","body":"Thanks a lot, actıually I already look at <a href=\"https://www.baeldung.com/mockito-verify\" rel=\"nofollow noreferrer\">this</a> page. But I am really confused and did not find a proper example. Because I need to check if there is a zero interaction if the list is empty. Any example pls?"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627310539,"post_id":68530411,"comment_id":121115497,"body_markdown":"`verifyNoMoreInteractions(demoService);` seems to be working, but I need to verify this based on a condition. So, how should I use this with that condition?","body":"<code>verifyNoMoreInteractions(demoService);</code> seems to be working, but I need to verify this based on a condition. So, how should I use this with that condition?"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627318959,"post_id":68530411,"comment_id":121119185,"body_markdown":"Any reply please?","body":"Any reply please?"}],"answers":[{"comments":[{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627306802,"post_id":68530860,"comment_id":121113672,"body_markdown":"Thanks for reply. Yes, if the list is empty the next lines of code are not executed. So, how should I test this if block? Any example code pls for the test method?","body":"Thanks for reply. Yes, if the list is empty the next lines of code are not executed. So, how should I test this if block? Any example code pls for the test method?"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627318947,"post_id":68530860,"comment_id":121119180,"body_markdown":"Any reply please?","body":"Any reply please?"}],"tags":[],"owner":{"account_id":3579519,"reputation":11,"user_id":2988055,"display_name":"PBeaumont"},"comment_count":2,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1627306492,"creation_date":1627306492,"answer_id":68530860,"question_id":68530411,"body_markdown":"The point of doing a return in your if condition is that the rest of the code is not executed. I.e., if this `// code omitted for brevity` was to be executed, the method would not fill it&#39;s purpose. Therefore, just make sure that whatever that code does, it was not done if your list is empty.","title":"How to test void using Unit Test?","body":"<p>The point of doing a return in your if condition is that the rest of the code is not executed. I.e., if this <code>// code omitted for brevity</code> was to be executed, the method would not fill it's purpose. Therefore, just make sure that whatever that code does, it was not done if your list is empty.</p>\n"},{"comments":[{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627307143,"post_id":68530948,"comment_id":121113834,"body_markdown":"Yes, I mocked `priceService` but as I am really beginner for Unit Test, I have really no idea how can I verify that `updateByPriceList` is never called. Any example code pls?","body":"Yes, I mocked <code>priceService</code> but as I am really beginner for Unit Test, I have really no idea how can I verify that <code>updateByPriceList</code> is never called. Any example code pls?"},{"owner":{"account_id":17835,"reputation":303905,"user_id":40342,"accept_rate":62,"display_name":"Joachim Sauer"},"score":0,"creation_date":1627307436,"post_id":68530948,"comment_id":121113990,"body_markdown":"You seem to be using Mockito. [This question talks how to verify a method is never called.](https://stackoverflow.com/questions/12862659/how-to-verify-that-a-specific-method-was-not-called-using-mockito).","body":"You seem to be using Mockito. <a href=\"https://stackoverflow.com/questions/12862659/how-to-verify-that-a-specific-method-was-not-called-using-mockito\">This question talks how to verify a method is never called.</a>."},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627309898,"post_id":68530948,"comment_id":121115143,"body_markdown":"Thanks a lot, actıually I already look at [this](https://www.baeldung.com/mockito-verify) page. But I am really confused and did not find a proper example. Because I need to check if there is a zero interaction if the list is empty. Any example pls?","body":"Thanks a lot, actıually I already look at <a href=\"https://www.baeldung.com/mockito-verify\" rel=\"nofollow noreferrer\">this</a> page. But I am really confused and did not find a proper example. Because I need to check if there is a zero interaction if the list is empty. Any example pls?"},{"owner":{"account_id":17835,"reputation":303905,"user_id":40342,"accept_rate":62,"display_name":"Joachim Sauer"},"score":0,"creation_date":1627309995,"post_id":68530948,"comment_id":121115198,"body_markdown":"@Henry: then re-read the accepted answer, it tells you **exactly** the code to verify a method is never called. If you have a *specific* question about that, then someone can help, but just repeating &quot;I need a sample&quot; is not going to help.","body":"@Henry: then re-read the accepted answer, it tells you <b>exactly</b> the code to verify a method is never called. If you have a <i>specific</i> question about that, then someone can help, but just repeating &quot;I need a sample&quot; is not going to help."},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627310263,"post_id":68530948,"comment_id":121115343,"body_markdown":"Accepted answer is for a previous version. I tried `verify(demoService.demoMethod(null), never()).clear()` but not working. Any idea?","body":"Accepted answer is for a previous version. I tried <code>verify(demoService.demoMethod(null), never()).clear()</code> but not working. Any idea?"},{"owner":{"account_id":17835,"reputation":303905,"user_id":40342,"accept_rate":62,"display_name":"Joachim Sauer"},"score":0,"creation_date":1627310306,"post_id":68530948,"comment_id":121115372,"body_markdown":"You need to learn to be more precise with your statements. &quot;but not working&quot; is almost worthless as far as a problem description goes.","body":"You need to learn to be more precise with your statements. &quot;but not working&quot; is almost worthless as far as a problem description goes."},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627310436,"post_id":68530948,"comment_id":121115450,"body_markdown":"`verifyNoMoreInteractions(demoService);` seems to be working, but I need to verify this based on a condition. So, how should I use this with that condition?","body":"<code>verifyNoMoreInteractions(demoService);</code> seems to be working, but I need to verify this based on a condition. So, how should I use this with that condition?"},{"owner":{"account_id":17835,"reputation":303905,"user_id":40342,"accept_rate":62,"display_name":"Joachim Sauer"},"score":0,"creation_date":1627310558,"post_id":68530948,"comment_id":121115505,"body_markdown":"@Henry: the call with an empty list should be its own test method anyway, shouldn&#39;t it? If it isn&#39;t, you can just put that call into an `if`: unit tests are just normal Java code after all. Edit: actually: you don&#39;t want to verify that there are no more interactions with `demoService`! You want to check for `priceService`!","body":"@Henry: the call with an empty list should be its own test method anyway, shouldn&#39;t it? If it isn&#39;t, you can just put that call into an <code>if</code>: unit tests are just normal Java code after all. Edit: actually: you don&#39;t want to verify that there are no more interactions with <code>demoService</code>! You want to check for <code>priceService</code>!"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627384070,"post_id":68530948,"comment_id":121136405,"body_markdown":"The point you missed is using `@Spy`  rather than `@Mock`","body":"The point you missed is using <code>@Spy</code>  rather than <code>@Mock</code>"}],"tags":[],"owner":{"account_id":17835,"reputation":303905,"user_id":40342,"accept_rate":62,"display_name":"Joachim Sauer"},"comment_count":9,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1701114751,"creation_date":1627306839,"answer_id":68530948,"question_id":68530411,"body_markdown":"The general idea is that you don&#39;t want to test *specific code*, but you want to test *some behaviour*.\r\n\r\nSo in your case you want to verify that `getPriceRequests` and `priceService.updateByPriceList` are not called when passing in an empty `List`.\r\n\r\nHow exactly you do that depends on what tools you have available. The easiest way is if you already mock `priceService`: then just instruct your mocking library/framework to verify that `updateByPriceList` is never called.","title":"How to test void using Unit Test?","body":"<p>The general idea is that you don't want to test <em>specific code</em>, but you want to test <em>some behaviour</em>.</p>\n<p>So in your case you want to verify that <code>getPriceRequests</code> and <code>priceService.updateByPriceList</code> are not called when passing in an empty <code>List</code>.</p>\n<p>How exactly you do that depends on what tools you have available. The easiest way is if you already mock <code>priceService</code>: then just instruct your mocking library/framework to verify that <code>updateByPriceList</code> is never called.</p>\n"},{"comments":[{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627310287,"post_id":68530968,"comment_id":121115361,"body_markdown":"Accepted answer is for a previous version. I tried `verify(demoService.demoMethod(null), never()).clear()` but not working. Any idea?","body":"Accepted answer is for a previous version. I tried <code>verify(demoService.demoMethod(null), never()).clear()</code> but not working. Any idea?"},{"owner":{"account_id":476019,"reputation":14699,"user_id":886697,"accept_rate":92,"display_name":"Stanislav Bashkyrtsev"},"score":0,"creation_date":1627310499,"post_id":68530968,"comment_id":121115480,"body_markdown":"@Henry, Did you mean to write something like `verify(priceService, never()).updateByPriceList(anyObject(), anyObject())`?","body":"@Henry, Did you mean to write something like <code>verify(priceService, never()).updateByPriceList(anyObject(), anyObject())</code>?"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627310635,"post_id":68530968,"comment_id":121115545,"body_markdown":"Actually I have no idea as I have no prior experience. ı just want to see an example usage to check zero interaction based on a condition (if a list is empty).","body":"Actually I have no idea as I have no prior experience. ı just want to see an example usage to check zero interaction based on a condition (if a list is empty)."},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627310643,"post_id":68530968,"comment_id":121115549,"body_markdown":"On the other hand, `verifyNoMoreInteractions(demoService);` seems to be working, but I need to verify this based on a condition. So, how should I use this with that condition?","body":"On the other hand, <code>verifyNoMoreInteractions(demoService);</code> seems to be working, but I need to verify this based on a condition. So, how should I use this with that condition?"},{"owner":{"account_id":476019,"reputation":14699,"user_id":886697,"accept_rate":92,"display_name":"Stanislav Bashkyrtsev"},"score":0,"creation_date":1627310808,"post_id":68530968,"comment_id":121115648,"body_markdown":"@Henry, you shouldn&#39;t verify this based on a condition. Ideally tests should be free of conditions. You&#39;d better write 2 separate tests.","body":"@Henry, you shouldn&#39;t verify this based on a condition. Ideally tests should be free of conditions. You&#39;d better write 2 separate tests."},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627311270,"post_id":68530968,"comment_id":121115874,"body_markdown":"But `verifyNoMoreInteractions(demoService.demoMethod(null))` does not work. So, how can I test that interaction against null parameter?","body":"But <code>verifyNoMoreInteractions(demoService.demoMethod(null))</code> does not work. So, how can I test that interaction against null parameter?"},{"owner":{"display_name":"user16409822"},"score":0,"creation_date":1627318943,"post_id":68530968,"comment_id":121119179,"body_markdown":"Any reply please?","body":"Any reply please?"}],"tags":[],"owner":{"account_id":476019,"reputation":14699,"user_id":886697,"accept_rate":92,"display_name":"Stanislav Bashkyrtsev"},"comment_count":7,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1627306925,"creation_date":1627306925,"answer_id":68530968,"question_id":68530411,"body_markdown":"You have 3 choices: \r\n\r\n1. Write a unit test with mocks. Mockito allows you to verify() whether some method was invoked.\r\n2. Write a more high-level test with database. When testing Service Facade Layer this is usually a wiser choice. In this case you can obtain the resulting state of DB in your test to check whether it did what it had to.\r\n3. Refactor your code to work differently\r\n\r\nCheck out [Test Pyramid][1] and [How anemic architecture spoils your tests][2] for more details.\r\n\r\n\r\n  [1]: http://qala.io/blog/test-pyramid.html\r\n  [2]: http://qala.io/blog/anaemic-architecture-enemy-of-testing.html","title":"How to test void using Unit Test?","body":"<p>You have 3 choices:</p>\n<ol>\n<li>Write a unit test with mocks. Mockito allows you to verify() whether some method was invoked.</li>\n<li>Write a more high-level test with database. When testing Service Facade Layer this is usually a wiser choice. In this case you can obtain the resulting state of DB in your test to check whether it did what it had to.</li>\n<li>Refactor your code to work differently</li>\n</ol>\n<p>Check out <a href=\"http://qala.io/blog/test-pyramid.html\" rel=\"nofollow noreferrer\">Test Pyramid</a> and <a href=\"http://qala.io/blog/anaemic-architecture-enemy-of-testing.html\" rel=\"nofollow noreferrer\">How anemic architecture spoils your tests</a> for more details.</p>\n"}],"owner":{"display_name":"user16409822"},"comment_count":16,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":586,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"answer_count":3,"score":1,"last_activity_date":1701114751,"creation_date":1627304705,"question_id":68530411,"body_markdown":"I have the following method and I wrote a *unit test* in Java for this method. It is coveraged except from the `if` statement and I also need to test this part. \r\n\r\n```\r\n@InjectMocks\r\nprivate ProductServiceImpl productService;\r\n\r\npublic void demoMethod(final List&lt;UUID&gt; productUuidList) {\r\n    if (productUuidList.isEmpty()) {\r\n        return;\r\n    }\r\n    final Map&lt;ProductRequest, PriceOverride&gt; requestMap = getPriceRequests(uuidList);\r\n    productService.updateByPriceList(priceRequestMap, companyUuid);\r\n}\r\n```\r\n\r\nHowever, as the method execution is finalized and does not return anything when `uuidList` is empty, I cannot test this `if` block. \r\n\r\nSo:\r\n\r\n 1. How can I test this `if` block? \r\n\r\n2. Should I create a new Unit Test method for testing this `if` block? Or should I add related assert lines to the current test method? \r\n\r\n***Update:*** Here is my test method:\r\n\r\n```\r\n@Test\r\npublic void testDemoMethod() {\r\n    final UUID uuid = UUID.randomUUID();\r\n    final List&lt;Price&gt; priceList = new ArrayList&lt;&gt;();\r\n    final Price price = new Price();\r\n    \r\n    price.setUuid(uuid);\r\n    priceList.add(price);\r\n\r\n    productService.demoMethod(Collections.singletonList(uuid));\r\n}\r\n```","title":"How to test void using Unit Test?","body":"<p>I have the following method and I wrote a <em>unit test</em> in Java for this method. It is coveraged except from the <code>if</code> statement and I also need to test this part.</p>\n<pre><code>@InjectMocks\nprivate ProductServiceImpl productService;\n\npublic void demoMethod(final List&lt;UUID&gt; productUuidList) {\n    if (productUuidList.isEmpty()) {\n        return;\n    }\n    final Map&lt;ProductRequest, PriceOverride&gt; requestMap = getPriceRequests(uuidList);\n    productService.updateByPriceList(priceRequestMap, companyUuid);\n}\n</code></pre>\n<p>However, as the method execution is finalized and does not return anything when <code>uuidList</code> is empty, I cannot test this <code>if</code> block.</p>\n<p>So:</p>\n<ol>\n<li><p>How can I test this <code>if</code> block?</p>\n</li>\n<li><p>Should I create a new Unit Test method for testing this <code>if</code> block? Or should I add related assert lines to the current test method?</p>\n</li>\n</ol>\n<p><em><strong>Update:</strong></em> Here is my test method:</p>\n<pre><code>@Test\npublic void testDemoMethod() {\n    final UUID uuid = UUID.randomUUID();\n    final List&lt;Price&gt; priceList = new ArrayList&lt;&gt;();\n    final Price price = new Price();\n    \n    price.setUuid(uuid);\n    priceList.add(price);\n\n    productService.demoMethod(Collections.singletonList(uuid));\n}\n</code></pre>\n"},{"tags":["java","memory","memory-management","low-level"],"comments":[{"owner":{"account_id":8191460,"reputation":13817,"user_id":7366707,"accept_rate":86,"display_name":"Salem"},"score":0,"creation_date":1512851673,"post_id":47732906,"comment_id":82426342,"body_markdown":"Well, the [general answer](https://stackoverflow.com/a/4626993/7366707) to this question should explain why.","body":"Well, the <a href=\"https://stackoverflow.com/a/4626993/7366707\">general answer</a> to this question should explain why."},{"owner":{"account_id":9640511,"reputation":4079,"user_id":7154924,"accept_rate":86,"display_name":"flow2k"},"score":2,"creation_date":1512851807,"post_id":47732906,"comment_id":82426389,"body_markdown":"@Mango Hmm...but that begs the question, as I allude to in the text: why must a `boolean` be addressable in the first place? Can&#39;t 8 `booleans` (in an `boolean` array for instance) share the same address, and then we shift appropriately depending on what the array index is?","body":"@Mango Hmm...but that begs the question, as I allude to in the text: why must a <code>boolean</code> be addressable in the first place? Can&#39;t 8 <code>booleans</code> (in an <code>boolean</code> array for instance) share the same address, and then we shift appropriately depending on what the array index is?"},{"owner":{"account_id":2734060,"reputation":263892,"user_id":2357112,"accept_rate":26,"display_name":"user2357112"},"score":2,"creation_date":1512851933,"post_id":47732906,"comment_id":82426430,"body_markdown":"Forcing a packed representation would just slow things down when space isn&#39;t an issue. You can pack it yourself or use a library implementation if you need the space.","body":"Forcing a packed representation would just slow things down when space isn&#39;t an issue. You can pack it yourself or use a library implementation if you need the space."},{"owner":{"account_id":3155790,"reputation":14985,"user_id":2668232,"accept_rate":100,"display_name":"Oleksandr Pyrohov"},"score":1,"creation_date":1512851945,"post_id":47732906,"comment_id":82426433,"body_markdown":"Possible duplicate of [Why is a boolean 1 byte and not 1 bit of size?](https://stackoverflow.com/questions/4626815/why-is-a-boolean-1-byte-and-not-1-bit-of-size)","body":"Possible duplicate of <a href=\"https://stackoverflow.com/questions/4626815/why-is-a-boolean-1-byte-and-not-1-bit-of-size\">Why is a boolean 1 byte and not 1 bit of size?</a>"},{"owner":{"account_id":2645973,"reputation":65777,"user_id":2288659,"accept_rate":90,"display_name":"Silvio Mayolo"},"score":3,"creation_date":1512851957,"post_id":47732906,"comment_id":82426437,"body_markdown":"@flow2k [Yes, they could.](https://docs.oracle.com/javase/7/docs/api/java/util/BitSet.html)","body":"@flow2k <a href=\"https://docs.oracle.com/javase/7/docs/api/java/util/BitSet.html\" rel=\"nofollow noreferrer\">Yes, they could.</a>"},{"owner":{"account_id":8191460,"reputation":13817,"user_id":7366707,"accept_rate":86,"display_name":"Salem"},"score":0,"creation_date":1512851962,"post_id":47732906,"comment_id":82426439,"body_markdown":"@Oleksandr Not necessarily a duplicate, C++ is not Java","body":"@Oleksandr Not necessarily a duplicate, C++ is not Java"},{"owner":{"account_id":8191460,"reputation":13817,"user_id":7366707,"accept_rate":86,"display_name":"Salem"},"score":1,"creation_date":1512851991,"post_id":47732906,"comment_id":82426452,"body_markdown":"@flow2k A boolean array could be optimized ([and in C++](http://en.cppreference.com/w/cpp/container/vector_bool), it has been with `std::vector&lt;bool&gt;`, which was arguably a questionable design decision as dereferencing the iterator no longer works), but in Java of course this _could_ work. As to why it wasn&#39;t done, I don&#39;t know. You could use a [`BitSet`](https://docs.oracle.com/javase/7/docs/api/java/util/BitSet.html) if you need a packed boolean array and/or efficiency.","body":"@flow2k A boolean array could be optimized (<a href=\"http://en.cppreference.com/w/cpp/container/vector_bool\" rel=\"nofollow noreferrer\">and in C++</a>, it has been with <code>std::vector&lt;bool&gt;</code>, which was arguably a questionable design decision as dereferencing the iterator no longer works), but in Java of course this <i>could</i> work. As to why it wasn&#39;t done, I don&#39;t know. You could use a <a href=\"https://docs.oracle.com/javase/7/docs/api/java/util/BitSet.html\" rel=\"nofollow noreferrer\"><code>BitSet</code></a> if you need a packed boolean array and/or efficiency."},{"owner":{"account_id":8191460,"reputation":13817,"user_id":7366707,"accept_rate":86,"display_name":"Salem"},"score":0,"creation_date":1512852107,"post_id":47732906,"comment_id":82426492,"body_markdown":"@Oleksandr ...which is not the point of _that specific question_. The _answers_ (not the question) refer to CPU limitations, however they do not necessarily apply equally to this question. The OP of this question even mentions that they are aware of this and instead asks _why_ such an optimization does not exist.","body":"@Oleksandr ...which is not the point of <i>that specific question</i>. The <i>answers</i> (not the question) refer to CPU limitations, however they do not necessarily apply equally to this question. The OP of this question even mentions that they are aware of this and instead asks <i>why</i> such an optimization does not exist."},{"owner":{"account_id":1079173,"reputation":42590,"user_id":1076640,"display_name":"yshavit"},"score":2,"creation_date":1512855395,"post_id":47732906,"comment_id":82427383,"body_markdown":"This question asserts they &quot;can&#39;t,&quot; but I don&#39;t know that that&#39;s true. Where does it say they can&#39;t? If you&#39;re asking about why they&#39;re not in any existing JVMs (which is likely), then &quot;computation time aside&quot; doesn&#39;t make much sense; computation time is the reason to make any optimization, like this one would be.","body":"This question asserts they &quot;can&#39;t,&quot; but I don&#39;t know that that&#39;s true. Where does it say they can&#39;t? If you&#39;re asking about why they&#39;re not in any existing JVMs (which is likely), then &quot;computation time aside&quot; doesn&#39;t make much sense; computation time is the reason to make any optimization, like this one would be."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":0,"creation_date":1512855917,"post_id":47732906,"comment_id":82427524,"body_markdown":"@Mango: An element of a `vector&lt;bool&gt;` is (as you say) no longer a `bool` object, it&#39;s a packed bit representing the value of a `bool`.  It&#39;s a race for two threads to write adjacent elements in a `vector&lt;bool&gt;` but not in an array of `bool`.  (Not that a packed bitmap is a bad data structure: it&#39;s great, but `vector&lt;bool&gt;` is probably not a good name for it.  See Howard Hinnant&#39;s blog: https://isocpp.org/blog/2012/11/on-vectorbool).","body":"@Mango: An element of a <code>vector&lt;bool&gt;</code> is (as you say) no longer a <code>bool</code> object, it&#39;s a packed bit representing the value of a <code>bool</code>.  It&#39;s a race for two threads to write adjacent elements in a <code>vector&lt;bool&gt;</code> but not in an array of <code>bool</code>.  (Not that a packed bitmap is a bad data structure: it&#39;s great, but <code>vector&lt;bool&gt;</code> is probably not a good name for it.  See Howard Hinnant&#39;s blog: <a href=\"https://isocpp.org/blog/2012/11/on-vectorbool\" rel=\"nofollow noreferrer\">isocpp.org/blog/2012/11/on-vectorbool</a>)."}],"answers":[{"comments":[{"owner":{"account_id":3211603,"reputation":289317,"user_id":2711488,"display_name":"Holger"},"score":1,"creation_date":1513160734,"post_id":47736383,"comment_id":82542332,"body_markdown":"I suppose, “very large” should be “very small”. Also, I’d use the term “atomic update” instead of “atomic operation”, as the latter is much broader and includes the not-so-expensive ordinary reads and writes.","body":"I suppose, “very large” should be “very small”. Also, I’d use the term “atomic update” instead of “atomic operation”, as the latter is much broader and includes the not-so-expensive ordinary reads and writes."},{"owner":{"account_id":50030,"reputation":61455,"user_id":149138,"accept_rate":56,"display_name":"BeeOnRope"},"score":0,"creation_date":1513186389,"post_id":47736383,"comment_id":82559153,"body_markdown":"@Holger - yes, good catch it should be &quot;very small&quot;. I left atomic operation in place as I think it is clear from the context that we are talking about hardware-level atomic/locked operations and not plain reads or writes that happen to be atomic on some platform.  This is, I think, conventional terminology in the area. In any case, atomic update doesn&#39;t really help, since it writes are updates yet not necessarily expensive, right? Perhaps &quot;atomic RMW&quot; but that&#39;s even more obscure and a bit platform specific.","body":"@Holger - yes, good catch it should be &quot;very small&quot;. I left atomic operation in place as I think it is clear from the context that we are talking about hardware-level atomic/locked operations and not plain reads or writes that happen to be atomic on some platform.  This is, I think, conventional terminology in the area. In any case, atomic update doesn&#39;t really help, since it writes are updates yet not necessarily expensive, right? Perhaps &quot;atomic RMW&quot; but that&#39;s even more obscure and a bit platform specific."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":0,"creation_date":1513186581,"post_id":47736383,"comment_id":82559249,"body_markdown":"You could argue that it&#39;s only an &quot;update&quot; if it depends on the old value.  But I agree it&#39;s clear from context and &quot;update&quot; doesn&#39;t obviously / clearly have that meaning (for all readers), so I think the current wording is fine.","body":"You could argue that it&#39;s only an &quot;update&quot; if it depends on the old value.  But I agree it&#39;s clear from context and &quot;update&quot; doesn&#39;t obviously / clearly have that meaning (for all readers), so I think the current wording is fine."},{"owner":{"account_id":3211603,"reputation":289317,"user_id":2711488,"display_name":"Holger"},"score":1,"creation_date":1513187680,"post_id":47736383,"comment_id":82559852,"body_markdown":"Even an “atomic update” does not have to be extraordinary expensive, if we don’t apply all other semantics of an update visible by other threads, but of course, for such a low level operation, every cycle counts…","body":"Even an “atomic update” does not have to be extraordinary expensive, if we don’t apply all other semantics of an update visible by other threads, but of course, for such a low level operation, every cycle counts…"},{"owner":{"account_id":50030,"reputation":61455,"user_id":149138,"accept_rate":56,"display_name":"BeeOnRope"},"score":0,"creation_date":1513188019,"post_id":47736383,"comment_id":82560032,"body_markdown":"@Holger - sure, and it depends on the hardware. On x86, for example, any atomic update or useful fence is pretty much as expensive as all the others and they all imply a full fence/sequential consistency. Other platforms have weaker options, but none are much faster for an &quot;atomic RMW&quot; like you&#39;d need here - in fact most won&#39;t provide a way to atomically set a bit at all so you are back to using LL/SC or CAS depending on the platform and thesee are generally expensive. None are &quot;extraordinarily expensive&quot; though: 20 - 50 cycles is par for the course.","body":"@Holger - sure, and it depends on the hardware. On x86, for example, any atomic update or useful fence is pretty much as expensive as all the others and they all imply a full fence/sequential consistency. Other platforms have weaker options, but none are much faster for an &quot;atomic RMW&quot; like you&#39;d need here - in fact most won&#39;t provide a way to atomically set a bit at all so you are back to using LL/SC or CAS depending on the platform and thesee are generally expensive. None are &quot;extraordinarily expensive&quot; though: 20 - 50 cycles is par for the course."},{"owner":{"account_id":9640511,"reputation":4079,"user_id":7154924,"accept_rate":86,"display_name":"flow2k"},"score":0,"creation_date":1513560593,"post_id":47736383,"comment_id":82686995,"body_markdown":"@BeeOnRope Thanks for this answer - I&#39;m still going through some of the finer details. Toward the beginning, you say &quot;when packed next to other elements larger than 1 byte on the stack or in an object, they are likely to be larger&quot;. What causes them to take up more than 1 byte? Some kind of memory alignment constraint?","body":"@BeeOnRope Thanks for this answer - I&#39;m still going through some of the finer details. Toward the beginning, you say &quot;when packed next to other elements larger than 1 byte on the stack or in an object, they are likely to be larger&quot;. What causes them to take up more than 1 byte? Some kind of memory alignment constraint?"},{"owner":{"account_id":50030,"reputation":61455,"user_id":149138,"accept_rate":56,"display_name":"BeeOnRope"},"score":3,"creation_date":1513560719,"post_id":47736383,"comment_id":82687028,"body_markdown":"@flow2k - correct. The `boolean` itself is still a byte (and accessed as a byte), but because objects are rounded up to the next alignment boundary, adding a `boolean` to an object often has the same effect as adding say an `int`. Java objects, for example, generally have 8-byte alignment on 64-bit platforms, so if you take an object that is exactly 16 bytes and add a single `boolean` it will be 24 bytes.","body":"@flow2k - correct. The <code>boolean</code> itself is still a byte (and accessed as a byte), but because objects are rounded up to the next alignment boundary, adding a <code>boolean</code> to an object often has the same effect as adding say an <code>int</code>. Java objects, for example, generally have 8-byte alignment on 64-bit platforms, so if you take an object that is exactly 16 bytes and add a single <code>boolean</code> it will be 24 bytes."},{"owner":{"account_id":3211603,"reputation":289317,"user_id":2711488,"display_name":"Holger"},"score":2,"creation_date":1700758120,"post_id":47736383,"comment_id":136696212,"body_markdown":"The 8-byte alignment applies to most 32-bit JVMs as well.","body":"The 8-byte alignment applies to most 32-bit JVMs as well."}],"tags":[],"owner":{"account_id":50030,"reputation":61455,"user_id":149138,"accept_rate":56,"display_name":"BeeOnRope"},"comment_count":8,"down_vote_count":0,"up_vote_count":12,"is_accepted":true,"score":12,"last_activity_date":1701114687,"creation_date":1512886305,"answer_id":47736383,"question_id":47732906,"body_markdown":"There is no reason why a boolean _must_ be one byte in size. In fact, is likely that booleans already aren&#39;t 1 byte in (effective) size in some scenarios: when packed next to other elements larger than 1 byte on the stack or in an object, they are likely to be _larger_ (i.e., adding them to an object may cause the size to grow by more than one byte).\r\n\r\nAny JVM is free to implement booleans as 1 bit, but as far as know none choose to do so, probably largely because:\r\n\r\n - Accessing one bit is often more expensive than accessing a byte, particularly when writing.\r\n\r\n To read a bit, a CPU using a &quot;classic RISC&quot; instruction set would often need need an additional `and` instruction to extract the relevant bit out of a packed byte (or larger word) of boolean bits. Some might even need a additional instruction to load a constant to `and`. In the case of indexing an array of `boolean`, where the bit-index isn&#39;t fixed at compile-time, you&#39;d need a variable shift. Some CPUs such as x86 have an easier time since they have memory source `test` instructions, including specific bit-test instructions taking a variable position such as `bt`. Such a CPU probably has similar read performance in both representations.\r\n\r\n Writing is worse: rather than a simple byte write to set a `boolean` value you now need to read the value, modify the appropriate bit and write it back. Some platforms such as x86 have memory source-and-destination RMW instructions such as `and` and `or` that will help, but these are still significantly more expensive than plain writes. In the worst case, repeatedly writing the same element will result in a dependency chain through memory that could slow your code down by an order of magnitude (a series of plain stores can&#39;t form a dependency chain).\r\n\r\n Even worse, the write method above is totally thread-unsafe. Two threads working on &quot;independent&quot; booleans might clobber each other, so the runtime would have to use atomic update operations just to write a bit for any field where the object cannot be proven local to the thread.\r\n\r\n - The space savings outside of arrays is usually very small, and is often zero: alignment concerns mean that a single bit will often end up taking the same space as a byte on the stack or in the layout for an object. Only if you had many primitive `boolean` values on the stack or an object would you see a savings (for example, objects are typically aligned to 8-byte boundaries, so if you have an object whose non-boolean fields are `int` or larger, you&#39;d need at least 4 `boolean` values to save any space, and often you&#39;d need 8).\r\n\r\n - This leaves the last remaining &quot;big win&quot; for bit-representation `boolean` in arrays of `boolean`, where you could have an asymptotic 8x space savings for large arrays. In fact, this case was motivating enough in the C++ world that `vector&lt;bool&gt;` there has a &quot;special&quot; implementation where each `bool` takes one bit - a never ending source of headaches due to all the required [special cases and non-intuitive behavior][1] (and often used as an example of a mis-feature that can&#39;t be removed now).\r\n\r\n  If it weren&#39;t for the memory model I could imagine a world where Java\r\n   implemented arrays of `boolean` in a bit-wise manner. They don&#39;t have\r\n   the same issues as `vector&lt;bool&gt;` (mostly because of the extra layer of abtraction provided by the JIT and also because an array provides a simpler interface than `vector`) and it could be done efficiently, I think. There is that pesky memory model though. That model allows writes to different array elements to be safe if done by different threads (i.e,. they act as independent variables for the purpose of the memory model). All common CPUs support this directly if you implement `boolean` as a byte, since they have independent byte accesses. No CPUs offer independent bit-access though: you are stuck using atomic operations (x86 offers the `lock bt*` operations, but these are slow: other platforms have even worse options). That would destroy the performance of any boolean array implemented as a bit-array.\r\n\r\n\r\nFinally, as described above, implementing `boolean` as a bit has significant downsides - but what about the upside?\r\n\r\nAs it turns out, if the user really wants this bit-packed representation of for boolean they can do so themselves! They can pack 8 boolean values into a `byte` (or 32 values into an `int` or whatever) in an object (and this is common for flags, etc) and the generated accessor code should be about efficient as efficient as if the JVM natively supported boolean-as-bit. In fact, when you _know_ you want an array-of-bits representation for a large number of booleans, you can simply use `BitSet` - this has the representation you want and sidesteps the atomic issues by not offering any thread-safety guarantees. So by implementing `boolean` as a byte, you sidestep all the problems above, but still let the user &quot;opt-in&quot; to bit-level representation if they want, without much runtime penalty.\r\n\r\n\r\n  [1]: https://isocpp.org/blog/2012/11/on-vectorbool","title":"Why must Java booleans be at least 1 byte in size?","body":"<p>There is no reason why a boolean <em>must</em> be one byte in size. In fact, is likely that booleans already aren't 1 byte in (effective) size in some scenarios: when packed next to other elements larger than 1 byte on the stack or in an object, they are likely to be <em>larger</em> (i.e., adding them to an object may cause the size to grow by more than one byte).</p>\n<p>Any JVM is free to implement booleans as 1 bit, but as far as know none choose to do so, probably largely because:</p>\n<ul>\n<li>Accessing one bit is often more expensive than accessing a byte, particularly when writing.</li>\n</ul>\n<p>To read a bit, a CPU using a &quot;classic RISC&quot; instruction set would often need need an additional <code>and</code> instruction to extract the relevant bit out of a packed byte (or larger word) of boolean bits. Some might even need a additional instruction to load a constant to <code>and</code>. In the case of indexing an array of <code>boolean</code>, where the bit-index isn't fixed at compile-time, you'd need a variable shift. Some CPUs such as x86 have an easier time since they have memory source <code>test</code> instructions, including specific bit-test instructions taking a variable position such as <code>bt</code>. Such a CPU probably has similar read performance in both representations.</p>\n<p>Writing is worse: rather than a simple byte write to set a <code>boolean</code> value you now need to read the value, modify the appropriate bit and write it back. Some platforms such as x86 have memory source-and-destination RMW instructions such as <code>and</code> and <code>or</code> that will help, but these are still significantly more expensive than plain writes. In the worst case, repeatedly writing the same element will result in a dependency chain through memory that could slow your code down by an order of magnitude (a series of plain stores can't form a dependency chain).</p>\n<p>Even worse, the write method above is totally thread-unsafe. Two threads working on &quot;independent&quot; booleans might clobber each other, so the runtime would have to use atomic update operations just to write a bit for any field where the object cannot be proven local to the thread.</p>\n<ul>\n<li><p>The space savings outside of arrays is usually very small, and is often zero: alignment concerns mean that a single bit will often end up taking the same space as a byte on the stack or in the layout for an object. Only if you had many primitive <code>boolean</code> values on the stack or an object would you see a savings (for example, objects are typically aligned to 8-byte boundaries, so if you have an object whose non-boolean fields are <code>int</code> or larger, you'd need at least 4 <code>boolean</code> values to save any space, and often you'd need 8).</p>\n</li>\n<li><p>This leaves the last remaining &quot;big win&quot; for bit-representation <code>boolean</code> in arrays of <code>boolean</code>, where you could have an asymptotic 8x space savings for large arrays. In fact, this case was motivating enough in the C++ world that <code>vector&lt;bool&gt;</code> there has a &quot;special&quot; implementation where each <code>bool</code> takes one bit - a never ending source of headaches due to all the required <a href=\"https://isocpp.org/blog/2012/11/on-vectorbool\" rel=\"nofollow noreferrer\">special cases and non-intuitive behavior</a> (and often used as an example of a mis-feature that can't be removed now).</p>\n</li>\n</ul>\n<p>If it weren't for the memory model I could imagine a world where Java\nimplemented arrays of <code>boolean</code> in a bit-wise manner. They don't have\nthe same issues as <code>vector&lt;bool&gt;</code> (mostly because of the extra layer of abtraction provided by the JIT and also because an array provides a simpler interface than <code>vector</code>) and it could be done efficiently, I think. There is that pesky memory model though. That model allows writes to different array elements to be safe if done by different threads (i.e,. they act as independent variables for the purpose of the memory model). All common CPUs support this directly if you implement <code>boolean</code> as a byte, since they have independent byte accesses. No CPUs offer independent bit-access though: you are stuck using atomic operations (x86 offers the <code>lock bt*</code> operations, but these are slow: other platforms have even worse options). That would destroy the performance of any boolean array implemented as a bit-array.</p>\n<p>Finally, as described above, implementing <code>boolean</code> as a bit has significant downsides - but what about the upside?</p>\n<p>As it turns out, if the user really wants this bit-packed representation of for boolean they can do so themselves! They can pack 8 boolean values into a <code>byte</code> (or 32 values into an <code>int</code> or whatever) in an object (and this is common for flags, etc) and the generated accessor code should be about efficient as efficient as if the JVM natively supported boolean-as-bit. In fact, when you <em>know</em> you want an array-of-bits representation for a large number of booleans, you can simply use <code>BitSet</code> - this has the representation you want and sidesteps the atomic issues by not offering any thread-safety guarantees. So by implementing <code>boolean</code> as a byte, you sidestep all the problems above, but still let the user &quot;opt-in&quot; to bit-level representation if they want, without much runtime penalty.</p>\n"}],"owner":{"account_id":9640511,"reputation":4079,"user_id":7154924,"accept_rate":86,"display_name":"flow2k"},"comment_count":10,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":3494,"favorite_count":0,"down_vote_count":1,"up_vote_count":7,"accepted_answer_id":47736383,"answer_count":1,"score":6,"last_activity_date":1701114687,"creation_date":1512851514,"question_id":47732906,"body_markdown":"It is known that C++ `bool`s must be at least 1 byte in size so that pointers can be created for each [\\[https://stackoverflow.com/a/2064565/7154924\\]][1]. But there are no pointers to primitive types in Java. Yet, they still take up at least 1 byte[ \\[https://stackoverflow.com/a/383597/7154924\\]][2].\r\n\r\nWhy is this the case - why can&#39;t Java `boolean`s be 1 bit in size? Computation time aside, if one has a large `boolean` array, surely one could conceive a compiler that does the appropriate shifting to retrieve the individual bit corresponding to a `boolean` value?\r\n\r\n\r\n  [1]: https://stackoverflow.com/a/2064565/7154924\r\n  [2]: https://stackoverflow.com/a/383597/7154924","title":"Why must Java booleans be at least 1 byte in size?","body":"<p>It is known that C++ <code>bool</code>s must be at least 1 byte in size so that pointers can be created for each <a href=\"https://stackoverflow.com/a/2064565/7154924\">[https://stackoverflow.com/a/2064565/7154924]</a>. But there are no pointers to primitive types in Java. Yet, they still take up at least 1 byte<a href=\"https://stackoverflow.com/a/383597/7154924\"> [https://stackoverflow.com/a/383597/7154924]</a>.</p>\n\n<p>Why is this the case - why can't Java <code>boolean</code>s be 1 bit in size? Computation time aside, if one has a large <code>boolean</code> array, surely one could conceive a compiler that does the appropriate shifting to retrieve the individual bit corresponding to a <code>boolean</code> value?</p>\n"},{"tags":["java","shell","logging","queue"],"owner":{"account_id":12955170,"reputation":554,"user_id":9366277,"display_name":"a_good_human"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":24,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701114637,"creation_date":1701112741,"question_id":77559407,"body_markdown":"I am using ProcessExecutor org.zeroturnaround.exec.ProcessExecutor, for executing a shell script in Java. The requirement is to to color code any error logs from the execution and write the output from both streams out and err to the same file.\r\n\r\nCurrently, I am initializing this as\r\n\r\n      ProcessExecutor processExecutor = new ProcessExecutor()\r\n                                            .command(commandList)\r\n                                            .directory(dir)\r\n                                            .environment(environment)\r\n                                            .readOutput(true)\r\n                                            .stopper(..)\r\n                                            .redirectOutput(new LogOutputStream() {\r\n                                              //print\r\n                                            })\r\n                                            .redirectError(new LogOutputStream() {\r\n                                              //color code to red and print\r\n                                            })\r\n\r\nThe issue is that sometimes the order of the logs is incorrect since they are 2 different streams and there is no coordination between them.\r\n\r\nI am okay moving away from ProcessExecutor as well.\r\n\r\nThanks!","title":"Redirect output and error to the same file using ProcessExecutor","body":"<p>I am using ProcessExecutor org.zeroturnaround.exec.ProcessExecutor, for executing a shell script in Java. The requirement is to to color code any error logs from the execution and write the output from both streams out and err to the same file.</p>\n<p>Currently, I am initializing this as</p>\n<pre><code>  ProcessExecutor processExecutor = new ProcessExecutor()\n                                        .command(commandList)\n                                        .directory(dir)\n                                        .environment(environment)\n                                        .readOutput(true)\n                                        .stopper(..)\n                                        .redirectOutput(new LogOutputStream() {\n                                          //print\n                                        })\n                                        .redirectError(new LogOutputStream() {\n                                          //color code to red and print\n                                        })\n</code></pre>\n<p>The issue is that sometimes the order of the logs is incorrect since they are 2 different streams and there is no coordination between them.</p>\n<p>I am okay moving away from ProcessExecutor as well.</p>\n<p>Thanks!</p>\n"},{"tags":["java","c++","swig"],"owner":{"account_id":22617085,"reputation":15,"user_id":16796475,"display_name":"Štefan Bellus"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":39,"favorite_count":0,"down_vote_count":3,"up_vote_count":1,"answer_count":0,"score":-2,"last_activity_date":1701114364,"creation_date":1701105762,"question_id":77558808,"body_markdown":"I read https://www.swig.org/Doc4.1/SWIGDocumentation.html#Java_memory_management_objects, but it does not help.\r\n\r\nI have following interface\r\n```\r\n    class ApplicantMatcher\r\n    {\r\n    public:\r\n        [[nodiscard]] virtual int Match(int probe, int gallery) const = 0;\r\n\r\n        ApplicantMatcher() = default;\r\n        virtual ~ApplicantMatcher() = default;\r\n    };\r\n```\r\nAnd class that stores the interface in constructor for later use.\r\n```\r\n    class AatestClass\r\n    {\r\n    public:\r\n        AatestClass(ApplicantMatcher&amp; matcher, ApplicantMatcher&amp; matcher2)\r\n          : m(matcher)\r\n          , m2(matcher2)\r\n        {\r\n        }\r\n        AatestClass() = delete;\r\n        virtual ~AatestClass() = default;\r\n\r\n    private:\r\n        ApplicantMatcher&amp; m;\r\n        ApplicantMatcher&amp; m2;\r\n    };\r\n```\r\nBecause of garbage collection in targeted languages I need to store references also in target constructor.\r\nI need to do it for target languages Java, C#, Ruby, Python.\r\nI do not find any usable documentation for from my point of view for typically usage of polymorphism.\r\n\r\nI tried in my *.i file\r\n\r\n```\r\n// The constructor&#39;s in cpp that uses references, MUST to store reference to provided object also in target language\r\n%typemap(javacode) inno::AatestClass %{\r\n  // Ensure that the GC doesn&#39;t collect any element set from Java\r\n  // as the underlying C++ class stores a shallow copy\r\n  private ApplicantMatcher ref_matcher;\r\n  private ApplicantMatcher ref_matcher2;\r\n%}\r\n%typemap(javain, \r\n         pre=&quot;      ref_$javainput = $javainput;&quot;\r\n         ) inno::ApplicantMatcher &amp; &quot;ApplicantMatcher.getCPtr($javainput)&quot;;\r\n```\r\nAnd it generates:\r\n\r\n```\r\n  // Ensure that the GC doesn&#39;t collect any element set from Java\r\n  // as the underlying C++ class stores a shallow copy\r\n  private ApplicantMatcher ref_matcher;\r\n  private ApplicantMatcher ref_matcher2;\r\n\r\n  static private long SwigConstructAatestClass(ApplicantMatcher matcher, ApplicantMatcher matcher2) {\r\n      ref_matcher = matcher;\r\n      ref_matcher2 = matcher2;\r\n    return enrollmentJNI.new_AatestClass(ApplicantMatcher.getCPtr(matcher), matcher, ApplicantMatcher.getCPtr(matcher2), matcher2);\r\n  }\r\n\r\n  public AatestClass(ApplicantMatcher matcher, ApplicantMatcher matcher2) {\r\n    this(AatestClass.SwigConstructAatestClass(matcher, matcher2), true);\r\n  }\r\n```\r\nBut it has several problems\r\n- Not working because SwigConstructAatestClass is static\r\n- It is only for java, it is not generic for all target languages\r\n- It apply also for other functions as constructor, where it is not necessary https://www.swig.org/Doc4.1/SWIGDocumentation.html#Java_pgcpp) and unusable\r\n\r\nI am confused, why SWIG do not generate references in target proxy classes, when the cpp class has reference in constructor automatically.\r\n\r\nI tried to find out swig functionality that will add references in proxy class from cpp constructor references.","title":"How to add reference in target language for c++ constructor with references to interface in SWIG","body":"<p>I read <a href=\"https://www.swig.org/Doc4.1/SWIGDocumentation.html#Java_memory_management_objects\" rel=\"nofollow noreferrer\">https://www.swig.org/Doc4.1/SWIGDocumentation.html#Java_memory_management_objects</a>, but it does not help.</p>\n<p>I have following interface</p>\n<pre><code>    class ApplicantMatcher\n    {\n    public:\n        [[nodiscard]] virtual int Match(int probe, int gallery) const = 0;\n\n        ApplicantMatcher() = default;\n        virtual ~ApplicantMatcher() = default;\n    };\n</code></pre>\n<p>And class that stores the interface in constructor for later use.</p>\n<pre><code>    class AatestClass\n    {\n    public:\n        AatestClass(ApplicantMatcher&amp; matcher, ApplicantMatcher&amp; matcher2)\n          : m(matcher)\n          , m2(matcher2)\n        {\n        }\n        AatestClass() = delete;\n        virtual ~AatestClass() = default;\n\n    private:\n        ApplicantMatcher&amp; m;\n        ApplicantMatcher&amp; m2;\n    };\n</code></pre>\n<p>Because of garbage collection in targeted languages I need to store references also in target constructor.\nI need to do it for target languages Java, C#, Ruby, Python.\nI do not find any usable documentation for from my point of view for typically usage of polymorphism.</p>\n<p>I tried in my *.i file</p>\n<pre><code>// The constructor's in cpp that uses references, MUST to store reference to provided object also in target language\n%typemap(javacode) inno::AatestClass %{\n  // Ensure that the GC doesn't collect any element set from Java\n  // as the underlying C++ class stores a shallow copy\n  private ApplicantMatcher ref_matcher;\n  private ApplicantMatcher ref_matcher2;\n%}\n%typemap(javain, \n         pre=&quot;      ref_$javainput = $javainput;&quot;\n         ) inno::ApplicantMatcher &amp; &quot;ApplicantMatcher.getCPtr($javainput)&quot;;\n</code></pre>\n<p>And it generates:</p>\n<pre><code>  // Ensure that the GC doesn't collect any element set from Java\n  // as the underlying C++ class stores a shallow copy\n  private ApplicantMatcher ref_matcher;\n  private ApplicantMatcher ref_matcher2;\n\n  static private long SwigConstructAatestClass(ApplicantMatcher matcher, ApplicantMatcher matcher2) {\n      ref_matcher = matcher;\n      ref_matcher2 = matcher2;\n    return enrollmentJNI.new_AatestClass(ApplicantMatcher.getCPtr(matcher), matcher, ApplicantMatcher.getCPtr(matcher2), matcher2);\n  }\n\n  public AatestClass(ApplicantMatcher matcher, ApplicantMatcher matcher2) {\n    this(AatestClass.SwigConstructAatestClass(matcher, matcher2), true);\n  }\n</code></pre>\n<p>But it has several problems</p>\n<ul>\n<li>Not working because SwigConstructAatestClass is static</li>\n<li>It is only for java, it is not generic for all target languages</li>\n<li>It apply also for other functions as constructor, where it is not necessary <a href=\"https://www.swig.org/Doc4.1/SWIGDocumentation.html#Java_pgcpp\" rel=\"nofollow noreferrer\">https://www.swig.org/Doc4.1/SWIGDocumentation.html#Java_pgcpp</a>) and unusable</li>\n</ul>\n<p>I am confused, why SWIG do not generate references in target proxy classes, when the cpp class has reference in constructor automatically.</p>\n<p>I tried to find out swig functionality that will add references in proxy class from cpp constructor references.</p>\n"},{"tags":["java","android-studio"],"answers":[{"tags":[],"owner":{"account_id":29753542,"reputation":11,"user_id":22874358,"display_name":"Developer_wanna_be"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1701113405,"creation_date":1701113405,"answer_id":77559457,"question_id":77553290,"body_markdown":"I was able to fix this issue, thank you. \r\n\r\nI took the Pager outside of the scroll view. Also, I had another layout V28 created by the IDE and I didn&#180;t noticed it, i had to modify that one as well. \r\n\r\n","title":"Getting NULL with ViewPager FindByViewID(R.id)","body":"<p>I was able to fix this issue, thank you.</p>\n<p>I took the Pager outside of the scroll view. Also, I had another layout V28 created by the IDE and I didn´t noticed it, i had to modify that one as well.</p>\n"}],"owner":{"account_id":29753542,"reputation":11,"user_id":22874358,"display_name":"Developer_wanna_be"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":20,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":77559457,"answer_count":1,"score":0,"last_activity_date":1701113405,"creation_date":1701028839,"question_id":77553290,"body_markdown":"I am going crazy, I tried to use ViewPager, CarouselView, ImageCarousel, ImageSlider and others and I keep having the same issue:\r\n`mViewPager = findViewById(R.id.viewPagerMain);\r\nR.id.viewPagerMain has value but nothing gets assigned to &quot;mViewPager&quot;.`\r\n\r\nI have watched several videos, read several explanations and I can&#180;t notice any difference. \r\nI thought that maybe I need to create a class specific for the ViewPager and nothing more...\r\n\r\nI have not created a carousel before, and I really do not understand what the problem is.\r\n\r\nWhat am I doing wrong?? Please help. \r\nBelow is my code:\r\n\r\n\r\n```\r\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\r\n&lt;ScrollView\r\n    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\r\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\r\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\r\n    android:layout_width=&quot;match_parent&quot;\r\n    android:layout_height=&quot;match_parent&quot;\r\n    android:fitsSystemWindows=&quot;true&quot;\r\n    tools:context=&quot;.Vistas.Logins.Login_activity&quot;\r\n    android:background=&quot;@color/white&quot;\r\n    &gt;\r\n\r\n    &lt;RelativeLayout\r\n        android:layout_width=&quot;match_parent&quot;\r\n        android:layout_height=&quot;wrap_content&quot;&gt;\r\n\r\n        &lt;androidx.appcompat.widget.LinearLayoutCompat\r\n            android:layout_width=&quot;match_parent&quot;\r\n            android:layout_height=&quot;match_parent&quot;\r\n            android:gravity=&quot;top&quot;\r\n            android:orientation=&quot;vertical&quot;&gt;\r\n\r\n            &lt;androidx.viewpager.widget.ViewPager\r\n                android:id=&quot;@+id/viewPagerMain&quot;\r\n                android:layout_width=&quot;match_parent&quot;\r\n                android:layout_height=&quot;250dp&quot;\r\n                android:background=&quot;@color/strongblue&quot;\r\n                android:contentDescription=&quot;@string/wali&quot;\r\n                /&gt;\r\n\r\n            &lt;androidx.appcompat.widget.LinearLayoutCompat\r\n                android:layout_width=&quot;match_parent&quot;\r\n                android:layout_height=&quot;wrap_content&quot;\r\n                android:orientation=&quot;vertical&quot;&gt;\r\n\r\n                &lt;TextView\r\n                    android:id=&quot;@+id/bienvenido2&quot;\r\n                    android:layout_width=&quot;wrap_content&quot;\r\n                    android:layout_height=&quot;wrap_content&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:layout_marginTop=&quot;25dp&quot;\r\n                    android:text=&quot;@string/bienvenido2&quot;\r\n                    android:textColor=&quot;@color/WaliBlue&quot;\r\n                    android:textSize=&quot;40sp&quot;\r\n                    android:textStyle=&quot;bold&quot; /&gt;\r\n\r\n                &lt;androidx.appcompat.widget.LinearLayoutCompat\r\n                    android:layout_width=&quot;wrap_content&quot;\r\n                    android:layout_height=&quot;wrap_content&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:gravity=&quot;center&quot;\r\n                    android:orientation=&quot;horizontal&quot;\r\n                    android:weightSum=&quot;2&quot;&gt;\r\n\r\n                    &lt;TextView\r\n                        android:id=&quot;@+id/usuariorecordado&quot;\r\n                        android:layout_width=&quot;wrap_content&quot;\r\n                        android:layout_height=&quot;wrap_content&quot;\r\n                        android:layout_weight=&quot;1&quot;\r\n                        android:gravity=&quot;center&quot;\r\n                        android:text=&quot;@string/usuariovariable&quot;\r\n                        android:textColor=&quot;@color/WaliBlue&quot;\r\n                        android:textSize=&quot;40sp&quot;\r\n                        android:textStyle=&quot;bold&quot; /&gt;\r\n\r\n                    &lt;TextView\r\n                        android:id=&quot;@+id/bienvenido2final&quot;\r\n                        android:layout_width=&quot;wrap_content&quot;\r\n                        android:layout_height=&quot;wrap_content&quot;\r\n                        android:layout_weight=&quot;1&quot;\r\n                        android:drawablePadding=&quot;10dp&quot;\r\n                        android:text=&quot;@string/bienvenido2final&quot;\r\n                        android:textColor=&quot;@color/WaliBlue&quot;\r\n                        android:textSize=&quot;40sp&quot;\r\n                        android:textStyle=&quot;bold&quot;\r\n                        app:drawableEndCompat=&quot;@drawable/mano_ico&quot; /&gt;\r\n\r\n                &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\r\n\r\n                &lt;TextView\r\n                    android:id=&quot;@+id/iniciasesion&quot;\r\n                    android:layout_width=&quot;wrap_content&quot;\r\n                    android:layout_height=&quot;wrap_content&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:layout_marginTop=&quot;5dp&quot;\r\n                    android:text=&quot;@string/iniciasesion&quot;\r\n                    android:textColor=&quot;@color/walilog&quot;\r\n                    android:textSize=&quot;20sp&quot; /&gt;\r\n\r\n\r\n                &lt;com.google.android.material.textfield.TextInputLayout\r\n                    android:layout_width=&quot;350dp&quot;\r\n                    android:layout_height=&quot;wrap_content&quot;\r\n                    android:layout_alignParentTop=&quot;true&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:layout_marginTop=&quot;60dp&quot;\r\n                    app:passwordToggleEnabled=&quot;true&quot;\r\n                    app:passwordToggleTint=&quot;@color/green&quot;&gt;\r\n\r\n                    &lt;EditText\r\n                        android:id=&quot;@+id/password&quot;\r\n                        android:layout_width=&quot;match_parent&quot;\r\n                        android:layout_height=&quot;48sp&quot;\r\n                        android:autofillHints=&quot;&quot;\r\n                        android:backgroundTint=&quot;@color/green&quot;\r\n                        android:hint=&quot;@string/password&quot;\r\n                        android:inputType=&quot;textPassword&quot;\r\n                        android:textColor=&quot;@color/black&quot;\r\n                        android:textSize=&quot;18sp&quot; /&gt;\r\n                &lt;/com.google.android.material.textfield.TextInputLayout&gt;\r\n\r\n                &lt;androidx.appcompat.widget.SwitchCompat\r\n                    android:id=&quot;@+id/recordarSesion&quot;\r\n                    android:layout_width=&quot;wrap_content&quot;\r\n                    android:layout_height=&quot;48dp&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:checked=&quot;true&quot;\r\n                    android:text=&quot;@string/recordarSesion&quot;\r\n                    android:textColor=&quot;@color/grey&quot;\r\n                    app:switchPadding=&quot;15dp&quot;\r\n                    app:thumbTint=&quot;@drawable/newthumb_switch&quot; /&gt;\r\n\r\n                &lt;!-- &lt;TextView\r\n                    android:layout_width=&quot;wrap_content&quot;\r\n                    android:layout_height=&quot;wrap_content&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:drawablePadding=&quot;10dp&quot;\r\n                    android:gravity=&quot;center&quot;\r\n                    android:text=&quot;@string/recordarSesion&quot;\r\n                    android:textSize=&quot;15sp&quot;\r\n                    android:layout_marginTop=&quot;5dp&quot;\r\n                    app:drawableRightCompat=&quot;@drawable/toggle_on&quot; /&gt;\r\n\r\n                    Temporal porque ir&#225; un toggle--&gt;\r\n\r\n\r\n                &lt;Button\r\n                    android:id=&quot;@+id/botoniniciar&quot;\r\n                    android:layout_width=&quot;250dp&quot;\r\n                    android:layout_height=&quot;50dp&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:layout_marginTop=&quot;60dp&quot;\r\n                    android:background=&quot;@drawable/boton_ripple&quot;\r\n                    android:text=&quot;@string/botoniniciar&quot;\r\n                    android:textAllCaps=&quot;false&quot;\r\n                    android:textColor=&quot;@color/white&quot;\r\n                    android:textSize=&quot;20sp&quot;\r\n                    android:textStyle=&quot;bold&quot; /&gt;\r\n\r\n                &lt;TextView\r\n                    android:id=&quot;@+id/nousuario&quot;\r\n                    android:layout_width=&quot;wrap_content&quot;\r\n                    android:layout_height=&quot;wrap_content&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:layout_marginTop=&quot;20dp&quot;\r\n                    android:gravity=&quot;center&quot;\r\n                    android:text=&quot;@string/nousuario&quot;\r\n                    android:textSize=&quot;16sp&quot; /&gt;\r\n\r\n                &lt;Button\r\n                    android:id=&quot;@+id/otracuenta&quot;\r\n                    style=&quot;?android:attr/borderlessButtonStyle&quot;\r\n                    android:layout_width=&quot;wrap_content&quot;\r\n                    android:layout_height=&quot;48dp&quot;\r\n                    android:layout_gravity=&quot;center&quot;\r\n                    android:background=&quot;@null&quot;\r\n                    android:gravity=&quot;top&quot;\r\n                    android:text=&quot;@string/otracuenta&quot;\r\n                    android:textAllCaps=&quot;false&quot;\r\n                    android:textColor=&quot;@color/walilog&quot;\r\n                    android:textSize=&quot;16sp&quot;\r\n                    android:textStyle=&quot;bold&quot; /&gt;\r\n\r\n            &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\r\n\r\n            &lt;androidx.appcompat.widget.LinearLayoutCompat\r\n                android:layout_width=&quot;match_parent&quot;\r\n                android:layout_height=&quot;130dp&quot;\r\n                android:layout_gravity=&quot;bottom&quot;\r\n                android:background=&quot;@color/white&quot;\r\n                android:gravity=&quot;bottom&quot;\r\n                android:orientation=&quot;vertical&quot;&gt;\r\n\r\n                &lt;androidx.appcompat.widget.LinearLayoutCompat\r\n                    android:layout_width=&quot;match_parent&quot;\r\n                    android:layout_height=&quot;wrap_content&quot;\r\n                    android:background=&quot;@color/azulrey&quot;\r\n                    android:orientation=&quot;horizontal&quot;\r\n                    android:weightSum=&quot;2&quot;\r\n                    android:layout_gravity=&quot;bottom&quot;&gt;\r\n\r\n                    &lt;TextView\r\n                        android:id=&quot;@+id/link&quot;\r\n                        android:layout_width=&quot;wrap_content&quot;\r\n                        android:layout_height=&quot;50dp&quot;\r\n                        android:layout_gravity=&quot;bottom&quot;\r\n                        android:layout_marginStart=&quot;15dp&quot;\r\n                        android:layout_weight=&quot;1&quot;\r\n                        android:autoLink=&quot;web&quot;\r\n                        android:drawablePadding=&quot;8dp&quot;\r\n                        android:gravity=&quot;center|left&quot;\r\n                        android:text=&quot;@string/link&quot;\r\n                        android:textColorLink=&quot;@color/white&quot;\r\n                        android:textSize=&quot;20sp&quot;\r\n                        android:textStyle=&quot;bold&quot;\r\n                        app:drawableLeftCompat=&quot;@drawable/web&quot;\r\n                        tools:ignore=&quot;RtlHardcoded&quot; /&gt;\r\n\r\n                    &lt;Button\r\n                        android:id=&quot;@+id/ayuda&quot;\r\n                        android:layout_width=&quot;wrap_content&quot;\r\n                        android:layout_height=&quot;48dp&quot;\r\n                        android:layout_gravity=&quot;bottom&quot;\r\n                        android:layout_marginEnd=&quot;-30dp&quot;\r\n                        android:layout_weight=&quot;1&quot;\r\n                        android:background=&quot;@null&quot;\r\n                        android:drawablePadding=&quot;8dp&quot;\r\n                        android:gravity=&quot;center_vertical&quot;\r\n                        android:text=&quot;@string/ayuda&quot;\r\n                        android:textAllCaps=&quot;false&quot;\r\n                        android:textColor=&quot;@color/white&quot;\r\n                        android:textSize=&quot;20sp&quot;\r\n                        android:textStyle=&quot;bold&quot;\r\n                        app:drawableStartCompat=&quot;@drawable/ayuda&quot;\r\n                        tools:ignore=&quot;RtlHardcoded&quot; /&gt;\r\n\r\n                &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\r\n            &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\r\n\r\n        &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\r\n\r\n        &lt;RelativeLayout\r\n\r\n            android:layout_width=&quot;match_parent&quot;\r\n            android:layout_height=&quot;match_parent&quot;\r\n            android:background=&quot;@color/dimBackground&quot;\r\n            android:elevation=&quot;2dp&quot;\r\n            android:gravity=&quot;center&quot;\r\n            android:visibility=&quot;invisible&quot;&gt;\r\n\r\n            &lt;ProgressBar\r\n                android:id=&quot;@+id/loadingPanel&quot;\r\n                android:layout_width=&quot;wrap_content&quot;\r\n                android:layout_height=&quot;wrap_content&quot;\r\n                android:elevation=&quot;10dp&quot;\r\n                android:background=&quot;@drawable/rounded_corners&quot;\r\n                android:indeterminate=&quot;true&quot;\r\n                /&gt;\r\n\r\n        &lt;/RelativeLayout&gt;\r\n\r\n    &lt;/RelativeLayout&gt;\r\n\r\n&lt;/ScrollView&gt;\r\n```\r\n\r\n\r\n```\r\npublic class ViewPagerAdapter extends PagerAdapter {\r\n    // Context object\r\n    Context context;\r\n\r\n    // Array of images\r\n    int[] images;\r\n\r\n    // Layout Inflater\r\n    LayoutInflater mLayoutInflater;\r\n\r\n\r\n    // Viewpager Constructor\r\n    public ViewPagerAdapter(Context context, int[] images) {\r\n        this.context = context;\r\n        this.images = images;\r\n        mLayoutInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);\r\n    }\r\n\r\n    @Override\r\n    public int getCount() {\r\n        // return the number of images\r\n        return images.length;\r\n    }\r\n\r\n    @Override\r\n    public boolean isViewFromObject(@NonNull View view, @NonNull Object object) {\r\n        return view == ((LinearLayout) object);\r\n    }\r\n\r\n    @NonNull\r\n    @Override\r\n    public Object instantiateItem(@NonNull ViewGroup container, final int position) {\r\n\r\n        // inflating the item\r\n        View itemView = mLayoutInflater.inflate(R.layout.carrusel_inicio, container, false);\r\n\r\n        // referencing the image view from the item.xml file\r\n        ImageView imageView = (ImageView) itemView.findViewById(R.id.imageViewMain);\r\n\r\n        // setting the image in the imageView\r\n        imageView.setImageResource(images[position]);\r\n\r\n        // Adding the View\r\n        Objects.requireNonNull(container).addView(itemView);\r\n\r\n        return itemView;\r\n    }\r\n\r\n    @Override\r\n    public void destroyItem(ViewGroup container, int position, @NonNull Object object) {\r\n\r\n        container.removeView((LinearLayout) object);\r\n    }\r\n}\r\n```\r\n\r\n\r\n```\r\npublic class Login_recordarUsuario extends AppCompatActivity {\r\n\r\n    EditText password;\r\n    Button botoniniciar,otracuenta,ayuda;\r\n    public ProgressDialog progressDialog;\r\n    public ProgressBar loadingPanel;\r\n    TextView iniciasesion,bienvenido2,link,nousuario,bienvenido2final,usuariorecordado;\r\n    SwitchCompat recordarSesion;\r\n    ViewPager mViewPager;\r\n    int[] images = {R.drawable.walilogin, R.drawable.wall_e, R.drawable.walle};\r\n    ViewPagerAdapter mViewPagerAdapter;\r\n\r\n    @SuppressLint(&quot;MissingInflatedId&quot;)\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_login_recordar_usuario);\r\n\r\n        ConnectivityManager connectivityManager = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);\r\n\r\n        boolean connected = (Objects.requireNonNull(connectivityManager.getNetworkInfo(ConnectivityManager.TYPE_MOBILE)).getState() == NetworkInfo.State.CONNECTED ||\r\n                Objects.requireNonNull(connectivityManager.getNetworkInfo(ConnectivityManager.TYPE_WIFI)).getState() == NetworkInfo.State.CONNECTED);\r\n\r\n            String ubicacion = &quot;Tipografia/GalanoGrotesqueAlt-Regular.ttf&quot;;\r\n            String ubicacion2 = &quot;Tipografia/GalanoGrotesqueDEMO-Bold.ttf&quot;;\r\n            Typeface tf = Typeface.createFromAsset(Login_recordarUsuario.this.getAssets(), ubicacion); //Inicia sesi&#243;n para...\r\n            Typeface tf2 = Typeface.createFromAsset(Login_recordarUsuario.this.getAssets(), ubicacion2); // Bienvenido\r\n\r\n            recordarSesion = findViewById(R.id.recordarSesion);\r\n\r\n            password = findViewById(R.id.password);\r\n            botoniniciar = findViewById(R.id.botoniniciar);\r\n            progressDialog = new ProgressDialog(Login_recordarUsuario.this);\r\n            loadingPanel = findViewById(R.id.loadingPanel);\r\n            progressDialog.setMessage(&quot;Iniciando sesi&#243;n...&quot;);\r\n            iniciasesion = findViewById(R.id.iniciasesion);\r\n            bienvenido2 = findViewById(R.id.bienvenido2);\r\n            link = findViewById(R.id.link);\r\n            nousuario = findViewById(R.id.nousuario);\r\n            otracuenta = findViewById(R.id.otracuenta);\r\n            usuariorecordado = findViewById(R.id.usuariorecordado);\r\n            bienvenido2final = findViewById(R.id.bienvenido2final);\r\n            ayuda = findViewById(R.id.ayuda);\r\n\r\n        // Initializing the ViewPager Object\r\n        mViewPager = findViewById(R.id.viewPagerMain);\r\n\r\n        // Initializing the ViewPagerAdapter\r\n        mViewPagerAdapter = new ViewPagerAdapter(Login_recordarUsuario.this, images);\r\n\r\n        // Adding the Adapter to the ViewPager\r\n        mViewPager.setAdapter(mViewPagerAdapter);\r\n\r\n//.... code Continues\r\n```\r\n\r\n\r\n","title":"Getting NULL with ViewPager FindByViewID(R.id)","body":"<p>I am going crazy, I tried to use ViewPager, CarouselView, ImageCarousel, ImageSlider and others and I keep having the same issue:\n<code>mViewPager = findViewById(R.id.viewPagerMain); R.id.viewPagerMain has value but nothing gets assigned to &quot;mViewPager&quot;.</code></p>\n<p>I have watched several videos, read several explanations and I can´t notice any difference.\nI thought that maybe I need to create a class specific for the ViewPager and nothing more...</p>\n<p>I have not created a carousel before, and I really do not understand what the problem is.</p>\n<p>What am I doing wrong?? Please help.\nBelow is my code:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;ScrollView\n    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:fitsSystemWindows=&quot;true&quot;\n    tools:context=&quot;.Vistas.Logins.Login_activity&quot;\n    android:background=&quot;@color/white&quot;\n    &gt;\n\n    &lt;RelativeLayout\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;wrap_content&quot;&gt;\n\n        &lt;androidx.appcompat.widget.LinearLayoutCompat\n            android:layout_width=&quot;match_parent&quot;\n            android:layout_height=&quot;match_parent&quot;\n            android:gravity=&quot;top&quot;\n            android:orientation=&quot;vertical&quot;&gt;\n\n            &lt;androidx.viewpager.widget.ViewPager\n                android:id=&quot;@+id/viewPagerMain&quot;\n                android:layout_width=&quot;match_parent&quot;\n                android:layout_height=&quot;250dp&quot;\n                android:background=&quot;@color/strongblue&quot;\n                android:contentDescription=&quot;@string/wali&quot;\n                /&gt;\n\n            &lt;androidx.appcompat.widget.LinearLayoutCompat\n                android:layout_width=&quot;match_parent&quot;\n                android:layout_height=&quot;wrap_content&quot;\n                android:orientation=&quot;vertical&quot;&gt;\n\n                &lt;TextView\n                    android:id=&quot;@+id/bienvenido2&quot;\n                    android:layout_width=&quot;wrap_content&quot;\n                    android:layout_height=&quot;wrap_content&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:layout_marginTop=&quot;25dp&quot;\n                    android:text=&quot;@string/bienvenido2&quot;\n                    android:textColor=&quot;@color/WaliBlue&quot;\n                    android:textSize=&quot;40sp&quot;\n                    android:textStyle=&quot;bold&quot; /&gt;\n\n                &lt;androidx.appcompat.widget.LinearLayoutCompat\n                    android:layout_width=&quot;wrap_content&quot;\n                    android:layout_height=&quot;wrap_content&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:gravity=&quot;center&quot;\n                    android:orientation=&quot;horizontal&quot;\n                    android:weightSum=&quot;2&quot;&gt;\n\n                    &lt;TextView\n                        android:id=&quot;@+id/usuariorecordado&quot;\n                        android:layout_width=&quot;wrap_content&quot;\n                        android:layout_height=&quot;wrap_content&quot;\n                        android:layout_weight=&quot;1&quot;\n                        android:gravity=&quot;center&quot;\n                        android:text=&quot;@string/usuariovariable&quot;\n                        android:textColor=&quot;@color/WaliBlue&quot;\n                        android:textSize=&quot;40sp&quot;\n                        android:textStyle=&quot;bold&quot; /&gt;\n\n                    &lt;TextView\n                        android:id=&quot;@+id/bienvenido2final&quot;\n                        android:layout_width=&quot;wrap_content&quot;\n                        android:layout_height=&quot;wrap_content&quot;\n                        android:layout_weight=&quot;1&quot;\n                        android:drawablePadding=&quot;10dp&quot;\n                        android:text=&quot;@string/bienvenido2final&quot;\n                        android:textColor=&quot;@color/WaliBlue&quot;\n                        android:textSize=&quot;40sp&quot;\n                        android:textStyle=&quot;bold&quot;\n                        app:drawableEndCompat=&quot;@drawable/mano_ico&quot; /&gt;\n\n                &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\n\n                &lt;TextView\n                    android:id=&quot;@+id/iniciasesion&quot;\n                    android:layout_width=&quot;wrap_content&quot;\n                    android:layout_height=&quot;wrap_content&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:layout_marginTop=&quot;5dp&quot;\n                    android:text=&quot;@string/iniciasesion&quot;\n                    android:textColor=&quot;@color/walilog&quot;\n                    android:textSize=&quot;20sp&quot; /&gt;\n\n\n                &lt;com.google.android.material.textfield.TextInputLayout\n                    android:layout_width=&quot;350dp&quot;\n                    android:layout_height=&quot;wrap_content&quot;\n                    android:layout_alignParentTop=&quot;true&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:layout_marginTop=&quot;60dp&quot;\n                    app:passwordToggleEnabled=&quot;true&quot;\n                    app:passwordToggleTint=&quot;@color/green&quot;&gt;\n\n                    &lt;EditText\n                        android:id=&quot;@+id/password&quot;\n                        android:layout_width=&quot;match_parent&quot;\n                        android:layout_height=&quot;48sp&quot;\n                        android:autofillHints=&quot;&quot;\n                        android:backgroundTint=&quot;@color/green&quot;\n                        android:hint=&quot;@string/password&quot;\n                        android:inputType=&quot;textPassword&quot;\n                        android:textColor=&quot;@color/black&quot;\n                        android:textSize=&quot;18sp&quot; /&gt;\n                &lt;/com.google.android.material.textfield.TextInputLayout&gt;\n\n                &lt;androidx.appcompat.widget.SwitchCompat\n                    android:id=&quot;@+id/recordarSesion&quot;\n                    android:layout_width=&quot;wrap_content&quot;\n                    android:layout_height=&quot;48dp&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:checked=&quot;true&quot;\n                    android:text=&quot;@string/recordarSesion&quot;\n                    android:textColor=&quot;@color/grey&quot;\n                    app:switchPadding=&quot;15dp&quot;\n                    app:thumbTint=&quot;@drawable/newthumb_switch&quot; /&gt;\n\n                &lt;!-- &lt;TextView\n                    android:layout_width=&quot;wrap_content&quot;\n                    android:layout_height=&quot;wrap_content&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:drawablePadding=&quot;10dp&quot;\n                    android:gravity=&quot;center&quot;\n                    android:text=&quot;@string/recordarSesion&quot;\n                    android:textSize=&quot;15sp&quot;\n                    android:layout_marginTop=&quot;5dp&quot;\n                    app:drawableRightCompat=&quot;@drawable/toggle_on&quot; /&gt;\n\n                    Temporal porque irá un toggle--&gt;\n\n\n                &lt;Button\n                    android:id=&quot;@+id/botoniniciar&quot;\n                    android:layout_width=&quot;250dp&quot;\n                    android:layout_height=&quot;50dp&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:layout_marginTop=&quot;60dp&quot;\n                    android:background=&quot;@drawable/boton_ripple&quot;\n                    android:text=&quot;@string/botoniniciar&quot;\n                    android:textAllCaps=&quot;false&quot;\n                    android:textColor=&quot;@color/white&quot;\n                    android:textSize=&quot;20sp&quot;\n                    android:textStyle=&quot;bold&quot; /&gt;\n\n                &lt;TextView\n                    android:id=&quot;@+id/nousuario&quot;\n                    android:layout_width=&quot;wrap_content&quot;\n                    android:layout_height=&quot;wrap_content&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:layout_marginTop=&quot;20dp&quot;\n                    android:gravity=&quot;center&quot;\n                    android:text=&quot;@string/nousuario&quot;\n                    android:textSize=&quot;16sp&quot; /&gt;\n\n                &lt;Button\n                    android:id=&quot;@+id/otracuenta&quot;\n                    style=&quot;?android:attr/borderlessButtonStyle&quot;\n                    android:layout_width=&quot;wrap_content&quot;\n                    android:layout_height=&quot;48dp&quot;\n                    android:layout_gravity=&quot;center&quot;\n                    android:background=&quot;@null&quot;\n                    android:gravity=&quot;top&quot;\n                    android:text=&quot;@string/otracuenta&quot;\n                    android:textAllCaps=&quot;false&quot;\n                    android:textColor=&quot;@color/walilog&quot;\n                    android:textSize=&quot;16sp&quot;\n                    android:textStyle=&quot;bold&quot; /&gt;\n\n            &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\n\n            &lt;androidx.appcompat.widget.LinearLayoutCompat\n                android:layout_width=&quot;match_parent&quot;\n                android:layout_height=&quot;130dp&quot;\n                android:layout_gravity=&quot;bottom&quot;\n                android:background=&quot;@color/white&quot;\n                android:gravity=&quot;bottom&quot;\n                android:orientation=&quot;vertical&quot;&gt;\n\n                &lt;androidx.appcompat.widget.LinearLayoutCompat\n                    android:layout_width=&quot;match_parent&quot;\n                    android:layout_height=&quot;wrap_content&quot;\n                    android:background=&quot;@color/azulrey&quot;\n                    android:orientation=&quot;horizontal&quot;\n                    android:weightSum=&quot;2&quot;\n                    android:layout_gravity=&quot;bottom&quot;&gt;\n\n                    &lt;TextView\n                        android:id=&quot;@+id/link&quot;\n                        android:layout_width=&quot;wrap_content&quot;\n                        android:layout_height=&quot;50dp&quot;\n                        android:layout_gravity=&quot;bottom&quot;\n                        android:layout_marginStart=&quot;15dp&quot;\n                        android:layout_weight=&quot;1&quot;\n                        android:autoLink=&quot;web&quot;\n                        android:drawablePadding=&quot;8dp&quot;\n                        android:gravity=&quot;center|left&quot;\n                        android:text=&quot;@string/link&quot;\n                        android:textColorLink=&quot;@color/white&quot;\n                        android:textSize=&quot;20sp&quot;\n                        android:textStyle=&quot;bold&quot;\n                        app:drawableLeftCompat=&quot;@drawable/web&quot;\n                        tools:ignore=&quot;RtlHardcoded&quot; /&gt;\n\n                    &lt;Button\n                        android:id=&quot;@+id/ayuda&quot;\n                        android:layout_width=&quot;wrap_content&quot;\n                        android:layout_height=&quot;48dp&quot;\n                        android:layout_gravity=&quot;bottom&quot;\n                        android:layout_marginEnd=&quot;-30dp&quot;\n                        android:layout_weight=&quot;1&quot;\n                        android:background=&quot;@null&quot;\n                        android:drawablePadding=&quot;8dp&quot;\n                        android:gravity=&quot;center_vertical&quot;\n                        android:text=&quot;@string/ayuda&quot;\n                        android:textAllCaps=&quot;false&quot;\n                        android:textColor=&quot;@color/white&quot;\n                        android:textSize=&quot;20sp&quot;\n                        android:textStyle=&quot;bold&quot;\n                        app:drawableStartCompat=&quot;@drawable/ayuda&quot;\n                        tools:ignore=&quot;RtlHardcoded&quot; /&gt;\n\n                &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\n            &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\n\n        &lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;\n\n        &lt;RelativeLayout\n\n            android:layout_width=&quot;match_parent&quot;\n            android:layout_height=&quot;match_parent&quot;\n            android:background=&quot;@color/dimBackground&quot;\n            android:elevation=&quot;2dp&quot;\n            android:gravity=&quot;center&quot;\n            android:visibility=&quot;invisible&quot;&gt;\n\n            &lt;ProgressBar\n                android:id=&quot;@+id/loadingPanel&quot;\n                android:layout_width=&quot;wrap_content&quot;\n                android:layout_height=&quot;wrap_content&quot;\n                android:elevation=&quot;10dp&quot;\n                android:background=&quot;@drawable/rounded_corners&quot;\n                android:indeterminate=&quot;true&quot;\n                /&gt;\n\n        &lt;/RelativeLayout&gt;\n\n    &lt;/RelativeLayout&gt;\n\n&lt;/ScrollView&gt;\n</code></pre>\n<pre><code>public class ViewPagerAdapter extends PagerAdapter {\n    // Context object\n    Context context;\n\n    // Array of images\n    int[] images;\n\n    // Layout Inflater\n    LayoutInflater mLayoutInflater;\n\n\n    // Viewpager Constructor\n    public ViewPagerAdapter(Context context, int[] images) {\n        this.context = context;\n        this.images = images;\n        mLayoutInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);\n    }\n\n    @Override\n    public int getCount() {\n        // return the number of images\n        return images.length;\n    }\n\n    @Override\n    public boolean isViewFromObject(@NonNull View view, @NonNull Object object) {\n        return view == ((LinearLayout) object);\n    }\n\n    @NonNull\n    @Override\n    public Object instantiateItem(@NonNull ViewGroup container, final int position) {\n\n        // inflating the item\n        View itemView = mLayoutInflater.inflate(R.layout.carrusel_inicio, container, false);\n\n        // referencing the image view from the item.xml file\n        ImageView imageView = (ImageView) itemView.findViewById(R.id.imageViewMain);\n\n        // setting the image in the imageView\n        imageView.setImageResource(images[position]);\n\n        // Adding the View\n        Objects.requireNonNull(container).addView(itemView);\n\n        return itemView;\n    }\n\n    @Override\n    public void destroyItem(ViewGroup container, int position, @NonNull Object object) {\n\n        container.removeView((LinearLayout) object);\n    }\n}\n</code></pre>\n<pre><code>public class Login_recordarUsuario extends AppCompatActivity {\n\n    EditText password;\n    Button botoniniciar,otracuenta,ayuda;\n    public ProgressDialog progressDialog;\n    public ProgressBar loadingPanel;\n    TextView iniciasesion,bienvenido2,link,nousuario,bienvenido2final,usuariorecordado;\n    SwitchCompat recordarSesion;\n    ViewPager mViewPager;\n    int[] images = {R.drawable.walilogin, R.drawable.wall_e, R.drawable.walle};\n    ViewPagerAdapter mViewPagerAdapter;\n\n    @SuppressLint(&quot;MissingInflatedId&quot;)\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_login_recordar_usuario);\n\n        ConnectivityManager connectivityManager = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);\n\n        boolean connected = (Objects.requireNonNull(connectivityManager.getNetworkInfo(ConnectivityManager.TYPE_MOBILE)).getState() == NetworkInfo.State.CONNECTED ||\n                Objects.requireNonNull(connectivityManager.getNetworkInfo(ConnectivityManager.TYPE_WIFI)).getState() == NetworkInfo.State.CONNECTED);\n\n            String ubicacion = &quot;Tipografia/GalanoGrotesqueAlt-Regular.ttf&quot;;\n            String ubicacion2 = &quot;Tipografia/GalanoGrotesqueDEMO-Bold.ttf&quot;;\n            Typeface tf = Typeface.createFromAsset(Login_recordarUsuario.this.getAssets(), ubicacion); //Inicia sesión para...\n            Typeface tf2 = Typeface.createFromAsset(Login_recordarUsuario.this.getAssets(), ubicacion2); // Bienvenido\n\n            recordarSesion = findViewById(R.id.recordarSesion);\n\n            password = findViewById(R.id.password);\n            botoniniciar = findViewById(R.id.botoniniciar);\n            progressDialog = new ProgressDialog(Login_recordarUsuario.this);\n            loadingPanel = findViewById(R.id.loadingPanel);\n            progressDialog.setMessage(&quot;Iniciando sesión...&quot;);\n            iniciasesion = findViewById(R.id.iniciasesion);\n            bienvenido2 = findViewById(R.id.bienvenido2);\n            link = findViewById(R.id.link);\n            nousuario = findViewById(R.id.nousuario);\n            otracuenta = findViewById(R.id.otracuenta);\n            usuariorecordado = findViewById(R.id.usuariorecordado);\n            bienvenido2final = findViewById(R.id.bienvenido2final);\n            ayuda = findViewById(R.id.ayuda);\n\n        // Initializing the ViewPager Object\n        mViewPager = findViewById(R.id.viewPagerMain);\n\n        // Initializing the ViewPagerAdapter\n        mViewPagerAdapter = new ViewPagerAdapter(Login_recordarUsuario.this, images);\n\n        // Adding the Adapter to the ViewPager\n        mViewPager.setAdapter(mViewPagerAdapter);\n\n//.... code Continues\n</code></pre>\n"},{"tags":["java","spring-boot","tomcat","unicode"],"comments":[{"owner":{"account_id":1471892,"reputation":9718,"user_id":1383240,"accept_rate":38,"display_name":"NiVeR"},"score":0,"creation_date":1532963975,"post_id":51597136,"comment_id":90160424,"body_markdown":"In second case which character is it?","body":"In second case which character is it?"},{"owner":{"account_id":7695425,"reputation":21,"user_id":5830134,"display_name":"Anshu Kumar"},"score":0,"creation_date":1532967769,"post_id":51597136,"comment_id":90162597,"body_markdown":"uFF07 represents &quot; single double quote character. Here problem is with u character tomcat hates to see it !!!","body":"uFF07 represents &quot; single double quote character. Here problem is with u character tomcat hates to see it !!!"}],"answers":[{"comments":[{"owner":{"account_id":7695425,"reputation":21,"user_id":5830134,"display_name":"Anshu Kumar"},"score":0,"creation_date":1532968390,"post_id":51597484,"comment_id":90162931,"body_markdown":"This does not work it changes default encoding of tomcat from ISO_8859_1 to UTF-8. Basically I have concern with the way tomcat decodes unicode character it just hates any thing after % character other than two hexadecimal digits","body":"This does not work it changes default encoding of tomcat from ISO_8859_1 to UTF-8. Basically I have concern with the way tomcat decodes unicode character it just hates any thing after % character other than two hexadecimal digits"},{"owner":{"account_id":7695425,"reputation":21,"user_id":5830134,"display_name":"Anshu Kumar"},"score":0,"creation_date":1533011173,"post_id":51597484,"comment_id":90176247,"body_markdown":"% character should have invoke 400 response. Here parameter get parsed as null which results in 200 response with all unfiltered data.","body":"% character should have invoke 400 response. Here parameter get parsed as null which results in 200 response with all unfiltered data."},{"owner":{"account_id":8606921,"reputation":1580,"user_id":6446770,"accept_rate":100,"display_name":"miiiii"},"score":0,"creation_date":1533021411,"post_id":51597484,"comment_id":90180133,"body_markdown":"What are you trying to say?? Why do you think `%` character should invoke `400` (which is a bad request) ?? I think you must read https://www.w3schools.com/tags/ref_urlencode.asp about url encoding.\n\nIt clearly says, `URL encoding replaces unsafe ASCII characters with a &quot;%&quot; followed by two hexadecimal digits.` and when you manually pass `%uFF07` it looks for `%XX` and here, `XX` means two hexadecimal string (i.e. 0-9 &amp; A-F) but as we know `u` is not a valid hex character, it ignores the value as dirty value. hence shows `null` in variable.","body":"What are you trying to say?? Why do you think <code>%</code> character should invoke <code>400</code> (which is a bad request) ?? I think you must read <a href=\"https://www.w3schools.com/tags/ref_urlencode.asp\" rel=\"nofollow noreferrer\">w3schools.com/tags/ref_urlencode.asp</a> about url encoding.  It clearly says, <code>URL encoding replaces unsafe ASCII characters with a &quot;%&quot; followed by two hexadecimal digits.</code> and when you manually pass <code>%uFF07</code> it looks for <code>%XX</code> and here, <code>XX</code> means two hexadecimal string (i.e. 0-9 &amp; A-F) but as we know <code>u</code> is not a valid hex character, it ignores the value as dirty value. hence shows <code>null</code> in variable."},{"owner":{"account_id":7695425,"reputation":21,"user_id":5830134,"display_name":"Anshu Kumar"},"score":0,"creation_date":1533023464,"post_id":51597484,"comment_id":90181208,"body_markdown":"yes an invalid character which can not be decoded should get response of 400","body":"yes an invalid character which can not be decoded should get response of 400"},{"owner":{"account_id":8606921,"reputation":1580,"user_id":6446770,"accept_rate":100,"display_name":"miiiii"},"score":0,"creation_date":1533032317,"post_id":51597484,"comment_id":90186605,"body_markdown":"Nope, if the character is not recognized that doesn&#39;t mean server would send `400` code.. `400` is for if your request (complete HTTP request) is not understood by the server then server sends `400` saying oops I didn get what you want to do.. but in your case, the value of request param is not recognized.. but your request is well recognized, if you put print in your method, you will see the output printed coz server knows which method to execute but gets param values as `null`.","body":"Nope, if the character is not recognized that doesn&#39;t mean server would send <code>400</code> code.. <code>400</code> is for if your request (complete HTTP request) is not understood by the server then server sends <code>400</code> saying oops I didn get what you want to do.. but in your case, the value of request param is not recognized.. but your request is well recognized, if you put print in your method, you will see the output printed coz server knows which method to execute but gets param values as <code>null</code>."}],"tags":[],"owner":{"account_id":8606921,"reputation":1580,"user_id":6446770,"accept_rate":100,"display_name":"miiiii"},"comment_count":5,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1532974472,"creation_date":1532964769,"answer_id":51597484,"question_id":51597136,"body_markdown":"You are passing `%` sign in your url, but `%` is symbol in url, to pass `%` as it is... you will have to pass `%25` then it will work as you expected.\r\n\r\nSo, if you pass `%25uFF07` then it will show you `%uFF07` as value.\r\n\r\nNo need to change anything in application.properties or any kind of settings. I have tested this in my project.\r\n\r\nPlease feel free to ask for any clarification. Hope It Helps.","title":"SpringBoot embedded tomcat server reads unicode character in query parameter as null","body":"<p>You are passing <code>%</code> sign in your url, but <code>%</code> is symbol in url, to pass <code>%</code> as it is... you will have to pass <code>%25</code> then it will work as you expected.</p>\n\n<p>So, if you pass <code>%25uFF07</code> then it will show you <code>%uFF07</code> as value.</p>\n\n<p>No need to change anything in application.properties or any kind of settings. I have tested this in my project.</p>\n\n<p>Please feel free to ask for any clarification. Hope It Helps.</p>\n"},{"tags":[],"owner":{"account_id":7695425,"reputation":21,"user_id":5830134,"display_name":"Anshu Kumar"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1701113074,"creation_date":1533296803,"answer_id":51671932,"question_id":51597136,"body_markdown":"I found out a way using filters. Basics about filters could be found over [here][1]. We can intercept request query string there and use Tomcat UDecoder class to parse the query string and if any exception is thrown we can show response of 400\r\n\r\n```java\r\npublic class SimpleFilter implements Filter {\r\n\r\n\tprivate final UDecoder urlDecoder = new UDecoder();\r\n\tprivate final Logger logger = LoggerFactory.getLogger(SimpleFilter.class);\r\n\r\n\t@Override\r\n\tpublic void init(FilterConfig filterConfig) throws ServletException {\r\n\t}\r\n\r\n\t@Override\r\n\tpublic void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\r\n\t\t\tthrows IOException, ServletException {\r\n\t\tHttpServletRequest httpServletRequest = (HttpServletRequest) request;\r\n\t\tHttpServletResponse httpServletResponse = (HttpServletResponse) response;\r\n\r\n\t\tString queryString = httpServletRequest.getQueryString();\r\n\t\tif (queryString != null) {\r\n\t\t\tByteChunk byteChunk = new ByteChunk();\r\n\t\t\tbyteChunk.setBytes(queryString.getBytes(), 0, queryString.length());\r\n\t\t\ttry {\r\n\t\t\t\turlDecoder.convert(byteChunk, true);\r\n\t\t\t} catch (IOException ioException) {\r\n\t\t\t\tlogger.error(&quot;Hazarduos character found in request parameter.&quot;);\r\n\t\t\t\thttpServletResponse.setStatus(HttpStatus.BAD_REQUEST.value());\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tchain.doFilter(request, response);\r\n\t}\r\n\r\n\t@Override\r\n\tpublic void destroy() {\r\n\t}\r\n\r\n}\r\n```\r\n\r\n  [1]: http://tutorials.jenkov.com/java-servlets/servlet-filters.html","title":"SpringBoot embedded tomcat server reads unicode character in query parameter as null","body":"<p>I found out a way using filters. Basics about filters could be found over <a href=\"http://tutorials.jenkov.com/java-servlets/servlet-filters.html\" rel=\"nofollow noreferrer\">here</a>. We can intercept request query string there and use Tomcat UDecoder class to parse the query string and if any exception is thrown we can show response of 400</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class SimpleFilter implements Filter {\n\n    private final UDecoder urlDecoder = new UDecoder();\n    private final Logger logger = LoggerFactory.getLogger(SimpleFilter.class);\n\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {\n    }\n\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n            throws IOException, ServletException {\n        HttpServletRequest httpServletRequest = (HttpServletRequest) request;\n        HttpServletResponse httpServletResponse = (HttpServletResponse) response;\n\n        String queryString = httpServletRequest.getQueryString();\n        if (queryString != null) {\n            ByteChunk byteChunk = new ByteChunk();\n            byteChunk.setBytes(queryString.getBytes(), 0, queryString.length());\n            try {\n                urlDecoder.convert(byteChunk, true);\n            } catch (IOException ioException) {\n                logger.error(&quot;Hazarduos character found in request parameter.&quot;);\n                httpServletResponse.setStatus(HttpStatus.BAD_REQUEST.value());\n                return;\n            }\n        }\n        chain.doFilter(request, response);\n    }\n\n    @Override\n    public void destroy() {\n    }\n\n}\n</code></pre>\n"}],"owner":{"account_id":7695425,"reputation":21,"user_id":5830134,"display_name":"Anshu Kumar"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":1159,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":51671932,"answer_count":2,"score":0,"last_activity_date":1701113074,"creation_date":1532963570,"question_id":51597136,"body_markdown":"I have a rest end point designed in spring boot. Tomcat is being used as embedded server. It takes a query parameter. \r\n\r\n 1. When I pass query parameter as param1%uFF07 tomcat internally reads parameter as null\r\n 2. When I pass query parameter as param1%FF07 tomcat reads as some character.\r\n\r\ntomcat only reads &#39;%&#39; character when followed by two hexadecimal numbers, if u is placed after &#39;%&#39; character tomcat parse parameter as `null` with message \r\n\r\n&gt; Character decoding failed. Parameter [name] with value [param1%uFF07]\r\n&gt; has been ignored. Note that the name and value quoted here may be\r\n&gt; corrupted due to the failed decoding. Use debug level logging to see\r\n&gt; the original, non-corrupted values.  Note: further occurrences of\r\n&gt; Parameter errors will be logged at DEBUG level.\r\n\r\n\r\nHere is spring boot controller code\r\n\r\n\t@RestController\r\n\tpublic class GreetingController {\r\n\r\n\t\tprivate static final String template = &quot;Hello, %s!&quot;;\r\n\t\tprivate final AtomicLong counter = new AtomicLong();\r\n\r\n\t\t@RequestMapping(&quot;/greeting&quot;)\r\n\t\tpublic Greeting greeting(@RequestParam(value = &quot;name&quot;, required = false) String name) {\r\n\t\t\treturn new Greeting(counter.incrementAndGet(), String.format(template, name));\r\n\t\t}\r\n\t}","title":"SpringBoot embedded tomcat server reads unicode character in query parameter as null","body":"<p>I have a rest end point designed in spring boot. Tomcat is being used as embedded server. It takes a query parameter. </p>\n\n<ol>\n<li>When I pass query parameter as param1%uFF07 tomcat internally reads parameter as null</li>\n<li>When I pass query parameter as param1%FF07 tomcat reads as some character.</li>\n</ol>\n\n<p>tomcat only reads '%' character when followed by two hexadecimal numbers, if u is placed after '%' character tomcat parse parameter as <code>null</code> with message </p>\n\n<blockquote>\n  <p>Character decoding failed. Parameter [name] with value [param1%uFF07]\n  has been ignored. Note that the name and value quoted here may be\n  corrupted due to the failed decoding. Use debug level logging to see\n  the original, non-corrupted values.  Note: further occurrences of\n  Parameter errors will be logged at DEBUG level.</p>\n</blockquote>\n\n<p>Here is spring boot controller code</p>\n\n<pre><code>@RestController\npublic class GreetingController {\n\n    private static final String template = \"Hello, %s!\";\n    private final AtomicLong counter = new AtomicLong();\n\n    @RequestMapping(\"/greeting\")\n    public Greeting greeting(@RequestParam(value = \"name\", required = false) String name) {\n        return new Greeting(counter.incrementAndGet(), String.format(template, name));\n    }\n}\n</code></pre>\n"},{"tags":["java","math","optimization","perfect-square"],"comments":[{"owner":{"account_id":14410,"reputation":44184,"user_id":29639,"accept_rate":74,"display_name":"T.E.D."},"score":0,"creation_date":1226931825,"post_id":295579,"comment_id":142819,"body_markdown":"Since Integer and Long son&#39;t really have a specific length specified (in most C-ish langauges, which is what your code looks like), better to say that, for a 32-bit integer, there are 2**16 perfect squares.","body":"Since Integer and Long son&#39;t really have a specific length specified (in most C-ish langauges, which is what your code looks like), better to say that, for a 32-bit integer, there are 2**16 perfect squares."},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":27,"creation_date":1226932513,"post_id":295579,"comment_id":142833,"body_markdown":"This is Java code, where int==32 bits and long==64 bits, and both are signed.","body":"This is Java code, where int==32 bits and long==64 bits, and both are signed."},{"owner":{"account_id":3435,"reputation":38521,"user_id":4958,"accept_rate":75,"display_name":"ShreevatsaR"},"score":0,"creation_date":1227027173,"post_id":295579,"comment_id":145343,"body_markdown":"Which is faster: &quot;long tst = (long)Math.sqrt(n); return tst*tst == n;&quot; (what you have) or &quot;double tst = Math.sqrt(n); return tst ==(double)Math.round(tst);&quot; ?","body":"Which is faster: &quot;long tst = (long)Math.sqrt(n); return tst*tst == n;&quot; (what you have) or &quot;double tst = Math.sqrt(n); return tst ==(double)Math.round(tst);&quot; ?"},{"owner":{"account_id":7650,"reputation":5400,"user_id":13342,"accept_rate":67,"display_name":"Eric Weilnau"},"score":0,"creation_date":1227277413,"post_id":295579,"comment_id":152103,"body_markdown":"Which JVM did you use for the testing? In my experience algorithm performance is dependant on the JVM.","body":"Which JVM did you use for the testing? In my experience algorithm performance is dependant on the JVM."},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":16,"creation_date":1228248193,"post_id":295579,"comment_id":171861,"body_markdown":"@Shreevasta: I&#39;ve done some testing on large values (greater than 2^53), and your method gives some false positives.  The first one encountered is for n=9007199326062755, which is not a perfect square but is returned as one.","body":"@Shreevasta: I&#39;ve done some testing on large values (greater than 2^53), and your method gives some false positives.  The first one encountered is for n=9007199326062755, which is not a perfect square but is returned as one."},{"owner":{"account_id":20245,"reputation":17785,"user_id":48181,"accept_rate":100,"display_name":"martinus"},"score":0,"creation_date":1230853714,"post_id":295579,"comment_id":230793,"body_markdown":"There is a bug in your code:\n\nsqrt = (long)Math.sqrt(n);\nreturn sqrt*sqrt == n;\n\nMath.sqrt(n) returns a floating point representation, e.g. Math.sqrt(9) might return 2.99999999999 if you are unlucky, and when you cast it with (long) you could easily end up with a too low number.","body":"There is a bug in your code:  sqrt = (long)Math.sqrt(n); return sqrt*sqrt == n;  Math.sqrt(n) returns a floating point representation, e.g. Math.sqrt(9) might return 2.99999999999 if you are unlucky, and when you cast it with (long) you could easily end up with a too low number."},{"owner":{"account_id":2516,"reputation":31761,"user_id":3508,"accept_rate":79,"display_name":"A. Rex"},"score":0,"creation_date":1231372106,"post_id":295579,"comment_id":246516,"body_markdown":"You can use bit tricks to check the last 6 bits:  if( (x&amp;2) || ((x &amp; 7) == 5) || ((x &amp; 11) == 8) || ((x &amp; 31) == 20) || ((x &amp; 47) == 24)) return false;","body":"You can use bit tricks to check the last 6 bits:  if( (x&amp;2) || ((x &amp; 7) == 5) || ((x &amp; 11) == 8) || ((x &amp; 31) == 20) || ((x &amp; 47) == 24)) return false;"},{"owner":{"account_id":5680,"reputation":680,"user_id":9282,"display_name":"user9282"},"score":39,"creation_date":1236752856,"post_id":295579,"comment_id":446550,"body_markdown":"Please don&#39;t call it the &quot;John Carmack hack.&quot; He didn&#39;t come up with it.","body":"Please don&#39;t call it the &quot;John Carmack hack.&quot; He didn&#39;t come up with it."},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":1,"creation_date":1236775316,"post_id":295579,"comment_id":447379,"body_markdown":"@martinus: for values below 2^53, the double representation is exact so there will be no roundoff error.  i&#39;ve also tested on every perfect square greater than 2^53, as well as +/- 1 from each perfect square, and roundoff error never results in an incorrect answer.","body":"@martinus: for values below 2^53, the double representation is exact so there will be no roundoff error.  i&#39;ve also tested on every perfect square greater than 2^53, as well as +/- 1 from each perfect square, and roundoff error never results in an incorrect answer."},{"owner":{"account_id":21994,"reputation":73808,"user_id":53897,"accept_rate":56,"display_name":"Thorbj&#248;rn Ravn Andersen"},"score":0,"creation_date":1243279563,"post_id":295579,"comment_id":715598,"body_markdown":"I believe that modern JVM&#39;s may be able to skip array index checks at a given spot if it can be concluded that they will always be valid there.  What JVM was the testing done with?","body":"I believe that modern JVM&#39;s may be able to skip array index checks at a given spot if it can be concluded that they will always be valid there.  What JVM was the testing done with?"},{"owner":{"account_id":21994,"reputation":73808,"user_id":53897,"accept_rate":56,"display_name":"Thorbj&#248;rn Ravn Andersen"},"score":0,"creation_date":1243337993,"post_id":295579,"comment_id":718038,"body_markdown":"The &quot;John Carmack hack&quot; should be feasible for a larger range, by doing the extra iteration commented out in the Quake source if needed (i,e number large enough).","body":"The &quot;John Carmack hack&quot; should be feasible for a larger range, by doing the extra iteration commented out in the Quake source if needed (i,e number large enough)."},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":0,"creation_date":1243348491,"post_id":295579,"comment_id":718850,"body_markdown":"@Thorbj&#248;rn Ravn Andersen: i was using j2se 6.0 windows jvm, downloaded from sun&#39;s site. i also tried uncommenting the extra iteration, and IIRC it actually got less accurate somehow.","body":"@Thorbj&#248;rn Ravn Andersen: i was using j2se 6.0 windows jvm, downloaded from sun&#39;s site. i also tried uncommenting the extra iteration, and IIRC it actually got less accurate somehow."},{"owner":{"account_id":41028,"reputation":1596,"user_id":119151,"accept_rate":77,"display_name":"dstibbe"},"score":0,"creation_date":1253869915,"post_id":295579,"comment_id":1326152,"body_markdown":"Make your quickfail quicker and make \n// Quickfail\n  if( n &lt; 0 || ((n&amp;2) != 0) || ((n &amp; 7) == 5) || ((n &amp; 11) == 8) )\n    return false;\n  if( n == 0 )\n    return true;\n\n\nthe other way around:\n// Quickfail\n  if( n == 0 )\n    return true;\n  if( n &lt; 0 || ((n&amp;2) != 0) || ((n &amp; 7) == 5) || ((n &amp; 11) == 8) )\n    return false;","body":"Make your quickfail quicker and make  // Quickfail   if( n &lt; 0 || ((n&amp;2) != 0) || ((n &amp; 7) == 5) || ((n &amp; 11) == 8) )     return false;   if( n == 0 )     return true;   the other way around: // Quickfail   if( n == 0 )     return true;   if( n &lt; 0 || ((n&amp;2) != 0) || ((n &amp; 7) == 5) || ((n &amp; 11) == 8) )     return false;"},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":0,"creation_date":1253884111,"post_id":295579,"comment_id":1327113,"body_markdown":"@dstibbe: that would only be faster when the input is 0. for 75% of other inputs (not even counting negative numbers) it will be faster the way its written, and for the other 25% there will be no difference.","body":"@dstibbe: that would only be faster when the input is 0. for 75% of other inputs (not even counting negative numbers) it will be faster the way its written, and for the other 25% there will be no difference."},{"owner":{"account_id":43031,"reputation":10689,"user_id":125601,"accept_rate":90,"display_name":"Robert Fraser"},"score":98,"creation_date":1273141518,"post_id":295579,"comment_id":2815132,"body_markdown":"@mamama -- Perhaps, but it&#39;s attributed to him. Henry Ford didn&#39;t invent the car, the Wright Bros. didn&#39;t invent the airplane, and and Galleleo wasn&#39;t the first to figure out the Earth revolved around the sun... the world is made up of stolen inventions (and love).","body":"@mamama -- Perhaps, but it&#39;s attributed to him. Henry Ford didn&#39;t invent the car, the Wright Bros. didn&#39;t invent the airplane, and and Galleleo wasn&#39;t the first to figure out the Earth revolved around the sun... the world is made up of stolen inventions (and love)."},{"owner":{"account_id":266709,"reputation":11856,"user_id":554431,"display_name":"bestsss"},"score":0,"creation_date":1307388839,"post_id":295579,"comment_id":7297866,"body_markdown":"@Kip, the microbenchmark for the algorithm could be off due to the relatively large table. When the entire table is in the cache (tight loops) there won&#39;t be cache misses. The boolean[] should be replaced by long constants (or array) and it will gain some more.","body":"@Kip, the microbenchmark for the algorithm could be off due to the relatively large table. When the entire table is in the cache (tight loops) there won&#39;t be cache misses. The boolean[] should be replaced by long constants (or array) and it will gain some more."},{"owner":{"account_id":141346,"reputation":3444,"user_id":348306,"display_name":"Nabb"},"score":4,"creation_date":1320149194,"post_id":295579,"comment_id":9739524,"body_markdown":"You might get a tiny speed increase in the &#39;quickfail&#39; by using something like `((1&lt;&lt;(n&amp;15))|65004) != 0`, instead of having three separate checks.","body":"You might get a tiny speed increase in the &#39;quickfail&#39; by using something like <code>((1&lt;&lt;(n&amp;15))|65004) != 0</code>, instead of having three separate checks."},{"owner":{"account_id":1202806,"reputation":23223,"user_id":1173112,"accept_rate":89,"display_name":"Koray Tugay"},"score":1,"creation_date":1369529439,"post_id":295579,"comment_id":24136123,"body_markdown":"Why are you adding the 0.5 ?","body":"Why are you adding the 0.5 ?"},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":1,"creation_date":1369770137,"post_id":295579,"comment_id":24212841,"body_markdown":"@KorayTugay to round the number. My concern was that Math.sqrt might return a value that is slightly off due to roundoff error. Say, if `math.sqrt(100)` returned `9.999999999999999` instead of `10`. I am not sure if there are any cases where this actually happens, however.","body":"@KorayTugay to round the number. My concern was that Math.sqrt might return a value that is slightly off due to roundoff error. Say, if <code>math.sqrt(100)</code> returned <code>9.999999999999999</code> instead of <code>10</code>. I am not sure if there are any cases where this actually happens, however."},{"owner":{"account_id":1968644,"reputation":32046,"user_id":1768232,"accept_rate":81,"display_name":"durron597"},"score":0,"creation_date":1370905843,"post_id":295579,"comment_id":24623212,"body_markdown":"@Kip check out my answer, I got a significant performance gain on your posted answer.","body":"@Kip check out my answer, I got a significant performance gain on your posted answer."},{"owner":{"account_id":1968644,"reputation":32046,"user_id":1768232,"accept_rate":81,"display_name":"durron597"},"score":0,"creation_date":1371135475,"post_id":295579,"comment_id":24720784,"body_markdown":"@Kip I edited my post to have a third algorithm that sometimes does better than my previous answer.","body":"@Kip I edited my post to have a third algorithm that sometimes does better than my previous answer."},{"owner":{"account_id":1554495,"reputation":10643,"user_id":1446048,"accept_rate":74,"display_name":"OJFord"},"score":1,"creation_date":1398986073,"post_id":295579,"comment_id":35886857,"body_markdown":"Surprised not to see, on such a popular question, anyone point out that you can be accurate at higher `n` using so-called &#39;Carmack hack&#39; by performing another iteration(s). N.B. The result isn&#39;t Carmack&#39;s, but Newton/Raphson&#39;s, I suppose the &#39;magic number&#39; hack would be a fairer attribution to Carmack.","body":"Surprised not to see, on such a popular question, anyone point out that you can be accurate at higher <code>n</code> using so-called &#39;Carmack hack&#39; by performing another iteration(s). N.B. The result isn&#39;t Carmack&#39;s, but Newton/Raphson&#39;s, I suppose the &#39;magic number&#39; hack would be a fairer attribution to Carmack."},{"owner":{"account_id":5405149,"reputation":1274,"user_id":4303905,"accept_rate":92,"display_name":"Travis"},"score":1,"creation_date":1423543242,"post_id":295579,"comment_id":45181193,"body_markdown":"Not sure if this is what you want, but this takes about 1 millisecond. (javascript, not Java.) `return math.sqrt(x).split(&quot;.&quot;).length &gt; 1`","body":"Not sure if this is what you want, but this takes about 1 millisecond. (javascript, not Java.) <code>return math.sqrt(x).split(&quot;.&quot;).length &gt; 1</code>"},{"owner":{"account_id":5120569,"reputation":1168,"user_id":4602283,"accept_rate":75,"display_name":"Jeutnarg"},"score":0,"creation_date":1467904909,"post_id":295579,"comment_id":63919886,"body_markdown":"I&#39;m late to the party, but I believe you could squeeze even more performance out of your final code snippet by using techniques from here: http://stackoverflow.com/questions/15621083/why-does-java-switch-on-contiguous-ints-appear-to-run-faster-with-added-cases?lq=1","body":"I&#39;m late to the party, but I believe you could squeeze even more performance out of your final code snippet by using techniques from here: <a href=\"http://stackoverflow.com/questions/15621083/why-does-java-switch-on-contiguous-ints-appear-to-run-faster-with-added-cases?lq=1\" title=\"why does java switch on contiguous ints appear to run faster with added cases\">stackoverflow.com/questions/15621083/&hellip;</a>"},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":1,"creation_date":1476281312,"post_id":295579,"comment_id":67279310,"body_markdown":"@user3932000 I did it because it may result in a slight compiler optimization. Here is some better discussion: http://stackoverflow.com/questions/5547663/java-final-method-what-does-it-promise","body":"@user3932000 I did it because it may result in a slight compiler optimization. Here is some better discussion: <a href=\"http://stackoverflow.com/questions/5547663/java-final-method-what-does-it-promise\" title=\"java final method what does it promise\">stackoverflow.com/questions/5547663/&hellip;</a>"},{"owner":{"account_id":508726,"reputation":352,"user_id":1761967,"accept_rate":67,"display_name":"ZKe"},"score":1,"creation_date":1485290574,"post_id":295579,"comment_id":70862427,"body_markdown":"I have never encountered a PE problem that could not be computed in under a minute in *ruby*. So the argument that performance matters to this end is a little unbelievable.","body":"I have never encountered a PE problem that could not be computed in under a minute in <i>ruby</i>. So the argument that performance matters to this end is a little unbelievable."},{"owner":{"account_id":1448228,"reputation":3218,"user_id":1366016,"accept_rate":60,"display_name":"Wheezil"},"score":0,"creation_date":1488298321,"post_id":295579,"comment_id":72164548,"body_markdown":"I am curious how this wisdom holds up in the face of innovations like SSE SQRTPS?  http://www.felixcloutier.com/x86/SQRTPS.html,","body":"I am curious how this wisdom holds up in the face of innovations like SSE SQRTPS?  <a href=\"http://www.felixcloutier.com/x86/SQRTPS.html\" rel=\"nofollow noreferrer\">felixcloutier.com/x86/SQRTPS.html</a>,"},{"owner":{"account_id":286249,"reputation":43961,"user_id":585411,"accept_rate":60,"display_name":"btilly"},"score":0,"creation_date":1513131126,"post_id":295579,"comment_id":82530419,"body_markdown":"What is an example of a problem where this makes a difference?  Rather than calculating individual square roots for a long list it is much better to walk up the list of perfect squares and filter the list that way.","body":"What is an example of a problem where this makes a difference?  Rather than calculating individual square roots for a long list it is much better to walk up the list of perfect squares and filter the list that way."},{"owner":{"account_id":71043,"reputation":30960,"user_id":205521,"accept_rate":89,"display_name":"Thomas Ahle"},"score":1,"creation_date":1514937186,"post_id":295579,"comment_id":83112566,"body_markdown":"For very large numbers, there is a fast randomized algorithm: http://petr-mitrichev.blogspot.com/2017/12/a-quadratic-week.html","body":"For very large numbers, there is a fast randomized algorithm: <a href=\"http://petr-mitrichev.blogspot.com/2017/12/a-quadratic-week.html\" rel=\"nofollow noreferrer\">petr-mitrichev.blogspot.com/2017/12/a-quadratic-week.html</a>"},{"owner":{"account_id":4680926,"reputation":2259,"user_id":3789665,"accept_rate":57,"display_name":"greybeard"},"score":2,"creation_date":1521999149,"post_id":295579,"comment_id":85960263,"body_markdown":"@RobertFraser [Galileo Galilei](https://en.m.wikipedia.org/wiki/Galileo_Galilei) wasn&#39;t the first to have his name mutilated.","body":"@RobertFraser <a href=\"https://en.m.wikipedia.org/wiki/Galileo_Galilei\" rel=\"nofollow noreferrer\">Galileo Galilei</a> wasn&#39;t the first to have his name mutilated."},{"owner":{"account_id":873870,"reputation":47256,"user_id":924109,"accept_rate":86,"display_name":"Rok Kralj"},"score":1,"creation_date":1524416614,"post_id":295579,"comment_id":86952797,"body_markdown":"@RobertFraser: Yes, and those are great injustices, about which you can do nothing about. This is never a way to justify your bad behavior.","body":"@RobertFraser: Yes, and those are great injustices, about which you can do nothing about. This is never a way to justify your bad behavior."},{"owner":{"account_id":5263661,"reputation":101,"user_id":11307631,"display_name":"Brady Gilg"},"score":2,"creation_date":1570810807,"post_id":295579,"comment_id":103045272,"body_markdown":"@RobertFraser I&#39;ve never heard anybody claim Galileo invented the heliocentric model. It&#39;s always attributed to Copernicus. Is that who you meant?","body":"@RobertFraser I&#39;ve never heard anybody claim Galileo invented the heliocentric model. It&#39;s always attributed to Copernicus. Is that who you meant?"}],"answers":[{"comments":[{"owner":{"account_id":11158,"reputation":10349,"user_id":21365,"accept_rate":100,"display_name":"PeterAllenWebb"},"score":2,"creation_date":1226933656,"post_id":295587,"comment_id":142865,"body_markdown":"There are 2^32 perfect squares in the range of a long. This table would be huge. Also, the advantage of computing the value over a memory access could be huge.","body":"There are 2^32 perfect squares in the range of a long. This table would be huge. Also, the advantage of computing the value over a memory access could be huge."},{"owner":{"account_id":2912,"reputation":160,"user_id":4125,"display_name":"Celestial M Weasel"},"score":0,"creation_date":1227009845,"post_id":295587,"comment_id":144744,"body_markdown":"Oh no there aren&#39;t, there are 2^16. 2^32 is 2^16 squared. There are 2^16.","body":"Oh no there aren&#39;t, there are 2^16. 2^32 is 2^16 squared. There are 2^16."},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":3,"creation_date":1228245297,"post_id":295587,"comment_id":171762,"body_markdown":"yes, but the range of a long is 64 bits, not 32 bits.  sqrt(2^64)=2^32.  (i&#39;m ignoring the sign bit to make the math a little easier...  there are actually (long)(2^31.5)=3037000499 perfect squares)","body":"yes, but the range of a long is 64 bits, not 32 bits.  sqrt(2^64)=2^32.  (i&#39;m ignoring the sign bit to make the math a little easier...  there are actually (long)(2^31.5)=3037000499 perfect squares)"}],"tags":[],"owner":{"account_id":2912,"reputation":160,"user_id":4125,"display_name":"Celestial M Weasel"},"comment_count":3,"down_vote_count":3,"up_vote_count":3,"is_accepted":false,"score":0,"last_activity_date":1226929709,"creation_date":1226929709,"answer_id":295587,"question_id":295579,"body_markdown":"If you want speed, given that your integers are of finite size, I suspect that the quickest way would involve (a) partitioning the parameters by size (e.g. into categories by largest bit set), then checking the value against an array of perfect squares within that range. ","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>If you want speed, given that your integers are of finite size, I suspect that the quickest way would involve (a) partitioning the parameters by size (e.g. into categories by largest bit set), then checking the value against an array of perfect squares within that range. </p>\n"},{"comments":[{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":11,"creation_date":1226951812,"post_id":295590,"comment_id":143510,"body_markdown":"It should be noted that this returns 1/sqrt(number), not sqrt(number).  I&#39;ve done some testing, and this fails starting at n=410881: the John Carmack magic formula returns 642.00104, when the actual square root is 641.","body":"It should be noted that this returns 1/sqrt(number), not sqrt(number).  I&#39;ve done some testing, and this fails starting at n=410881: the John Carmack magic formula returns 642.00104, when the actual square root is 641."},{"owner":{"display_name":"user21037"},"score":12,"creation_date":1228213499,"post_id":295590,"comment_id":170749,"body_markdown":"You could look at Chris Lomonts paper on fast inverse square roots: http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf It uses the same technique as here, but with a different magic number. The paper explains why the magic number was chosen.","body":"You could look at Chris Lomonts paper on fast inverse square roots: <a href=\"http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf\" rel=\"nofollow noreferrer\">lomont.org/Math/Papers/2003/InvSqrt.pdf</a> It uses the same technique as here, but with a different magic number. The paper explains why the magic number was chosen."},{"owner":{"display_name":"user21037"},"score":4,"creation_date":1228213593,"post_id":295590,"comment_id":170751,"body_markdown":"Also, http://www.beyond3d.com/content/articles/8/ and http://www.beyond3d.com/content/articles/15/ shed some light as to the origins of this method. It&#39;s often attributed to John Carmack, but it seems the original code was (possibly) written by Gary Tarolli, Greg Walsh and probably others.","body":"Also, <a href=\"http://www.beyond3d.com/content/articles/8/\" rel=\"nofollow noreferrer\">beyond3d.com/content/articles/8</a> and <a href=\"http://www.beyond3d.com/content/articles/15/\" rel=\"nofollow noreferrer\">beyond3d.com/content/articles/15</a> shed some light as to the origins of this method. It&#39;s often attributed to John Carmack, but it seems the original code was (possibly) written by Gary Tarolli, Greg Walsh and probably others."},{"owner":{"account_id":1520477,"reputation":38093,"user_id":1420279,"accept_rate":80,"display_name":"Antimony"},"score":4,"creation_date":1377613783,"post_id":295590,"comment_id":27143589,"body_markdown":"Also you can&#39;t typepun  floats and ints in Java.","body":"Also you can&#39;t typepun  floats and ints in Java."},{"owner":{"account_id":130645,"reputation":81705,"user_id":330057,"accept_rate":77,"display_name":"corsiKa"},"score":15,"creation_date":1432749052,"post_id":295590,"comment_id":49057548,"body_markdown":"@Antimony who says? [FloatToIntBits](https://docs.oracle.com/javase/7/docs/api/java/lang/Float.html#floatToIntBits(float)) and [IntToFloatBits](https://docs.oracle.com/javase/7/docs/api/java/lang/Float.html#intBitsToFloat(int)) have been around since java 1.0.2.","body":"@Antimony who says? <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/Float.html#floatToIntBits(float)\" rel=\"nofollow noreferrer\">FloatToIntBits</a> and <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/Float.html#intBitsToFloat(int)\" rel=\"nofollow noreferrer\">IntToFloatBits</a> have been around since java 1.0.2."},{"owner":{"account_id":3813614,"reputation":9757,"user_id":3163618,"accept_rate":82,"display_name":"qwr"},"score":1,"creation_date":1659478403,"post_id":295590,"comment_id":129303632,"body_markdown":"This does not answer the question which is about exact square number computation.","body":"This does not answer the question which is about exact square number computation."}],"tags":[],"owner":{"account_id":2222,"reputation":61064,"user_id":3055,"accept_rate":75,"display_name":"chakrit"},"comment_count":6,"down_vote_count":3,"up_vote_count":60,"is_accepted":false,"score":57,"last_activity_date":1680649592,"creation_date":1226929819,"answer_id":295590,"question_id":295579,"body_markdown":"I was thinking about the horrible times I&#39;ve spent in Numerical Analysis course.\r\n\r\nAnd then I remember, there was this function circling around the &#39;net from the Quake Source code:\r\n\r\n```lang-cpp\r\nfloat Q_rsqrt( float number )\r\n{\r\n  long i;\r\n  float x2, y;\r\n  const float threehalfs = 1.5F;\r\n\r\n  x2 = number * 0.5F;\r\n  y  = number;\r\n  i  = * ( long * ) &amp;y;  // evil floating point bit level hacking\r\n  i  = 0x5f3759df - ( i &gt;&gt; 1 ); // wtf?\r\n  y  = * ( float * ) &amp;i;\r\n  y  = y * ( threehalfs - ( x2 * y * y ) ); // 1st iteration\r\n  // y  = y * ( threehalfs - ( x2 * y * y ) ); // 2nd iteration, this can be removed\r\n\r\n  #ifndef Q3_VM\r\n  #ifdef __linux__\r\n    assert( !isnan(y) ); // bk010122 - FPE?\r\n  #endif\r\n  #endif\r\n  return y;\r\n}\r\n```\r\n\r\nWhich basically calculates a square root, using Newton&#39;s approximation function (cant remember the exact name).\r\n\r\nIt should be usable and might even be faster, it&#39;s from one of the phenomenal id software&#39;s game!\r\n\r\nIt&#39;s written in C++ but it should not be too hard to reuse the same technique in Java once you get the idea:\r\n\r\nI originally found it at: &lt;https://web.archive.org/web/20110708173806/https://www.codemaestro.com/reviews/9&gt;\r\n\r\nNewton&#39;s method explained at wikipedia: &lt;http://en.wikipedia.org/wiki/Newton%27s_method&gt;\r\n\r\nYou can follow the link for more explanation of how it works, but if you don&#39;t care much, then this is roughly what I remember from reading the blog and from taking the Numerical Analysis course:\r\n\r\n* the `* (long*) &amp;y` is basically a fast convert-to-long function so integer operations can be applied on the raw bytes.\r\n* the `0x5f3759df - (i &gt;&gt; 1);` line is a pre-calculated seed value for the approximation function.\r\n* the `* (float*) &amp;i` converts the value back to floating point.\r\n* the `y  = y * ( threehalfs - ( x2 * y * y ) )` line bascially iterates the value over the function again.\r\n\r\nThe approximation function gives more precise values the more you iterate the function over the result. In Quake&#39;s case, one iteration is &quot;good enough&quot;, but if it wasn&#39;t for you... then you could add as much iteration as you need.\r\n\r\nThis should be faster because it reduces the number of division operations done in naive square rooting down to a simple divide by 2 (actually a `* 0.5F` multiply operation) and replace it with a few fixed number of multiplication operations instead.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>I was thinking about the horrible times I've spent in Numerical Analysis course.</p>\n<p>And then I remember, there was this function circling around the 'net from the Quake Source code:</p>\n<pre class=\"lang-cpp prettyprint-override\"><code>float Q_rsqrt( float number )\n{\n  long i;\n  float x2, y;\n  const float threehalfs = 1.5F;\n\n  x2 = number * 0.5F;\n  y  = number;\n  i  = * ( long * ) &amp;y;  // evil floating point bit level hacking\n  i  = 0x5f3759df - ( i &gt;&gt; 1 ); // wtf?\n  y  = * ( float * ) &amp;i;\n  y  = y * ( threehalfs - ( x2 * y * y ) ); // 1st iteration\n  // y  = y * ( threehalfs - ( x2 * y * y ) ); // 2nd iteration, this can be removed\n\n  #ifndef Q3_VM\n  #ifdef __linux__\n    assert( !isnan(y) ); // bk010122 - FPE?\n  #endif\n  #endif\n  return y;\n}\n</code></pre>\n<p>Which basically calculates a square root, using Newton's approximation function (cant remember the exact name).</p>\n<p>It should be usable and might even be faster, it's from one of the phenomenal id software's game!</p>\n<p>It's written in C++ but it should not be too hard to reuse the same technique in Java once you get the idea:</p>\n<p>I originally found it at: <a href=\"https://web.archive.org/web/20110708173806/https://www.codemaestro.com/reviews/9\" rel=\"nofollow noreferrer\">https://web.archive.org/web/20110708173806/https://www.codemaestro.com/reviews/9</a></p>\n<p>Newton's method explained at wikipedia: <a href=\"http://en.wikipedia.org/wiki/Newton%27s_method\" rel=\"nofollow noreferrer\">http://en.wikipedia.org/wiki/Newton%27s_method</a></p>\n<p>You can follow the link for more explanation of how it works, but if you don't care much, then this is roughly what I remember from reading the blog and from taking the Numerical Analysis course:</p>\n<ul>\n<li>the <code>* (long*) &amp;y</code> is basically a fast convert-to-long function so integer operations can be applied on the raw bytes.</li>\n<li>the <code>0x5f3759df - (i &gt;&gt; 1);</code> line is a pre-calculated seed value for the approximation function.</li>\n<li>the <code>* (float*) &amp;i</code> converts the value back to floating point.</li>\n<li>the <code>y  = y * ( threehalfs - ( x2 * y * y ) )</code> line bascially iterates the value over the function again.</li>\n</ul>\n<p>The approximation function gives more precise values the more you iterate the function over the result. In Quake's case, one iteration is &quot;good enough&quot;, but if it wasn't for you... then you could add as much iteration as you need.</p>\n<p>This should be faster because it reduces the number of division operations done in naive square rooting down to a simple divide by 2 (actually a <code>* 0.5F</code> multiply operation) and replace it with a few fixed number of multiplication operations instead.</p>\n"},{"comments":[{"owner":{"account_id":11158,"reputation":10349,"user_id":21365,"accept_rate":100,"display_name":"PeterAllenWebb"},"score":0,"creation_date":1226933077,"post_id":295592,"comment_id":142848,"body_markdown":"My money is on this kind of approach. Avoid calling sqrt() since it is calculating a full square root, and you only need the first few digits.","body":"My money is on this kind of approach. Avoid calling sqrt() since it is calculating a full square root, and you only need the first few digits."},{"owner":{"account_id":11683,"reputation":1438219,"user_id":22656,"accept_rate":86,"display_name":"Jon Skeet"},"score":3,"creation_date":1226933378,"post_id":295592,"comment_id":142854,"body_markdown":"On the other hand, if the floating point is being done in a dedicated FP unit, it may be using all kinds of fun tricks. I wouldn&#39;t like to bet on it without a benchmark :)\n\n(I may try it tonight though in C#, just to see...)","body":"On the other hand, if the floating point is being done in a dedicated FP unit, it may be using all kinds of fun tricks. I wouldn&#39;t like to bet on it without a benchmark :)  (I may try it tonight though in C#, just to see...)"},{"owner":{"account_id":5807,"reputation":392471,"user_id":9530,"accept_rate":78,"display_name":"Adam Rosenfield"},"score":8,"creation_date":1227931131,"post_id":295592,"comment_id":166086,"body_markdown":"Hardware sqrts are actually pretty fast these days.","body":"Hardware sqrts are actually pretty fast these days."}],"tags":[],"owner":{"account_id":11683,"reputation":1438219,"user_id":22656,"accept_rate":86,"display_name":"Jon Skeet"},"comment_count":3,"down_vote_count":0,"up_vote_count":36,"is_accepted":false,"score":36,"last_activity_date":1226933328,"creation_date":1226929848,"answer_id":295592,"question_id":295579,"body_markdown":"If you do a binary chop to try to find the &quot;right&quot; square root, you can fairly easily detect if the value you&#39;ve got is close enough to tell:\r\n\r\n    (n+1)^2 = n^2 + 2n + 1\r\n    (n-1)^2 = n^2 - 2n + 1\r\n\r\nSo having calculated `n^2`, the options are:\r\n\r\n  - `n^2 = target`: done, return true\r\n  - `n^2 + 2n + 1 &gt; target &gt; n^2` : you&#39;re close, but it&#39;s not perfect: return false\r\n  - `n^2 - 2n + 1 &lt; target &lt; n^2` : ditto\r\n  - `target &lt; n^2 - 2n + 1` : binary chop on a lower `n`\r\n  - `target &gt; n^2 + 2n + 1` : binary chop on a higher `n`\r\n\r\n(Sorry, this uses `n` as your current guess, and `target` for the parameter. Apologise for the confusion!)\r\n\r\nI don&#39;t know whether this will be faster or not, but it&#39;s worth a try.\r\n\r\nEDIT: The binary chop doesn&#39;t have to take in the whole range of integers, either `(2^x)^2 = 2^(2x)`, so once you&#39;ve found the top set bit in your target (which can be done with a bit-twiddling trick; I forget exactly how) you can quickly get a range of potential answers. Mind you, a naive binary chop is still only going to take up to 31 or 32 iterations.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>If you do a binary chop to try to find the \"right\" square root, you can fairly easily detect if the value you've got is close enough to tell:</p>\n\n<pre><code>(n+1)^2 = n^2 + 2n + 1\n(n-1)^2 = n^2 - 2n + 1\n</code></pre>\n\n<p>So having calculated <code>n^2</code>, the options are:</p>\n\n<ul>\n<li><code>n^2 = target</code>: done, return true</li>\n<li><code>n^2 + 2n + 1 &gt; target &gt; n^2</code> : you're close, but it's not perfect: return false</li>\n<li><code>n^2 - 2n + 1 &lt; target &lt; n^2</code> : ditto</li>\n<li><code>target &lt; n^2 - 2n + 1</code> : binary chop on a lower <code>n</code></li>\n<li><code>target &gt; n^2 + 2n + 1</code> : binary chop on a higher <code>n</code></li>\n</ul>\n\n<p>(Sorry, this uses <code>n</code> as your current guess, and <code>target</code> for the parameter. Apologise for the confusion!)</p>\n\n<p>I don't know whether this will be faster or not, but it's worth a try.</p>\n\n<p>EDIT: The binary chop doesn't have to take in the whole range of integers, either <code>(2^x)^2 = 2^(2x)</code>, so once you've found the top set bit in your target (which can be done with a bit-twiddling trick; I forget exactly how) you can quickly get a range of potential answers. Mind you, a naive binary chop is still only going to take up to 31 or 32 iterations.</p>\n"},{"comments":[{"owner":{"account_id":15628,"reputation":244161,"user_id":33213,"accept_rate":76,"display_name":"jalf"},"score":13,"creation_date":1226935369,"post_id":295595,"comment_id":142927,"body_markdown":"I believe Carmack&#39;s trick is fairly pointless these days. The built-in sqrt instruction is a lot faster than it used to be, so you may be better off just performing a regular square root and testing if the result is an int. As always, benchmark it.","body":"I believe Carmack&#39;s trick is fairly pointless these days. The built-in sqrt instruction is a lot faster than it used to be, so you may be better off just performing a regular square root and testing if the result is an int. As always, benchmark it."},{"owner":{"account_id":13018,"reputation":14568,"user_id":25920,"accept_rate":88,"display_name":"luke"},"score":0,"creation_date":1226947530,"post_id":295595,"comment_id":143368,"body_markdown":"doubles can always represent integers in their range exactly","body":"doubles can always represent integers in their range exactly"},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":4,"creation_date":1226951713,"post_id":295595,"comment_id":143505,"body_markdown":"This breaks starting at n=410881, the John Carmack magic formula returns 642.00104, when the actual square root is 641.","body":"This breaks starting at n=410881, the John Carmack magic formula returns 642.00104, when the actual square root is 641."},{"owner":{"account_id":7052,"reputation":48090,"user_id":12048,"accept_rate":94,"display_name":"finnw"},"score":12,"creation_date":1262865469,"post_id":295595,"comment_id":1941863,"body_markdown":"I recently used Carmack&#39;s trick in a Java game and it was very effective, giving a speedup of about 40%, so it is still useful, at least in Java.","body":"I recently used Carmack&#39;s trick in a Java game and it was very effective, giving a speedup of about 40%, so it is still useful, at least in Java."},{"owner":{"account_id":43031,"reputation":10689,"user_id":125601,"accept_rate":90,"display_name":"Robert Fraser"},"score":0,"creation_date":1273141665,"post_id":295595,"comment_id":2815147,"body_markdown":"@finnw - +40% in actual framerate or just in the sqrt function? I&#39;m actually quite surprised about this, since most of the games I&#39;ve played (and the one I&#39;ve made in XNA) have been GPU-bound instead of CPU-bound anyway (though I know this can differ between use&#39;s machine, blah blah blah)","body":"@finnw - +40% in actual framerate or just in the sqrt function? I&#39;m actually quite surprised about this, since most of the games I&#39;ve played (and the one I&#39;ve made in XNA) have been GPU-bound instead of CPU-bound anyway (though I know this can differ between use&#39;s machine, blah blah blah)"},{"owner":{"account_id":7052,"reputation":48090,"user_id":12048,"accept_rate":94,"display_name":"finnw"},"score":3,"creation_date":1273142931,"post_id":295595,"comment_id":2815257,"body_markdown":"@Robert Fraser Yes +40% in the overall frame rate.  The game had a particle physics system which took up nearly all available CPU cycles, dominated by the square root function and the round-to-nearest-integer function (which I had also optimised using a similar bit twiddling hack.)","body":"@Robert Fraser Yes +40% in the overall frame rate.  The game had a particle physics system which took up nearly all available CPU cycles, dominated by the square root function and the round-to-nearest-integer function (which I had also optimised using a similar bit twiddling hack.)"},{"owner":{"account_id":1520477,"reputation":38093,"user_id":1420279,"accept_rate":80,"display_name":"Antimony"},"score":0,"creation_date":1377613709,"post_id":295595,"comment_id":27143534,"body_markdown":"@luke but they can&#39;t represent longs above 2^53.","body":"@luke but they can&#39;t represent longs above 2^53."},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":0,"creation_date":1400533636,"post_id":295595,"comment_id":36508360,"body_markdown":"@Antimony Right, but it works when done right, see my solution below.","body":"@Antimony Right, but it works when done right, see my solution below."},{"owner":{"account_id":2249947,"reputation":1740,"user_id":1982385,"accept_rate":92,"display_name":"Daniel Gray"},"score":0,"creation_date":1562027902,"post_id":295595,"comment_id":100239415,"body_markdown":"The link has been fixed by pointing it to the Wayback Machine&#39;s snapshot from around the time this was posted :)","body":"The link has been fixed by pointing it to the Wayback Machine&#39;s snapshot from around the time this was posted :)"},{"owner":{"account_id":22374659,"reputation":1608,"user_id":16589128,"display_name":"puppydrum64"},"score":0,"creation_date":1670947342,"post_id":295595,"comment_id":131988275,"body_markdown":"Would Carmack&#39;s trick have value in an architecture other than x86? Such as MIPS?","body":"Would Carmack&#39;s trick have value in an architecture other than x86? Such as MIPS?"}],"tags":[],"owner":{"account_id":1392,"reputation":65576,"user_id":1862,"accept_rate":59,"display_name":"Kibbee"},"comment_count":10,"down_vote_count":3,"up_vote_count":41,"is_accepted":false,"score":38,"last_activity_date":1562027852,"creation_date":1226929905,"answer_id":295595,"question_id":295579,"body_markdown":"I&#39;m not sure if it would be faster, or even accurate, but you could use [John Carmack&#39;s Magical Square Root][1], algorithm to solve the square root faster.  You could probably easily test this for all possible 32 bit integers, and validate that you actually got correct results, as it&#39;s only an appoximation.  However, now that I think about it, using doubles is approximating also, so I&#39;m not sure how that would come into play.\r\n\r\n\r\n  [1]: https://web.archive.org/web/20081106174735/http://www.codemaestro.com/reviews/9","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>I'm not sure if it would be faster, or even accurate, but you could use <a href=\"https://web.archive.org/web/20081106174735/http://www.codemaestro.com/reviews/9\" rel=\"nofollow noreferrer\">John Carmack's Magical Square Root</a>, algorithm to solve the square root faster.  You could probably easily test this for all possible 32 bit integers, and validate that you actually got correct results, as it's only an appoximation.  However, now that I think about it, using doubles is approximating also, so I'm not sure how that would come into play.</p>\n"},{"comments":[{"owner":{"account_id":5559,"reputation":539158,"user_id":9021,"accept_rate":70,"display_name":"nickf"},"score":1,"creation_date":1226930670,"post_id":295613,"comment_id":142780,"body_markdown":"wouldn&#39;t it be faster and cheaper to &quot;take the square root in the normal fashion&quot; and check if its an int?","body":"wouldn&#39;t it be faster and cheaper to &quot;take the square root in the normal fashion&quot; and check if its an int?"},{"owner":{"account_id":2212,"reputation":403900,"user_id":3043,"accept_rate":70,"display_name":"Joel Coehoorn"},"score":0,"creation_date":1226937455,"post_id":295613,"comment_id":143019,"body_markdown":"I suppose it depends on whether a mod op or a mult op is faster on your system.","body":"I suppose it depends on whether a mod op or a mult op is faster on your system."},{"owner":{"account_id":9366757,"reputation":793,"user_id":8031498,"accept_rate":67,"display_name":"Steve Storck"},"score":0,"creation_date":1512471000,"post_id":295613,"comment_id":82261618,"body_markdown":"Check my suggestion above.  It takes a very simple approach.  But you can also use the sqrt function and mod it by 1.  I&#39;ll add that as another proposed solution.","body":"Check my suggestion above.  It takes a very simple approach.  But you can also use the sqrt function and mod it by 1.  I&#39;ll add that as another proposed solution."}],"tags":[],"owner":{"account_id":2212,"reputation":403900,"user_id":3043,"accept_rate":70,"display_name":"Joel Coehoorn"},"comment_count":3,"down_vote_count":6,"up_vote_count":1,"is_accepted":false,"score":-5,"last_activity_date":1226933366,"creation_date":1226930240,"answer_id":295613,"question_id":295579,"body_markdown":"Don&#39;t know about fastest, but the simplest is to take the square root in the normal fashion, multiply the result by itself, and see if it matches your original value.\r\n\r\nSince we&#39;re talking integers here, the fasted would probably involve a collection where you can just make a lookup.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Don't know about fastest, but the simplest is to take the square root in the normal fashion, multiply the result by itself, and see if it matches your original value.</p>\n\n<p>Since we're talking integers here, the fasted would probably involve a collection where you can just make a lookup.</p>\n"},{"comments":[{"owner":{"account_id":11158,"reputation":10349,"user_id":21365,"accept_rate":100,"display_name":"PeterAllenWebb"},"score":0,"creation_date":1226933804,"post_id":295678,"comment_id":142873,"body_markdown":"Nice point about the trailing bits. I would try to combine that test with some of the other remarks here.","body":"Nice point about the trailing bits. I would try to combine that test with some of the other remarks here."},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":0,"creation_date":1226938194,"post_id":295678,"comment_id":143050,"body_markdown":"I benchmarked it for the first 100 million integers.. this approximately halves the time required.","body":"I benchmarked it for the first 100 million integers.. this approximately halves the time required."},{"owner":{"account_id":19945,"reputation":6738,"user_id":47181,"display_name":"kenj0418"},"score":0,"creation_date":1265604112,"post_id":295678,"comment_id":2173301,"body_markdown":"You could extend this beyond the last digit as well.  For example, there are only 44 different values the least significant byte can have.","body":"You could extend this beyond the last digit as well.  For example, there are only 44 different values the least significant byte can have."},{"owner":{"account_id":186022,"reputation":27604,"user_id":423105,"accept_rate":68,"display_name":"LarsH"},"score":0,"creation_date":1382021014,"post_id":295678,"comment_id":28805323,"body_markdown":"FYI, I tested this method in Python. It gave about a 3/8 speedup over the vanilla `t = math.floor(math.sqrt(n) + 0.5); return t*t == n` (5 seconds vs. 8 seconds to compute for the first 100,000 integers, 100 times).","body":"FYI, I tested this method in Python. It gave about a 3/8 speedup over the vanilla <code>t = math.floor(math.sqrt(n) + 0.5); return t*t == n</code> (5 seconds vs. 8 seconds to compute for the first 100,000 integers, 100 times)."},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":4,"creation_date":1402683162,"post_id":295678,"comment_id":37384232,"body_markdown":"@LarsH There&#39;s no need to add 0.5, see my solution for a link to the proof.","body":"@LarsH There&#39;s no need to add 0.5, see my solution for a link to the proof."},{"owner":{"account_id":3690624,"reputation":44120,"user_id":3073272,"accept_rate":48,"display_name":"GorvGoyl"},"score":0,"creation_date":1483435603,"post_id":295678,"comment_id":70086347,"body_markdown":"you said that if-else is faster than switch but this http://stackoverflow.com/questions/6805026/is-switch-faster-than-if question tells the different story.","body":"you said that if-else is faster than switch but this <a href=\"http://stackoverflow.com/questions/6805026/is-switch-faster-than-if\" title=\"is switch faster than if\">stackoverflow.com/questions/6805026/is-switch-faster-than-if</a> question tells the different story."},{"owner":{"account_id":540420,"reputation":6131,"user_id":908621,"accept_rate":61,"display_name":"fishinear"},"score":3,"creation_date":1510332994,"post_id":295678,"comment_id":81405603,"body_markdown":"@JerryGoyal It depends on the compiler and the values of the cases. In a perfect compiler, a switch is always at least as fast as if-else. But compilers are not perfect, so it is best to try it out, like John did.","body":"@JerryGoyal It depends on the compiler and the values of the cases. In a perfect compiler, a switch is always at least as fast as if-else. But compilers are not perfect, so it is best to try it out, like John did."}],"tags":[],"owner":{"account_id":12710,"reputation":29685,"user_id":25188,"accept_rate":89,"display_name":"John D. Cook"},"comment_count":7,"down_vote_count":0,"up_vote_count":138,"is_accepted":false,"score":138,"last_activity_date":1233088545,"creation_date":1226932037,"answer_id":295678,"question_id":295579,"body_markdown":"You&#39;ll have to do some benchmarking.  The best algorithm will depend on the distribution of your inputs.\r\n\r\nYour algorithm may be nearly optimal, but you might want to do a quick check to rule out some possibilities before calling your square root routine.  For example, look at the last digit of your number in hex by doing a bit-wise &quot;and.&quot;  Perfect squares can only end in 0, 1, 4, or 9 in base 16,  So for 75% of your inputs (assuming they are uniformly distributed) you can avoid a call to the square root in exchange for some very fast bit twiddling.\r\n\r\nKip benchmarked the following code implementing the hex trick.  When testing numbers 1 through 100,000,000, this code ran twice as fast as the original.\r\n\r\n    public final static boolean isPerfectSquare(long n)\r\n    {\r\n        if (n &lt; 0)\r\n            return false;\r\n      \r\n        switch((int)(n &amp; 0xF))\r\n        {\r\n        case 0: case 1: case 4: case 9:\r\n            long tst = (long)Math.sqrt(n);\r\n            return tst*tst == n;\r\n        \r\n        default:\r\n            return false;\r\n        }\r\n    }\r\n\r\nWhen I tested the analogous code in C++, it actually ran slower than the original. However, when I eliminated the switch statement, the hex trick once again make the code twice as fast.\r\n\r\n    int isPerfectSquare(int n)\r\n    {\r\n        int h = n &amp; 0xF;  // h is the last hex &quot;digit&quot;\r\n        if (h &gt; 9)\r\n            return 0;\r\n        // Use lazy evaluation to jump out of the if statement as soon as possible\r\n        if (h != 2 &amp;&amp; h != 3 &amp;&amp; h != 5 &amp;&amp; h != 6 &amp;&amp; h != 7 &amp;&amp; h != 8)\r\n        {\r\n            int t = (int) floor( sqrt((double) n) + 0.5 );\r\n            return t*t == n;\r\n        }\r\n        return 0;\r\n    }\r\n\r\nEliminating the switch statement had little effect on the C# code.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>You'll have to do some benchmarking.  The best algorithm will depend on the distribution of your inputs.</p>\n\n<p>Your algorithm may be nearly optimal, but you might want to do a quick check to rule out some possibilities before calling your square root routine.  For example, look at the last digit of your number in hex by doing a bit-wise \"and.\"  Perfect squares can only end in 0, 1, 4, or 9 in base 16,  So for 75% of your inputs (assuming they are uniformly distributed) you can avoid a call to the square root in exchange for some very fast bit twiddling.</p>\n\n<p>Kip benchmarked the following code implementing the hex trick.  When testing numbers 1 through 100,000,000, this code ran twice as fast as the original.</p>\n\n<pre><code>public final static boolean isPerfectSquare(long n)\n{\n    if (n &lt; 0)\n        return false;\n\n    switch((int)(n &amp; 0xF))\n    {\n    case 0: case 1: case 4: case 9:\n        long tst = (long)Math.sqrt(n);\n        return tst*tst == n;\n\n    default:\n        return false;\n    }\n}\n</code></pre>\n\n<p>When I tested the analogous code in C++, it actually ran slower than the original. However, when I eliminated the switch statement, the hex trick once again make the code twice as fast.</p>\n\n<pre><code>int isPerfectSquare(int n)\n{\n    int h = n &amp; 0xF;  // h is the last hex \"digit\"\n    if (h &gt; 9)\n        return 0;\n    // Use lazy evaluation to jump out of the if statement as soon as possible\n    if (h != 2 &amp;&amp; h != 3 &amp;&amp; h != 5 &amp;&amp; h != 6 &amp;&amp; h != 7 &amp;&amp; h != 8)\n    {\n        int t = (int) floor( sqrt((double) n) + 0.5 );\n        return t*t == n;\n    }\n    return 0;\n}\n</code></pre>\n\n<p>Eliminating the switch statement had little effect on the C# code.</p>\n"},{"comments":[{"owner":{"account_id":2680,"reputation":48580,"user_id":3757,"accept_rate":86,"display_name":"Christian Oudard"},"score":1,"creation_date":1262969280,"post_id":295761,"comment_id":1952527,"body_markdown":"The digital root is strictly computationally equivalent to modulo, so should be considered along with other modulo methods here, such as mod 16 and mod 255.","body":"The digital root is strictly computationally equivalent to modulo, so should be considered along with other modulo methods here, such as mod 16 and mod 255."},{"owner":{"account_id":558241,"reputation":834,"user_id":920769,"accept_rate":79,"display_name":"Fractaly"},"score":1,"creation_date":1322973882,"post_id":295761,"comment_id":10332808,"body_markdown":"Are you sure the digital root is equivalent to modulo? It seems to be something entirely different as explained by the link. Notice the list is 1,4,7,9 not 1,4,5,9.","body":"Are you sure the digital root is equivalent to modulo? It seems to be something entirely different as explained by the link. Notice the list is 1,4,7,9 not 1,4,5,9."},{"owner":{"account_id":7359583,"reputation":11343,"user_id":5603247,"display_name":"Hans Olsson"},"score":1,"creation_date":1516365104,"post_id":295761,"comment_id":83667549,"body_markdown":"Digital root in the decimal system is equivalent to using modulo 9 (well dr(n)=1+((n-1) mod 9); so a slight shift as well). The numbers 0,1,4,5,9 are for modulo 16, and 0, 1, 4, 7 are for modulo 9 - which correspond to 1, 4, 7, 9 for digital root.","body":"Digital root in the decimal system is equivalent to using modulo 9 (well dr(n)=1+((n-1) mod 9); so a slight shift as well). The numbers 0,1,4,5,9 are for modulo 16, and 0, 1, 4, 7 are for modulo 9 - which correspond to 1, 4, 7, 9 for digital root."}],"tags":[],"owner":{"account_id":970,"reputation":399857,"user_id":1288,"accept_rate":93,"display_name":"Bill the Lizard"},"comment_count":3,"down_vote_count":0,"up_vote_count":18,"is_accepted":false,"score":18,"last_activity_date":1226934289,"creation_date":1226933904,"answer_id":295761,"question_id":295579,"body_markdown":"It should be much faster to use [Newton&#39;s method][1] to calculate the [Integer Square Root][2], then square this number and check, as you do in your current solution.  Newton&#39;s method is the basis for the Carmack solution mentioned in some other answers.  You should be able to get a faster answer since you&#39;re only interested in the integer part of the root, allowing you to stop the approximation algorithm sooner.\r\n\r\nAnother optimization that you can try:  If the [Digital Root][3] of a number doesn&#39;t end in \r\n1, 4, 7, or 9 the number is **not** a perfect square.  This can be used as a quick way to eliminate 60% of your inputs before applying the slower square root algorithm.\r\n\r\n\r\n  [1]: http://en.wikipedia.org/wiki/Newton%27s_method\r\n  [2]: http://en.wikipedia.org/wiki/Integer_square_root\r\n  [3]: http://en.wikipedia.org/wiki/Digital_root","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>It should be much faster to use <a href=\"http://en.wikipedia.org/wiki/Newton%27s_method\" rel=\"noreferrer\">Newton's method</a> to calculate the <a href=\"http://en.wikipedia.org/wiki/Integer_square_root\" rel=\"noreferrer\">Integer Square Root</a>, then square this number and check, as you do in your current solution.  Newton's method is the basis for the Carmack solution mentioned in some other answers.  You should be able to get a faster answer since you're only interested in the integer part of the root, allowing you to stop the approximation algorithm sooner.</p>\n\n<p>Another optimization that you can try:  If the <a href=\"http://en.wikipedia.org/wiki/Digital_root\" rel=\"noreferrer\">Digital Root</a> of a number doesn't end in \n1, 4, 7, or 9 the number is <strong>not</strong> a perfect square.  This can be used as a quick way to eliminate 60% of your inputs before applying the slower square root algorithm.</p>\n"},{"comments":[{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":0,"creation_date":1231252806,"post_id":297350,"comment_id":241058,"body_markdown":"The problem is that there is no &quot;commonly used set of inputs&quot;--usually I&#39;m iterating through a list, so I won&#39;t use the same inputs twice.","body":"The problem is that there is no &quot;commonly used set of inputs&quot;--usually I&#39;m iterating through a list, so I won&#39;t use the same inputs twice."}],"tags":[],"owner":{"account_id":15751,"reputation":13418,"user_id":33611,"accept_rate":74,"display_name":"Elijah"},"comment_count":1,"down_vote_count":1,"up_vote_count":2,"is_accepted":false,"score":1,"last_activity_date":1226964598,"creation_date":1226964598,"answer_id":297350,"question_id":295579,"body_markdown":"If speed is a concern, why not partition off the most commonly used set of inputs and their values to a lookup table and then do whatever optimized magic algorithm you have come up with for the exceptional cases?","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>If speed is a concern, why not partition off the most commonly used set of inputs and their values to a lookup table and then do whatever optimized magic algorithm you have come up with for the exceptional cases?</p>\n"},{"comments":[{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":5,"creation_date":1231252418,"post_id":299183,"comment_id":241046,"body_markdown":"I&#39;ve actually tested the answer on all perfect squares larger than 2^53, as well as all numbers from 5 below each perfect square to 5 above each perfect square, and I get the correct result.  (the roundoff error is corrected when I round the sqrt answer to a long, then square that value and compare)","body":"I&#39;ve actually tested the answer on all perfect squares larger than 2^53, as well as all numbers from 5 below each perfect square to 5 above each perfect square, and I get the correct result.  (the roundoff error is corrected when I round the sqrt answer to a long, then square that value and compare)"},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":2,"creation_date":1378667547,"post_id":299183,"comment_id":27527967,"body_markdown":"@Kip: I guess I&#39;ve proven that [it works](http://math.stackexchange.com/questions/237865/show-that-floating-point-sqrtx-cdot-x-geq-x-for-all-long-x).","body":"@Kip: I guess I&#39;ve proven that <a href=\"http://math.stackexchange.com/questions/237865/show-that-floating-point-sqrtx-cdot-x-geq-x-for-all-long-x\">it works</a>."},{"owner":{"account_id":200320,"reputation":3453,"user_id":446106,"display_name":"mwfearnley"},"score":0,"creation_date":1398128044,"post_id":299183,"comment_id":35502154,"body_markdown":"The results aren&#39;t perfectly accurate, but more accurate than you might think.  If we assume at least 15 accurate digits after the conversion to double and after the square root, then that&#39;s plenty, because we need no more than 11: 10 digits for the 32-bit square root and less than 1 for a decimal place, because the +0.5 rounds to nearest.","body":"The results aren&#39;t perfectly accurate, but more accurate than you might think.  If we assume at least 15 accurate digits after the conversion to double and after the square root, then that&#39;s plenty, because we need no more than 11: 10 digits for the 32-bit square root and less than 1 for a decimal place, because the +0.5 rounds to nearest."},{"owner":{"account_id":3941049,"reputation":51697,"user_id":3255455,"display_name":"gnasher729"},"score":4,"creation_date":1398986869,"post_id":299183,"comment_id":35887089,"body_markdown":"Math.sqrt() isn&#39;t totally accurate, but it doesn&#39;t have to. In the very first post, tst is an integer close to sqrt (N). If N is not a square, then tst * tst != N, no matter what the value of tst is. If N is a perfect square, then sqrt (N) &lt; 2^32, and as long as sqrt (N) is calculated with an error &lt; 0.5, we are fine.","body":"Math.sqrt() isn&#39;t totally accurate, but it doesn&#39;t have to. In the very first post, tst is an integer close to sqrt (N). If N is not a square, then tst * tst != N, no matter what the value of tst is. If N is a perfect square, then sqrt (N) &lt; 2^32, and as long as sqrt (N) is calculated with an error &lt; 0.5, we are fine."}],"tags":[],"owner":{"account_id":14294,"reputation":69,"user_id":29288,"display_name":"mrzl"},"comment_count":4,"down_vote_count":3,"up_vote_count":18,"is_accepted":false,"score":15,"last_activity_date":1523005669,"creation_date":1227023864,"answer_id":299183,"question_id":295579,"body_markdown":"&gt; I want this function to work with all\r\n&gt; positive 64-bit signed integers\r\n\r\n`Math.sqrt()` works with doubles as input parameters, so you won&#39;t get accurate results for integers bigger than **2^53**.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<blockquote>\n  <p>I want this function to work with all\n  positive 64-bit signed integers</p>\n</blockquote>\n\n<p><code>Math.sqrt()</code> works with doubles as input parameters, so you won't get accurate results for integers bigger than <strong>2^53</strong>.</p>\n"},{"comments":[{"owner":{"account_id":7052,"reputation":48090,"user_id":12048,"accept_rate":94,"display_name":"finnw"},"score":0,"creation_date":1262867287,"post_id":327134,"comment_id":1942018,"body_markdown":"Nice.  Did you work this out algebraically or by trial and error?  I can see why it&#39;s so effective - lots of collisions between perfect squares, e.g. 333^2 % 110880 == 3^2, 334^2 % 110880 == 26^2, 338^2 % 110880 == 58^2...","body":"Nice.  Did you work this out algebraically or by trial and error?  I can see why it&#39;s so effective - lots of collisions between perfect squares, e.g. 333^2 % 110880 == 3^2, 334^2 % 110880 == 26^2, 338^2 % 110880 == 58^2..."},{"owner":{"account_id":8382,"reputation":6567,"user_id":15069,"accept_rate":25,"display_name":"Hugh Allen"},"score":0,"creation_date":1263863932,"post_id":327134,"comment_id":2023101,"body_markdown":"IIRC it was brute force, but note that 110880 = 2^5 * 3^2 * 5 * 7 * 11, which gives 6*3*2*2*2 - 1 = 143 proper divisors.","body":"IIRC it was brute force, but note that 110880 = 2^5 * 3^2 * 5 * 7 * 11, which gives 6*3*2*2*2 - 1 = 143 proper divisors."},{"owner":{"account_id":558241,"reputation":834,"user_id":920769,"accept_rate":79,"display_name":"Fractaly"},"score":0,"creation_date":1322978225,"post_id":327134,"comment_id":10333111,"body_markdown":"I found that because of the limitations of the lookup, 44352 works better, with a 2.6% pass rate. At least in my implementation.","body":"I found that because of the limitations of the lookup, 44352 works better, with a 2.6% pass rate. At least in my implementation."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1440123196,"post_id":327134,"comment_id":52153455,"body_markdown":"Integer division (`idiv`) is equal or worse in cost to FP sqrt (`sqrtsd`) on current x86 hardware.  Also, completely disagree with avoiding bitfields.  Cache hit rate will be tons better with a bitfield, and testing a bit in a bitfield is only one or two more simple instructions than testing a whole byte.  (For tiny tables that fit in cache even as non-bitfields, a byte array would be best, not 32bit ints.  x86 has single-byte access with equal speed to 32bit dword.)","body":"Integer division (<code>idiv</code>) is equal or worse in cost to FP sqrt (<code>sqrtsd</code>) on current x86 hardware.  Also, completely disagree with avoiding bitfields.  Cache hit rate will be tons better with a bitfield, and testing a bit in a bitfield is only one or two more simple instructions than testing a whole byte.  (For tiny tables that fit in cache even as non-bitfields, a byte array would be best, not 32bit ints.  x86 has single-byte access with equal speed to 32bit dword.)"}],"tags":[],"owner":{"account_id":8382,"reputation":6567,"user_id":15069,"accept_rate":25,"display_name":"Hugh Allen"},"comment_count":4,"down_vote_count":1,"up_vote_count":11,"is_accepted":false,"score":10,"last_activity_date":1227930756,"creation_date":1227930756,"answer_id":327134,"question_id":295579,"body_markdown":"It&#39;s been pointed out that the last `d` digits of a perfect square can only take on certain values. The last `d` digits (in base `b`) of a number `n` is the same as the remainder when `n` is divided by `b`&lt;sup&gt;`d`&lt;/sup&gt;, ie. in C notation `n % pow(b, d)`.\r\n\r\nThis can be generalized to any modulus `m`, ie. `n % m` can be used to rule out some percentage of numbers from being perfect squares. The modulus you are currently using is 64, which allows 12, ie. 19% of remainders, as possible squares. With a little coding I found the modulus 110880, which allows only 2016, ie. 1.8% of remainders as possible squares. So depending on the cost of a modulus operation (ie. division) and a table lookup versus a square root on your machine, using this modulus might be faster.\r\n\r\nBy the way if Java has a way to store a packed array of bits for the lookup table, don&#39;t use it. 110880 32-bit words is not much RAM these days and fetching a machine word is going to be faster than fetching a single bit.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>It's been pointed out that the last <code>d</code> digits of a perfect square can only take on certain values. The last <code>d</code> digits (in base <code>b</code>) of a number <code>n</code> is the same as the remainder when <code>n</code> is divided by <code>b</code><sup><code>d</code></sup>, ie. in C notation <code>n % pow(b, d)</code>.</p>\n\n<p>This can be generalized to any modulus <code>m</code>, ie. <code>n % m</code> can be used to rule out some percentage of numbers from being perfect squares. The modulus you are currently using is 64, which allows 12, ie. 19% of remainders, as possible squares. With a little coding I found the modulus 110880, which allows only 2016, ie. 1.8% of remainders as possible squares. So depending on the cost of a modulus operation (ie. division) and a table lookup versus a square root on your machine, using this modulus might be faster.</p>\n\n<p>By the way if Java has a way to store a packed array of bits for the lookup table, don't use it. 110880 32-bit words is not much RAM these days and fetching a machine word is going to be faster than fetching a single bit.</p>\n"},{"comments":[{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1440123721,"post_id":333510,"comment_id":52153571,"body_markdown":"integer division is slower than FP sqrt on current hardware.  This idea has no chance. &gt;.&lt;  Even in 2008, Core2&#39;s `sqrtsd` throughput is one per 6-58c.  Its `idiv` is one per 12-36cycles.  (latencies similar to throughputs: neither unit is pipelined).","body":"integer division is slower than FP sqrt on current hardware.  This idea has no chance. &gt;.&lt;  Even in 2008, Core2&#39;s <code>sqrtsd</code> throughput is one per 6-58c.  Its <code>idiv</code> is one per 12-36cycles.  (latencies similar to throughputs: neither unit is pipelined)."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":0,"creation_date":1440123836,"post_id":333510,"comment_id":52153600,"body_markdown":"sqrt doesn&#39;t need to be perfectly accurate.  That&#39;s why you check by integer-squaring the result and doing an integer-compare to decide if the input integer had an exact integer sqrt.","body":"sqrt doesn&#39;t need to be perfectly accurate.  That&#39;s why you check by integer-squaring the result and doing an integer-compare to decide if the input integer had an exact integer sqrt."},{"owner":{"account_id":85671,"reputation":40858,"user_id":238704,"display_name":"President James K. Polk"},"score":1,"creation_date":1624140451,"post_id":333510,"comment_id":120278305,"body_markdown":"This may not be the winner but I like it because it&#39;s a different approach.","body":"This may not be the winner but I like it because it&#39;s a different approach."},{"owner":{"account_id":3813614,"reputation":9757,"user_id":3163618,"accept_rate":82,"display_name":"qwr"},"score":0,"creation_date":1659478529,"post_id":333510,"comment_id":129303673,"body_markdown":"Your solution to check if a number is square is to... factor it?? Do you know how hard factoring can be?","body":"Your solution to check if a number is square is to... factor it?? Do you know how hard factoring can be?"}],"tags":[],"owner":{"account_id":17619,"reputation":15368,"user_id":39622,"accept_rate":78,"display_name":"Cyrille Ka"},"comment_count":4,"down_vote_count":1,"up_vote_count":13,"is_accepted":false,"score":12,"last_activity_date":1228212022,"creation_date":1228212022,"answer_id":333510,"question_id":295579,"body_markdown":"Just for the record, another approach is to use the prime decomposition. If every factor of the decomposition is even, then the number is a perfect square. So what you want is to see if a number can be decomposed as a product of squares of prime numbers. Of course, you don&#39;t need to obtain such a decomposition, just to see if it exists.\r\n\r\nFirst build a table of squares of prime numbers which are lower than 2^32. This is far smaller than a table of all integers up to this limit.\r\n\r\nA solution would then be like this:\r\n\r\n    boolean isPerfectSquare(long number)\r\n    {\r\n        if (number &lt; 0) return false;\r\n        if (number &lt; 2) return true;\r\n\r\n        for (int i = 0; ; i++)\r\n        {\r\n            long square = squareTable[i];\r\n            if (square &gt; number) return false;\r\n            while (number % square == 0)\r\n            {\r\n                number /= square;\r\n            }\r\n            if (number == 1) return true;\r\n        }\r\n    }\r\n\r\nI guess it&#39;s a bit cryptic. What it does is checking in every step that the square of a prime number divide the input number. If it does then it divides the number by the square as long as it is possible, to remove this square from the prime decomposition.\r\nIf by this process, we came to 1, then the input number was a decomposition of square of prime numbers. If the square becomes larger than the number itself, then there is no way this square, or any larger squares, can divide it, so the number can not be a decomposition of squares of prime numbers.\r\n\r\nGiven nowadays&#39; sqrt done in hardware and the need to compute prime numbers here, I guess this solution is way slower. But it should give better results than solution with sqrt which won&#39;t work over 2^54, as says mrzl [in his answer][1].\r\n\r\n\r\n  [1]: #299183","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Just for the record, another approach is to use the prime decomposition. If every factor of the decomposition is even, then the number is a perfect square. So what you want is to see if a number can be decomposed as a product of squares of prime numbers. Of course, you don't need to obtain such a decomposition, just to see if it exists.</p>\n\n<p>First build a table of squares of prime numbers which are lower than 2^32. This is far smaller than a table of all integers up to this limit.</p>\n\n<p>A solution would then be like this:</p>\n\n<pre><code>boolean isPerfectSquare(long number)\n{\n    if (number &lt; 0) return false;\n    if (number &lt; 2) return true;\n\n    for (int i = 0; ; i++)\n    {\n        long square = squareTable[i];\n        if (square &gt; number) return false;\n        while (number % square == 0)\n        {\n            number /= square;\n        }\n        if (number == 1) return true;\n    }\n}\n</code></pre>\n\n<p>I guess it's a bit cryptic. What it does is checking in every step that the square of a prime number divide the input number. If it does then it divides the number by the square as long as it is possible, to remove this square from the prime decomposition.\nIf by this process, we came to 1, then the input number was a decomposition of square of prime numbers. If the square becomes larger than the number itself, then there is no way this square, or any larger squares, can divide it, so the number can not be a decomposition of squares of prime numbers.</p>\n\n<p>Given nowadays' sqrt done in hardware and the need to compute prime numbers here, I guess this solution is way slower. But it should give better results than solution with sqrt which won't work over 2^54, as says mrzl in his answer.</p>\n"},{"comments":[{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":0,"creation_date":1228506994,"post_id":342996,"comment_id":179192,"body_markdown":"I&#39;ve incorporated your suggestion into the solution too.  Also, nice handle. :)","body":"I&#39;ve incorporated your suggestion into the solution too.  Also, nice handle. :)"}],"tags":[],"owner":{"account_id":17260,"reputation":28385,"user_id":38426,"display_name":"BobbyShaftoe"},"comment_count":1,"down_vote_count":0,"up_vote_count":9,"is_accepted":false,"score":9,"last_activity_date":1228455398,"creation_date":1228455398,"answer_id":342996,"question_id":295579,"body_markdown":"For performance, you very often have to do some compromsies. Others have expressed various methods, however, you noted Carmack&#39;s hack was faster up to certain values of N. Then, you should check the &quot;n&quot; and if it is less than that number N, use Carmack&#39;s hack, else use some other method described in the answers here.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>For performance, you very often have to do some compromsies. Others have expressed various methods, however, you noted Carmack's hack was faster up to certain values of N. Then, you should check the \"n\" and if it is less than that number N, use Carmack's hack, else use some other method described in the answers here.</p>\n"},{"tags":[],"owner":{"account_id":21012,"reputation":1198,"user_id":50761,"display_name":"David Lehavi"},"comment_count":0,"down_vote_count":0,"up_vote_count":7,"is_accepted":false,"score":7,"last_activity_date":1230884266,"creation_date":1230847958,"answer_id":405554,"question_id":295579,"body_markdown":"You should get rid of the 2-power part of N right from the start.\r\n\r\n**2nd Edit**\r\nThe magical expression for m below should be\r\n\r\n    m = N - (N &amp; (N-1));\r\n\r\nand not as written\r\n\r\n**End of 2nd edit**\r\n\r\n    m = N &amp; (N-1); // the lawest bit of N\r\n    N /= m;\r\n    byte = N &amp; 0x0F;\r\n    if ((m % 2) || (byte !=1 &amp;&amp; byte !=9))\r\n      return false;\r\n\r\n**1st Edit:**\r\n\r\nMinor improvement:\r\n\r\n    m = N &amp; (N-1); // the lawest bit of N\r\n    N /= m;\r\n    if ((m % 2) || (N &amp; 0x07 != 1))\r\n      return false;\r\n\r\n**End of 1st edit**\r\n\r\nNow continue as usual. This way, by the time you get to the floating point part, you already got rid of all the numbers whose 2-power part is odd (about half), and then you only consider 1/8 of whats left. I.e. you run the floating point part on 6% of the numbers.\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>You should get rid of the 2-power part of N right from the start.</p>\n\n<p><strong>2nd Edit</strong>\nThe magical expression for m below should be</p>\n\n<pre><code>m = N - (N &amp; (N-1));\n</code></pre>\n\n<p>and not as written</p>\n\n<p><strong>End of 2nd edit</strong></p>\n\n<pre><code>m = N &amp; (N-1); // the lawest bit of N\nN /= m;\nbyte = N &amp; 0x0F;\nif ((m % 2) || (byte !=1 &amp;&amp; byte !=9))\n  return false;\n</code></pre>\n\n<p><strong>1st Edit:</strong></p>\n\n<p>Minor improvement:</p>\n\n<pre><code>m = N &amp; (N-1); // the lawest bit of N\nN /= m;\nif ((m % 2) || (N &amp; 0x07 != 1))\n  return false;\n</code></pre>\n\n<p><strong>End of 1st edit</strong></p>\n\n<p>Now continue as usual. This way, by the time you get to the floating point part, you already got rid of all the numbers whose 2-power part is odd (about half), and then you only consider 1/8 of whats left. I.e. you run the floating point part on 6% of the numbers.</p>\n"},{"comments":[{"owner":{"account_id":2675,"reputation":6268,"user_id":3750,"accept_rate":83,"display_name":"Tadmas"},"score":0,"creation_date":1230855874,"post_id":405578,"comment_id":230830,"body_markdown":"The number of iterations looks O(ln n), where n is the bit-length of v, so I doubt this will save much for larger v.  Floating point sqrt is slow, maybe 100-200 cycles, but integer math isn&#39;t free either.  A dozen iterations with 15 cycles each, and it&#39;d be a wash.  Still, +1 for being interesting.","body":"The number of iterations looks O(ln n), where n is the bit-length of v, so I doubt this will save much for larger v.  Floating point sqrt is slow, maybe 100-200 cycles, but integer math isn&#39;t free either.  A dozen iterations with 15 cycles each, and it&#39;d be a wash.  Still, +1 for being interesting."},{"owner":{"account_id":5863,"reputation":9597,"user_id":9634,"accept_rate":84,"display_name":"Brent.Longborough"},"score":0,"creation_date":1230883935,"post_id":405578,"comment_id":231231,"body_markdown":"Actually, I believe the additions and subtractions can be done by XOR.","body":"Actually, I believe the additions and subtractions can be done by XOR."},{"owner":{"account_id":5863,"reputation":9597,"user_id":9634,"accept_rate":84,"display_name":"Brent.Longborough"},"score":0,"creation_date":1230887609,"post_id":405578,"comment_id":231297,"body_markdown":"That was a daft comment - only the addition can be done by an XOR; the subtraction is arithmetic.","body":"That was a daft comment - only the addition can be done by an XOR; the subtraction is arithmetic."},{"owner":{"account_id":2675,"reputation":6268,"user_id":3750,"accept_rate":83,"display_name":"Tadmas"},"score":1,"creation_date":1230937174,"post_id":405578,"comment_id":233186,"body_markdown":"Is there really any substantive difference between the run time of XOR and addition anyway?","body":"Is there really any substantive difference between the run time of XOR and addition anyway?"},{"owner":{"account_id":5863,"reputation":9597,"user_id":9634,"accept_rate":84,"display_name":"Brent.Longborough"},"score":1,"creation_date":1231028271,"post_id":405578,"comment_id":235082,"body_markdown":"@Tadmas: probably not enough to break the &quot;optimise later&quot; rule. (:-)","body":"@Tadmas: probably not enough to break the &quot;optimise later&quot; rule. (:-)"},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":0,"creation_date":1519144039,"post_id":405578,"comment_id":84784814,"body_markdown":"@Tadmas No. While XOR is much simpler and faster in hardware, the cycle of any CPU is more than long enough for the addition. So you can&#39;t save anything unless you build your own circuit. +++ The slowest operation is actually the branching (pipeline work lost due to branch mispredictions) and this may be optimized away (a good compiler does it already).","body":"@Tadmas No. While XOR is much simpler and faster in hardware, the cycle of any CPU is more than long enough for the addition. So you can&#39;t save anything unless you build your own circuit. +++ The slowest operation is actually the branching (pipeline work lost due to branch mispredictions) and this may be optimized away (a good compiler does it already)."}],"tags":[],"owner":{"account_id":5863,"reputation":9597,"user_id":9634,"accept_rate":84,"display_name":"Brent.Longborough"},"comment_count":6,"down_vote_count":0,"up_vote_count":6,"is_accepted":false,"score":6,"last_activity_date":1674469907,"creation_date":1230848863,"answer_id":405578,"question_id":295579,"body_markdown":"This a rework from decimal to binary of the old Marchant calculator algorithm (sorry, I don&#39;t have a reference), in Ruby, adapted specifically for this question:\r\n\r\n    def isexactsqrt(v)\r\n    \tvalue = v.abs\r\n    \tresidue = value\r\n    \troot = 0\r\n    \tonebit = 1\r\n    \tonebit &lt;&lt;= 8 while (onebit &lt; residue)\r\n    \tonebit &gt;&gt;= 2 while (onebit &gt; residue)\r\n    \twhile (onebit &gt; 0)\r\n    \t\tx = root + onebit\r\n    \t\tif (residue &gt;= x) then\r\n    \t\t\tresidue -= x\r\n    \t\t\troot = x + onebit\r\n    \t\tend\r\n    \t\troot &gt;&gt;= 1\r\n    \t\tonebit &gt;&gt;= 2\r\n    \tend\r\n    \treturn (residue == 0)\r\n    end\r\n\r\nHere&#39;s a workup of something similar (there may be coding style/smells or clunky O/O - it&#39;s the algorithm that counts, and C++ is not my home language). In this case, we&#39;re looking for residue == 0:\r\n\r\n    #include &lt;iostream&gt;  \r\n    \r\n    using namespace std;  \r\n    typedef unsigned long long int llint;\r\n    \r\n    class ISqrt {\t\t\t// Integer Square Root\r\n    \tllint value;\t\t// Integer whose square root is required\r\n    \tllint root;\t\t\t// Result: floor(sqrt(value))\r\n    \tllint residue;\t\t// Result: value-root*root\r\n    \tllint onebit, x;\t// Working bit, working value\r\n    \r\n    public:\r\n    \r\n    \tISqrt(llint v = 2) {\t// Constructor\r\n    \t\tRoot(v);\t\t\t// Take the root \r\n    \t};\r\n    \r\n    \tllint Root(llint r) {\t// Resets and calculates new square root\r\n    \t\tvalue = r;\t\t\t// Store input\r\n    \t\tresidue = value;\t// Initialise for subtracting down\r\n    \t\troot = 0;\t\t\t// Clear root accumulator\r\n    \t\t\r\n    \t\tonebit = 1;\t\t\t\t\t// Calculate start value of counter\r\n    \t\tonebit &lt;&lt;= (8*sizeof(llint)-2);\t\t\t// Set up counter bit as greatest odd power of 2 \r\n    \t\twhile (onebit &gt; residue) {onebit &gt;&gt;= 2; };\t// Shift down until just &lt; value\r\n    \t\t\r\n    \t\twhile (onebit &gt; 0) {\r\n    \t\t\tx = root ^ onebit;\t\t\t// Will check root+1bit (root bit corresponding to onebit is always zero)\r\n    \t\t\tif (residue &gt;= x) {\t\t\t// Room to subtract?\r\n    \t\t\t\tresidue -= x;\t\t\t// Yes - deduct from residue\r\n    \t\t\t\troot = x + onebit;\t\t// and step root\r\n    \t\t\t};\r\n    \t\t\troot &gt;&gt;= 1;\r\n    \t\t\tonebit &gt;&gt;= 2;\r\n    \t\t};\r\n    \t\treturn root;\t\t\t\t\t\r\n    \t};\r\n    \tllint Residue() {\t\t\t// Returns residue from last calculation\r\n    \t\treturn residue;\t\t\t\t\t\r\n    \t};\r\n    };\r\n    \r\n    int main() {\r\n    \tllint big, i, q, r, v, delta;\r\n    \tbig = 0; big = (big-1);\t\t\t// Kludge for &quot;big number&quot;\r\n    \tISqrt b;\t\t\t\t\t\t\t// Make q sqrt generator\r\n    \tfor ( i = big; i &gt; 0 ; i /= 7 ) {\t// for several numbers\r\n    \t\tq = b.Root(i);\t\t\t\t\t// Get the square root\r\n    \t\tr = b.Residue();\t\t\t\t// Get the residue\r\n    \t\tv = q*q+r;\t\t\t\t\t\t// Recalc original value\r\n    \t\tdelta = v-i;\t\t\t\t\t// And diff, hopefully 0\r\n    \t\tcout &lt;&lt; i &lt;&lt; &quot;: &quot; &lt;&lt; q &lt;&lt; &quot; ++ &quot; &lt;&lt; r &lt;&lt; &quot; V: &quot; &lt;&lt; v &lt;&lt; &quot; Delta: &quot; &lt;&lt; delta &lt;&lt; &quot;\\n&quot;;\r\n    \t};\r\n    \treturn 0;\r\n    };\r\n\r\n\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>This a rework from decimal to binary of the old Marchant calculator algorithm (sorry, I don't have a reference), in Ruby, adapted specifically for this question:</p>\n<pre><code>def isexactsqrt(v)\n    value = v.abs\n    residue = value\n    root = 0\n    onebit = 1\n    onebit &lt;&lt;= 8 while (onebit &lt; residue)\n    onebit &gt;&gt;= 2 while (onebit &gt; residue)\n    while (onebit &gt; 0)\n        x = root + onebit\n        if (residue &gt;= x) then\n            residue -= x\n            root = x + onebit\n        end\n        root &gt;&gt;= 1\n        onebit &gt;&gt;= 2\n    end\n    return (residue == 0)\nend\n</code></pre>\n<p>Here's a workup of something similar (there may be coding style/smells or clunky O/O - it's the algorithm that counts, and C++ is not my home language). In this case, we're looking for residue == 0:</p>\n<pre><code>#include &lt;iostream&gt;  \n\nusing namespace std;  \ntypedef unsigned long long int llint;\n\nclass ISqrt {           // Integer Square Root\n    llint value;        // Integer whose square root is required\n    llint root;         // Result: floor(sqrt(value))\n    llint residue;      // Result: value-root*root\n    llint onebit, x;    // Working bit, working value\n\npublic:\n\n    ISqrt(llint v = 2) {    // Constructor\n        Root(v);            // Take the root \n    };\n\n    llint Root(llint r) {   // Resets and calculates new square root\n        value = r;          // Store input\n        residue = value;    // Initialise for subtracting down\n        root = 0;           // Clear root accumulator\n        \n        onebit = 1;                 // Calculate start value of counter\n        onebit &lt;&lt;= (8*sizeof(llint)-2);         // Set up counter bit as greatest odd power of 2 \n        while (onebit &gt; residue) {onebit &gt;&gt;= 2; };  // Shift down until just &lt; value\n        \n        while (onebit &gt; 0) {\n            x = root ^ onebit;          // Will check root+1bit (root bit corresponding to onebit is always zero)\n            if (residue &gt;= x) {         // Room to subtract?\n                residue -= x;           // Yes - deduct from residue\n                root = x + onebit;      // and step root\n            };\n            root &gt;&gt;= 1;\n            onebit &gt;&gt;= 2;\n        };\n        return root;                    \n    };\n    llint Residue() {           // Returns residue from last calculation\n        return residue;                 \n    };\n};\n\nint main() {\n    llint big, i, q, r, v, delta;\n    big = 0; big = (big-1);         // Kludge for &quot;big number&quot;\n    ISqrt b;                            // Make q sqrt generator\n    for ( i = big; i &gt; 0 ; i /= 7 ) {   // for several numbers\n        q = b.Root(i);                  // Get the square root\n        r = b.Residue();                // Get the residue\n        v = q*q+r;                      // Recalc original value\n        delta = v-i;                    // And diff, hopefully 0\n        cout &lt;&lt; i &lt;&lt; &quot;: &quot; &lt;&lt; q &lt;&lt; &quot; ++ &quot; &lt;&lt; r &lt;&lt; &quot; V: &quot; &lt;&lt; v &lt;&lt; &quot; Delta: &quot; &lt;&lt; delta &lt;&lt; &quot;\\n&quot;;\n    };\n    return 0;\n};\n</code></pre>\n"},{"comments":[{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":8,"creation_date":1231796831,"post_id":424936,"comment_id":259723,"body_markdown":"Wow!  I&#39;ll try to convert this to Java and do a comparison, as well as an accuracy check on the results.  I&#39;ll let you know what I find.","body":"Wow!  I&#39;ll try to convert this to Java and do a comparison, as well as an accuracy check on the results.  I&#39;ll let you know what I find."},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":2,"creation_date":1232136832,"post_id":424936,"comment_id":272424,"body_markdown":"Testing on all values is impossible, but a test on suspect values (+/- 1 from very large perfect squares) has proven to be accurate.  On a run of the first billion integers, this only took 34% of the time required by the original algorithm.","body":"Testing on all values is impossible, but a test on suspect values (+/- 1 from very large perfect squares) has proven to be accurate.  On a run of the first billion integers, this only took 34% of the time required by the original algorithm."},{"owner":{"account_id":2516,"reputation":31761,"user_id":3508,"accept_rate":79,"display_name":"A. Rex"},"score":0,"creation_date":1232139031,"post_id":424936,"comment_id":272534,"body_markdown":"Awesome!  I&#39;m glad it worked out for you.  One thing that&#39;s different in C(++) and Java is that Java checks bounds on array lookups, so I thought you might take a hit there.","body":"Awesome!  I&#39;m glad it worked out for you.  One thing that&#39;s different in C(++) and Java is that Java checks bounds on array lookups, so I thought you might take a hit there."},{"owner":{"account_id":16586,"reputation":241521,"user_id":36305,"accept_rate":100,"display_name":"Dimitre Novatchev"},"score":0,"creation_date":1238197495,"post_id":424936,"comment_id":505380,"body_markdown":"Seems that this only returns true/false, but it will be difficult to return the square root itself?","body":"Seems that this only returns true/false, but it will be difficult to return the square root itself?"},{"owner":{"account_id":3435,"reputation":38521,"user_id":4958,"accept_rate":75,"display_name":"ShreevatsaR"},"score":102,"creation_date":1243219018,"post_id":424936,"comment_id":712968,"body_markdown":"Wow, this is beautiful. I&#39;d seen Hensel lifting before (computing roots of polynomials modulo a prime) but I hadn&#39;t even realised the lemma could be carefully lowered all the way for computing square roots of numbers; this is... uplifting :)","body":"Wow, this is beautiful. I&#39;d seen Hensel lifting before (computing roots of polynomials modulo a prime) but I hadn&#39;t even realised the lemma could be carefully lowered all the way for computing square roots of numbers; this is... uplifting :)"},{"owner":{"account_id":2516,"reputation":31761,"user_id":3508,"accept_rate":79,"display_name":"A. Rex"},"score":0,"creation_date":1259884242,"post_id":424936,"comment_id":1737330,"body_markdown":"@Dimitre Novatchev: No, it would not be too difficult.  If the number is a perfect square, then its square root is `r` times some power of 2, which can be determined when dividing out by powers of 4.","body":"@Dimitre Novatchev: No, it would not be too difficult.  If the number is a perfect square, then its square root is <code>r</code> times some power of 2, which can be determined when dividing out by powers of 4."},{"owner":{"account_id":104670,"reputation":1454,"user_id":279703,"accept_rate":60,"display_name":"PeterT"},"score":0,"creation_date":1294758502,"post_id":424936,"comment_id":5131883,"body_markdown":"@A. Rex: HotSpot is able to eliminate bounds checks in certain circumstances http://stackoverflow.com/questions/4469483/bounds-checking-in-java so the hit is probably being avoided.","body":"@A. Rex: HotSpot is able to eliminate bounds checks in certain circumstances <a href=\"http://stackoverflow.com/questions/4469483/bounds-checking-in-java\" title=\"bounds checking in java\">stackoverflow.com/questions/4469483/bounds-checking-in-java</a> so the hit is probably being avoided."},{"owner":{"account_id":273792,"reputation":113282,"user_id":565635,"accept_rate":89,"display_name":"orlp"},"score":0,"creation_date":1347870045,"post_id":424936,"comment_id":16750619,"body_markdown":"@A. Rex: I might be mistaken, but isn&#39;t 9 a perfect square? And doesn&#39;t `if( x &lt; 0 || (x&amp;2) || ((x &amp; 7) == 5) || ((x &amp; 11) == 8) ) return false;` filter it out as not being one? And similar for all other uneven perfect squares?","body":"@A. Rex: I might be mistaken, but isn&#39;t 9 a perfect square? And doesn&#39;t <code>if( x &lt; 0 || (x&amp;2) || ((x &amp; 7) == 5) || ((x &amp; 11) == 8) ) return false;</code> filter it out as not being one? And similar for all other uneven perfect squares?"},{"owner":{"account_id":1413321,"reputation":1402,"user_id":1441398,"display_name":"primo"},"score":3,"creation_date":1354435016,"post_id":424936,"comment_id":18758801,"body_markdown":"@nightcracker It doesn&#39;t. `9 &lt; 0 =&gt; false`, `9&amp;2 =&gt; 0`, `9&amp;7 == 5 =&gt; false`, `9&amp;11 == 8 =&gt; false`.","body":"@nightcracker It doesn&#39;t. <code>9 &lt; 0 =&gt; false</code>, <code>9&amp;2 =&gt; 0</code>, <code>9&amp;7 == 5 =&gt; false</code>, <code>9&amp;11 == 8 =&gt; false</code>."},{"owner":{"account_id":305991,"reputation":39137,"user_id":616460,"accept_rate":93,"display_name":"Jason C"},"score":63,"creation_date":1395028009,"post_id":424936,"comment_id":34139261,"body_markdown":"Maartinus posted [a 2x faster solution](http://stackoverflow.com/a/18686659/616460) (and much shorter) down below, a bit later, that doesn&#39;t seem to be getting much love.","body":"Maartinus posted <a href=\"http://stackoverflow.com/a/18686659/616460\">a 2x faster solution</a> (and much shorter) down below, a bit later, that doesn&#39;t seem to be getting much love."},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":1,"creation_date":1402687305,"post_id":424936,"comment_id":37386270,"body_markdown":"@A.Rex AFAIK, the final test `t &lt;= (1LL &lt;&lt; 33)` is useless as you either get a square root or overshoot anyway. I dropped it and it works (but maybe there&#39;s a gotcha with numbers I haven&#39;t tried?).","body":"@A.Rex AFAIK, the final test <code>t &lt;= (1LL &lt;&lt; 33)</code> is useless as you either get a square root or overshoot anyway. I dropped it and it works (but maybe there&#39;s a gotcha with numbers I haven&#39;t tried?)."},{"owner":{"account_id":2158815,"reputation":1546,"user_id":1914292,"accept_rate":40,"display_name":"user1914292"},"score":4,"creation_date":1412702776,"post_id":424936,"comment_id":41162049,"body_markdown":"It seems like a lot of the speed advantage in the different solutions is gained by filtering out the obvious squares. Did anyone benchmark the situation of filtering out via Maartinus&#39; solution and then just using the sqrt function as that&#39;s a built-in function?","body":"It seems like a lot of the speed advantage in the different solutions is gained by filtering out the obvious squares. Did anyone benchmark the situation of filtering out via Maartinus&#39; solution and then just using the sqrt function as that&#39;s a built-in function?"},{"owner":{"account_id":2802349,"reputation":146437,"user_id":2410359,"accept_rate":87,"display_name":"chux - Reinstate Monica"},"score":1,"creation_date":1526891405,"post_id":424936,"comment_id":87903267,"body_markdown":"`LL` in `y &amp; 4294967295LL` not needed.","body":"<code>LL</code> in <code>y &amp; 4294967295LL</code> not needed."},{"owner":{"account_id":5858722,"reputation":3725,"user_id":4615179,"display_name":"Ma&#235;lan"},"score":1,"creation_date":1569771108,"post_id":424936,"comment_id":102695931,"body_markdown":"“Next, check if it&#39;s a square modulo 255 = 3 * 5 * 17. Because that&#39;s a product of three distinct primes, only about 1/8 of the residues mod 255 are squares.” Actually, the proportion of squares modulo 255 is 54/255 ≃ 0.212, much more than 1/8 = 0.125 (because the proportion of squares modulo each of the prime factors are slightly more than 1/2). But note that you are not limited to primes. The proportion of squares modulo 256 is 44/256 ≃ 0.172, and computing modulo 256 is much more convenient.","body":"“Next, check if it&#39;s a square modulo 255 = 3 * 5 * 17. Because that&#39;s a product of three distinct primes, only about 1/8 of the residues mod 255 are squares.” Actually, the proportion of squares modulo 255 is 54/255 ≃ 0.212, much more than 1/8 = 0.125 (because the proportion of squares modulo each of the prime factors are slightly more than 1/2). But note that you are not limited to primes. The proportion of squares modulo 256 is 44/256 ≃ 0.172, and computing modulo 256 is much more convenient."},{"owner":{"account_id":5858722,"reputation":3725,"user_id":4615179,"display_name":"Ma&#235;lan"},"score":1,"creation_date":1569772233,"post_id":424936,"comment_id":102696238,"body_markdown":"That’s essentially one of the things maaartinus’ answer does, except that it uses 64 instead of 256 (which gives a more compact precomputed table with a better cache behavior, while still being pretty efficient at filtering out non-squares, as the proportion of squares modulo 64 is 12/64 ≃ 0.188).","body":"That’s essentially one of the things maaartinus’ answer does, except that it uses 64 instead of 256 (which gives a more compact precomputed table with a better cache behavior, while still being pretty efficient at filtering out non-squares, as the proportion of squares modulo 64 is 12/64 ≃ 0.188)."},{"owner":{"account_id":6317514,"reputation":1163,"user_id":6425831,"display_name":"saolof"},"score":0,"creation_date":1644330064,"post_id":424936,"comment_id":125573943,"body_markdown":"It might be worth mentioning that x86 has an assembly instruction to get the number of trailing zeroes which is supported as a trailing zeroes function in most languages, so the binary search isn&#39;t needed. But applying Hensel&#39;s lemma is a good idea.","body":"It might be worth mentioning that x86 has an assembly instruction to get the number of trailing zeroes which is supported as a trailing zeroes function in most languages, so the binary search isn&#39;t needed. But applying Hensel&#39;s lemma is a good idea."},{"owner":{"account_id":100551,"reputation":29438,"user_id":270986,"display_name":"Mark Dickinson"},"score":0,"creation_date":1646334955,"post_id":424936,"comment_id":126103898,"body_markdown":"For the Hensel&#39;s lemma lifting part of the solution, it ought to be possible to roughly double the number of correct bits per iteration instead of just getting an additional bit per iteration. See https://gist.github.com/mdickinson/e087001d213725a93eeb8d8f447a2f40#file-sqrt_exact-c for some C code along these lines.","body":"For the Hensel&#39;s lemma lifting part of the solution, it ought to be possible to roughly double the number of correct bits per iteration instead of just getting an additional bit per iteration. See <a href=\"https://gist.github.com/mdickinson/e087001d213725a93eeb8d8f447a2f40#file-sqrt_exact-c\" rel=\"nofollow noreferrer\">gist.github.com/mdickinson/&hellip;</a> for some C code along these lines."}],"tags":[],"owner":{"account_id":2516,"reputation":31761,"user_id":3508,"accept_rate":79,"display_name":"A. Rex"},"comment_count":17,"down_vote_count":0,"up_vote_count":824,"is_accepted":true,"score":824,"last_activity_date":1701112993,"creation_date":1231432362,"answer_id":424936,"question_id":295579,"body_markdown":"I figured out a method that works ~35% faster than your 6bits+Carmack+sqrt code, at least with my CPU (x86) and programming language (C/C++).  Your results may vary, especially because I don&#39;t know how the Java factor will play out.\r\n\r\nMy approach is threefold:\r\n\r\n&lt;ol&gt;\r\n&lt;li&gt;First, filter out obvious answers.  This includes negative numbers and looking at the last 4 bits.  (I found looking at the last six didn&#39;t help.)  I also answer yes for 0.  (In reading the code below, note that my input is &lt;code&gt;int64 x&lt;/code&gt;.)\r\n\r\n```lang-c\r\nif( x &lt; 0 || (x&amp;2) || ((x &amp; 7) == 5) || ((x &amp; 11) == 8) )\r\n\treturn false;\r\nif( x == 0 )\r\n\treturn true;\r\n```\r\n&lt;/li&gt;\r\n&lt;li&gt;Next, check if it&#39;s a square modulo 255 = 3 * 5 * 17.  Because that&#39;s a product of three distinct primes, only about 1/8 of the residues mod 255 are squares.  However, in my experience, calling the modulo operator (%) costs more than the benefit one gets, so I use bit tricks involving 255 = 2^8-1 to compute the residue.  (For better or worse, I am not using the trick of reading individual bytes out of a word, only bitwise-and and shifts.)\r\n\r\n```lang-c\r\nint64 y = x;\r\ny = (y &amp; 4294967295LL) + (y &gt;&gt; 32); \r\ny = (y &amp; 65535) + (y &gt;&gt; 16);\r\ny = (y &amp; 255) + ((y &gt;&gt; 8) &amp; 255) + (y &gt;&gt; 16);\r\n// At this point, y is between 0 and 511.  More code can reduce it farther.\r\n```\r\n\r\nTo actually check if the residue is a square, I look up the answer in a precomputed table.\r\n\r\n```lang-c\r\nif( bad255[y] )\r\n\treturn false;\r\n// However, I just use a table of size 512\r\n```\r\n&lt;/li&gt;\r\n&lt;li&gt;Finally, try to compute the square root using a method similar to &lt;a href=&quot;http://en.wikipedia.org/wiki/Hensel%27s_lemma&quot;&gt;Hensel&#39;s lemma&lt;/a&gt;.  (I don&#39;t think it&#39;s applicable directly, but it works with some modifications.)  Before doing that, I divide out all powers of 2 with a binary search:\r\n\r\n```lang-c\r\nif((x &amp; 4294967295LL) == 0)\r\n\tx &gt;&gt;= 32;\r\nif((x &amp; 65535) == 0)\r\n\tx &gt;&gt;= 16;\r\nif((x &amp; 255) == 0)\r\n\tx &gt;&gt;= 8;\r\nif((x &amp; 15) == 0)\r\n\tx &gt;&gt;= 4;\r\nif((x &amp; 3) == 0)\r\n\tx &gt;&gt;= 2;\r\n```\r\nAt this point, for our number to be a square, it must be 1 mod 8.\r\n\r\n```lang-c\r\nif((x &amp; 7) != 1)\r\n\treturn false;\r\n```\r\n\r\nThe basic structure of Hensel&#39;s lemma is the following.  (Note: untested code; if it doesn&#39;t work, try t=2 or 8.)\r\n\r\n```lang-c\r\nint64 t = 4, r = 1;\r\nt &lt;&lt;= 1; r += ((x - r * r) &amp; t) &gt;&gt; 1;\r\nt &lt;&lt;= 1; r += ((x - r * r) &amp; t) &gt;&gt; 1;\r\nt &lt;&lt;= 1; r += ((x - r * r) &amp; t) &gt;&gt; 1;\r\n// Repeat until t is 2^33 or so.  Use a loop if you want.\r\n```\r\n\r\nThe idea is that at each iteration, you add one bit onto r, the &quot;current&quot; square root of x; each square root is accurate modulo a larger and larger power of 2, namely t/2.  At the end, r and t/2-r will be square roots of x modulo t/2.  (Note that if r is a square root of x, then so is -r.  This is true even modulo numbers, but beware, modulo some numbers, things can have even more than 2 square roots; notably, this includes powers of 2.)  Because our actual square root is less than 2^32, at that point we can actually just check if r or t/2-r are real square roots.  In my actual code, I use the following modified loop:\r\n\r\n```lang-c\r\nint64 r, t, z;\r\nr = start[(x &gt;&gt; 3) &amp; 1023];\r\ndo {\r\n\tz = x - r * r;\r\n\tif( z == 0 )\r\n\t\treturn true;\r\n\tif( z &lt; 0 )\r\n\t\treturn false;\r\n\tt = z &amp; (-z);\r\n\tr += (z &amp; t) &gt;&gt; 1;\r\n\tif( r &gt; (t &gt;&gt; 1) )\r\n\t\tr = t - r;\r\n} while( t &lt;= (1LL &lt;&lt; 33) );\r\n```\r\n\r\nThe speedup here is obtained in three ways: precomputed start value (equivalent to ~10 iterations of the loop), earlier exit of the loop, and skipping some t values.  For the last part, I look at `z = r - x * x`, and set t to be the largest power of 2 dividing z with a bit trick.  This allows me to skip t values that wouldn&#39;t have affected the value of r anyway.  The precomputed start value in my case picks out the &quot;smallest positive&quot; square root modulo 8192.\r\n&lt;/li&gt;\r\n&lt;/ol&gt;\r\nEven if this code doesn&#39;t work faster for you, I hope you enjoy some of the ideas it contains.  Complete, tested code follows, including the precomputed tables.\r\n\r\n```lang-c\r\ntypedef signed long long int int64;\r\n\r\nint start[1024] =\r\n{1,3,1769,5,1937,1741,7,1451,479,157,9,91,945,659,1817,11,\r\n1983,707,1321,1211,1071,13,1479,405,415,1501,1609,741,15,339,1703,203,\r\n129,1411,873,1669,17,1715,1145,1835,351,1251,887,1573,975,19,1127,395,\r\n1855,1981,425,453,1105,653,327,21,287,93,713,1691,1935,301,551,587,\r\n257,1277,23,763,1903,1075,1799,1877,223,1437,1783,859,1201,621,25,779,\r\n1727,573,471,1979,815,1293,825,363,159,1315,183,27,241,941,601,971,\r\n385,131,919,901,273,435,647,1493,95,29,1417,805,719,1261,1177,1163,\r\n1599,835,1367,315,1361,1933,1977,747,31,1373,1079,1637,1679,1581,1753,1355,\r\n513,1539,1815,1531,1647,205,505,1109,33,1379,521,1627,1457,1901,1767,1547,\r\n1471,1853,1833,1349,559,1523,967,1131,97,35,1975,795,497,1875,1191,1739,\r\n641,1149,1385,133,529,845,1657,725,161,1309,375,37,463,1555,615,1931,\r\n1343,445,937,1083,1617,883,185,1515,225,1443,1225,869,1423,1235,39,1973,\r\n769,259,489,1797,1391,1485,1287,341,289,99,1271,1701,1713,915,537,1781,\r\n1215,963,41,581,303,243,1337,1899,353,1245,329,1563,753,595,1113,1589,\r\n897,1667,407,635,785,1971,135,43,417,1507,1929,731,207,275,1689,1397,\r\n1087,1725,855,1851,1873,397,1607,1813,481,163,567,101,1167,45,1831,1205,\r\n1025,1021,1303,1029,1135,1331,1017,427,545,1181,1033,933,1969,365,1255,1013,\r\n959,317,1751,187,47,1037,455,1429,609,1571,1463,1765,1009,685,679,821,\r\n1153,387,1897,1403,1041,691,1927,811,673,227,137,1499,49,1005,103,629,\r\n831,1091,1449,1477,1967,1677,697,1045,737,1117,1737,667,911,1325,473,437,\r\n1281,1795,1001,261,879,51,775,1195,801,1635,759,165,1871,1645,1049,245,\r\n703,1597,553,955,209,1779,1849,661,865,291,841,997,1265,1965,1625,53,\r\n1409,893,105,1925,1297,589,377,1579,929,1053,1655,1829,305,1811,1895,139,\r\n575,189,343,709,1711,1139,1095,277,993,1699,55,1435,655,1491,1319,331,\r\n1537,515,791,507,623,1229,1529,1963,1057,355,1545,603,1615,1171,743,523,\r\n447,1219,1239,1723,465,499,57,107,1121,989,951,229,1521,851,167,715,\r\n1665,1923,1687,1157,1553,1869,1415,1749,1185,1763,649,1061,561,531,409,907,\r\n319,1469,1961,59,1455,141,1209,491,1249,419,1847,1893,399,211,985,1099,\r\n1793,765,1513,1275,367,1587,263,1365,1313,925,247,1371,1359,109,1561,1291,\r\n191,61,1065,1605,721,781,1735,875,1377,1827,1353,539,1777,429,1959,1483,\r\n1921,643,617,389,1809,947,889,981,1441,483,1143,293,817,749,1383,1675,\r\n63,1347,169,827,1199,1421,583,1259,1505,861,457,1125,143,1069,807,1867,\r\n2047,2045,279,2043,111,307,2041,597,1569,1891,2039,1957,1103,1389,231,2037,\r\n65,1341,727,837,977,2035,569,1643,1633,547,439,1307,2033,1709,345,1845,\r\n1919,637,1175,379,2031,333,903,213,1697,797,1161,475,1073,2029,921,1653,\r\n193,67,1623,1595,943,1395,1721,2027,1761,1955,1335,357,113,1747,1497,1461,\r\n1791,771,2025,1285,145,973,249,171,1825,611,265,1189,847,1427,2023,1269,\r\n321,1475,1577,69,1233,755,1223,1685,1889,733,1865,2021,1807,1107,1447,1077,\r\n1663,1917,1129,1147,1775,1613,1401,555,1953,2019,631,1243,1329,787,871,885,\r\n449,1213,681,1733,687,115,71,1301,2017,675,969,411,369,467,295,693,\r\n1535,509,233,517,401,1843,1543,939,2015,669,1527,421,591,147,281,501,\r\n577,195,215,699,1489,525,1081,917,1951,2013,73,1253,1551,173,857,309,\r\n1407,899,663,1915,1519,1203,391,1323,1887,739,1673,2011,1585,493,1433,117,\r\n705,1603,1111,965,431,1165,1863,533,1823,605,823,1179,625,813,2009,75,\r\n1279,1789,1559,251,657,563,761,1707,1759,1949,777,347,335,1133,1511,267,\r\n833,1085,2007,1467,1745,1805,711,149,1695,803,1719,485,1295,1453,935,459,\r\n1151,381,1641,1413,1263,77,1913,2005,1631,541,119,1317,1841,1773,359,651,\r\n961,323,1193,197,175,1651,441,235,1567,1885,1481,1947,881,2003,217,843,\r\n1023,1027,745,1019,913,717,1031,1621,1503,867,1015,1115,79,1683,793,1035,\r\n1089,1731,297,1861,2001,1011,1593,619,1439,477,585,283,1039,1363,1369,1227,\r\n895,1661,151,645,1007,1357,121,1237,1375,1821,1911,549,1999,1043,1945,1419,\r\n1217,957,599,571,81,371,1351,1003,1311,931,311,1381,1137,723,1575,1611,\r\n767,253,1047,1787,1169,1997,1273,853,1247,413,1289,1883,177,403,999,1803,\r\n1345,451,1495,1093,1839,269,199,1387,1183,1757,1207,1051,783,83,423,1995,\r\n639,1155,1943,123,751,1459,1671,469,1119,995,393,219,1743,237,153,1909,\r\n1473,1859,1705,1339,337,909,953,1771,1055,349,1993,613,1393,557,729,1717,\r\n511,1533,1257,1541,1425,819,519,85,991,1693,503,1445,433,877,1305,1525,\r\n1601,829,809,325,1583,1549,1991,1941,927,1059,1097,1819,527,1197,1881,1333,\r\n383,125,361,891,495,179,633,299,863,285,1399,987,1487,1517,1639,1141,\r\n1729,579,87,1989,593,1907,839,1557,799,1629,201,155,1649,1837,1063,949,\r\n255,1283,535,773,1681,461,1785,683,735,1123,1801,677,689,1939,487,757,\r\n1857,1987,983,443,1327,1267,313,1173,671,221,695,1509,271,1619,89,565,\r\n127,1405,1431,1659,239,1101,1159,1067,607,1565,905,1755,1231,1299,665,373,\r\n1985,701,1879,1221,849,627,1465,789,543,1187,1591,923,1905,979,1241,181};\r\n\r\nbool bad255[512] =\r\n{0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,\r\n 1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,\r\n 0,1,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,1,\r\n 1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,\r\n 1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,\r\n 1,1,1,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,\r\n 1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,\r\n 1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,\r\n 0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,\r\n 1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,\r\n 0,1,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,1,\r\n 1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,\r\n 1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,\r\n 1,1,1,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,\r\n 1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,\r\n 1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,\r\n 0,0};\r\n\r\ninline bool square( int64 x ) {\r\n\t// Quickfail\r\n\tif( x &lt; 0 || (x&amp;2) || ((x &amp; 7) == 5) || ((x &amp; 11) == 8) )\r\n\t\treturn false;\r\n\tif( x == 0 )\r\n\t\treturn true;\r\n\r\n\t// Check mod 255 = 3 * 5 * 17, for fun\r\n\tint64 y = x;\r\n\ty = (y &amp; 4294967295LL) + (y &gt;&gt; 32);\r\n\ty = (y &amp; 65535) + (y &gt;&gt; 16);\r\n\ty = (y &amp; 255) + ((y &gt;&gt; 8) &amp; 255) + (y &gt;&gt; 16);\r\n\tif( bad255[y] )\r\n\t\treturn false;\r\n\r\n\t// Divide out powers of 4 using binary search\r\n\tif((x &amp; 4294967295LL) == 0)\r\n\t\tx &gt;&gt;= 32;\r\n\tif((x &amp; 65535) == 0)\r\n\t\tx &gt;&gt;= 16;\r\n\tif((x &amp; 255) == 0)\r\n\t\tx &gt;&gt;= 8;\r\n\tif((x &amp; 15) == 0)\r\n\t\tx &gt;&gt;= 4;\r\n\tif((x &amp; 3) == 0)\r\n\t\tx &gt;&gt;= 2;\r\n\r\n\tif((x &amp; 7) != 1)\r\n\t\treturn false;\r\n\r\n\t// Compute sqrt using something like Hensel&#39;s lemma\r\n\tint64 r, t, z;\r\n\tr = start[(x &gt;&gt; 3) &amp; 1023];\r\n\tdo {\r\n\t\tz = x - r * r;\r\n\t\tif( z == 0 )\r\n\t\t\treturn true;\r\n\t\tif( z &lt; 0 )\r\n\t\t\treturn false;\r\n\t\tt = z &amp; (-z);\r\n\t\tr += (z &amp; t) &gt;&gt; 1;\r\n\t\tif( r &gt; (t &gt;&gt; 1) )\r\n\t\t\tr = t - r;\r\n\t} while( t &lt;= (1LL &lt;&lt; 33) );\r\n\t\r\n\treturn false;\r\n}\r\n```","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>I figured out a method that works ~35% faster than your 6bits+Carmack+sqrt code, at least with my CPU (x86) and programming language (C/C++).  Your results may vary, especially because I don't know how the Java factor will play out.</p>\n<p>My approach is threefold:</p>\n<ol>\n<li>First, filter out obvious answers.  This includes negative numbers and looking at the last 4 bits.  (I found looking at the last six didn't help.)  I also answer yes for 0.  (In reading the code below, note that my input is <code>int64 x</code>.)\n<pre class=\"lang-c prettyprint-override\"><code>if( x &lt; 0 || (x&amp;2) || ((x &amp; 7) == 5) || ((x &amp; 11) == 8) )\n    return false;\nif( x == 0 )\n    return true;\n</code></pre>\n</li>\n<li>Next, check if it's a square modulo 255 = 3 * 5 * 17.  Because that's a product of three distinct primes, only about 1/8 of the residues mod 255 are squares.  However, in my experience, calling the modulo operator (%) costs more than the benefit one gets, so I use bit tricks involving 255 = 2^8-1 to compute the residue.  (For better or worse, I am not using the trick of reading individual bytes out of a word, only bitwise-and and shifts.)\n<pre class=\"lang-c prettyprint-override\"><code>int64 y = x;\ny = (y &amp; 4294967295LL) + (y &gt;&gt; 32); \ny = (y &amp; 65535) + (y &gt;&gt; 16);\ny = (y &amp; 255) + ((y &gt;&gt; 8) &amp; 255) + (y &gt;&gt; 16);\n// At this point, y is between 0 and 511.  More code can reduce it farther.\n</code></pre>\n<p>To actually check if the residue is a square, I look up the answer in a precomputed table.</p>\n<pre class=\"lang-c prettyprint-override\"><code>if( bad255[y] )\n    return false;\n// However, I just use a table of size 512\n</code></pre>\n</li>\n<li>Finally, try to compute the square root using a method similar to <a href=\"http://en.wikipedia.org/wiki/Hensel%27s_lemma\" rel=\"nofollow noreferrer\">Hensel's lemma</a>.  (I don't think it's applicable directly, but it works with some modifications.)  Before doing that, I divide out all powers of 2 with a binary search:\n<pre class=\"lang-c prettyprint-override\"><code>if((x &amp; 4294967295LL) == 0)\n    x &gt;&gt;= 32;\nif((x &amp; 65535) == 0)\n    x &gt;&gt;= 16;\nif((x &amp; 255) == 0)\n    x &gt;&gt;= 8;\nif((x &amp; 15) == 0)\n    x &gt;&gt;= 4;\nif((x &amp; 3) == 0)\n    x &gt;&gt;= 2;\n</code></pre>\n<p>At this point, for our number to be a square, it must be 1 mod 8.</p>\n<pre class=\"lang-c prettyprint-override\"><code>if((x &amp; 7) != 1)\n    return false;\n</code></pre>\n<p>The basic structure of Hensel's lemma is the following.  (Note: untested code; if it doesn't work, try t=2 or 8.)</p>\n<pre class=\"lang-c prettyprint-override\"><code>int64 t = 4, r = 1;\nt &lt;&lt;= 1; r += ((x - r * r) &amp; t) &gt;&gt; 1;\nt &lt;&lt;= 1; r += ((x - r * r) &amp; t) &gt;&gt; 1;\nt &lt;&lt;= 1; r += ((x - r * r) &amp; t) &gt;&gt; 1;\n// Repeat until t is 2^33 or so.  Use a loop if you want.\n</code></pre>\n<p>The idea is that at each iteration, you add one bit onto r, the &quot;current&quot; square root of x; each square root is accurate modulo a larger and larger power of 2, namely t/2.  At the end, r and t/2-r will be square roots of x modulo t/2.  (Note that if r is a square root of x, then so is -r.  This is true even modulo numbers, but beware, modulo some numbers, things can have even more than 2 square roots; notably, this includes powers of 2.)  Because our actual square root is less than 2^32, at that point we can actually just check if r or t/2-r are real square roots.  In my actual code, I use the following modified loop:</p>\n<pre class=\"lang-c prettyprint-override\"><code>int64 r, t, z;\nr = start[(x &gt;&gt; 3) &amp; 1023];\ndo {\n    z = x - r * r;\n    if( z == 0 )\n        return true;\n    if( z &lt; 0 )\n        return false;\n    t = z &amp; (-z);\n    r += (z &amp; t) &gt;&gt; 1;\n    if( r &gt; (t &gt;&gt; 1) )\n        r = t - r;\n} while( t &lt;= (1LL &lt;&lt; 33) );\n</code></pre>\n<p>The speedup here is obtained in three ways: precomputed start value (equivalent to ~10 iterations of the loop), earlier exit of the loop, and skipping some t values.  For the last part, I look at <code>z = r - x * x</code>, and set t to be the largest power of 2 dividing z with a bit trick.  This allows me to skip t values that wouldn't have affected the value of r anyway.  The precomputed start value in my case picks out the &quot;smallest positive&quot; square root modulo 8192.</p>\n</li>\n</ol>\nEven if this code doesn't work faster for you, I hope you enjoy some of the ideas it contains.  Complete, tested code follows, including the precomputed tables.\n<pre class=\"lang-c prettyprint-override\"><code>typedef signed long long int int64;\n\nint start[1024] =\n{1,3,1769,5,1937,1741,7,1451,479,157,9,91,945,659,1817,11,\n1983,707,1321,1211,1071,13,1479,405,415,1501,1609,741,15,339,1703,203,\n129,1411,873,1669,17,1715,1145,1835,351,1251,887,1573,975,19,1127,395,\n1855,1981,425,453,1105,653,327,21,287,93,713,1691,1935,301,551,587,\n257,1277,23,763,1903,1075,1799,1877,223,1437,1783,859,1201,621,25,779,\n1727,573,471,1979,815,1293,825,363,159,1315,183,27,241,941,601,971,\n385,131,919,901,273,435,647,1493,95,29,1417,805,719,1261,1177,1163,\n1599,835,1367,315,1361,1933,1977,747,31,1373,1079,1637,1679,1581,1753,1355,\n513,1539,1815,1531,1647,205,505,1109,33,1379,521,1627,1457,1901,1767,1547,\n1471,1853,1833,1349,559,1523,967,1131,97,35,1975,795,497,1875,1191,1739,\n641,1149,1385,133,529,845,1657,725,161,1309,375,37,463,1555,615,1931,\n1343,445,937,1083,1617,883,185,1515,225,1443,1225,869,1423,1235,39,1973,\n769,259,489,1797,1391,1485,1287,341,289,99,1271,1701,1713,915,537,1781,\n1215,963,41,581,303,243,1337,1899,353,1245,329,1563,753,595,1113,1589,\n897,1667,407,635,785,1971,135,43,417,1507,1929,731,207,275,1689,1397,\n1087,1725,855,1851,1873,397,1607,1813,481,163,567,101,1167,45,1831,1205,\n1025,1021,1303,1029,1135,1331,1017,427,545,1181,1033,933,1969,365,1255,1013,\n959,317,1751,187,47,1037,455,1429,609,1571,1463,1765,1009,685,679,821,\n1153,387,1897,1403,1041,691,1927,811,673,227,137,1499,49,1005,103,629,\n831,1091,1449,1477,1967,1677,697,1045,737,1117,1737,667,911,1325,473,437,\n1281,1795,1001,261,879,51,775,1195,801,1635,759,165,1871,1645,1049,245,\n703,1597,553,955,209,1779,1849,661,865,291,841,997,1265,1965,1625,53,\n1409,893,105,1925,1297,589,377,1579,929,1053,1655,1829,305,1811,1895,139,\n575,189,343,709,1711,1139,1095,277,993,1699,55,1435,655,1491,1319,331,\n1537,515,791,507,623,1229,1529,1963,1057,355,1545,603,1615,1171,743,523,\n447,1219,1239,1723,465,499,57,107,1121,989,951,229,1521,851,167,715,\n1665,1923,1687,1157,1553,1869,1415,1749,1185,1763,649,1061,561,531,409,907,\n319,1469,1961,59,1455,141,1209,491,1249,419,1847,1893,399,211,985,1099,\n1793,765,1513,1275,367,1587,263,1365,1313,925,247,1371,1359,109,1561,1291,\n191,61,1065,1605,721,781,1735,875,1377,1827,1353,539,1777,429,1959,1483,\n1921,643,617,389,1809,947,889,981,1441,483,1143,293,817,749,1383,1675,\n63,1347,169,827,1199,1421,583,1259,1505,861,457,1125,143,1069,807,1867,\n2047,2045,279,2043,111,307,2041,597,1569,1891,2039,1957,1103,1389,231,2037,\n65,1341,727,837,977,2035,569,1643,1633,547,439,1307,2033,1709,345,1845,\n1919,637,1175,379,2031,333,903,213,1697,797,1161,475,1073,2029,921,1653,\n193,67,1623,1595,943,1395,1721,2027,1761,1955,1335,357,113,1747,1497,1461,\n1791,771,2025,1285,145,973,249,171,1825,611,265,1189,847,1427,2023,1269,\n321,1475,1577,69,1233,755,1223,1685,1889,733,1865,2021,1807,1107,1447,1077,\n1663,1917,1129,1147,1775,1613,1401,555,1953,2019,631,1243,1329,787,871,885,\n449,1213,681,1733,687,115,71,1301,2017,675,969,411,369,467,295,693,\n1535,509,233,517,401,1843,1543,939,2015,669,1527,421,591,147,281,501,\n577,195,215,699,1489,525,1081,917,1951,2013,73,1253,1551,173,857,309,\n1407,899,663,1915,1519,1203,391,1323,1887,739,1673,2011,1585,493,1433,117,\n705,1603,1111,965,431,1165,1863,533,1823,605,823,1179,625,813,2009,75,\n1279,1789,1559,251,657,563,761,1707,1759,1949,777,347,335,1133,1511,267,\n833,1085,2007,1467,1745,1805,711,149,1695,803,1719,485,1295,1453,935,459,\n1151,381,1641,1413,1263,77,1913,2005,1631,541,119,1317,1841,1773,359,651,\n961,323,1193,197,175,1651,441,235,1567,1885,1481,1947,881,2003,217,843,\n1023,1027,745,1019,913,717,1031,1621,1503,867,1015,1115,79,1683,793,1035,\n1089,1731,297,1861,2001,1011,1593,619,1439,477,585,283,1039,1363,1369,1227,\n895,1661,151,645,1007,1357,121,1237,1375,1821,1911,549,1999,1043,1945,1419,\n1217,957,599,571,81,371,1351,1003,1311,931,311,1381,1137,723,1575,1611,\n767,253,1047,1787,1169,1997,1273,853,1247,413,1289,1883,177,403,999,1803,\n1345,451,1495,1093,1839,269,199,1387,1183,1757,1207,1051,783,83,423,1995,\n639,1155,1943,123,751,1459,1671,469,1119,995,393,219,1743,237,153,1909,\n1473,1859,1705,1339,337,909,953,1771,1055,349,1993,613,1393,557,729,1717,\n511,1533,1257,1541,1425,819,519,85,991,1693,503,1445,433,877,1305,1525,\n1601,829,809,325,1583,1549,1991,1941,927,1059,1097,1819,527,1197,1881,1333,\n383,125,361,891,495,179,633,299,863,285,1399,987,1487,1517,1639,1141,\n1729,579,87,1989,593,1907,839,1557,799,1629,201,155,1649,1837,1063,949,\n255,1283,535,773,1681,461,1785,683,735,1123,1801,677,689,1939,487,757,\n1857,1987,983,443,1327,1267,313,1173,671,221,695,1509,271,1619,89,565,\n127,1405,1431,1659,239,1101,1159,1067,607,1565,905,1755,1231,1299,665,373,\n1985,701,1879,1221,849,627,1465,789,543,1187,1591,923,1905,979,1241,181};\n\nbool bad255[512] =\n{0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,\n 1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,\n 0,1,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,1,\n 1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,\n 1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,\n 1,1,1,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,\n 1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,\n 1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,\n 0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,\n 1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,\n 0,1,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,1,\n 1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,\n 1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,\n 1,1,1,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,\n 1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,\n 1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,\n 0,0};\n\ninline bool square( int64 x ) {\n    // Quickfail\n    if( x &lt; 0 || (x&amp;2) || ((x &amp; 7) == 5) || ((x &amp; 11) == 8) )\n        return false;\n    if( x == 0 )\n        return true;\n\n    // Check mod 255 = 3 * 5 * 17, for fun\n    int64 y = x;\n    y = (y &amp; 4294967295LL) + (y &gt;&gt; 32);\n    y = (y &amp; 65535) + (y &gt;&gt; 16);\n    y = (y &amp; 255) + ((y &gt;&gt; 8) &amp; 255) + (y &gt;&gt; 16);\n    if( bad255[y] )\n        return false;\n\n    // Divide out powers of 4 using binary search\n    if((x &amp; 4294967295LL) == 0)\n        x &gt;&gt;= 32;\n    if((x &amp; 65535) == 0)\n        x &gt;&gt;= 16;\n    if((x &amp; 255) == 0)\n        x &gt;&gt;= 8;\n    if((x &amp; 15) == 0)\n        x &gt;&gt;= 4;\n    if((x &amp; 3) == 0)\n        x &gt;&gt;= 2;\n\n    if((x &amp; 7) != 1)\n        return false;\n\n    // Compute sqrt using something like Hensel's lemma\n    int64 r, t, z;\n    r = start[(x &gt;&gt; 3) &amp; 1023];\n    do {\n        z = x - r * r;\n        if( z == 0 )\n            return true;\n        if( z &lt; 0 )\n            return false;\n        t = z &amp; (-z);\n        r += (z &amp; t) &gt;&gt; 1;\n        if( r &gt; (t &gt;&gt; 1) )\n            r = t - r;\n    } while( t &lt;= (1LL &lt;&lt; 33) );\n    \n    return false;\n}\n</code></pre>\n"},{"tags":[],"owner":{"account_id":24765,"reputation":3353,"user_id":63189,"display_name":"paulmurray"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1262862007,"creation_date":1235283721,"answer_id":574455,"question_id":295579,"body_markdown":"It ought to be possible to pack the &#39;cannot be a perfect square if the last X digits are N&#39; much more efficiently than that! I&#39;ll use java 32 bit ints, and produce enough data to check the last 16 bits of the number - that&#39;s 2048 hexadecimal int values.\r\n\r\n...\r\n\r\nOk. Either I have run into some number theory that is a little beyond me, or there is a bug in my code. In any case, here is the code:\r\n\r\n\tpublic static void main(String[] args) {\r\n\t\tfinal int BITS = 16;\r\n\t\t\r\n\t\tBitSet foo = new BitSet();\r\n\t\t\r\n\t\tfor(int i = 0; i&lt; (1&lt;&lt;BITS); i++) {\r\n\t\t\tint sq = (i*i);\r\n\t\t\tsq = sq &amp; ((1&lt;&lt;BITS)-1);\r\n\t\t\tfoo.set(sq);\r\n\t\t}\r\n\t\t\r\n\t\tSystem.out.println(&quot;int[] mayBeASquare = {&quot;);\r\n\t\t\r\n\t\tfor(int i = 0; i&lt; 1&lt;&lt;(BITS-5); i++) {\r\n\t\t\tint kk = 0;\r\n\t\t\tfor(int j = 0; j&lt;32; j++) {\r\n\t\t\t\tif(foo.get((i &lt;&lt; 5) | j)) {\r\n\t\t\t\t\tkk |= 1&lt;&lt;j;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tSystem.out.print(&quot;0x&quot; + Integer.toHexString(kk) + &quot;, &quot;);\r\n\t\t\tif(i%8 == 7) System.out.println();\r\n\t\t}\r\n\t\tSystem.out.println(&quot;};&quot;);\r\n\t}\r\n\r\n\r\nand here are the results:\r\n\r\n(ed: elided for poor performance in prettify.js; view revision history to see.)\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>It ought to be possible to pack the 'cannot be a perfect square if the last X digits are N' much more efficiently than that! I'll use java 32 bit ints, and produce enough data to check the last 16 bits of the number - that's 2048 hexadecimal int values.</p>\n\n<p>...</p>\n\n<p>Ok. Either I have run into some number theory that is a little beyond me, or there is a bug in my code. In any case, here is the code:</p>\n\n<pre><code>public static void main(String[] args) {\n    final int BITS = 16;\n\n    BitSet foo = new BitSet();\n\n    for(int i = 0; i&lt; (1&lt;&lt;BITS); i++) {\n        int sq = (i*i);\n        sq = sq &amp; ((1&lt;&lt;BITS)-1);\n        foo.set(sq);\n    }\n\n    System.out.println(\"int[] mayBeASquare = {\");\n\n    for(int i = 0; i&lt; 1&lt;&lt;(BITS-5); i++) {\n        int kk = 0;\n        for(int j = 0; j&lt;32; j++) {\n            if(foo.get((i &lt;&lt; 5) | j)) {\n                kk |= 1&lt;&lt;j;\n            }\n        }\n        System.out.print(\"0x\" + Integer.toHexString(kk) + \", \");\n        if(i%8 == 7) System.out.println();\n    }\n    System.out.println(\"};\");\n}\n</code></pre>\n\n<p>and here are the results:</p>\n\n<p>(ed: elided for poor performance in prettify.js; view revision history to see.)</p>\n"},{"tags":[],"owner":{"account_id":876456,"reputation":570,"user_id":76649,"display_name":"Ben"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1236777939,"creation_date":1236777494,"answer_id":634473,"question_id":295579,"body_markdown":"Regarding the Carmac method, it seems like it would be quite easy just to iterate once more, which should double the number of digits of accuracy. It is, after all, an extremely truncated iterative method -- Newton&#39;s, with a very good first guess.\r\n\r\nRegarding your current best, I see two micro-optimizations:\r\n\r\n* move the check vs. 0 after the check using mod255\r\n* rearrange the dividing out powers of four to skip all the checks for the usual (75%) case.  \r\n\r\nI.e:\r\n\r\n    // Divide out powers of 4 using binary search\r\n\r\n    if((n &amp; 0x3L) == 0) {\r\n      n &gt;&gt;=2;\r\n\r\n      if((n &amp; 0xffffffffL) == 0)\r\n        n &gt;&gt;= 32;\r\n      if((n &amp; 0xffffL) == 0)\r\n          n &gt;&gt;= 16;\r\n      if((n &amp; 0xffL) == 0)\r\n          n &gt;&gt;= 8;\r\n      if((n &amp; 0xfL) == 0)\r\n          n &gt;&gt;= 4;\r\n      if((n &amp; 0x3L) == 0)\r\n          n &gt;&gt;= 2;\r\n    }\r\n\r\nEven better might be a simple\r\n    \r\n    while ((n &amp; 0x03L) == 0) n &gt;&gt;= 2;\r\n\r\nObviously, it would be interesting to know how many numbers get culled at each checkpoint -- I rather doubt the checks are truly independent, which makes things tricky.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Regarding the Carmac method, it seems like it would be quite easy just to iterate once more, which should double the number of digits of accuracy. It is, after all, an extremely truncated iterative method -- Newton's, with a very good first guess.</p>\n\n<p>Regarding your current best, I see two micro-optimizations:</p>\n\n<ul>\n<li>move the check vs. 0 after the check using mod255</li>\n<li>rearrange the dividing out powers of four to skip all the checks for the usual (75%) case.  </li>\n</ul>\n\n<p>I.e:</p>\n\n<pre><code>// Divide out powers of 4 using binary search\n\nif((n &amp; 0x3L) == 0) {\n  n &gt;&gt;=2;\n\n  if((n &amp; 0xffffffffL) == 0)\n    n &gt;&gt;= 32;\n  if((n &amp; 0xffffL) == 0)\n      n &gt;&gt;= 16;\n  if((n &amp; 0xffL) == 0)\n      n &gt;&gt;= 8;\n  if((n &amp; 0xfL) == 0)\n      n &gt;&gt;= 4;\n  if((n &amp; 0x3L) == 0)\n      n &gt;&gt;= 2;\n}\n</code></pre>\n\n<p>Even better might be a simple</p>\n\n<pre><code>while ((n &amp; 0x03L) == 0) n &gt;&gt;= 2;\n</code></pre>\n\n<p>Obviously, it would be interesting to know how many numbers get culled at each checkpoint -- I rather doubt the checks are truly independent, which makes things tricky.</p>\n"},{"comments":[{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":3,"creation_date":1378667916,"post_id":634494,"comment_id":27528074,"body_markdown":"I&#39;d bet you&#39;re wrong twice. 1. Intel sqrt conforms to IEEE. The only non-conforming instructions are the goniometrical instructions for lange arguments. 2. Java uses intrinsics for Math.sqrt, [no JNI](http://psy-lob-saw.blogspot.de/2012/10/java-intrinsics-are-not-jni-calls.html).","body":"I&#39;d bet you&#39;re wrong twice. 1. Intel sqrt conforms to IEEE. The only non-conforming instructions are the goniometrical instructions for lange arguments. 2. Java uses intrinsics for Math.sqrt, <a href=\"http://psy-lob-saw.blogspot.de/2012/10/java-intrinsics-are-not-jni-calls.html\" rel=\"nofollow noreferrer\">no JNI</a>."},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":1,"creation_date":1519144443,"post_id":634494,"comment_id":84785091,"body_markdown":"Didn&#39;t you forget to use `pp2`? I understand that `pp1` is used for testing the six least significant bits, but I don&#39;t believe that testing the next six bits makes any sense.","body":"Didn&#39;t you forget to use <code>pp2</code>? I understand that <code>pp1</code> is used for testing the six least significant bits, but I don&#39;t believe that testing the next six bits makes any sense."}],"tags":[],"owner":{"display_name":"hydrodog"},"comment_count":2,"down_vote_count":0,"up_vote_count":6,"is_accepted":false,"score":6,"last_activity_date":1236778673,"creation_date":1236777905,"answer_id":634494,"question_id":295579,"body_markdown":"The sqrt call is not perfectly accurate, as has been mentioned, but it&#39;s interesting and instructive that it doesn&#39;t blow away the other answers in terms of speed. After all, the sequence of assembly language instructions for a sqrt is tiny. Intel has a hardware instruction, which isn&#39;t used by Java I believe because it doesn&#39;t conform to IEEE.\r\n\r\nSo why is it slow? Because Java is actually calling a C routine through JNI, and it&#39;s actually slower to do so than to call a Java subroutine, which itself is slower than doing it inline. This is very annoying, and Java should have come up with a better solution, ie building in floating point library calls if necessary. Oh well.\r\n\r\nIn C++, I suspect all the complex alternatives would lose on speed, but I haven&#39;t checked them all.\r\nWhat I did, and what Java people will find usefull, is a simple hack, an extension of the special case testing suggested by A. Rex. Use a single long value as a bit array, which isn&#39;t bounds checked. That way, you have 64 bit boolean lookup.\r\n\r\n\r\n    typedef unsigned long long UVLONG\r\n    UVLONG pp1,pp2;\r\n\r\n    void init2() {\r\n      for (int i = 0; i &lt; 64; i++) {\r\n        for (int j = 0; j &lt; 64; j++)\r\n          if (isPerfectSquare(i * 64 + j)) {\r\n\t    pp1 |= (1 &lt;&lt; j);\r\n\t    pp2 |= (1 &lt;&lt; i);\r\n\t    break;\r\n          }\r\n       }\r\n       cout &lt;&lt; &quot;pp1=&quot; &lt;&lt; pp1 &lt;&lt; &quot;,&quot; &lt;&lt; pp2 &lt;&lt; &quot;\\n&quot;;  \r\n    }\r\n\r\n\r\n    inline bool isPerfectSquare5(UVLONG x) {\r\n      return pp1 &amp; (1 &lt;&lt; (x &amp; 0x3F)) ? isPerfectSquare(x) : false;\r\n    }\r\n\r\nThe routine isPerfectSquare5 runs in about 1/3 the time on my core2 duo machine. I suspect that further tweaks along the same lines could reduce the time further on average, but every time you check, you are trading off more testing for more eliminating, so you can&#39;t go too much farther on that road.\r\n\r\nCertainly, rather than having a separate test for negative, you could check the high 6 bits the same way.\r\n\r\nNote that all I&#39;m doing is eliminating possible squares, but when I have a potential case I have to call the original, inlined isPerfectSquare.\r\n\r\nThe init2 routine is called once to initialize the static values of pp1 and pp2.\r\nNote that in my implementation in C++, I&#39;m using unsigned long long, so since you&#39;re signed, you&#39;d have to use the &gt;&gt;&gt; operator.\r\n\r\nThere is no intrinsic need to bounds check the array, but Java&#39;s optimizer has to figure this stuff out pretty quickly, so I don&#39;t blame them for that.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>The sqrt call is not perfectly accurate, as has been mentioned, but it's interesting and instructive that it doesn't blow away the other answers in terms of speed. After all, the sequence of assembly language instructions for a sqrt is tiny. Intel has a hardware instruction, which isn't used by Java I believe because it doesn't conform to IEEE.</p>\n\n<p>So why is it slow? Because Java is actually calling a C routine through JNI, and it's actually slower to do so than to call a Java subroutine, which itself is slower than doing it inline. This is very annoying, and Java should have come up with a better solution, ie building in floating point library calls if necessary. Oh well.</p>\n\n<p>In C++, I suspect all the complex alternatives would lose on speed, but I haven't checked them all.\nWhat I did, and what Java people will find usefull, is a simple hack, an extension of the special case testing suggested by A. Rex. Use a single long value as a bit array, which isn't bounds checked. That way, you have 64 bit boolean lookup.</p>\n\n<pre><code>typedef unsigned long long UVLONG\nUVLONG pp1,pp2;\n\nvoid init2() {\n  for (int i = 0; i &lt; 64; i++) {\n    for (int j = 0; j &lt; 64; j++)\n      if (isPerfectSquare(i * 64 + j)) {\n    pp1 |= (1 &lt;&lt; j);\n    pp2 |= (1 &lt;&lt; i);\n    break;\n      }\n   }\n   cout &lt;&lt; \"pp1=\" &lt;&lt; pp1 &lt;&lt; \",\" &lt;&lt; pp2 &lt;&lt; \"\\n\";  \n}\n\n\ninline bool isPerfectSquare5(UVLONG x) {\n  return pp1 &amp; (1 &lt;&lt; (x &amp; 0x3F)) ? isPerfectSquare(x) : false;\n}\n</code></pre>\n\n<p>The routine isPerfectSquare5 runs in about 1/3 the time on my core2 duo machine. I suspect that further tweaks along the same lines could reduce the time further on average, but every time you check, you are trading off more testing for more eliminating, so you can't go too much farther on that road.</p>\n\n<p>Certainly, rather than having a separate test for negative, you could check the high 6 bits the same way.</p>\n\n<p>Note that all I'm doing is eliminating possible squares, but when I have a potential case I have to call the original, inlined isPerfectSquare.</p>\n\n<p>The init2 routine is called once to initialize the static values of pp1 and pp2.\nNote that in my implementation in C++, I'm using unsigned long long, so since you're signed, you'd have to use the >>> operator.</p>\n\n<p>There is no intrinsic need to bounds check the array, but Java's optimizer has to figure this stuff out pretty quickly, so I don't blame them for that.</p>\n"},{"comments":[{"owner":{"display_name":"user2975337"},"score":1,"creation_date":1436840851,"post_id":682088,"comment_id":50769016,"body_markdown":"I was thinking the same thing about these algorithms not translating well to multi-precision buffers. So thought I&#39;d stick this here... I actually found [a probabilistic squaredness test](http://math.stackexchange.com/a/1360053/253804) with better asymptotic complexity for huge numbers..... where number theory applications not uncommonly find themselves. Not familiar with Project Euler though... looks interesting.","body":"I was thinking the same thing about these algorithms not translating well to multi-precision buffers. So thought I&#39;d stick this here... I actually found <a href=\"http://math.stackexchange.com/a/1360053/253804\">a probabilistic squaredness test</a> with better asymptotic complexity for huge numbers..... where number theory applications not uncommonly find themselves. Not familiar with Project Euler though... looks interesting."}],"tags":[],"owner":{"account_id":30006,"reputation":1200,"user_id":81502,"accept_rate":50,"display_name":"bgiles"},"comment_count":1,"down_vote_count":0,"up_vote_count":7,"is_accepted":false,"score":7,"last_activity_date":1561500170,"creation_date":1237994585,"answer_id":682088,"question_id":295579,"body_markdown":"Project Euler is mentioned in the tags and many of the problems in it require checking numbers &gt;&gt; `2^64`.  Most of the optimizations mentioned above don&#39;t work easily when you are working with an 80 byte buffer.\r\n\r\nI used java BigInteger and a slightly modified version of Newton&#39;s method, one that works better with integers.  The problem was that exact squares `n^2` converged to `(n-1)` instead of `n` because `n^2-1 = (n-1)(n+1)` and the final error was just one step below the final divisor and the algorithm terminated.  It was easy to fix by adding one to the original argument before computing the error.  (Add two for cube roots, etc.)\r\n\r\nOne nice attribute of this algorithm is that you can immediately tell if the number is a perfect square - the final error (not correction) in Newton&#39;s method will be zero.  A simple modification also lets you quickly calculate `floor(sqrt(x))` instead of the closest integer.  This is handy with several Euler problems.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Project Euler is mentioned in the tags and many of the problems in it require checking numbers >> <code>2^64</code>.  Most of the optimizations mentioned above don't work easily when you are working with an 80 byte buffer.</p>\n\n<p>I used java BigInteger and a slightly modified version of Newton's method, one that works better with integers.  The problem was that exact squares <code>n^2</code> converged to <code>(n-1)</code> instead of <code>n</code> because <code>n^2-1 = (n-1)(n+1)</code> and the final error was just one step below the final divisor and the algorithm terminated.  It was easy to fix by adding one to the original argument before computing the error.  (Add two for cube roots, etc.)</p>\n\n<p>One nice attribute of this algorithm is that you can immediately tell if the number is a perfect square - the final error (not correction) in Newton's method will be zero.  A simple modification also lets you quickly calculate <code>floor(sqrt(x))</code> instead of the closest integer.  This is handy with several Euler problems.</p>\n"},{"tags":[],"owner":{"account_id":20188,"reputation":1433,"user_id":48011,"display_name":"Jonny Heggheim"},"comment_count":0,"down_vote_count":0,"up_vote_count":6,"is_accepted":false,"score":6,"last_activity_date":1243215504,"creation_date":1243214548,"answer_id":905031,"question_id":295579,"body_markdown":"I like the idea to use an almost correct method on some of the input. Here is a version with a higher &quot;offset&quot;. The code seems to work and passes my simple test case.\r\n\r\nJust replace your:\r\n\r\n    if(n &lt; 410881L){...}\r\ncode with this one:\r\n\r\n    if (n &lt; 11043908100L) {\r\n        //John Carmack hack, converted to Java.\r\n        // See: http://www.codemaestro.com/reviews/9\r\n        int i;\r\n        float x2, y;\r\n\r\n        x2 = n * 0.5F;\r\n        y = n;\r\n        i = Float.floatToRawIntBits(y);\r\n        //using the magic number from \r\n        //http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf\r\n        //since it more accurate\r\n        i = 0x5f375a86 - (i &gt;&gt; 1);\r\n        y = Float.intBitsToFloat(i);\r\n        y = y * (1.5F - (x2 * y * y));\r\n        y = y * (1.5F - (x2 * y * y)); //Newton iteration, more accurate\r\n\r\n        sqrt = Math.round(1.0F / y);\r\n    } else {\r\n        //Carmack hack gives incorrect answer for n &gt;= 11043908100.\r\n        sqrt = (long) Math.sqrt(n);\r\n    }\r\n\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>I like the idea to use an almost correct method on some of the input. Here is a version with a higher \"offset\". The code seems to work and passes my simple test case.</p>\n\n<p>Just replace your:</p>\n\n<pre><code>if(n &lt; 410881L){...}\n</code></pre>\n\n<p>code with this one:</p>\n\n<pre><code>if (n &lt; 11043908100L) {\n    //John Carmack hack, converted to Java.\n    // See: http://www.codemaestro.com/reviews/9\n    int i;\n    float x2, y;\n\n    x2 = n * 0.5F;\n    y = n;\n    i = Float.floatToRawIntBits(y);\n    //using the magic number from \n    //http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf\n    //since it more accurate\n    i = 0x5f375a86 - (i &gt;&gt; 1);\n    y = Float.intBitsToFloat(i);\n    y = y * (1.5F - (x2 * y * y));\n    y = y * (1.5F - (x2 * y * y)); //Newton iteration, more accurate\n\n    sqrt = Math.round(1.0F / y);\n} else {\n    //Carmack hack gives incorrect answer for n &gt;= 11043908100.\n    sqrt = (long) Math.sqrt(n);\n}\n</code></pre>\n"},{"comments":[{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":7,"creation_date":1253799751,"post_id":1470707,"comment_id":1321247,"body_markdown":"actually this has been suggested, only in different bases.  Checking the last base-10 digit requires taking `n%10`, which is a division (and thus expensive).  Besides, this would only eliminate 40% of possible values.  In base-16, you can find the last hex-digit with `n&amp;0xf`, which is a very fast bit-wise operation.  In base 16, the last digit of a perfect square has to be 0, 1, 4, or 9, which means that 75% of numbers are eliminated by that check.","body":"actually this has been suggested, only in different bases.  Checking the last base-10 digit requires taking <code>n%10</code>, which is a division (and thus expensive).  Besides, this would only eliminate 40% of possible values.  In base-16, you can find the last hex-digit with <code>n&amp;0xf</code>, which is a very fast bit-wise operation.  In base 16, the last digit of a perfect square has to be 0, 1, 4, or 9, which means that 75% of numbers are eliminated by that check."},{"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"score":0,"creation_date":1253799892,"post_id":1470707,"comment_id":1321269,"body_markdown":"This is the line that checks that the last hex digit is either 0, 1, 4, or 9, though it&#39;s using some optimized bit tricks to do it: `if( n &lt; 0 || ((n&amp;2) != 0) || ((n &amp; 7) == 5) || ((n &amp; 11) == 8) )`","body":"This is the line that checks that the last hex digit is either 0, 1, 4, or 9, though it&#39;s using some optimized bit tricks to do it: <code>if( n &lt; 0 || ((n&amp;2) != 0) || ((n &amp; 7) == 5) || ((n &amp; 11) == 8) )</code>"},{"owner":{"account_id":41028,"reputation":1596,"user_id":119151,"accept_rate":77,"display_name":"dstibbe"},"score":0,"creation_date":1253872062,"post_id":1470707,"comment_id":1326325,"body_markdown":"Perhaps the following will be faster?\nChange:\nif( n &lt; 0 || ((n&amp;2) != 0) || ((n &amp; 7) == 5) || ((n &amp; 11) == 8) )\n    return false;\n\n  if( n == 0 )\n    return true;\n\ninto:\n\n  if( n == 0 )\n    return true;\n\n  if( n &lt; 0 || !( ( n&amp;7 == 1 )  || n==4 )    )\n    return false;","body":"Perhaps the following will be faster? Change: if( n &lt; 0 || ((n&amp;2) != 0) || ((n &amp; 7) == 5) || ((n &amp; 11) == 8) )     return false;    if( n == 0 )     return true;  into:    if( n == 0 )     return true;    if( n &lt; 0 || !( ( n&amp;7 == 1 )  || n==4 )    )     return false;"}],"tags":[],"owner":{"account_id":41028,"reputation":1596,"user_id":119151,"accept_rate":77,"display_name":"dstibbe"},"comment_count":3,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1253785617,"creation_date":1253785617,"answer_id":1470707,"question_id":295579,"body_markdown":"&quot;I&#39;m looking for the fastest way to determine if a long value is a perfect square (i.e. its square root is another integer).&quot; \r\n\r\nThe answers are impressive, but I failed to see a simple check :\r\n\r\ncheck whether the first number on the right of the long it a member of the set (0,1,4,5,6,9) . If it is not, then it cannot possibly be a &#39;perfect square&#39; .\r\n\r\neg.\r\n\r\n4567 - cannot be a perfect square.\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>\"I'm looking for the fastest way to determine if a long value is a perfect square (i.e. its square root is another integer).\" </p>\n\n<p>The answers are impressive, but I failed to see a simple check :</p>\n\n<p>check whether the first number on the right of the long it a member of the set (0,1,4,5,6,9) . If it is not, then it cannot possibly be a 'perfect square' .</p>\n\n<p>eg.</p>\n\n<p>4567 - cannot be a perfect square.</p>\n"},{"tags":[],"owner":{"account_id":7052,"reputation":48090,"user_id":12048,"accept_rate":94,"display_name":"finnw"},"comment_count":0,"down_vote_count":0,"up_vote_count":8,"is_accepted":false,"score":8,"last_activity_date":1273163860,"creation_date":1273152550,"answer_id":2781475,"question_id":295579,"body_markdown":"This is the fastest Java implementation I could come up with, using a combination of techniques suggested by others in this thread.\r\n\r\n* Mod-256 test\r\n* Inexact mod-3465 test (avoids integer division at the cost of some false positives)\r\n* Floating-point square root, round and compare with input value\r\n\r\nI also experimented with these modifications but they did not help performance:\r\n\r\n* Additional mod-255 test\r\n* Dividing the input value by powers of 4\r\n* Fast Inverse Square Root (to work for high values of N it needs 3 iterations, enough to make it slower than the hardware square root function.)\r\n\r\n&lt;p/&gt;\r\n\r\n    public class SquareTester {\r\n    \r\n        public static boolean isPerfectSquare(long n) {\r\n            if (n &lt; 0) {\r\n                return false;\r\n            } else {\r\n                switch ((byte) n) {\r\n                case -128: case -127: case -124: case -119: case -112:\r\n                case -111: case -103: case  -95: case  -92: case  -87:\r\n                case  -79: case  -71: case  -64: case  -63: case  -60:\r\n                case  -55: case  -47: case  -39: case  -31: case  -28:\r\n                case  -23: case  -15: case   -7: case    0: case    1:\r\n                case    4: case    9: case   16: case   17: case   25:\r\n                case   33: case   36: case   41: case   49: case   57:\r\n                case   64: case   65: case   68: case   73: case   81:\r\n                case   89: case   97: case  100: case  105: case  113:\r\n                case  121:\r\n                    long i = (n * INV3465) &gt;&gt;&gt; 52;\r\n                    if (! good3465[(int) i]) {\r\n                        return false;\r\n                    } else {\r\n                        long r = round(Math.sqrt(n));\r\n                        return r*r == n; \r\n                    }\r\n                default:\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n    \r\n        private static int round(double x) {\r\n            return (int) Double.doubleToRawLongBits(x + (double) (1L &lt;&lt; 52));\r\n        }\r\n    \r\n        /** 3465&lt;sup&gt;-1&lt;/sup&gt; modulo 2&lt;sup&gt;64&lt;/sup&gt; */\r\n        private static final long INV3465 = 0x8ffed161732e78b9L;\r\n    \r\n        private static final boolean[] good3465 =\r\n            new boolean[0x1000];\r\n    \r\n        static {\r\n            for (int r = 0; r &lt; 3465; ++ r) {\r\n                int i = (int) ((r * r * INV3465) &gt;&gt;&gt; 52);\r\n                good3465[i] = good3465[i+1] = true;\r\n            }\r\n        }\r\n    \r\n    }","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>This is the fastest Java implementation I could come up with, using a combination of techniques suggested by others in this thread.</p>\n\n<ul>\n<li>Mod-256 test</li>\n<li>Inexact mod-3465 test (avoids integer division at the cost of some false positives)</li>\n<li>Floating-point square root, round and compare with input value</li>\n</ul>\n\n<p>I also experimented with these modifications but they did not help performance:</p>\n\n<ul>\n<li>Additional mod-255 test</li>\n<li>Dividing the input value by powers of 4</li>\n<li>Fast Inverse Square Root (to work for high values of N it needs 3 iterations, enough to make it slower than the hardware square root function.)</li>\n</ul>\n\n<p></p>\n\n<pre><code>public class SquareTester {\n\n    public static boolean isPerfectSquare(long n) {\n        if (n &lt; 0) {\n            return false;\n        } else {\n            switch ((byte) n) {\n            case -128: case -127: case -124: case -119: case -112:\n            case -111: case -103: case  -95: case  -92: case  -87:\n            case  -79: case  -71: case  -64: case  -63: case  -60:\n            case  -55: case  -47: case  -39: case  -31: case  -28:\n            case  -23: case  -15: case   -7: case    0: case    1:\n            case    4: case    9: case   16: case   17: case   25:\n            case   33: case   36: case   41: case   49: case   57:\n            case   64: case   65: case   68: case   73: case   81:\n            case   89: case   97: case  100: case  105: case  113:\n            case  121:\n                long i = (n * INV3465) &gt;&gt;&gt; 52;\n                if (! good3465[(int) i]) {\n                    return false;\n                } else {\n                    long r = round(Math.sqrt(n));\n                    return r*r == n; \n                }\n            default:\n                return false;\n            }\n        }\n    }\n\n    private static int round(double x) {\n        return (int) Double.doubleToRawLongBits(x + (double) (1L &lt;&lt; 52));\n    }\n\n    /** 3465&lt;sup&gt;-1&lt;/sup&gt; modulo 2&lt;sup&gt;64&lt;/sup&gt; */\n    private static final long INV3465 = 0x8ffed161732e78b9L;\n\n    private static final boolean[] good3465 =\n        new boolean[0x1000];\n\n    static {\n        for (int r = 0; r &lt; 3465; ++ r) {\n            int i = (int) ((r * r * INV3465) &gt;&gt;&gt; 52);\n            good3465[i] = good3465[i+1] = true;\n        }\n    }\n\n}\n</code></pre>\n"},{"comments":[{"owner":{"account_id":683863,"reputation":1,"user_id":530074,"display_name":"nabam serbang"},"score":0,"creation_date":1292684786,"post_id":4351380,"comment_id":4896820,"body_markdown":"@Kip: Some problem with my browser.","body":"@Kip: Some problem with my browser."}],"tags":[],"owner":{"account_id":683863,"reputation":1,"user_id":530074,"display_name":"nabam serbang"},"comment_count":1,"down_vote_count":0,"up_vote_count":6,"is_accepted":false,"score":6,"last_activity_date":1520286620,"creation_date":1291425754,"answer_id":4351380,"question_id":295579,"body_markdown":"Considering for general bit length (though I have used specific type here), I tried to design simplistic algo as below. Simple and obvious check for 0,1,2 or &lt;0 is required initially.\r\nFollowing is simple in sense that it doesn&#39;t try to use any existing maths functions. Most of the operator can be replaced with bit-wise operators. I haven&#39;t tested with any bench mark data though. I&#39;m neither expert at maths or computer algorithm design in particular, I would love to see you pointing out problem. I know there is lots of improvement chances there.\r\n\r\n    int main()\r\n    {\r\n    \tunsigned int c1=0 ,c2 = 0;  \r\n    \tunsigned int x = 0;  \r\n    \tunsigned int p = 0;  \r\n    \tint k1 = 0;  \r\n    \tscanf(&quot;%d&quot;,&amp;p);  \r\n    \tif(p % 2 == 0) {  \r\n    \t    x = p/2; \r\n    \t}  \r\n    \telse {  \r\n    \t    x = (p/2) +1;  \r\n    \t}  \r\n    \twhile(x) \r\n        {\r\n    \t    if((x*x) &gt; p) {  \r\n    \t\t    c1 = x;  \r\n    \t\t    x = x/2; \r\n    \t\t}else {  \r\n    \t\t    c2 = x;  \r\n    \t\t    break;  \r\n    \t\t}  \r\n    \t}  \r\n    \tif((p%2) != 0)  \r\n            c2++;\r\n    \r\n        while(c2 &lt; c1) \r\n        {  \r\n            if((c2 * c2 ) == p) {  \r\n                k1 = 1;  \r\n                break;  \r\n       \t    }  \r\n            c2++; \r\n        }  \r\n        if(k1)  \r\n            printf(&quot;\\n Perfect square for %d&quot;, c2);  \r\n        else  \r\n            printf(&quot;\\n Not perfect but nearest to :%d :&quot;, c2);  \r\n        return 0;  \r\n    }  \r\n\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Considering for general bit length (though I have used specific type here), I tried to design simplistic algo as below. Simple and obvious check for 0,1,2 or &lt;0 is required initially.\nFollowing is simple in sense that it doesn't try to use any existing maths functions. Most of the operator can be replaced with bit-wise operators. I haven't tested with any bench mark data though. I'm neither expert at maths or computer algorithm design in particular, I would love to see you pointing out problem. I know there is lots of improvement chances there.</p>\n\n<pre><code>int main()\n{\n    unsigned int c1=0 ,c2 = 0;  \n    unsigned int x = 0;  \n    unsigned int p = 0;  \n    int k1 = 0;  \n    scanf(\"%d\",&amp;p);  \n    if(p % 2 == 0) {  \n        x = p/2; \n    }  \n    else {  \n        x = (p/2) +1;  \n    }  \n    while(x) \n    {\n        if((x*x) &gt; p) {  \n            c1 = x;  \n            x = x/2; \n        }else {  \n            c2 = x;  \n            break;  \n        }  \n    }  \n    if((p%2) != 0)  \n        c2++;\n\n    while(c2 &lt; c1) \n    {  \n        if((c2 * c2 ) == p) {  \n            k1 = 1;  \n            break;  \n        }  \n        c2++; \n    }  \n    if(k1)  \n        printf(\"\\n Perfect square for %d\", c2);  \n    else  \n        printf(\"\\n Not perfect but nearest to :%d :\", c2);  \n    return 0;  \n}  \n</code></pre>\n"},{"tags":[],"owner":{"account_id":558241,"reputation":834,"user_id":920769,"accept_rate":79,"display_name":"Fractaly"},"comment_count":0,"down_vote_count":0,"up_vote_count":5,"is_accepted":false,"score":5,"last_activity_date":1323059388,"creation_date":1322973052,"answer_id":8373278,"question_id":295579,"body_markdown":"I checked all of the possible results when the last n bits of a square is observed. By successively examining more bits, up to 5/6th of inputs can be eliminated. I actually designed this to implement Fermat&#39;s Factorization algorithm, and it is very fast there.\r\n\r\n    public static boolean isSquare(final long val) {\r\n       if ((val &amp; 2) == 2 || (val &amp; 7) == 5) {\r\n         return false;\r\n       }\r\n       if ((val &amp; 11) == 8 || (val &amp; 31) == 20) {\r\n         return false;\r\n       }\r\n\r\n       if ((val &amp; 47) == 32 || (val &amp; 127) == 80) {\r\n         return false;\r\n       }\r\n\r\n       if ((val &amp; 191) == 128 || (val &amp; 511) == 320) {\r\n         return false;\r\n       }\r\n\r\n       // if((val &amp; a == b) || (val &amp; c == d){\r\n       //   return false;\r\n       // }\r\n       \r\n       if (!modSq[(int) (val % modSq.length)]) {\r\n            return false;\r\n       }\r\n       \r\n       final long root = (long) Math.sqrt(val);\r\n       return root * root == val;\r\n    }\r\nThe last bit of pseudocode can be used to extend the tests to eliminate more values. The tests above are for k = 0, 1, 2, 3\r\n\r\n&lt;ul&gt;&lt;li&gt;a is of the form (3 &lt;&lt; 2k) - 1\r\n    &lt;li&gt;b is of the form (2 &lt;&lt; 2k)\r\n    &lt;li&gt;c is of the form (2 &lt;&lt; 2k + 2) - 1\r\n    &lt;li&gt;d is of the form (2 &lt;&lt; 2k - 1) * 10\r\n\r\nIt first tests whether it has a  square residual with moduli of power of two, then it tests based on a final modulus, then it uses the Math.sqrt to do a final test. I came up with the idea from the top post, and attempted to extend upon it. I appreciate any comments or suggestions.\r\n\r\n**Update:** Using the test by a modulus, (modSq) and a modulus base of 44352, my test runs in 96% of the time of the one in the OP&#39;s update for numbers up to 1,000,000,000.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>I checked all of the possible results when the last n bits of a square is observed. By successively examining more bits, up to 5/6th of inputs can be eliminated. I actually designed this to implement Fermat's Factorization algorithm, and it is very fast there.</p>\n\n<pre><code>public static boolean isSquare(final long val) {\n   if ((val &amp; 2) == 2 || (val &amp; 7) == 5) {\n     return false;\n   }\n   if ((val &amp; 11) == 8 || (val &amp; 31) == 20) {\n     return false;\n   }\n\n   if ((val &amp; 47) == 32 || (val &amp; 127) == 80) {\n     return false;\n   }\n\n   if ((val &amp; 191) == 128 || (val &amp; 511) == 320) {\n     return false;\n   }\n\n   // if((val &amp; a == b) || (val &amp; c == d){\n   //   return false;\n   // }\n\n   if (!modSq[(int) (val % modSq.length)]) {\n        return false;\n   }\n\n   final long root = (long) Math.sqrt(val);\n   return root * root == val;\n}\n</code></pre>\n\n<p>The last bit of pseudocode can be used to extend the tests to eliminate more values. The tests above are for k = 0, 1, 2, 3</p>\n\n<p><li>a is of the form (3 &lt;&lt; 2k) - 1\n    <li>b is of the form (2 &lt;&lt; 2k)\n    <li>c is of the form (2 &lt;&lt; 2k + 2) - 1\n    <li>d is of the form (2 &lt;&lt; 2k - 1) * 10</p>\n\n<p>It first tests whether it has a  square residual with moduli of power of two, then it tests based on a final modulus, then it uses the Math.sqrt to do a final test. I came up with the idea from the top post, and attempted to extend upon it. I appreciate any comments or suggestions.</p>\n\n<p><strong>Update:</strong> Using the test by a modulus, (modSq) and a modulus base of 44352, my test runs in 96% of the time of the one in the OP's update for numbers up to 1,000,000,000.</p>\n"},{"comments":[{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":4,"creation_date":1440122713,"post_id":17028771,"comment_id":52153354,"body_markdown":"A giant lookup table doesn&#39;t seem like a good idea.  A cache miss is slower (~100 to 150 cycles) than the x86 hardware sqrt instruction (~20 cycles).  Throughput-wise, you can sustain a lot of outstanding cache-misses, but you&#39;re still evicting other useful data.  A huge lookup table would only be worth it if it was a LOT faster than any other option, and this function was the major factor in the performance of your whole program.","body":"A giant lookup table doesn&#39;t seem like a good idea.  A cache miss is slower (~100 to 150 cycles) than the x86 hardware sqrt instruction (~20 cycles).  Throughput-wise, you can sustain a lot of outstanding cache-misses, but you&#39;re still evicting other useful data.  A huge lookup table would only be worth it if it was a LOT faster than any other option, and this function was the major factor in the performance of your whole program."},{"owner":{"account_id":2785627,"reputation":2135,"user_id":2397118,"accept_rate":52,"display_name":"Swiss Frank"},"score":0,"creation_date":1540926580,"post_id":17028771,"comment_id":93040953,"body_markdown":"@Peter Cordes, you should only have cache misses a few times initially, then it will all be in cache, right?","body":"@Peter Cordes, you should only have cache misses a few times initially, then it will all be in cache, right?"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1540937582,"post_id":17028771,"comment_id":93045481,"body_markdown":"@SwissFrank: is perfect-square checking the *only* thing your program does?  A lookup table can look good in a microbenchmark that calls it repeatedly in a tight loop, but in a real program that has other data in its working set, it&#39;s not good.","body":"@SwissFrank: is perfect-square checking the <i>only</i> thing your program does?  A lookup table can look good in a microbenchmark that calls it repeatedly in a tight loop, but in a real program that has other data in its working set, it&#39;s not good."},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1540937885,"post_id":17028771,"comment_id":93045626,"body_markdown":"A bitmap of 0x1FFFFFE bits takes 4 mega-*bytes* if stored as a packed bitmap.  An L3 cache *hit* on a modern Intel desktop has &gt; 40 cycles of latency, and worse on a big Xeon; longer than hardware sqrt+mul latency.  If stored as a *byte*-map with 1 byte per value, it&#39;s about 32 MB; bigger than the L3 cache of anything but a many-core Xeon where all core share one huge cache.  So if your inputs data has a uniform random distribution over a large enough range of inputs, you&#39;ll get lots of L2 cache misses even in a tight loop.  (private per-core L2 on Intel is only 256k, with ~12 cycle latency.)","body":"A bitmap of 0x1FFFFFE bits takes 4 mega-<i>bytes</i> if stored as a packed bitmap.  An L3 cache <i>hit</i> on a modern Intel desktop has &gt; 40 cycles of latency, and worse on a big Xeon; longer than hardware sqrt+mul latency.  If stored as a <i>byte</i>-map with 1 byte per value, it&#39;s about 32 MB; bigger than the L3 cache of anything but a many-core Xeon where all core share one huge cache.  So if your inputs data has a uniform random distribution over a large enough range of inputs, you&#39;ll get lots of L2 cache misses even in a tight loop.  (private per-core L2 on Intel is only 256k, with ~12 cycle latency.)"},{"owner":{"account_id":2785627,"reputation":2135,"user_id":2397118,"accept_rate":52,"display_name":"Swiss Frank"},"score":0,"creation_date":1540978607,"post_id":17028771,"comment_id":93057793,"body_markdown":"@Peter Cordes, the original poster seems to say that that this is the core part of his program.  As a recreational mathematician he may not be running any other processes while this is going, so it could be expected to have the cache much to itself.  However if I understand your numbers, if you can&#39;t get it in L2--and you can&#39;t--then sqrt will be faster than going to L3.  Off subject but do you have a convenient reference for access times on various CPUs?","body":"@Peter Cordes, the original poster seems to say that that this is the core part of his program.  As a recreational mathematician he may not be running any other processes while this is going, so it could be expected to have the cache much to itself.  However if I understand your numbers, if you can&#39;t get it in L2--and you can&#39;t--then sqrt will be faster than going to L3.  Off subject but do you have a convenient reference for access times on various CPUs?"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1540979259,"post_id":17028771,"comment_id":93058135,"body_markdown":"@SwissFrank: Oh, if all you&#39;re doing is root checking, then there&#39;s potential to this with a bitmap to get L3 hits.  I was looking at latency, but many misses can be in flight at once, so throughput is potentially good. \n OTOH, SIMD `sqrtps` throughput or even `sqrtpd` (double-precision) is not too bad on Skylake, but is not much better than latency on old CPUs. \n Anyway https://www.7-cpu.com/cpu/Haswell.html has some nice experimental numbers, and pages for other CPUs.  Agner Fog&#39;s microarch guide pdf has some cache latency numbers for Intel and AMD uarches: https://agner.org/optimize/","body":"@SwissFrank: Oh, if all you&#39;re doing is root checking, then there&#39;s potential to this with a bitmap to get L3 hits.  I was looking at latency, but many misses can be in flight at once, so throughput is potentially good.   OTOH, SIMD <code>sqrtps</code> throughput or even <code>sqrtpd</code> (double-precision) is not too bad on Skylake, but is not much better than latency on old CPUs.   Anyway <a href=\"https://www.7-cpu.com/cpu/Haswell.html\" rel=\"nofollow noreferrer\">7-cpu.com/cpu/Haswell.html</a> has some nice experimental numbers, and pages for other CPUs.  Agner Fog&#39;s microarch guide pdf has some cache latency numbers for Intel and AMD uarches: <a href=\"https://agner.org/optimize/\" rel=\"nofollow noreferrer\">agner.org/optimize</a>"},{"owner":{"account_id":78868,"reputation":337070,"user_id":224132,"accept_rate":83,"display_name":"Peter Cordes"},"score":1,"creation_date":1540979558,"post_id":17028771,"comment_id":93058291,"body_markdown":"Using x86 SIMD from Java is a problem, and by the time you add in the cost of int-&gt;fp and fp-&gt;int conversion, it&#39;s plausible that a bitmap could be better.  You do need `double` precision to avoid rounding some integer outside the +-2^24 range (so a 32-bit integer can be outside that), and `sqrtpd` is slower than `sqrtps` as well as only processing half as many elements per instruction (per SIMD vector).","body":"Using x86 SIMD from Java is a problem, and by the time you add in the cost of int-&gt;fp and fp-&gt;int conversion, it&#39;s plausible that a bitmap could be better.  You do need <code>double</code> precision to avoid rounding some integer outside the +-2^24 range (so a 32-bit integer can be outside that), and <code>sqrtpd</code> is slower than <code>sqrtps</code> as well as only processing half as many elements per instruction (per SIMD vector)."},{"owner":{"account_id":2785627,"reputation":2135,"user_id":2397118,"accept_rate":52,"display_name":"Swiss Frank"},"score":0,"creation_date":1540997157,"post_id":17028771,"comment_id":93068922,"body_markdown":"&gt; &quot;by the time you add in the cost of int-&gt;fp and fp-&gt;int conversion, it&#39;s plausible that a bitmap could be better&quot;  Just checked your profile, many bows!  One idea that comes to mind is running your loop in int and double side by side, using the double where you need it and int where you need it.  I totally haven&#39;t checked whether that even fits the wider discussion, but is just one thing I&#39;ve done.  BTW I do synthesizer software and am keen to try SIMD for one aspect of it...","body":"&gt; &quot;by the time you add in the cost of int-&gt;fp and fp-&gt;int conversion, it&#39;s plausible that a bitmap could be better&quot;  Just checked your profile, many bows!  One idea that comes to mind is running your loop in int and double side by side, using the double where you need it and int where you need it.  I totally haven&#39;t checked whether that even fits the wider discussion, but is just one thing I&#39;ve done.  BTW I do synthesizer software and am keen to try SIMD for one aspect of it..."}],"tags":[],"owner":{"account_id":1968644,"reputation":32046,"user_id":1768232,"accept_rate":81,"display_name":"durron597"},"comment_count":8,"down_vote_count":0,"up_vote_count":25,"is_accepted":false,"score":25,"last_activity_date":1371145366,"creation_date":1370882347,"answer_id":17028771,"question_id":295579,"body_markdown":"I ran my own analysis of several of the algorithms in this thread and came up with some new results. You can see those old results in the edit history of this answer, but they&#39;re not accurate, as I made a mistake, and wasted time analyzing several algorithms which aren&#39;t close. However, pulling lessons from several different answers, I now have two algorithms that crush the &quot;winner&quot; of this thread. Here&#39;s the core thing I do differently than everyone else:\r\n\r\n\t// This is faster because a number is divisible by 2^4 or more only 6% of the time\r\n\t// and more than that a vanishingly small percentage.\r\n\twhile((x &amp; 0x3) == 0) x &gt;&gt;= 2;\r\n\t// This is effectively the same as the switch-case statement used in the original\r\n\t// answer. \r\n\tif((x &amp; 0x7) != 1) return false;\r\n\r\nHowever, this simple line, which most of the time adds one or two very fast instructions, greatly simplifies the `switch-case` statement into one if statement. However, it can add to the runtime if many of the tested numbers have significant power-of-two factors.\r\n\r\nThe algorithms below are as follows:\r\n\r\n - **Internet** - Kip&#39;s posted answer\r\n - **Durron** - My modified answer using the one-pass answer as a base\r\n - **DurronTwo** - My modified answer using the two-pass answer (by @JohnnyHeggheim), with some other slight modifications.\r\n\r\nHere is a sample runtime if the numbers are generated using `Math.abs(java.util.Random.nextLong())`\r\n\r\n     0% Scenario{vm=java, trial=0, benchmark=Internet} 39673.40 ns; ?=378.78 ns @ 3 trials\r\n    33% Scenario{vm=java, trial=0, benchmark=Durron} 37785.75 ns; ?=478.86 ns @ 10 trials\r\n    67% Scenario{vm=java, trial=0, benchmark=DurronTwo} 35978.10 ns; ?=734.10 ns @ 10 trials\r\n\r\n    benchmark   us linear runtime\r\n     Internet 39.7 ==============================\r\n       Durron 37.8 ============================\r\n    DurronTwo 36.0 ===========================\r\n\r\n    vm: java\r\n    trial: 0\r\n\r\nAnd here is a sample runtime if it&#39;s run on the first million longs only:\r\n\r\n     0% Scenario{vm=java, trial=0, benchmark=Internet} 2933380.84 ns; ?=56939.84 ns @ 10 trials\r\n    33% Scenario{vm=java, trial=0, benchmark=Durron} 2243266.81 ns; ?=50537.62 ns @ 10 trials\r\n    67% Scenario{vm=java, trial=0, benchmark=DurronTwo} 3159227.68 ns; ?=10766.22 ns @ 3 trials\r\n\r\n    benchmark   ms linear runtime\r\n     Internet 2.93 ===========================\r\n       Durron 2.24 =====================\r\n    DurronTwo 3.16 ==============================\r\n\r\n    vm: java\r\n    trial: 0\r\n\r\nAs you can see, `DurronTwo` does better for large inputs, because it gets to use the magic trick very very often, but gets clobbered compared to the first algorithm and `Math.sqrt` because the numbers are so much smaller. Meanwhile, the simpler `Durron` is a huge winner because it never has to divide by 4 many many times in the first million numbers.\r\n\r\nHere&#39;s `Durron`:\r\n\r\n\tpublic final static boolean isPerfectSquareDurron(long n) {\r\n\t\tif(n &lt; 0) return false;\r\n\t\tif(n == 0) return true;\r\n\t\t\r\n\t\tlong x = n;\r\n\t\t// This is faster because a number is divisible by 16 only 6% of the time\r\n\t\t// and more than that a vanishingly small percentage.\r\n\t\twhile((x &amp; 0x3) == 0) x &gt;&gt;= 2;\r\n\t\t// This is effectively the same as the switch-case statement used in the original\r\n\t\t// answer. \r\n\t\tif((x &amp; 0x7) == 1) {\r\n\t\r\n\t\t\tlong sqrt;\r\n\t\t\tif(x &lt; 410881L)\r\n\t\t\t{\r\n\t\t\t\tint i;\r\n\t\t\t\tfloat x2, y;\r\n\t\r\n\t\t\t\tx2 = x * 0.5F;\r\n\t\t\t\ty  = x;\r\n\t\t\t\ti  = Float.floatToRawIntBits(y);\r\n\t\t\t\ti  = 0x5f3759df - ( i &gt;&gt; 1 );\r\n\t\t\t\ty  = Float.intBitsToFloat(i);\r\n\t\t\t\ty  = y * ( 1.5F - ( x2 * y * y ) );\r\n\t\r\n\t\t\t\tsqrt = (long)(1.0F/y);\r\n\t\t\t} else {\r\n\t\t\t\tsqrt = (long) Math.sqrt(x);\r\n\t\t\t}\r\n\t\t\treturn sqrt*sqrt == x;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\nAnd `DurronTwo`\r\n\r\n\tpublic final static boolean isPerfectSquareDurronTwo(long n) {\r\n\t\tif(n &lt; 0) return false;\r\n\t\t// Needed to prevent infinite loop\r\n\t\tif(n == 0) return true;\r\n\t\t\r\n\t\tlong x = n;\r\n\t\twhile((x &amp; 0x3) == 0) x &gt;&gt;= 2;\r\n\t\tif((x &amp; 0x7) == 1) {\r\n\t\t\tlong sqrt;\r\n\t\t\tif (x &lt; 41529141369L) {\r\n\t\t\t\tint i;\r\n\t\t\t\tfloat x2, y;\r\n\t\r\n\t\t\t\tx2 = x * 0.5F;\r\n\t\t\t\ty = x;\r\n\t\t\t\ti = Float.floatToRawIntBits(y);\r\n\t\t\t\t//using the magic number from \r\n\t\t\t\t//http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf\r\n\t\t\t\t//since it more accurate\r\n\t\t\t\ti = 0x5f375a86 - (i &gt;&gt; 1);\r\n\t\t\t\ty = Float.intBitsToFloat(i);\r\n\t\t\t\ty = y * (1.5F - (x2 * y * y));\r\n\t\t\t\ty = y * (1.5F - (x2 * y * y)); //Newton iteration, more accurate\r\n\t\t\t\tsqrt = (long) ((1.0F/y) + 0.2);\r\n\t\t\t} else {\r\n\t\t\t\t//Carmack hack gives incorrect answer for n &gt;= 41529141369.\r\n\t\t\t\tsqrt = (long) Math.sqrt(x);\r\n\t\t\t}\r\n\t\t\treturn sqrt*sqrt == x;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\nAnd my benchmark harness: (Requires Google caliper 0.1-rc5)\r\n\r\n\tpublic class SquareRootBenchmark {\r\n\t\tpublic static class Benchmark1 extends SimpleBenchmark {\r\n\t\t\tprivate static final int ARRAY_SIZE = 10000;\r\n\t\t\tlong[] trials = new long[ARRAY_SIZE];\r\n\t\r\n\t\t\t@Override\r\n\t\t\tprotected void setUp() throws Exception {\r\n\t\t\t\tRandom r = new Random();\r\n\t\t\t\tfor (int i = 0; i &lt; ARRAY_SIZE; i++) {\r\n\t\t\t\t\ttrials[i] = Math.abs(r.nextLong());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\t\r\n\t\t\tpublic int timeInternet(int reps) {\r\n\t\t\t\tint trues = 0;\r\n\t\t\t\tfor(int i = 0; i &lt; reps; i++) {\r\n\t\t\t\t\tfor(int j = 0; j &lt; ARRAY_SIZE; j++) {\r\n\t\t\t\t\t\tif(SquareRootAlgs.isPerfectSquareInternet(trials[j])) trues++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\treturn trues;   \r\n\t\t\t}\r\n\t\r\n\t\t\tpublic int timeDurron(int reps) {\r\n\t\t\t\tint trues = 0;\r\n\t\t\t\tfor(int i = 0; i &lt; reps; i++) {\r\n\t\t\t\t\tfor(int j = 0; j &lt; ARRAY_SIZE; j++) {\r\n\t\t\t\t\t\tif(SquareRootAlgs.isPerfectSquareDurron(trials[j])) trues++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\treturn trues;   \r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic int timeDurronTwo(int reps) {\r\n\t\t\t\tint trues = 0;\r\n\t\t\t\tfor(int i = 0; i &lt; reps; i++) {\r\n\t\t\t\t\tfor(int j = 0; j &lt; ARRAY_SIZE; j++) {\r\n\t\t\t\t\t\tif(SquareRootAlgs.isPerfectSquareDurronTwo(trials[j])) trues++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\treturn trues;   \r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tpublic static void main(String... args) {\r\n\t\t\tRunner.main(Benchmark1.class, args);\r\n\t\t}\r\n\t}\r\n\r\n**UPDATE:** I&#39;ve made a new algorithm that is faster in some scenarios, slower in others, I&#39;ve gotten different benchmarks based on different inputs. If we calculate modulo `0xFFFFFF = 3 x 3 x 5 x 7 x 13 x 17 x 241`, we can eliminate 97.82% of numbers that cannot be squares. This can be (sort of) done in one line, with 5 bitwise operations:\r\n\r\n\tif (!goodLookupSquares[(int) ((n &amp; 0xFFFFFFl) + ((n &gt;&gt; 24) &amp; 0xFFFFFFl) + (n &gt;&gt; 48))]) return false;\r\n\r\nThe resulting index is either 1) the residue, 2) the residue `+ 0xFFFFFF`, or 3) the residue `+ 0x1FFFFFE`. Of course, we need to have a lookup table for residues modulo `0xFFFFFF`, which is about a 3mb file (in this case stored as ascii text decimal numbers, not optimal but clearly improvable with a `ByteBuffer` and so forth. But since that is precalculation it doesn&#39;t matter so much. [You can find the file here](http://www.stwing.org/~martinja/24residues_squares.txt) (or generate it yourself): \r\n\r\n\tpublic final static boolean isPerfectSquareDurronThree(long n) {\r\n\t\tif(n &lt; 0) return false;\r\n\t\tif(n == 0) return true;\r\n\t\t\r\n\t\tlong x = n;\r\n\t\twhile((x &amp; 0x3) == 0) x &gt;&gt;= 2;\r\n\t\tif((x &amp; 0x7) == 1) {\r\n\t\t\tif (!goodLookupSquares[(int) ((n &amp; 0xFFFFFFl) + ((n &gt;&gt; 24) &amp; 0xFFFFFFl) + (n &gt;&gt; 48))]) return false;\r\n\t\t\tlong sqrt;\r\n\t\t\tif(x &lt; 410881L)\r\n\t\t\t{\r\n\t\t\t\tint i;\r\n\t\t\t\tfloat x2, y;\r\n\t\r\n\t\t\t\tx2 = x * 0.5F;\r\n\t\t\t\ty  = x;\r\n\t\t\t\ti  = Float.floatToRawIntBits(y);\r\n\t\t\t\ti  = 0x5f3759df - ( i &gt;&gt; 1 );\r\n\t\t\t\ty  = Float.intBitsToFloat(i);\r\n\t\t\t\ty  = y * ( 1.5F - ( x2 * y * y ) );\r\n\t\r\n\t\t\t\tsqrt = (long)(1.0F/y);\r\n\t\t\t} else {\r\n\t\t\t\tsqrt = (long) Math.sqrt(x);\r\n\t\t\t}\r\n\t\t\treturn sqrt*sqrt == x;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\nI load it into a `boolean` array like this:\r\n\r\n\tprivate static boolean[] goodLookupSquares = null;\r\n\t\r\n\tpublic static void initGoodLookupSquares() throws Exception {\r\n\t\tScanner s = new Scanner(new File(&quot;24residues_squares.txt&quot;));\r\n\t\t\r\n\t\tgoodLookupSquares = new boolean[0x1FFFFFE];\r\n\t\t\r\n\t\twhile(s.hasNextLine()) {\r\n\t\t\tint residue = Integer.valueOf(s.nextLine());\r\n\t\t\tgoodLookupSquares[residue] = true;\r\n\t\t\tgoodLookupSquares[residue + 0xFFFFFF] = true;\r\n\t\t\tgoodLookupSquares[residue + 0x1FFFFFE] = true;\r\n\t\t}\r\n\t\t\r\n\t\ts.close();\r\n\t}\r\n\r\nExample runtime. It beat `Durron` (version one) in every trial I ran.\r\n\r\n     0% Scenario{vm=java, trial=0, benchmark=Internet} 40665.77 ns; ?=566.71 ns @ 10 trials\r\n    33% Scenario{vm=java, trial=0, benchmark=Durron} 38397.60 ns; ?=784.30 ns @ 10 trials\r\n    67% Scenario{vm=java, trial=0, benchmark=DurronThree} 36171.46 ns; ?=693.02 ns @ 10 trials\r\n\r\n      benchmark   us linear runtime\r\n       Internet 40.7 ==============================\r\n         Durron 38.4 ============================\r\n    DurronThree 36.2 ==========================\r\n\r\n    vm: java\r\n    trial: 0","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>I ran my own analysis of several of the algorithms in this thread and came up with some new results. You can see those old results in the edit history of this answer, but they're not accurate, as I made a mistake, and wasted time analyzing several algorithms which aren't close. However, pulling lessons from several different answers, I now have two algorithms that crush the \"winner\" of this thread. Here's the core thing I do differently than everyone else:</p>\n\n<pre><code>// This is faster because a number is divisible by 2^4 or more only 6% of the time\n// and more than that a vanishingly small percentage.\nwhile((x &amp; 0x3) == 0) x &gt;&gt;= 2;\n// This is effectively the same as the switch-case statement used in the original\n// answer. \nif((x &amp; 0x7) != 1) return false;\n</code></pre>\n\n<p>However, this simple line, which most of the time adds one or two very fast instructions, greatly simplifies the <code>switch-case</code> statement into one if statement. However, it can add to the runtime if many of the tested numbers have significant power-of-two factors.</p>\n\n<p>The algorithms below are as follows:</p>\n\n<ul>\n<li><strong>Internet</strong> - Kip's posted answer</li>\n<li><strong>Durron</strong> - My modified answer using the one-pass answer as a base</li>\n<li><strong>DurronTwo</strong> - My modified answer using the two-pass answer (by @JohnnyHeggheim), with some other slight modifications.</li>\n</ul>\n\n<p>Here is a sample runtime if the numbers are generated using <code>Math.abs(java.util.Random.nextLong())</code></p>\n\n<pre><code> 0% Scenario{vm=java, trial=0, benchmark=Internet} 39673.40 ns; ?=378.78 ns @ 3 trials\n33% Scenario{vm=java, trial=0, benchmark=Durron} 37785.75 ns; ?=478.86 ns @ 10 trials\n67% Scenario{vm=java, trial=0, benchmark=DurronTwo} 35978.10 ns; ?=734.10 ns @ 10 trials\n\nbenchmark   us linear runtime\n Internet 39.7 ==============================\n   Durron 37.8 ============================\nDurronTwo 36.0 ===========================\n\nvm: java\ntrial: 0\n</code></pre>\n\n<p>And here is a sample runtime if it's run on the first million longs only:</p>\n\n<pre><code> 0% Scenario{vm=java, trial=0, benchmark=Internet} 2933380.84 ns; ?=56939.84 ns @ 10 trials\n33% Scenario{vm=java, trial=0, benchmark=Durron} 2243266.81 ns; ?=50537.62 ns @ 10 trials\n67% Scenario{vm=java, trial=0, benchmark=DurronTwo} 3159227.68 ns; ?=10766.22 ns @ 3 trials\n\nbenchmark   ms linear runtime\n Internet 2.93 ===========================\n   Durron 2.24 =====================\nDurronTwo 3.16 ==============================\n\nvm: java\ntrial: 0\n</code></pre>\n\n<p>As you can see, <code>DurronTwo</code> does better for large inputs, because it gets to use the magic trick very very often, but gets clobbered compared to the first algorithm and <code>Math.sqrt</code> because the numbers are so much smaller. Meanwhile, the simpler <code>Durron</code> is a huge winner because it never has to divide by 4 many many times in the first million numbers.</p>\n\n<p>Here's <code>Durron</code>:</p>\n\n<pre><code>public final static boolean isPerfectSquareDurron(long n) {\n    if(n &lt; 0) return false;\n    if(n == 0) return true;\n\n    long x = n;\n    // This is faster because a number is divisible by 16 only 6% of the time\n    // and more than that a vanishingly small percentage.\n    while((x &amp; 0x3) == 0) x &gt;&gt;= 2;\n    // This is effectively the same as the switch-case statement used in the original\n    // answer. \n    if((x &amp; 0x7) == 1) {\n\n        long sqrt;\n        if(x &lt; 410881L)\n        {\n            int i;\n            float x2, y;\n\n            x2 = x * 0.5F;\n            y  = x;\n            i  = Float.floatToRawIntBits(y);\n            i  = 0x5f3759df - ( i &gt;&gt; 1 );\n            y  = Float.intBitsToFloat(i);\n            y  = y * ( 1.5F - ( x2 * y * y ) );\n\n            sqrt = (long)(1.0F/y);\n        } else {\n            sqrt = (long) Math.sqrt(x);\n        }\n        return sqrt*sqrt == x;\n    }\n    return false;\n}\n</code></pre>\n\n<p>And <code>DurronTwo</code></p>\n\n<pre><code>public final static boolean isPerfectSquareDurronTwo(long n) {\n    if(n &lt; 0) return false;\n    // Needed to prevent infinite loop\n    if(n == 0) return true;\n\n    long x = n;\n    while((x &amp; 0x3) == 0) x &gt;&gt;= 2;\n    if((x &amp; 0x7) == 1) {\n        long sqrt;\n        if (x &lt; 41529141369L) {\n            int i;\n            float x2, y;\n\n            x2 = x * 0.5F;\n            y = x;\n            i = Float.floatToRawIntBits(y);\n            //using the magic number from \n            //http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf\n            //since it more accurate\n            i = 0x5f375a86 - (i &gt;&gt; 1);\n            y = Float.intBitsToFloat(i);\n            y = y * (1.5F - (x2 * y * y));\n            y = y * (1.5F - (x2 * y * y)); //Newton iteration, more accurate\n            sqrt = (long) ((1.0F/y) + 0.2);\n        } else {\n            //Carmack hack gives incorrect answer for n &gt;= 41529141369.\n            sqrt = (long) Math.sqrt(x);\n        }\n        return sqrt*sqrt == x;\n    }\n    return false;\n}\n</code></pre>\n\n<p>And my benchmark harness: (Requires Google caliper 0.1-rc5)</p>\n\n<pre><code>public class SquareRootBenchmark {\n    public static class Benchmark1 extends SimpleBenchmark {\n        private static final int ARRAY_SIZE = 10000;\n        long[] trials = new long[ARRAY_SIZE];\n\n        @Override\n        protected void setUp() throws Exception {\n            Random r = new Random();\n            for (int i = 0; i &lt; ARRAY_SIZE; i++) {\n                trials[i] = Math.abs(r.nextLong());\n            }\n        }\n\n\n        public int timeInternet(int reps) {\n            int trues = 0;\n            for(int i = 0; i &lt; reps; i++) {\n                for(int j = 0; j &lt; ARRAY_SIZE; j++) {\n                    if(SquareRootAlgs.isPerfectSquareInternet(trials[j])) trues++;\n                }\n            }\n\n            return trues;   \n        }\n\n        public int timeDurron(int reps) {\n            int trues = 0;\n            for(int i = 0; i &lt; reps; i++) {\n                for(int j = 0; j &lt; ARRAY_SIZE; j++) {\n                    if(SquareRootAlgs.isPerfectSquareDurron(trials[j])) trues++;\n                }\n            }\n\n            return trues;   \n        }\n\n        public int timeDurronTwo(int reps) {\n            int trues = 0;\n            for(int i = 0; i &lt; reps; i++) {\n                for(int j = 0; j &lt; ARRAY_SIZE; j++) {\n                    if(SquareRootAlgs.isPerfectSquareDurronTwo(trials[j])) trues++;\n                }\n            }\n\n            return trues;   \n        }\n    }\n\n    public static void main(String... args) {\n        Runner.main(Benchmark1.class, args);\n    }\n}\n</code></pre>\n\n<p><strong>UPDATE:</strong> I've made a new algorithm that is faster in some scenarios, slower in others, I've gotten different benchmarks based on different inputs. If we calculate modulo <code>0xFFFFFF = 3 x 3 x 5 x 7 x 13 x 17 x 241</code>, we can eliminate 97.82% of numbers that cannot be squares. This can be (sort of) done in one line, with 5 bitwise operations:</p>\n\n<pre><code>if (!goodLookupSquares[(int) ((n &amp; 0xFFFFFFl) + ((n &gt;&gt; 24) &amp; 0xFFFFFFl) + (n &gt;&gt; 48))]) return false;\n</code></pre>\n\n<p>The resulting index is either 1) the residue, 2) the residue <code>+ 0xFFFFFF</code>, or 3) the residue <code>+ 0x1FFFFFE</code>. Of course, we need to have a lookup table for residues modulo <code>0xFFFFFF</code>, which is about a 3mb file (in this case stored as ascii text decimal numbers, not optimal but clearly improvable with a <code>ByteBuffer</code> and so forth. But since that is precalculation it doesn't matter so much. <a href=\"http://www.stwing.org/~martinja/24residues_squares.txt\" rel=\"noreferrer\">You can find the file here</a> (or generate it yourself): </p>\n\n<pre><code>public final static boolean isPerfectSquareDurronThree(long n) {\n    if(n &lt; 0) return false;\n    if(n == 0) return true;\n\n    long x = n;\n    while((x &amp; 0x3) == 0) x &gt;&gt;= 2;\n    if((x &amp; 0x7) == 1) {\n        if (!goodLookupSquares[(int) ((n &amp; 0xFFFFFFl) + ((n &gt;&gt; 24) &amp; 0xFFFFFFl) + (n &gt;&gt; 48))]) return false;\n        long sqrt;\n        if(x &lt; 410881L)\n        {\n            int i;\n            float x2, y;\n\n            x2 = x * 0.5F;\n            y  = x;\n            i  = Float.floatToRawIntBits(y);\n            i  = 0x5f3759df - ( i &gt;&gt; 1 );\n            y  = Float.intBitsToFloat(i);\n            y  = y * ( 1.5F - ( x2 * y * y ) );\n\n            sqrt = (long)(1.0F/y);\n        } else {\n            sqrt = (long) Math.sqrt(x);\n        }\n        return sqrt*sqrt == x;\n    }\n    return false;\n}\n</code></pre>\n\n<p>I load it into a <code>boolean</code> array like this:</p>\n\n<pre><code>private static boolean[] goodLookupSquares = null;\n\npublic static void initGoodLookupSquares() throws Exception {\n    Scanner s = new Scanner(new File(\"24residues_squares.txt\"));\n\n    goodLookupSquares = new boolean[0x1FFFFFE];\n\n    while(s.hasNextLine()) {\n        int residue = Integer.valueOf(s.nextLine());\n        goodLookupSquares[residue] = true;\n        goodLookupSquares[residue + 0xFFFFFF] = true;\n        goodLookupSquares[residue + 0x1FFFFFE] = true;\n    }\n\n    s.close();\n}\n</code></pre>\n\n<p>Example runtime. It beat <code>Durron</code> (version one) in every trial I ran.</p>\n\n<pre><code> 0% Scenario{vm=java, trial=0, benchmark=Internet} 40665.77 ns; ?=566.71 ns @ 10 trials\n33% Scenario{vm=java, trial=0, benchmark=Durron} 38397.60 ns; ?=784.30 ns @ 10 trials\n67% Scenario{vm=java, trial=0, benchmark=DurronThree} 36171.46 ns; ?=693.02 ns @ 10 trials\n\n  benchmark   us linear runtime\n   Internet 40.7 ==============================\n     Durron 38.4 ============================\nDurronThree 36.2 ==========================\n\nvm: java\ntrial: 0\n</code></pre>\n"},{"comments":[{"owner":{"account_id":971754,"reputation":48147,"user_id":1477667,"accept_rate":56,"display_name":"dfeuer"},"score":4,"creation_date":1405040644,"post_id":18686659,"comment_id":38281978,"body_markdown":"That implicit masking of the shift value is a bit ... evil. Do you have any idea why that&#39;s in the Java spec?","body":"That implicit masking of the shift value is a bit ... evil. Do you have any idea why that&#39;s in the Java spec?"},{"owner":{"account_id":971754,"reputation":48147,"user_id":1477667,"accept_rate":56,"display_name":"dfeuer"},"score":0,"creation_date":1405040938,"post_id":18686659,"comment_id":38282070,"body_markdown":"A question about your code in particular: why do you need to check that an odd number ends `001`? Isn&#39;t that handled by the `goodMask` test?","body":"A question about your code in particular: why do you need to check that an odd number ends <code>001</code>? Isn&#39;t that handled by the <code>goodMask</code> test?"},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":7,"creation_date":1405090513,"post_id":18686659,"comment_id":38304145,"body_markdown":"@dfeuer I guess there are two reasons: 1. Shifting by more makes no sense. 2. It&#39;s like the HW works and anyone using bitwise operations is interested in performance, so doing anything else would be wrong. **-** The `goodMask` test does it, but it does it *before* the right shift. So you&#39;d have to repeat it, but this way it&#39;s simpler and AFAIK a tiny bit faster and equally good.","body":"@dfeuer I guess there are two reasons: 1. Shifting by more makes no sense. 2. It&#39;s like the HW works and anyone using bitwise operations is interested in performance, so doing anything else would be wrong. <b>-</b> The <code>goodMask</code> test does it, but it does it <i>before</i> the right shift. So you&#39;d have to repeat it, but this way it&#39;s simpler and AFAIK a tiny bit faster and equally good."},{"owner":{"account_id":971754,"reputation":48147,"user_id":1477667,"accept_rate":56,"display_name":"dfeuer"},"score":0,"creation_date":1405091464,"post_id":18686659,"comment_id":38304737,"body_markdown":"I missed the fact that you were shifting off the zeroes there. I guess the trailing zero count is too expensive to do first? Which architectures use only low-order bits for shifts?","body":"I missed the fact that you were shifting off the zeroes there. I guess the trailing zero count is too expensive to do first? Which architectures use only low-order bits for shifts?"},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":3,"creation_date":1405092257,"post_id":18686659,"comment_id":38305194,"body_markdown":"@dfeuer For the benchmark it&#39;s important to give answer ASAP, and the trailing zero count itself gives no answer; it&#39;s just a preparatory step. i86/amd64 do it. No idea about the small CPUs in mobiles, but at worst, Java has to generate an AND instruction for them, which is surely simpler than the other way round.","body":"@dfeuer For the benchmark it&#39;s important to give answer ASAP, and the trailing zero count itself gives no answer; it&#39;s just a preparatory step. i86/amd64 do it. No idea about the small CPUs in mobiles, but at worst, Java has to generate an AND instruction for them, which is surely simpler than the other way round."},{"owner":{"account_id":971754,"reputation":48147,"user_id":1477667,"accept_rate":56,"display_name":"dfeuer"},"score":1,"creation_date":1405247359,"post_id":18686659,"comment_id":38345226,"body_markdown":"Please take a look at my answer. If you could plug it into your benchmark system, I&#39;d be very grateful.","body":"Please take a look at my answer. If you could plug it into your benchmark system, I&#39;d be very grateful."},{"owner":{"account_id":1968644,"reputation":32046,"user_id":1768232,"accept_rate":81,"display_name":"durron597"},"score":1,"creation_date":1426290165,"post_id":18686659,"comment_id":46327222,"body_markdown":"Can you post the full benchmark results, not just those 5?","body":"Can you post the full benchmark results, not just those 5?"},{"owner":{"account_id":220947,"reputation":313,"user_id":478658,"accept_rate":100,"display_name":"Sebastian"},"score":0,"creation_date":1470328216,"post_id":18686659,"comment_id":64917103,"body_markdown":"The third test\n`if ((x&amp;7) != 1 | x &lt;= 0) return x == 0;`\ncould be\n`if ((x&amp;7) != 1 | x &lt; 0) return x == 0;`\n(the case x==0 is already caught by `(x&amp;7) != 1`). I&#39;m not sure if this speeds up the computation, but it makes it more obvious that you can remove the second test if your input is positive:\n`if ((x&amp;7) != 1) return x == 0;`\nI know there are no unsigned longs in java, but it might be helpful for people porting this code to other languages (like I&#39;m doing right now).","body":"The third test <code>if ((x&amp;7) != 1 | x &lt;= 0) return x == 0;</code> could be <code>if ((x&amp;7) != 1 | x &lt; 0) return x == 0;</code> (the case x==0 is already caught by <code>(x&amp;7) != 1</code>). I&#39;m not sure if this speeds up the computation, but it makes it more obvious that you can remove the second test if your input is positive: <code>if ((x&amp;7) != 1) return x == 0;</code> I know there are no unsigned longs in java, but it might be helpful for people porting this code to other languages (like I&#39;m doing right now)."},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":0,"creation_date":1470329835,"post_id":18686659,"comment_id":64918071,"body_markdown":"@Sebastian I guess, you&#39;re right. However, IIRC the JIT made out of it something very different from what I was hoping for, so it may improve or worsen things. The problen with JIT is that the compiled code depends on data it was fed with, so aggregating the two cases didn&#39;t take place as I used no (hardly any?) negative inputs in my benchmark.","body":"@Sebastian I guess, you&#39;re right. However, IIRC the JIT made out of it something very different from what I was hoping for, so it may improve or worsen things. The problen with JIT is that the compiled code depends on data it was fed with, so aggregating the two cases didn&#39;t take place as I used no (hardly any?) negative inputs in my benchmark."},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":2,"creation_date":1470329945,"post_id":18686659,"comment_id":64918130,"body_markdown":"@Sebastian A probably better test: `if ((x &amp; (7 | Integer.MIN_VALUE)) != 1) return x == 0;`.","body":"@Sebastian A probably better test: <code>if ((x &amp; (7 | Integer.MIN_VALUE)) != 1) return x == 0;</code>."},{"owner":{"account_id":220947,"reputation":313,"user_id":478658,"accept_rate":100,"display_name":"Sebastian"},"score":1,"creation_date":1470330170,"post_id":18686659,"comment_id":64918258,"body_markdown":"@maaartinus: I agree :) and then of course put `(7 | Long.MIN_VALUE)` in a constant (or assume the compiler is clever enough to do that for you)","body":"@maaartinus: I agree :) and then of course put <code>(7 | Long.MIN_VALUE)</code> in a constant (or assume the compiler is clever enough to do that for you)"},{"owner":{"account_id":2802349,"reputation":146437,"user_id":2410359,"accept_rate":87,"display_name":"chux - Reinstate Monica"},"score":4,"creation_date":1490280681,"post_id":18686659,"comment_id":73050920,"body_markdown":"&quot;As double has only 56 bits mantissa&quot; --&gt; I would say it has more likely has a [53 bit](https://en.wikipedia.org/wiki/Double-precision_floating-point_format) one.  [Also](http://math.stackexchange.com/q/237865/83175)","body":"&quot;As double has only 56 bits mantissa&quot; --&gt; I would say it has more likely has a <a href=\"https://en.wikipedia.org/wiki/Double-precision_floating-point_format\" rel=\"nofollow noreferrer\">53 bit</a> one.  <a href=\"http://math.stackexchange.com/q/237865/83175\">Also</a>"},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":1,"creation_date":1501454196,"post_id":18686659,"comment_id":77771056,"body_markdown":"@Sebastian It must be clever as it&#39;s a compile time constant according to the JLS.","body":"@Sebastian It must be clever as it&#39;s a compile time constant according to the JLS."},{"owner":{"account_id":60521,"reputation":34336,"user_id":180719,"accept_rate":88,"display_name":"Olivier Gr&#233;goire"},"score":0,"creation_date":1517482196,"post_id":18686659,"comment_id":84117431,"body_markdown":"@maaartinus Dropbox says: &quot;Sorry, that file doesn’t live here anymore. It might have been moved or made private.&quot; Would you post it here instead? Stackoverflow supports posts up to 40 KiB.Doesn&#39;t the file fit in?","body":"@maaartinus Dropbox says: &quot;Sorry, that file doesn’t live here anymore. It might have been moved or made private.&quot; Would you post it here instead? Stackoverflow supports posts up to 40 KiB.Doesn&#39;t the file fit in?"},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":0,"creation_date":1517483127,"post_id":18686659,"comment_id":84118082,"body_markdown":"@OlivierGr&#233;goire Sorry for that. I&#39;ll do it in two weeks, when I&#39;m on the right machine again (it&#39;s offline, sorry!). The file surely fits. All my dropbox links broke, that&#39;s sad.","body":"@OlivierGr&#233;goire Sorry for that. I&#39;ll do it in two weeks, when I&#39;m on the right machine again (it&#39;s offline, sorry!). The file surely fits. All my dropbox links broke, that&#39;s sad."},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":0,"creation_date":1518726075,"post_id":18686659,"comment_id":84635041,"body_markdown":"@OlivierGr&#233;goire I&#39;ve fixed the link instead. The file has 22k and would fit, but I guess, the current link will for for a few years. I prefer not to post it here, as it&#39;s pretty long and boring, but feel free to edit, if you think otherwise.","body":"@OlivierGr&#233;goire I&#39;ve fixed the link instead. The file has 22k and would fit, but I guess, the current link will for for a few years. I prefer not to post it here, as it&#39;s pretty long and boring, but feel free to edit, if you think otherwise."},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":0,"creation_date":1519600677,"post_id":18686659,"comment_id":84964066,"body_markdown":"@OlivierGr&#233;goire I&#39;m just using it for https://projecteuler.net/problem=621 and that sad thing is that using nothing but the floating point test is equally good. :(","body":"@OlivierGr&#233;goire I&#39;m just using it for <a href=\"https://projecteuler.net/problem=621\" rel=\"nofollow noreferrer\">projecteuler.net/problem=621</a> and that sad thing is that using nothing but the floating point test is equally good. :("},{"owner":{"account_id":16569445,"reputation":222,"user_id":11973019,"display_name":"Nuwan Harshakumara Piyarathna"},"score":0,"creation_date":1587893104,"post_id":18686659,"comment_id":108682884,"body_markdown":"How can I use this for very large numbers (BigIntegers).Then what will be the Mask value?How to calculate it?","body":"How can I use this for very large numbers (BigIntegers).Then what will be the Mask value?How to calculate it?"},{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":0,"creation_date":1587941697,"post_id":18686659,"comment_id":108701473,"body_markdown":"@NuwanHarshakumaraPiyarathna Both the `goodMask` and `numberOfTrailingZeros` can be used in the same way (same value of `goodMask`).","body":"@NuwanHarshakumaraPiyarathna Both the <code>goodMask</code> and <code>numberOfTrailingZeros</code> can be used in the same way (same value of <code>goodMask</code>)."},{"owner":{"account_id":13021621,"reputation":113,"user_id":10399560,"display_name":"HiddenBabel"},"score":0,"creation_date":1595804818,"post_id":18686659,"comment_id":111593239,"body_markdown":"@maaartinus How does the `goodMask` test catch 81% of all longs? Isn&#39;t ``goodMask &lt;&lt; x` equal to 0 for all `x &gt; 64`?","body":"@maaartinus How does the <code>goodMask</code> test catch 81% of all longs? Isn&#39;t ``goodMask &lt;&lt; x` equal to 0 for all <code>x &gt; 64</code>?"},{"owner":{"account_id":1175385,"reputation":22626,"user_id":1151521,"accept_rate":77,"display_name":"Aleksandr Dubinsky"},"score":3,"creation_date":1628437661,"post_id":18686659,"comment_id":121414522,"body_markdown":"@HiddenBabel No, because the Java Language Specification says &quot;If  the  promoted  type  of  the  left-hand  operand  is  long,  then  only  the  six  lowest-order  bits  of  the  right-hand  operand  are  used  as  the  shift  distance.  It  is  as  if  the right-hand operand were subjected to a bitwise logical AND operator &amp; (&#167;15.22.1)\nwith the mask value 0x3f (0b111111). The shift distance actually used is therefore\nalways in the range 0 to 63, inclusive.&quot; https://docs.oracle.com/javase/specs/jls/se11/jls11.pdf","body":"@HiddenBabel No, because the Java Language Specification says &quot;If  the  promoted  type  of  the  left-hand  operand  is  long,  then  only  the  six  lowest-order  bits  of  the  right-hand  operand  are  used  as  the  shift  distance.  It  is  as  if  the right-hand operand were subjected to a bitwise logical AND operator &amp; (&#167;15.22.1) with the mask value 0x3f (0b111111). The shift distance actually used is therefore always in the range 0 to 63, inclusive.&quot; <a href=\"https://docs.oracle.com/javase/specs/jls/se11/jls11.pdf\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/specs/jls/se11/jls11.pdf</a>"}],"tags":[],"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"comment_count":21,"down_vote_count":0,"up_vote_count":457,"is_accepted":false,"score":457,"last_activity_date":1518725921,"creation_date":1378661857,"answer_id":18686659,"question_id":295579,"body_markdown":"![](https://i.stack.imgur.com/UDUNr.png)\n\nI&#39;m pretty late to the party, but I hope to provide a better answer; shorter and (assuming my [benchmark][src] is correct) also much [faster][speed].\n\n    long goodMask; // 0xC840C04048404040 computed below\n    {\n        for (int i=0; i&lt;64; ++i) goodMask |= Long.MIN_VALUE &gt;&gt;&gt; (i*i);\n    }\n\n    public boolean isSquare(long x) {\n        // This tests if the 6 least significant bits are right.\n        // Moving the to be tested bit to the highest position saves us masking.\n        if (goodMask &lt;&lt; x &gt;= 0) return false;\n        final int numberOfTrailingZeros = Long.numberOfTrailingZeros(x);\n        // Each square ends with an even number of zeros.\n        if ((numberOfTrailingZeros &amp; 1) != 0) return false;\n        x &gt;&gt;= numberOfTrailingZeros;\n        // Now x is either 0 or odd.\n        // In binary each odd square ends with 001.\n        // Postpone the sign test until now; handle zero in the branch.\n        if ((x&amp;7) != 1 | x &lt;= 0) return x == 0;\n        // Do it in the classical way.\n        // The correctness is not trivial as the conversion from long to double is lossy!\n        final long tst = (long) Math.sqrt(x);\n        return tst * tst == x;\n    }\n\nThe first test catches most non-squares quickly. It uses a 64-item table packed in a long, so there&#39;s no array access cost (indirection and bounds checks). For a uniformly random `long`, there&#39;s a 81.25% probability of ending here.\n\nThe second test catches all numbers having an odd number of twos in their factorization. The method `Long.numberOfTrailingZeros` is very fast as it gets JIT-ed into a single i86 instruction.\n\nAfter dropping the trailing zeros, the third test handles numbers ending with 011, 101, or 111 in binary, which are no perfect squares. It also cares about negative numbers and also handles 0.\n\nThe final test falls back to `double` arithmetic. As `double` has only 53 bits mantissa, \nthe conversion from `long` to `double` includes rounding for big values. Nonetheless, the test is  correct (unless the [proof][] is wrong).\n\nTrying to incorporate the mod255 idea wasn&#39;t successful.\n\n[src]: \nhttps://www.dropbox.com/s/ad4r6oxfcilqkch/IsSquareBenchmark.java?dl=0\n\n[speed]: https://microbenchmarks.appspot.com/runs/185f228a-fd9b-44b4-8a7a-48d12101aece\n[proof]: https://math.stackexchange.com/questions/237865/show-that-floating-point-sqrtx-cdot-x-geq-x-for-all-long-x\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p><img src=\"https://i.stack.imgur.com/UDUNr.png\" alt=\"\" /></p>\n<p>I'm pretty late to the party, but I hope to provide a better answer; shorter and (assuming my <a href=\"https://www.dropbox.com/s/ad4r6oxfcilqkch/IsSquareBenchmark.java?dl=0\" rel=\"noreferrer\">benchmark</a> is correct) also much <a href=\"https://microbenchmarks.appspot.com/runs/185f228a-fd9b-44b4-8a7a-48d12101aece\" rel=\"noreferrer\">faster</a>.</p>\n<pre><code>long goodMask; // 0xC840C04048404040 computed below\n{\n    for (int i=0; i&lt;64; ++i) goodMask |= Long.MIN_VALUE &gt;&gt;&gt; (i*i);\n}\n\npublic boolean isSquare(long x) {\n    // This tests if the 6 least significant bits are right.\n    // Moving the to be tested bit to the highest position saves us masking.\n    if (goodMask &lt;&lt; x &gt;= 0) return false;\n    final int numberOfTrailingZeros = Long.numberOfTrailingZeros(x);\n    // Each square ends with an even number of zeros.\n    if ((numberOfTrailingZeros &amp; 1) != 0) return false;\n    x &gt;&gt;= numberOfTrailingZeros;\n    // Now x is either 0 or odd.\n    // In binary each odd square ends with 001.\n    // Postpone the sign test until now; handle zero in the branch.\n    if ((x&amp;7) != 1 | x &lt;= 0) return x == 0;\n    // Do it in the classical way.\n    // The correctness is not trivial as the conversion from long to double is lossy!\n    final long tst = (long) Math.sqrt(x);\n    return tst * tst == x;\n}\n</code></pre>\n<p>The first test catches most non-squares quickly. It uses a 64-item table packed in a long, so there's no array access cost (indirection and bounds checks). For a uniformly random <code>long</code>, there's a 81.25% probability of ending here.</p>\n<p>The second test catches all numbers having an odd number of twos in their factorization. The method <code>Long.numberOfTrailingZeros</code> is very fast as it gets JIT-ed into a single i86 instruction.</p>\n<p>After dropping the trailing zeros, the third test handles numbers ending with 011, 101, or 111 in binary, which are no perfect squares. It also cares about negative numbers and also handles 0.</p>\n<p>The final test falls back to <code>double</code> arithmetic. As <code>double</code> has only 53 bits mantissa,\nthe conversion from <code>long</code> to <code>double</code> includes rounding for big values. Nonetheless, the test is  correct (unless the <a href=\"https://math.stackexchange.com/questions/237865/show-that-floating-point-sqrtx-cdot-x-geq-x-for-all-long-x\">proof</a> is wrong).</p>\n<p>Trying to incorporate the mod255 idea wasn't successful.</p>\n"},{"comments":[{"owner":{"display_name":"user2975337"},"score":0,"creation_date":1436839518,"post_id":19385572,"comment_id":50768734,"body_markdown":"Actually the time would be at least `O((log n)^2)` because multiplication is not constant-time but in fact has a lower bound of `O(log n)`, which becomes apparent when working with large multi-precision numbers. But the scope of this wiki seems to be 64-bits, so maybe it&#39;s nbd.","body":"Actually the time would be at least <code>O((log n)^2)</code> because multiplication is not constant-time but in fact has a lower bound of <code>O(log n)</code>, which becomes apparent when working with large multi-precision numbers. But the scope of this wiki seems to be 64-bits, so maybe it&#39;s nbd."},{"owner":{"account_id":4495,"reputation":335863,"user_id":6782,"accept_rate":78,"display_name":"Alnitak"},"score":0,"creation_date":1622548320,"post_id":19385572,"comment_id":119818355,"body_markdown":"Multiplication of native word sized integers _is_ O(1) on many modern CPUs.","body":"Multiplication of native word sized integers <i>is</i> O(1) on many modern CPUs."}],"tags":[],"owner":{"account_id":107038,"reputation":133820,"user_id":284795,"accept_rate":79,"display_name":"Colonel Panic"},"comment_count":2,"down_vote_count":0,"up_vote_count":13,"is_accepted":false,"score":13,"last_activity_date":1381918733,"creation_date":1381852114,"answer_id":19385572,"question_id":295579,"body_markdown":"An integer problem deserves an integer solution. Thus\r\n\r\nDo binary search on the (non-negative) integers to find the greatest integer t such that `t**2 &lt;= n`. Then test whether `r**2 = n` exactly. This takes time O(log n). \r\n\r\nIf you don&#39;t know how to binary search the positive integers because the set is unbounded, it&#39;s easy. You starting by computing your increasing function f (above `f(t) = t**2 - n`) on powers of two. When you see it turn positive, you&#39;ve found an upper bound. Then you can do standard binary search.\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>An integer problem deserves an integer solution. Thus</p>\n\n<p>Do binary search on the (non-negative) integers to find the greatest integer t such that <code>t**2 &lt;= n</code>. Then test whether <code>r**2 = n</code> exactly. This takes time O(log n). </p>\n\n<p>If you don't know how to binary search the positive integers because the set is unbounded, it's easy. You starting by computing your increasing function f (above <code>f(t) = t**2 - n</code>) on powers of two. When you see it turn positive, you've found an upper bound. Then you can do standard binary search.</p>\n"},{"comments":[{"owner":{"account_id":283609,"reputation":45044,"user_id":581205,"accept_rate":72,"display_name":"maaartinus"},"score":2,"creation_date":1405511146,"post_id":24721612,"comment_id":38454433,"body_markdown":"The results are [here](https://microbenchmarks.appspot.com/runs/5e02e0d4-8122-43d4-bcf5-def2bf357165). Removing the first test is bad as it solves most cases pretty cheaply.  The source is in my answer (updated).","body":"The results are <a href=\"https://microbenchmarks.appspot.com/runs/5e02e0d4-8122-43d4-bcf5-def2bf357165\" rel=\"nofollow noreferrer\">here</a>. Removing the first test is bad as it solves most cases pretty cheaply.  The source is in my answer (updated)."}],"tags":[],"owner":{"account_id":971754,"reputation":48147,"user_id":1477667,"accept_rate":56,"display_name":"dfeuer"},"comment_count":1,"down_vote_count":0,"up_vote_count":10,"is_accepted":false,"score":10,"last_activity_date":1405279451,"creation_date":1405246635,"answer_id":24721612,"question_id":295579,"body_markdown":"The following simplification of maaartinus&#39;s solution appears to shave a few percentage points off the runtime, but I&#39;m not good enough at benchmarking to produce a benchmark I can trust:\r\n\r\n    long goodMask; // 0xC840C04048404040 computed below\r\n    {\r\n        for (int i=0; i&lt;64; ++i) goodMask |= Long.MIN_VALUE &gt;&gt;&gt; (i*i);\r\n    }\r\n    \r\n    public boolean isSquare(long x) {\r\n        // This tests if the 6 least significant bits are right.\r\n        // Moving the to be tested bit to the highest position saves us masking.\r\n        if (goodMask &lt;&lt; x &gt;= 0) return false;\r\n        // Remove an even number of trailing zeros, leaving at most one.\r\n        x &gt;&gt;= (Long.numberOfTrailingZeros(x) &amp; (-2);\r\n        // Repeat the test on the 6 least significant remaining bits.\r\n        if (goodMask &lt;&lt; x &gt;= 0 | x &lt;= 0) return x == 0;\r\n        // Do it in the classical way.\r\n        // The correctness is not trivial as the conversion from long to double is lossy!\r\n        final long tst = (long) Math.sqrt(x);\r\n        return tst * tst == x;\r\n    }\r\n\r\nIt would be worth checking how omitting the first test,\r\n\r\n    if (goodMask &lt;&lt; x &gt;= 0) return false;\r\n\r\nwould affect performance.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>The following simplification of maaartinus's solution appears to shave a few percentage points off the runtime, but I'm not good enough at benchmarking to produce a benchmark I can trust:</p>\n\n<pre><code>long goodMask; // 0xC840C04048404040 computed below\n{\n    for (int i=0; i&lt;64; ++i) goodMask |= Long.MIN_VALUE &gt;&gt;&gt; (i*i);\n}\n\npublic boolean isSquare(long x) {\n    // This tests if the 6 least significant bits are right.\n    // Moving the to be tested bit to the highest position saves us masking.\n    if (goodMask &lt;&lt; x &gt;= 0) return false;\n    // Remove an even number of trailing zeros, leaving at most one.\n    x &gt;&gt;= (Long.numberOfTrailingZeros(x) &amp; (-2);\n    // Repeat the test on the 6 least significant remaining bits.\n    if (goodMask &lt;&lt; x &gt;= 0 | x &lt;= 0) return x == 0;\n    // Do it in the classical way.\n    // The correctness is not trivial as the conversion from long to double is lossy!\n    final long tst = (long) Math.sqrt(x);\n    return tst * tst == x;\n}\n</code></pre>\n\n<p>It would be worth checking how omitting the first test,</p>\n\n<pre><code>if (goodMask &lt;&lt; x &gt;= 0) return false;\n</code></pre>\n\n<p>would affect performance.</p>\n"},{"comments":[{"owner":{"account_id":914346,"reputation":1030,"user_id":947488,"display_name":"Stefan Reich"},"score":2,"creation_date":1512391948,"post_id":46720183,"comment_id":82225157,"body_markdown":"I think you mean `(long) Math.pow(roundedRoot, 2)`","body":"I think you mean <code>(long) Math.pow(roundedRoot, 2)</code>"},{"owner":{"account_id":9366757,"reputation":793,"user_id":8031498,"accept_rate":67,"display_name":"Steve Storck"},"score":0,"creation_date":1512471803,"post_id":46720183,"comment_id":82262141,"body_markdown":"I updated this soltution/suggestion to be the simplest way to figure it out.  I wonder how it would compare in terms of benchmark against some of the custom solutions.","body":"I updated this soltution/suggestion to be the simplest way to figure it out.  I wonder how it would compare in terms of benchmark against some of the custom solutions."},{"owner":{"account_id":6333754,"reputation":2065,"user_id":4917881,"display_name":"aventurin"},"score":4,"creation_date":1539467099,"post_id":46720183,"comment_id":92514942,"body_markdown":"Your method returns `true` for `10_000_000_000_000_000L` and `10_000_000_000_000_001L` which proves that it&#39;t wrong.","body":"Your method returns <code>true</code> for <code>10_000_000_000_000_000L</code> and <code>10_000_000_000_000_001L</code> which proves that it&#39;t wrong."},{"owner":{"account_id":9366757,"reputation":793,"user_id":8031498,"accept_rate":67,"display_name":"Steve Storck"},"score":0,"creation_date":1613413951,"post_id":46720183,"comment_id":117062633,"body_markdown":"@aventurin I have changed my answer to deal with your accurate assessment of my previous attempt.  If you downvoted my comment, please reconsider.  Thanks!","body":"@aventurin I have changed my answer to deal with your accurate assessment of my previous attempt.  If you downvoted my comment, please reconsider.  Thanks!"}],"tags":[],"owner":{"account_id":9366757,"reputation":793,"user_id":8031498,"accept_rate":67,"display_name":"Steve Storck"},"comment_count":4,"down_vote_count":3,"up_vote_count":5,"is_accepted":false,"score":2,"last_activity_date":1613413669,"creation_date":1507849699,"answer_id":46720183,"question_id":295579,"body_markdown":"Here is the simplest and most concise way, although I do not know how it compares in terms of CPU cycles.  This works great if you only wish to know if the root is a whole number.  If you really care if it is an integer, you can also figure that out.  Here is a simple (and pure) function:\r\n\r\n    private static final MathContext precision = new MathContext(20);\r\n\r\n    private static final Function&lt;Long, Boolean&gt; isRootWhole = (n) -&gt; {\r\n        long digit = n % 10;\r\n        if (digit == 2 || digit == 3 || digit == 7 || digit == 8) {\r\n            return false;\r\n        }\r\n        return new BigDecimal(n).sqrt(precision).scale() == 0;\r\n    };\r\n\r\nIf you do not need micro-optimization, this answer is better in terms of simplicity and maintainability.  If you will be calculating negative numbers, you will need to handle that accordingly, and send the absolute value into the function.  I have included a minor optimization because no perfect squares have a tens digit of 2, 3, 7, or 8 due to quadratic residues mod 10.\r\n\r\nOn my CPU, a run of this algorithm on 0 - 10,000,000 took an average of 1000 - 1100 nanoseconds per calculation.\r\n\r\nIf you are performing a lesser number of calculations, the earlier calculations take a bit longer.\r\n\r\nI had a negative comment that my previous edit did not work for large numbers.  The OP mentioned Longs, and the largest perfect square that is a Long is 9223372030926249001, so this method works for all Longs.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Here is the simplest and most concise way, although I do not know how it compares in terms of CPU cycles.  This works great if you only wish to know if the root is a whole number.  If you really care if it is an integer, you can also figure that out.  Here is a simple (and pure) function:</p>\n<pre><code>private static final MathContext precision = new MathContext(20);\n\nprivate static final Function&lt;Long, Boolean&gt; isRootWhole = (n) -&gt; {\n    long digit = n % 10;\n    if (digit == 2 || digit == 3 || digit == 7 || digit == 8) {\n        return false;\n    }\n    return new BigDecimal(n).sqrt(precision).scale() == 0;\n};\n</code></pre>\n<p>If you do not need micro-optimization, this answer is better in terms of simplicity and maintainability.  If you will be calculating negative numbers, you will need to handle that accordingly, and send the absolute value into the function.  I have included a minor optimization because no perfect squares have a tens digit of 2, 3, 7, or 8 due to quadratic residues mod 10.</p>\n<p>On my CPU, a run of this algorithm on 0 - 10,000,000 took an average of 1000 - 1100 nanoseconds per calculation.</p>\n<p>If you are performing a lesser number of calculations, the earlier calculations take a bit longer.</p>\n<p>I had a negative comment that my previous edit did not work for large numbers.  The OP mentioned Longs, and the largest perfect square that is a Long is 9223372030926249001, so this method works for all Longs.</p>\n"},{"comments":[{"owner":{"account_id":1460523,"reputation":883,"user_id":1374975,"accept_rate":100,"display_name":"Albert van der Horst"},"score":0,"creation_date":1545911838,"post_id":52522407,"comment_id":94727987,"body_markdown":"Oops, this is an O(N^.5) algorithm, so it is really bad regards speed, and lasts forever for 63 bit numbers that may be input. I changed my upvode to a downvote. What was I thinking when I upvoted it. At least the idea behind it is correct, but I didn&#39;t test it.","body":"Oops, this is an O(N^.5) algorithm, so it is really bad regards speed, and lasts forever for 63 bit numbers that may be input. I changed my upvode to a downvote. What was I thinking when I upvoted it. At least the idea behind it is correct, but I didn&#39;t test it."},{"owner":{"account_id":3813614,"reputation":9757,"user_id":3163618,"accept_rate":82,"display_name":"qwr"},"score":0,"creation_date":1659479333,"post_id":52522407,"comment_id":129303845,"body_markdown":"the idea is based on square numbers being of form 1 + 3 + 5 + ... unfortunately this is very slow, with sqrt(N) iterations, as opposed to a few machine cycles using FP sqrt. The recursion doesn&#39;t help either.","body":"the idea is based on square numbers being of form 1 + 3 + 5 + ... unfortunately this is very slow, with sqrt(N) iterations, as opposed to a few machine cycles using FP sqrt. The recursion doesn&#39;t help either."}],"tags":[],"owner":{"account_id":5444163,"reputation":1840,"user_id":4331279,"accept_rate":75,"display_name":"MWB"},"comment_count":2,"down_vote_count":3,"up_vote_count":2,"is_accepted":false,"score":-1,"last_activity_date":1537979564,"creation_date":1537979564,"answer_id":52522407,"question_id":295579,"body_markdown":"Not sure if this is the fastest way, but this is something I stumbled upon  (long time ago in high-school) when I was bored and playing with my calculator during math class. At that time, I was really amazed this was working...\r\n\r\n\tpublic static boolean isIntRoot(int number) {\r\n\t\treturn isIntRootHelper(number, 1);\r\n\t}\r\n\t\r\n\tprivate static boolean isIntRootHelper(int number, int index) {\r\n\t\tif (number == index) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (number &lt; index) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn isIntRootHelper(number - 2 * index, index + 1);\r\n\t\t}\r\n\t}\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Not sure if this is the fastest way, but this is something I stumbled upon  (long time ago in high-school) when I was bored and playing with my calculator during math class. At that time, I was really amazed this was working...</p>\n\n<pre><code>public static boolean isIntRoot(int number) {\n    return isIntRootHelper(number, 1);\n}\n\nprivate static boolean isIntRootHelper(int number, int index) {\n    if (number == index) {\n        return true;\n    }\n    if (number &lt; index) {\n        return false;\n    }\n    else {\n        return isIntRootHelper(number - 2 * index, index + 1);\n    }\n}\n</code></pre>\n"},{"tags":[],"owner":{"account_id":6333754,"reputation":2065,"user_id":4917881,"display_name":"aventurin"},"comment_count":0,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1539816594,"creation_date":1539816594,"answer_id":52864659,"question_id":295579,"body_markdown":"# Newton&#39;s Method with integer arithmetic\r\n\r\nIf you wish to avoid non-integer operations you could use the method below. It basically uses Newton&#39;s Method modified for integer arithmetic.\r\n\r\n\t/**\r\n\t * Test if the given number is a perfect square.\r\n\t * @param n Must be greater than 0 and less\r\n\t *    than Long.MAX_VALUE.\r\n\t * @return &lt;code&gt;true&lt;/code&gt; if n is a perfect\r\n\t *    square, or &lt;code&gt;false&lt;/code&gt; otherwise.\r\n\t */\r\n\tpublic static boolean isSquare(long n)\r\n\t{\r\n\t\tlong x1 = n;\r\n\t\tlong x2 = 1L;\r\n\r\n\t\twhile (x1 &gt; x2)\r\n\t\t{\r\n\t\t\tx1 = (x1 + x2) / 2L;\r\n\t\t\tx2 = n / x1;\r\n\t\t}\r\n\r\n\t\treturn x1 == x2 &amp;&amp; n % x1 == 0L;\r\n\t}\r\n\r\nThis implementation can not compete with solutions that use `Math.sqrt`. However, its performance can be improved by using the filtering mechanisms described in some of the other posts.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<h1>Newton's Method with integer arithmetic</h1>\n\n<p>If you wish to avoid non-integer operations you could use the method below. It basically uses Newton's Method modified for integer arithmetic.</p>\n\n<pre><code>/**\n * Test if the given number is a perfect square.\n * @param n Must be greater than 0 and less\n *    than Long.MAX_VALUE.\n * @return &lt;code&gt;true&lt;/code&gt; if n is a perfect\n *    square, or &lt;code&gt;false&lt;/code&gt; otherwise.\n */\npublic static boolean isSquare(long n)\n{\n    long x1 = n;\n    long x2 = 1L;\n\n    while (x1 &gt; x2)\n    {\n        x1 = (x1 + x2) / 2L;\n        x2 = n / x1;\n    }\n\n    return x1 == x2 &amp;&amp; n % x1 == 0L;\n}\n</code></pre>\n\n<p>This implementation can not compete with solutions that use <code>Math.sqrt</code>. However, its performance can be improved by using the filtering mechanisms described in some of the other posts.</p>\n"},{"comments":[{"owner":{"account_id":5444163,"reputation":1840,"user_id":4331279,"accept_rate":75,"display_name":"MWB"},"score":0,"creation_date":1545933529,"post_id":53939196,"comment_id":94736493,"body_markdown":"Getting a good estimate is not too hard. You can use the number of digits of the number to estimate a lower and upper bound for the solution. See also my answer where I propose a divide and conquer solution.","body":"Getting a good estimate is not too hard. You can use the number of digits of the number to estimate a lower and upper bound for the solution. See also my answer where I propose a divide and conquer solution."},{"owner":{"account_id":1460523,"reputation":883,"user_id":1374975,"accept_rate":100,"display_name":"Albert van der Horst"},"score":0,"creation_date":1546100829,"post_id":53939196,"comment_id":94780098,"body_markdown":"What is the difference between POPCNT and counting the number of digits? Except that you can do POPCNT in one nanosecond.","body":"What is the difference between POPCNT and counting the number of digits? Except that you can do POPCNT in one nanosecond."}],"tags":[],"owner":{"account_id":1460523,"reputation":883,"user_id":1374975,"accept_rate":100,"display_name":"Albert van der Horst"},"comment_count":2,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1545878576,"creation_date":1545878576,"answer_id":53939196,"question_id":295579,"body_markdown":"Calculating square roots by Newton&#39;s method is horrendously fast ... provided that the starting value is reasonable. However there is no reasonable starting value, and in practice we end with bisection and log(2^64) behaviour.  \r\nTo be really fast we need a fast way to get at a reasonable starting value, and that means we need to descend into machine language. \r\nIf a processor provides an instruction like POPCNT in the Pentium, that counts the leading zeroes we can use that to have a starting value with half the significant bits. With care we can find a a fixed number of Newton steps that will always suffice. \r\n(Thus foregoing the need to loop and have very fast execution.)\r\n\r\nA second solution is going via the floating point facility, which may have a fast sqrt calculation (like the i87 coprocessor.) Even an excursion via exp() and log() may be faster than Newton degenerated into a binary search. There is a tricky aspect to this, a processor dependant analysis of what and if refinement afterwards is necessary.\r\n\r\nA third solution solves a slightly different problem, but is well worth mentionning because the situation is described in the question. If you want to calculate a great many square roots for numbers that differ slightly, you can use Newton iteration, if you never reinitialise the starting value, but just leave it where the previous calculation left off. I&#39;ve used this with success in at least one Euler problem. ","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Calculating square roots by Newton's method is horrendously fast ... provided that the starting value is reasonable. However there is no reasonable starting value, and in practice we end with bisection and log(2^64) behaviour.<br>\nTo be really fast we need a fast way to get at a reasonable starting value, and that means we need to descend into machine language. \nIf a processor provides an instruction like POPCNT in the Pentium, that counts the leading zeroes we can use that to have a starting value with half the significant bits. With care we can find a a fixed number of Newton steps that will always suffice. \n(Thus foregoing the need to loop and have very fast execution.)</p>\n\n<p>A second solution is going via the floating point facility, which may have a fast sqrt calculation (like the i87 coprocessor.) Even an excursion via exp() and log() may be faster than Newton degenerated into a binary search. There is a tricky aspect to this, a processor dependant analysis of what and if refinement afterwards is necessary.</p>\n\n<p>A third solution solves a slightly different problem, but is well worth mentionning because the situation is described in the question. If you want to calculate a great many square roots for numbers that differ slightly, you can use Newton iteration, if you never reinitialise the starting value, but just leave it where the previous calculation left off. I've used this with success in at least one Euler problem. </p>\n"},{"comments":[{"owner":{"account_id":6656322,"reputation":4673,"user_id":5601591,"accept_rate":100,"display_name":"Jack G"},"score":4,"creation_date":1579815951,"post_id":53948574,"comment_id":105903710,"body_markdown":"I love the concept, but I would like to politely point out a major flaw: numbers are in base 2 binary. Converting base 2 to base 10 via `toString` is an incredibly expensive operation compared to bitwise operators. Thus, to satisfy the objective of the question--performance--you must use bitwise operators instead of base 10 strings. Again, I really like your concept. Notwithstanding, your implementation (as it stands now) is by far the slowest out of all the possible solutions posted for the question.","body":"I love the concept, but I would like to politely point out a major flaw: numbers are in base 2 binary. Converting base 2 to base 10 via <code>toString</code> is an incredibly expensive operation compared to bitwise operators. Thus, to satisfy the objective of the question--performance--you must use bitwise operators instead of base 10 strings. Again, I really like your concept. Notwithstanding, your implementation (as it stands now) is by far the slowest out of all the possible solutions posted for the question."}],"tags":[],"owner":{"account_id":5444163,"reputation":1840,"user_id":4331279,"accept_rate":75,"display_name":"MWB"},"comment_count":1,"down_vote_count":0,"up_vote_count":3,"is_accepted":false,"score":3,"last_activity_date":1545930831,"creation_date":1545930831,"answer_id":53948574,"question_id":295579,"body_markdown":"**Here is a divide and conquer solution.** \r\n\r\nIf the square root of a natural number (`number`) is a natural number (`solution`), you can easily determine a range for `solution` based on the number of digits of `number`:\r\n\r\n - `number` has 1 digit: `solution` in range = 1 - 4\r\n - `number` has 2 digits: `solution` in range = 3 - 10\r\n - `number` has 3 digits: `solution` in range = 10 - 40\r\n - `number` has 4 digits: `solution` in range = 30 - 100\r\n - `number` has 5 digits: `solution` in range = 100 - 400\r\n\r\nNotice the repetition?\r\n\r\nYou can use this range in a binary search approach to see if there is a `solution` for which:\r\n\r\n    number == solution * solution\r\n\r\n**Here is the code**\r\n\r\nHere is my class SquareRootChecker\r\n\r\n    public class SquareRootChecker {\r\n    \r\n        private long number;\r\n        private long initialLow;\r\n        private long initialHigh;\r\n    \r\n        public SquareRootChecker(long number) {\r\n            this.number = number;\r\n    \r\n            initialLow = 1;\r\n            initialHigh = 4;\r\n            if (Long.toString(number).length() % 2 == 0) {\r\n                initialLow = 3;\r\n                initialHigh = 10;\r\n            }\r\n            for (long i = 0; i &lt; Long.toString(number).length() / 2; i++) {\r\n                initialLow *= 10;\r\n                initialHigh *= 10;\r\n            }\r\n            if (Long.toString(number).length() % 2 == 0) {\r\n                initialLow /= 10;\r\n                initialHigh /=10;\r\n            }\r\n        }\r\n    \r\n        public boolean checkSquareRoot() {\r\n            return findSquareRoot(initialLow, initialHigh, number);\r\n        }\r\n    \r\n        private boolean findSquareRoot(long low, long high, long number) {\r\n            long check = low + (high - low) / 2;\r\n            if (high &gt;= low) {\r\n                if (number == check * check) {\r\n                    return true;\r\n                }\r\n                else if (number &lt; check * check) {\r\n                    high = check - 1;\r\n                    return findSquareRoot(low, high, number);\r\n                }\r\n                else  {\r\n                    low = check + 1;\r\n                    return findSquareRoot(low, high, number);\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n    \r\n    }\r\n\r\nAnd here is an example on how to use it.\r\n\r\n    long number =  1234567;\r\n    long square = number * number;\r\n    SquareRootChecker squareRootChecker = new SquareRootChecker(square);\r\n    System.out.println(square + &quot;: &quot; + squareRootChecker.checkSquareRoot()); //Prints &quot;1524155677489: true&quot;\r\n\r\n    long notSquare = square + 1;\r\n    squareRootChecker = new SquareRootChecker(notSquare);\r\n    System.out.println(notSquare + &quot;: &quot; + squareRootChecker.checkSquareRoot()); //Prints &quot;1524155677490: false&quot;\r\n","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p><strong>Here is a divide and conquer solution.</strong> </p>\n\n<p>If the square root of a natural number (<code>number</code>) is a natural number (<code>solution</code>), you can easily determine a range for <code>solution</code> based on the number of digits of <code>number</code>:</p>\n\n<ul>\n<li><code>number</code> has 1 digit: <code>solution</code> in range = 1 - 4</li>\n<li><code>number</code> has 2 digits: <code>solution</code> in range = 3 - 10</li>\n<li><code>number</code> has 3 digits: <code>solution</code> in range = 10 - 40</li>\n<li><code>number</code> has 4 digits: <code>solution</code> in range = 30 - 100</li>\n<li><code>number</code> has 5 digits: <code>solution</code> in range = 100 - 400</li>\n</ul>\n\n<p>Notice the repetition?</p>\n\n<p>You can use this range in a binary search approach to see if there is a <code>solution</code> for which:</p>\n\n<pre><code>number == solution * solution\n</code></pre>\n\n<p><strong>Here is the code</strong></p>\n\n<p>Here is my class SquareRootChecker</p>\n\n<pre><code>public class SquareRootChecker {\n\n    private long number;\n    private long initialLow;\n    private long initialHigh;\n\n    public SquareRootChecker(long number) {\n        this.number = number;\n\n        initialLow = 1;\n        initialHigh = 4;\n        if (Long.toString(number).length() % 2 == 0) {\n            initialLow = 3;\n            initialHigh = 10;\n        }\n        for (long i = 0; i &lt; Long.toString(number).length() / 2; i++) {\n            initialLow *= 10;\n            initialHigh *= 10;\n        }\n        if (Long.toString(number).length() % 2 == 0) {\n            initialLow /= 10;\n            initialHigh /=10;\n        }\n    }\n\n    public boolean checkSquareRoot() {\n        return findSquareRoot(initialLow, initialHigh, number);\n    }\n\n    private boolean findSquareRoot(long low, long high, long number) {\n        long check = low + (high - low) / 2;\n        if (high &gt;= low) {\n            if (number == check * check) {\n                return true;\n            }\n            else if (number &lt; check * check) {\n                high = check - 1;\n                return findSquareRoot(low, high, number);\n            }\n            else  {\n                low = check + 1;\n                return findSquareRoot(low, high, number);\n            }\n        }\n        return false;\n    }\n\n}\n</code></pre>\n\n<p>And here is an example on how to use it.</p>\n\n<pre><code>long number =  1234567;\nlong square = number * number;\nSquareRootChecker squareRootChecker = new SquareRootChecker(square);\nSystem.out.println(square + \": \" + squareRootChecker.checkSquareRoot()); //Prints \"1524155677489: true\"\n\nlong notSquare = square + 1;\nsquareRootChecker = new SquareRootChecker(notSquare);\nSystem.out.println(notSquare + \": \" + squareRootChecker.checkSquareRoot()); //Prints \"1524155677490: false\"\n</code></pre>\n"},{"tags":[],"owner":{"account_id":1558254,"reputation":474,"user_id":5191852,"accept_rate":100,"display_name":"Viktor"},"comment_count":0,"down_vote_count":1,"up_vote_count":1,"is_accepted":false,"score":0,"last_activity_date":1547905465,"creation_date":1547905465,"answer_id":54267721,"question_id":295579,"body_markdown":"May be the best algorithm for the problem is a fast integer square root algorithm https://stackoverflow.com/a/51585204/5191852\r\n\r\nThere @Kde claims that three iterations of the Newton method would be sufficient for the accuracy of &#177;1 for 32 bit integers. Certainly, more iterations are needed for 64-bit integers, may be 6 or 7. ","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>May be the best algorithm for the problem is a fast integer square root algorithm <a href=\"https://stackoverflow.com/a/51585204/5191852\">https://stackoverflow.com/a/51585204/5191852</a></p>\n\n<p>There @Kde claims that three iterations of the Newton method would be sufficient for the accuracy of ±1 for 32 bit integers. Certainly, more iterations are needed for 64-bit integers, may be 6 or 7. </p>\n"},{"comments":[{"owner":{"account_id":4788305,"reputation":569,"user_id":3868157,"display_name":"ambiso"},"score":3,"creation_date":1608046844,"post_id":58655853,"comment_id":115459299,"body_markdown":"I don&#39;t think that complexity is correct. The complexity should be the number of squares less than or equal to n, or approximately O(sqrt(n)).","body":"I don&#39;t think that complexity is correct. The complexity should be the number of squares less than or equal to n, or approximately O(sqrt(n))."}],"tags":[],"owner":{"account_id":17011704,"reputation":9,"user_id":12306536,"display_name":"Sajjad Ali Vayani"},"comment_count":1,"down_vote_count":1,"up_vote_count":3,"is_accepted":false,"score":2,"last_activity_date":1572596919,"creation_date":1572594797,"answer_id":58655853,"question_id":295579,"body_markdown":"Square Root of a number, given that the number is a perfect square.\r\n\r\nThe complexity is log(n)\r\n\r\n \r\n\r\n    /**\r\n     * Calculate square root if the given number is a perfect square.\r\n     * \r\n     * Approach: Sum of n odd numbers is equals to the square root of n*n, given \r\n     * that n is a perfect square.\r\n     *\r\n     * @param number\r\n     * @return squareRoot\r\n     */\r\n    \r\n    public static int calculateSquareRoot(int number) {\r\n    \r\n        int sum=1;\r\n        int count =1;\r\n        int squareRoot=1;\r\n        while(sum&lt;number) {\r\n            count+=2;\r\n            sum+=count;\r\n            squareRoot++;\r\n        }\r\n        return squareRoot;\r\n    }","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>Square Root of a number, given that the number is a perfect square.</p>\n\n<p>The complexity is log(n)</p>\n\n<pre><code>/**\n * Calculate square root if the given number is a perfect square.\n * \n * Approach: Sum of n odd numbers is equals to the square root of n*n, given \n * that n is a perfect square.\n *\n * @param number\n * @return squareRoot\n */\n\npublic static int calculateSquareRoot(int number) {\n\n    int sum=1;\n    int count =1;\n    int squareRoot=1;\n    while(sum&lt;number) {\n        count+=2;\n        sum+=count;\n        squareRoot++;\n    }\n    return squareRoot;\n}\n</code></pre>\n"},{"comments":[{"owner":{"account_id":100551,"reputation":29438,"user_id":270986,"display_name":"Mark Dickinson"},"score":0,"creation_date":1645777083,"post_id":71258391,"comment_id":125965432,"body_markdown":"The OP was asking about `long` rather than `int`, and unfortunately for `long` this approach doesn&#39;t work (which is why it doesn&#39;t appear in the older answers). The first failure is with `input = 4503599761588224`, which is not a square, but whose square root calculated with IEEE 754 binary64 floating-point arithmetic _is_ an integer, `67108865.0`.","body":"The OP was asking about <code>long</code> rather than <code>int</code>, and unfortunately for <code>long</code> this approach doesn&#39;t work (which is why it doesn&#39;t appear in the older answers). The first failure is with <code>input = 4503599761588224</code>, which is not a square, but whose square root calculated with IEEE 754 binary64 floating-point arithmetic <i>is</i> an integer, <code>67108865.0</code>."}],"tags":[],"owner":{"account_id":23951166,"reputation":23,"user_id":17942727,"display_name":"FrederickAmpsUp"},"comment_count":1,"down_vote_count":5,"up_vote_count":0,"is_accepted":false,"score":-5,"last_activity_date":1645737659,"creation_date":1645737659,"answer_id":71258391,"question_id":295579,"body_markdown":"```java\r\nstatic boolean isPerfectSquare (int input) {\r\n  return Math.sqrt(input) == (int) Math.sqrt(input);\r\n}\r\n```\r\nThis will return if the integer value of the square root of `input` is equal to the double value. This means it it is an integer, it will return `true`. Otherwise, it will return `false`.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<pre class=\"lang-java prettyprint-override\"><code>static boolean isPerfectSquare (int input) {\n  return Math.sqrt(input) == (int) Math.sqrt(input);\n}\n</code></pre>\n<p>This will return if the integer value of the square root of <code>input</code> is equal to the double value. This means it it is an integer, it will return <code>true</code>. Otherwise, it will return <code>false</code>.</p>\n"},{"comments":[{"owner":{"account_id":100551,"reputation":29438,"user_id":270986,"display_name":"Mark Dickinson"},"score":0,"creation_date":1668331536,"post_id":74416232,"comment_id":131375323,"body_markdown":"Yep, this is a fairly common approach. (It&#39;s what Java&#39;s BigInteger uses under the hood, for example.) See https://en.wikipedia.org/wiki/Integer_square_root#Using_only_integer_division for more. For 64-bit integers, it&#39;s possible to reduce the number of divisions to just 2 (at the expense of a lookup table). See https://stackoverflow.com/a/70550680/270986","body":"Yep, this is a fairly common approach. (It&#39;s what Java&#39;s BigInteger uses under the hood, for example.) See <a href=\"https://en.wikipedia.org/wiki/Integer_square_root#Using_only_integer_division\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a> for more. For 64-bit integers, it&#39;s possible to reduce the number of divisions to just 2 (at the expense of a lookup table). See <a href=\"https://stackoverflow.com/a/70550680/270986\">stackoverflow.com/a/70550680/270986</a>"},{"owner":{"account_id":26879596,"reputation":1092,"user_id":20460267,"display_name":"Simon Goater"},"score":0,"creation_date":1668335196,"post_id":74416232,"comment_id":131375886,"body_markdown":"You appear to be something of an authority on this topic. Thanks for the link. I think the comprehensive answer you posted on the link deserves more credit and attention.","body":"You appear to be something of an authority on this topic. Thanks for the link. I think the comprehensive answer you posted on the link deserves more credit and attention."}],"tags":[],"owner":{"account_id":26879596,"reputation":1092,"user_id":20460267,"display_name":"Simon Goater"},"comment_count":2,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1668285799,"creation_date":1668283984,"answer_id":74416232,"question_id":295579,"body_markdown":"This question got me wondering, so I did some simple coding and I&#39;m presenting it here because I think it&#39;s interesting, relevant, but I don&#39;t know how useful. There&#39;s a simple algorithm \r\n\r\n    a_n+1 = (a_n + x/a_n)/2\r\n\r\nfor calculating square roots, but it&#39;s meant to be used for decimals. I wondered what would happen if I just coded the same algorithm using integer maths. Would it even converge on the right answer? I didn&#39;t know, so I wrote a program...\r\n\r\n    #include &lt;stdio.h&gt;\r\n    #include &lt;stdint.h&gt;\r\n    #include &lt;stdlib.h&gt;\r\n    #include &lt;math.h&gt;\r\n    \r\n    _Bool isperfectsquare(uint64_t x, uint64_t *isqrtx) {\r\n      // NOTE: isqrtx approximate for non-squares. (benchmarked at 162ns 3GHz i5)\r\n      uint32_t i;\r\n      uint64_t ai;\r\n      ai = 1 + ((x &amp; 0xffff000000000000) &gt;&gt; 32) + ((x &amp; 0xffff00000000) &gt;&gt; 24) + ((x &amp; 0xffff0000) &gt;&gt; 16);\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = (ai + x/ai)/2;\r\n      ai = ai &amp; 0xffffffff;\r\n      if (isqrtx != NULL) isqrtx[0] = ai;\r\n      return ai*ai == x;\r\n    }\r\n    \r\n    void main() {\r\n    \r\n      uint64_t x, isqrtx;\r\n      uint64_t i;\r\n      for (i=1; i&lt;0x100000000; i++) {\r\n        if (!isperfectsquare(i*i, &amp;isqrtx)) {\r\n          printf(&quot;Failed at %li&quot;, i);\r\n          exit(1);\r\n        }\r\n      }\r\n      printf(&quot;All OK.\\n&quot;);\r\n    } \r\n\r\nSo, it turns out that 12 iterations of the formula is enough to give correct results for all 64 bit unsigned longs that are perfect squares, and of course, non-squares will return false. \r\n\r\n    simon@simon-Inspiron-N5040:~$ time ./isqrt.bin \r\n    All OK.\r\n    \r\n    real\t11m37.096s\r\n    user\t11m35.053s\r\n    sys\t0m0.272s\r\n\r\nSo 697s/2^32 is approx 162ns. As it is, the function will have the same runtime for all inputs. Some of the measures detailed elsewhere in the discussion could speed it up for non-squares by checking the last four bits etc. Hope someone finds this interesting as I did.","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>This question got me wondering, so I did some simple coding and I'm presenting it here because I think it's interesting, relevant, but I don't know how useful. There's a simple algorithm</p>\n<pre><code>a_n+1 = (a_n + x/a_n)/2\n</code></pre>\n<p>for calculating square roots, but it's meant to be used for decimals. I wondered what would happen if I just coded the same algorithm using integer maths. Would it even converge on the right answer? I didn't know, so I wrote a program...</p>\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n\n_Bool isperfectsquare(uint64_t x, uint64_t *isqrtx) {\n  // NOTE: isqrtx approximate for non-squares. (benchmarked at 162ns 3GHz i5)\n  uint32_t i;\n  uint64_t ai;\n  ai = 1 + ((x &amp; 0xffff000000000000) &gt;&gt; 32) + ((x &amp; 0xffff00000000) &gt;&gt; 24) + ((x &amp; 0xffff0000) &gt;&gt; 16);\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = (ai + x/ai)/2;\n  ai = ai &amp; 0xffffffff;\n  if (isqrtx != NULL) isqrtx[0] = ai;\n  return ai*ai == x;\n}\n\nvoid main() {\n\n  uint64_t x, isqrtx;\n  uint64_t i;\n  for (i=1; i&lt;0x100000000; i++) {\n    if (!isperfectsquare(i*i, &amp;isqrtx)) {\n      printf(&quot;Failed at %li&quot;, i);\n      exit(1);\n    }\n  }\n  printf(&quot;All OK.\\n&quot;);\n} \n</code></pre>\n<p>So, it turns out that 12 iterations of the formula is enough to give correct results for all 64 bit unsigned longs that are perfect squares, and of course, non-squares will return false.</p>\n<pre><code>simon@simon-Inspiron-N5040:~$ time ./isqrt.bin \nAll OK.\n\nreal    11m37.096s\nuser    11m35.053s\nsys 0m0.272s\n</code></pre>\n<p>So 697s/2^32 is approx 162ns. As it is, the function will have the same runtime for all inputs. Some of the measures detailed elsewhere in the discussion could speed it up for non-squares by checking the last four bits etc. Hope someone finds this interesting as I did.</p>\n"}],"owner":{"account_id":9921,"reputation":107684,"user_id":18511,"accept_rate":92,"display_name":"Kip"},"comment_count":32,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":327140,"favorite_count":0,"down_vote_count":4,"up_vote_count":1610,"accepted_answer_id":424936,"answer_count":37,"score":1606,"last_activity_date":1701112993,"creation_date":1226929401,"question_id":295579,"body_markdown":"I&#39;m looking for the fastest way to determine if a `long` value is a perfect square (i.e. its square root is another integer): \r\n\r\n 1. I&#39;ve done it the easy way, by using the built-in [`Math.sqrt()`][1]\r\n    function, but I&#39;m wondering if there is a way to do it faster by\r\n    restricting yourself to integer-only domain.\r\n 2. Maintaining a lookup table is impractical (since there are about\r\n    2&lt;sup&gt;31.5&lt;/sup&gt; integers whose square is less than 2&lt;sup&gt;63&lt;/sup&gt;).\r\n\r\nHere is the very simple and straightforward way I&#39;m doing it now:\r\n\r\n    public final static boolean isPerfectSquare(long n)\r\n    {\r\n      if (n &lt; 0)\r\n        return false;\r\n      \r\n      long tst = (long)(Math.sqrt(n) + 0.5);\r\n      return tst*tst == n;\r\n    }\r\n\r\n&lt;sub&gt;Note: I&#39;m using this function in many &lt;a href=&quot;http://projecteuler.net/&quot;&gt;Project Euler&lt;/a&gt; problems.  So no one else will ever have to maintain this code.  And this kind of micro-optimization could actually make a difference, since part of the challenge is to do every algorithm in less than a minute, and this function will need to be called millions of times in some problems.&lt;/sub&gt;\r\n\r\n---\r\n\r\nI&#39;ve tried the different solutions to the problem:\r\n\r\n* After exhaustive testing, I found that adding `0.5` to the result of Math.sqrt() is not necessary, at least not on my machine.\r\n* The &lt;a href=&quot;https://en.wikipedia.org/wiki/Fast_inverse_square_root&quot;&gt;fast inverse square root&lt;/a&gt; was faster, but it gave incorrect results for n &gt;= 410881.  However, as suggested by &lt;a href=&quot;https://stackoverflow.com/users/38426/bobbyshaftoe&quot;&gt;BobbyShaftoe&lt;/a&gt;, we can use the FISR hack for n &lt; 410881.\r\n* Newton&#39;s method was a good bit slower than `Math.sqrt()`.  This is probably because `Math.sqrt()` uses something similar to Newton&#39;s Method, but implemented in the hardware so it&#39;s much faster than in Java.  Also, Newton&#39;s Method still required use of doubles.\r\n* A modified Newton&#39;s method, which used a few tricks so that only integer math was involved, required some hacks to avoid overflow (I want this function to work with all positive 64-bit signed integers), and it was still slower than `Math.sqrt()`.\r\n* Binary chop was even slower.  This makes sense because the binary chop will on average require 16 passes to find the square root of a 64-bit number.\r\n* According to John&#39;s tests, using `or` statements is faster in C++ than using a `switch`, but in Java and C# there appears to be no difference between `or` and `switch`.\r\n* I also tried making a lookup table (as a private static array of 64 boolean values).  Then instead of either switch or `or` statement, I would just say `if(lookup[(int)(n&amp;0x3F)]) { test } else return false;`.  To my surprise, this was (just slightly) slower. This is because &lt;a href=&quot;https://stackoverflow.com/questions/299079/why-is-this-code-with-several-or-statements-slightly-faster-than-using-a-lookup-t#299205&quot;&gt;array bounds are checked in Java&lt;/a&gt;. \r\n\r\n\r\n  [1]: https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#sqrt(double)","title":"Fastest way to determine if an integer&#39;s square root is an integer","body":"<p>I'm looking for the fastest way to determine if a <code>long</code> value is a perfect square (i.e. its square root is another integer): </p>\n\n<ol>\n<li>I've done it the easy way, by using the built-in <a href=\"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#sqrt(double)\" rel=\"noreferrer\"><code>Math.sqrt()</code></a>\nfunction, but I'm wondering if there is a way to do it faster by\nrestricting yourself to integer-only domain.</li>\n<li>Maintaining a lookup table is impractical (since there are about\n2<sup>31.5</sup> integers whose square is less than 2<sup>63</sup>).</li>\n</ol>\n\n<p>Here is the very simple and straightforward way I'm doing it now:</p>\n\n<pre><code>public final static boolean isPerfectSquare(long n)\n{\n  if (n &lt; 0)\n    return false;\n\n  long tst = (long)(Math.sqrt(n) + 0.5);\n  return tst*tst == n;\n}\n</code></pre>\n\n<p><sub>Note: I'm using this function in many <a href=\"http://projecteuler.net/\" rel=\"noreferrer\">Project Euler</a> problems.  So no one else will ever have to maintain this code.  And this kind of micro-optimization could actually make a difference, since part of the challenge is to do every algorithm in less than a minute, and this function will need to be called millions of times in some problems.</sub></p>\n\n<hr>\n\n<p>I've tried the different solutions to the problem:</p>\n\n<ul>\n<li>After exhaustive testing, I found that adding <code>0.5</code> to the result of Math.sqrt() is not necessary, at least not on my machine.</li>\n<li>The <a href=\"https://en.wikipedia.org/wiki/Fast_inverse_square_root\" rel=\"noreferrer\">fast inverse square root</a> was faster, but it gave incorrect results for n >= 410881.  However, as suggested by <a href=\"https://stackoverflow.com/users/38426/bobbyshaftoe\">BobbyShaftoe</a>, we can use the FISR hack for n &lt; 410881.</li>\n<li>Newton's method was a good bit slower than <code>Math.sqrt()</code>.  This is probably because <code>Math.sqrt()</code> uses something similar to Newton's Method, but implemented in the hardware so it's much faster than in Java.  Also, Newton's Method still required use of doubles.</li>\n<li>A modified Newton's method, which used a few tricks so that only integer math was involved, required some hacks to avoid overflow (I want this function to work with all positive 64-bit signed integers), and it was still slower than <code>Math.sqrt()</code>.</li>\n<li>Binary chop was even slower.  This makes sense because the binary chop will on average require 16 passes to find the square root of a 64-bit number.</li>\n<li>According to John's tests, using <code>or</code> statements is faster in C++ than using a <code>switch</code>, but in Java and C# there appears to be no difference between <code>or</code> and <code>switch</code>.</li>\n<li>I also tried making a lookup table (as a private static array of 64 boolean values).  Then instead of either switch or <code>or</code> statement, I would just say <code>if(lookup[(int)(n&amp;0x3F)]) { test } else return false;</code>.  To my surprise, this was (just slightly) slower. This is because <a href=\"https://stackoverflow.com/questions/299079/why-is-this-code-with-several-or-statements-slightly-faster-than-using-a-lookup-t#299205\">array bounds are checked in Java</a>. </li>\n</ul>\n"},{"tags":["java","jboss"],"comments":[{"owner":{"account_id":51161,"reputation":17015,"user_id":152794,"display_name":"James R. Perkins"},"score":0,"creation_date":1701112645,"post_id":77553603,"comment_id":136732400,"body_markdown":"Are you using WildFly or JBoss EAP? If so which version?","body":"Are you using WildFly or JBoss EAP? If so which version?"},{"owner":{"account_id":21827053,"reputation":1,"user_id":16122372,"display_name":"Kishan Yarlagadda"},"score":0,"creation_date":1701188428,"post_id":77553603,"comment_id":136743027,"body_markdown":"`jboss-eap-7.1`","body":"<code>jboss-eap-7.1</code>"},{"owner":{"account_id":51161,"reputation":17015,"user_id":152794,"display_name":"James R. Perkins"},"score":0,"creation_date":1701207595,"post_id":77553603,"comment_id":136746350,"body_markdown":"If you&#39;re including Jackson in your deployment there is a chance it&#39;s conflicting with the version provided by JBoss EAP 7.1. You may want to try to exclude Jackson from your deployment.","body":"If you&#39;re including Jackson in your deployment there is a chance it&#39;s conflicting with the version provided by JBoss EAP 7.1. You may want to try to exclude Jackson from your deployment."},{"owner":{"account_id":21827053,"reputation":1,"user_id":16122372,"display_name":"Kishan Yarlagadda"},"score":0,"creation_date":1701219881,"post_id":77553603,"comment_id":136747800,"body_markdown":"`Thanks it worked`","body":"<code>Thanks it worked</code>"}],"owner":{"account_id":21827053,"reputation":1,"user_id":16122372,"display_name":"Kishan Yarlagadda"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":40,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701112599,"creation_date":1701035220,"question_id":77553603,"body_markdown":"    java.lang.IllegalAccessError: tried to access field com.fasterxml.jackson.core.JsonFactory.DEFAULT_ROOT_VALUE_SEPARATOR from class com.fasterxml.jackson.core.JsonFactoryBuilder \r\n        at com.fasterxml.jackson.core.JsonFactoryBuilder.&lt;init&gt;(JsonFactoryBuilder.java:36) \r\n        at io.swagger.v3.parser.ObjectMapperFactory.createJsonFactory(ObjectMapperFactory.java:41) \r\n        at io.swagger.v3.parser.ObjectMapperFactory.createJson(ObjectMapperFactory.java:18) \r\n        at io.swagger.v3.parser.ObjectMapperFactory.createJson(ObjectMapperFactory.java:14) \r\n        at io.swagger.v3.parser.OpenAPIV3Parser.&lt;clinit&gt;(OpenAPIV3Parser.java:43) at io.swagger.parser.OpenAPIParser.readContents(OpenAPIParser.java:28) \r\n        at com.atlassian.oai.validator.util.OpenApiLoader.readSwaggerParserResult(OpenApiLoader.java:63) \r\n        at com.atlassian.oai.validator.util.OpenApiLoader.loadApi(OpenApiLoader.java:46) \r\n        at com.atlassian.oai.validator.OpenApiInteractionValidator$Builder.build(OpenApiInteractionValidator.java:606)\r\n\r\n**tried the dependency tree. mvn dependecy:tree**\r\n\r\n/- com.atlassian.oai:swagger-request-validator-core:jar:2.18.0:compile [INFO] | +- io.swagger.parser.v3:swagger-parser:jar:2.0.29:compile [INFO] | | +- io.swagger.parser.v3:swagger-parser-v2-converter:jar:2.0.29:compile [INFO] | | | +- io.swagger:swagger-core:jar:1.6.3:compile [INFO] | | | | - io.swagger:swagger-models:jar:1.6.3:compile [INFO] | | | | - io.swagger:swagger-annotations:jar:1.6.3:compile [INFO] | | | +- io.swagger:swagger-parser:jar:1.0.56:compile [INFO] | | | +- io.swagger:swagger-compat-spec-parser:jar:1.0.56:compile [INFO] | | | | - com.github.java-json-tools:json-patch:jar:1.13:compile [INFO] | | | +- io.swagger.core.v3:swagger-models:jar:2.1.11:compile [INFO] | | | - io.swagger.parser.v3:swagger-parser-core:jar:2.0.29:compile [INFO] | | - io.swagger.parser.v3:swagger-parser-v3:jar:2.0.29:compile [INFO] | | - io.swagger.core.v3:swagger-core:jar:2.1.11:compile [INFO] | | +- jakarta.xml.bind:jakarta.xml.bind-api:jar:2.3.2:compile [INFO] | | | - jakarta.activation:jakarta.activation-api:jar:1.2.1:compile [INFO] | | +- com.fasterxml.jackson.datatype:jackson-datatype-jsr310:jar:2.15.0-rc2:compile [INFO] | | +- io.swagger.core.v3:swagger-annotations:jar:2.1.11:compile [INFO] | | - jakarta.validation:jakarta.validation-api:jar:2.0.2:compile/\r\n\r\n**is it due to the dependency conflict?**","title":"Jackson throwing the invalid access for the schema validation","body":"<pre><code>java.lang.IllegalAccessError: tried to access field com.fasterxml.jackson.core.JsonFactory.DEFAULT_ROOT_VALUE_SEPARATOR from class com.fasterxml.jackson.core.JsonFactoryBuilder \n    at com.fasterxml.jackson.core.JsonFactoryBuilder.&lt;init&gt;(JsonFactoryBuilder.java:36) \n    at io.swagger.v3.parser.ObjectMapperFactory.createJsonFactory(ObjectMapperFactory.java:41) \n    at io.swagger.v3.parser.ObjectMapperFactory.createJson(ObjectMapperFactory.java:18) \n    at io.swagger.v3.parser.ObjectMapperFactory.createJson(ObjectMapperFactory.java:14) \n    at io.swagger.v3.parser.OpenAPIV3Parser.&lt;clinit&gt;(OpenAPIV3Parser.java:43) at io.swagger.parser.OpenAPIParser.readContents(OpenAPIParser.java:28) \n    at com.atlassian.oai.validator.util.OpenApiLoader.readSwaggerParserResult(OpenApiLoader.java:63) \n    at com.atlassian.oai.validator.util.OpenApiLoader.loadApi(OpenApiLoader.java:46) \n    at com.atlassian.oai.validator.OpenApiInteractionValidator$Builder.build(OpenApiInteractionValidator.java:606)\n</code></pre>\n<p><strong>tried the dependency tree. mvn dependecy:tree</strong></p>\n<p>/- com.atlassian.oai:swagger-request-validator-core:jar:2.18.0:compile [INFO] | +- io.swagger.parser.v3:swagger-parser:jar:2.0.29:compile [INFO] | | +- io.swagger.parser.v3:swagger-parser-v2-converter:jar:2.0.29:compile [INFO] | | | +- io.swagger:swagger-core:jar:1.6.3:compile [INFO] | | | | - io.swagger:swagger-models:jar:1.6.3:compile [INFO] | | | | - io.swagger:swagger-annotations:jar:1.6.3:compile [INFO] | | | +- io.swagger:swagger-parser:jar:1.0.56:compile [INFO] | | | +- io.swagger:swagger-compat-spec-parser:jar:1.0.56:compile [INFO] | | | | - com.github.java-json-tools:json-patch:jar:1.13:compile [INFO] | | | +- io.swagger.core.v3:swagger-models:jar:2.1.11:compile [INFO] | | | - io.swagger.parser.v3:swagger-parser-core:jar:2.0.29:compile [INFO] | | - io.swagger.parser.v3:swagger-parser-v3:jar:2.0.29:compile [INFO] | | - io.swagger.core.v3:swagger-core:jar:2.1.11:compile [INFO] | | +- jakarta.xml.bind:jakarta.xml.bind-api:jar:2.3.2:compile [INFO] | | | - jakarta.activation:jakarta.activation-api:jar:1.2.1:compile [INFO] | | +- com.fasterxml.jackson.datatype:jackson-datatype-jsr310:jar:2.15.0-rc2:compile [INFO] | | +- io.swagger.core.v3:swagger-annotations:jar:2.1.11:compile [INFO] | | - jakarta.validation:jakarta.validation-api:jar:2.0.2:compile/</p>\n<p><strong>is it due to the dependency conflict?</strong></p>\n"},{"tags":["java","arrays"],"answers":[{"tags":[],"owner":{"account_id":21994,"reputation":73808,"user_id":53897,"accept_rate":56,"display_name":"Thorbj&#248;rn Ravn Andersen"},"comment_count":0,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1270243795,"creation_date":1270243795,"answer_id":2569296,"question_id":2569279,"body_markdown":"Count the total number of elements in originalArray.  Create new array of that length.  Copy elements one by one into the new array.\r\n\r\nI am unfamiliar with any library function to do so.","title":"How to flatten 2D array to 1D array?","body":"<p>Count the total number of elements in originalArray.  Create new array of that length.  Copy elements one by one into the new array.</p>\n\n<p>I am unfamiliar with any library function to do so.</p>\n"},{"tags":[],"owner":{"account_id":35487,"reputation":64776,"user_id":100516,"accept_rate":69,"display_name":"Roman"},"comment_count":0,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1270243817,"creation_date":1270243817,"answer_id":2569301,"question_id":2569279,"body_markdown":"There will be 2 steps: \r\n\r\n1) find out total number of elements to create a new vector (1d array)\r\n\r\n2) iterate through your 2d array in predefined order and copy its elements to the created vector\r\n\r\n    int elementsNumber = 0;\r\n    \r\n    for (int i = 0; i &lt; originalArray.length; i++) {\r\n       elementsNumber += originalArray[i].length;\r\n    }\r\n    \r\n    int[] newArray = new int[elementsNumber];\r\n    int j = 0;\r\n    for (int i = 0; i &lt; originalArray.length; i++) {\r\n       System.arrayCopy (originalArray[i], 0, newArray, j, originalArray[i].length);\r\n       j += originalArray[i].length;\r\n    }","title":"How to flatten 2D array to 1D array?","body":"<p>There will be 2 steps: </p>\n\n<p>1) find out total number of elements to create a new vector (1d array)</p>\n\n<p>2) iterate through your 2d array in predefined order and copy its elements to the created vector</p>\n\n<pre><code>int elementsNumber = 0;\n\nfor (int i = 0; i &lt; originalArray.length; i++) {\n   elementsNumber += originalArray[i].length;\n}\n\nint[] newArray = new int[elementsNumber];\nint j = 0;\nfor (int i = 0; i &lt; originalArray.length; i++) {\n   System.arrayCopy (originalArray[i], 0, newArray, j, originalArray[i].length);\n   j += originalArray[i].length;\n}\n</code></pre>\n"},{"comments":[{"owner":{"account_id":94444,"reputation":6766,"user_id":257878,"accept_rate":81,"display_name":"dclowd9901"},"score":0,"creation_date":1270244017,"post_id":2569309,"comment_id":2574345,"body_markdown":"Wow, I&#39;m quite surprised recursion isn&#39;t necessary.","body":"Wow, I&#39;m quite surprised recursion isn&#39;t necessary."},{"owner":{"account_id":29808,"reputation":15451,"user_id":80796,"accept_rate":77,"display_name":"Jessy"},"score":0,"creation_date":1270244193,"post_id":2569309,"comment_id":2574359,"body_markdown":"is it possible not to use loop?","body":"is it possible not to use loop?"},{"owner":{"account_id":16209,"reputation":280512,"user_id":35070,"accept_rate":78,"display_name":"phihag"},"score":0,"creation_date":1270244247,"post_id":2569309,"comment_id":2574366,"body_markdown":"@Jessy Well, you could use recursion, but that would it make way messier and slower.","body":"@Jessy Well, you could use recursion, but that would it make way messier and slower."},{"owner":{"account_id":29808,"reputation":15451,"user_id":80796,"accept_rate":77,"display_name":"Jessy"},"score":0,"creation_date":1270245098,"post_id":2569309,"comment_id":2574449,"body_markdown":"I think, I should use arraycopy :-)","body":"I think, I should use arraycopy :-)"},{"owner":{"account_id":11848,"reputation":9175,"user_id":23056,"accept_rate":100,"display_name":"nicerobot"},"score":0,"creation_date":1270245777,"post_id":2569309,"comment_id":2574497,"body_markdown":"Note: though it wasn&#39;t specified as a requirement, with this technique, there&#39;s no way to return to the original arrays without retaining their lengths. The solution by @rsp is close a technique capable of reversing the process. Just pointing out that the requirements of the flattening will dictate the solution.","body":"Note: though it wasn&#39;t specified as a requirement, with this technique, there&#39;s no way to return to the original arrays without retaining their lengths. The solution by @rsp is close a technique capable of reversing the process. Just pointing out that the requirements of the flattening will dictate the solution."}],"tags":[],"owner":{"account_id":16209,"reputation":280512,"user_id":35070,"accept_rate":78,"display_name":"phihag"},"comment_count":5,"down_vote_count":1,"up_vote_count":3,"is_accepted":false,"score":2,"last_activity_date":1270244198,"creation_date":1270243893,"answer_id":2569309,"question_id":2569279,"body_markdown":"Since arrays can&#39;t be extended (i.e. you have to declare the size of an error upon initialization), you have to traverse the arrays twice:\r\n\r\n    int size = 0;\r\n    for (int[] ar : originalArray) size += ar.length;\r\n    int[] result = new int[size];\r\n    int pos = 0;\r\n    for (int[] ar : originalArray) {\r\n        System.arraycopy(ar, 0, result, pos, ar.length);\r\n        pos += ar.length;\r\n    }","title":"How to flatten 2D array to 1D array?","body":"<p>Since arrays can't be extended (i.e. you have to declare the size of an error upon initialization), you have to traverse the arrays twice:</p>\n\n<pre><code>int size = 0;\nfor (int[] ar : originalArray) size += ar.length;\nint[] result = new int[size];\nint pos = 0;\nfor (int[] ar : originalArray) {\n    System.arraycopy(ar, 0, result, pos, ar.length);\n    pos += ar.length;\n}\n</code></pre>\n"},{"comments":[{"owner":{"account_id":16209,"reputation":280512,"user_id":35070,"accept_rate":78,"display_name":"phihag"},"score":1,"creation_date":1270244699,"post_id":2569314,"comment_id":2574408,"body_markdown":"The example arrays don&#39;t have the same length. a.length == 5, b.length == 4, c.length == 4.","body":"The example arrays don&#39;t have the same length. a.length == 5, b.length == 4, c.length == 4."},{"owner":{"account_id":110658,"reputation":9404,"user_id":292728,"accept_rate":87,"display_name":"Kevin K"},"score":1,"creation_date":1270705279,"post_id":2569314,"comment_id":2606330,"body_markdown":"Also might be worth mentioning that the two examples end up with different orderings for the final flattened array, if that matters.  In the first example, the arrays are &#39;weaved&#39;, while in the second, they are placed &#39;end-to-end&#39;, if that makes sense","body":"Also might be worth mentioning that the two examples end up with different orderings for the final flattened array, if that matters.  In the first example, the arrays are &#39;weaved&#39;, while in the second, they are placed &#39;end-to-end&#39;, if that makes sense"},{"owner":{"account_id":62440,"reputation":23185,"user_id":185541,"display_name":"rsp"},"score":1,"creation_date":1270717190,"post_id":2569314,"comment_id":2607254,"body_markdown":"@Kevin, I think I did mention that: `different order, a, b, c can be of different lengths`","body":"@Kevin, I think I did mention that: <code>different order, a, b, c can be of different lengths</code>"}],"tags":[],"owner":{"account_id":62440,"reputation":23185,"user_id":185541,"display_name":"rsp"},"comment_count":3,"down_vote_count":2,"up_vote_count":11,"is_accepted":true,"score":9,"last_activity_date":1618596087,"creation_date":1270243967,"answer_id":2569314,"question_id":2569279,"body_markdown":"A simple for loop will do, it is not difficult, but will depend on the order in which you want to copy the values. For instance (based on the fact that in your example the arrays all have the same length):\r\n\r\n    int[] newArray = new int[3 * a.length];\r\n    int index = 0;\r\n    for (int n = 0; n &lt; a.length; n++) {\r\n        newArray[index++] = a[n];\r\n        newArray[index++] = b[n];\r\n        newArray[index++] = c[n];\r\n    }\r\n\r\nor (different order, a, b, c can be of different lengths):\r\n\r\n    int[] newArray = new int[a.length + b.length + c.length];\r\n    System.arraycopy(a, 0, newArray, 0, a.length);\r\n    System.arraycopy(b, 0, newArray, a.length, b.length);\r\n    System.arraycopy(c, 0, newArray, a.length + b.length, c.length);\r\n\r\n","title":"How to flatten 2D array to 1D array?","body":"<p>A simple for loop will do, it is not difficult, but will depend on the order in which you want to copy the values. For instance (based on the fact that in your example the arrays all have the same length):</p>\n<pre><code>int[] newArray = new int[3 * a.length];\nint index = 0;\nfor (int n = 0; n &lt; a.length; n++) {\n    newArray[index++] = a[n];\n    newArray[index++] = b[n];\n    newArray[index++] = c[n];\n}\n</code></pre>\n<p>or (different order, a, b, c can be of different lengths):</p>\n<pre><code>int[] newArray = new int[a.length + b.length + c.length];\nSystem.arraycopy(a, 0, newArray, 0, a.length);\nSystem.arraycopy(b, 0, newArray, a.length, b.length);\nSystem.arraycopy(c, 0, newArray, a.length + b.length, c.length);\n</code></pre>\n"},{"comments":[{"owner":{"account_id":69527,"reputation":40466,"user_id":202214,"display_name":"Kevin Bourrillion"},"score":13,"creation_date":1272932235,"post_id":2597764,"comment_id":2794144,"body_markdown":"Downvoted why?  Who wants to write all that code above when they need to do this?","body":"Downvoted why?  Who wants to write all that code above when they need to do this?"},{"owner":{"account_id":1677076,"reputation":19026,"user_id":1542343,"accept_rate":84,"display_name":"gvlasov"},"score":0,"creation_date":1392007478,"post_id":2597764,"comment_id":32754598,"body_markdown":"Is there any method to do the same for an array of Objects?","body":"Is there any method to do the same for an array of Objects?"},{"owner":{"account_id":69527,"reputation":40466,"user_id":202214,"display_name":"Kevin Bourrillion"},"score":3,"creation_date":1393000425,"post_id":2597764,"comment_id":33235775,"body_markdown":"`ObjectArrays.concat`","body":"<code>ObjectArrays.concat</code>"}],"tags":[],"owner":{"account_id":69527,"reputation":40466,"user_id":202214,"display_name":"Kevin Bourrillion"},"comment_count":3,"down_vote_count":1,"up_vote_count":47,"is_accepted":false,"score":46,"last_activity_date":1701111671,"creation_date":1270704679,"answer_id":2597764,"question_id":2569279,"body_markdown":"With [Guava][1], you can use either\r\n\r\n`int[] all = Ints.concat(originalArray);`\r\n\r\nor \r\n\r\n`int[] all = Ints.concat(a, b, c);`\r\n\r\n\r\n  [1]: https://guava.dev/","title":"How to flatten 2D array to 1D array?","body":"<p>With <a href=\"https://guava.dev/\" rel=\"nofollow noreferrer\">Guava</a>, you can use either</p>\n<p><code>int[] all = Ints.concat(originalArray);</code></p>\n<p>or</p>\n<p><code>int[] all = Ints.concat(a, b, c);</code></p>\n"},{"tags":[],"owner":{"account_id":875840,"reputation":6908,"user_id":925504,"accept_rate":69,"display_name":"Nolesh"},"comment_count":0,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1360333022,"creation_date":1360333022,"answer_id":14774529,"question_id":2569279,"body_markdown":"\r\n    int[] oneDArray = new int[arr.length*arr.length];\r\n\t\t//Flatten 2D array to 1D array...\r\n\t\tint s = 0;\r\n\t\tfor(int i = 0; i &lt; arr.length; i ++) \r\n\t          for(int j = 0; j &lt; arr.length; j ++){\t        \t  \t          \r\n\t        \t  oneDArray[s] = arr[i][j];\r\n\t        \t  s++;\r\n\t          }\t","title":"How to flatten 2D array to 1D array?","body":"<pre><code>int[] oneDArray = new int[arr.length*arr.length];\n    //Flatten 2D array to 1D array...\n    int s = 0;\n    for(int i = 0; i &lt; arr.length; i ++) \n          for(int j = 0; j &lt; arr.length; j ++){                           \n              oneDArray[s] = arr[i][j];\n              s++;\n          } \n</code></pre>\n"},{"tags":[],"owner":{"account_id":440158,"reputation":323231,"user_id":829571,"accept_rate":94,"display_name":"assylias"},"comment_count":0,"down_vote_count":0,"up_vote_count":43,"is_accepted":false,"score":43,"last_activity_date":1422986279,"creation_date":1422986279,"answer_id":28305591,"question_id":2569279,"body_markdown":"With Java 8 you can &quot;flatMap&quot; the inner arrays:\r\n\r\n    int[] flatArray = Arrays.stream(originalArray)\r\n            .flatMapToInt(Arrays::stream)\r\n            .toArray();\r\n\r\nor:\r\n\r\n    int[] flatArray = Stream.of(a, b, c)\r\n            .flatMapToInt(Arrays::stream)\r\n            .toArray();\r\n","title":"How to flatten 2D array to 1D array?","body":"<p>With Java 8 you can \"flatMap\" the inner arrays:</p>\n\n<pre><code>int[] flatArray = Arrays.stream(originalArray)\n        .flatMapToInt(Arrays::stream)\n        .toArray();\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>int[] flatArray = Stream.of(a, b, c)\n        .flatMapToInt(Arrays::stream)\n        .toArray();\n</code></pre>\n"},{"tags":[],"owner":{"account_id":15524669,"reputation":2739,"user_id":11199879,"display_name":"Kaplan"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1587138884,"creation_date":1587138884,"answer_id":61275703,"question_id":2569279,"body_markdown":"*one-liner with* `IntStream`\r\n\r\n    IntStream.concat(\r\n        IntStream.concat( IntStream.of(originalArray[0]), IntStream.of(originalArray[1]) ),\r\n            IntStream.of(originalArray[2]) ).toArray();\r\n\r\ngets: `[1, 2, 6, 7, 2, 2, 44, 55, 2, 2, 44, 511, 33]`","title":"How to flatten 2D array to 1D array?","body":"<p><em>one-liner with</em> <code>IntStream</code></p>\n\n<pre><code>IntStream.concat(\n    IntStream.concat( IntStream.of(originalArray[0]), IntStream.of(originalArray[1]) ),\n        IntStream.of(originalArray[2]) ).toArray();\n</code></pre>\n\n<p>gets: <code>[1, 2, 6, 7, 2, 2, 44, 55, 2, 2, 44, 511, 33]</code></p>\n"},{"tags":[],"owner":{"account_id":7006182,"reputation":2025,"user_id":5370480,"display_name":"Dean Jain"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1634684142,"creation_date":1634684142,"answer_id":69638449,"question_id":2569279,"body_markdown":"below code can merge varied 2D arrays (diff sizes of internal array) into a one dimensional array:\r\n\r\n     public static Integer[] merge2DArrays(int[][] twoDArray){\r\n            ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;();\r\n            for (int i = 0; i &lt; twoDArray.length; i++) {\r\n                for (int j = 0; j &lt; twoDArray[i].length; j++) {\r\n                    list.add(twoDArray[i][j]);\r\n                }\r\n            }\r\n        return list.toArray(new Integer[list.size()]);\r\n        }","title":"How to flatten 2D array to 1D array?","body":"<p>below code can merge varied 2D arrays (diff sizes of internal array) into a one dimensional array:</p>\n<pre><code> public static Integer[] merge2DArrays(int[][] twoDArray){\n        ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;();\n        for (int i = 0; i &lt; twoDArray.length; i++) {\n            for (int j = 0; j &lt; twoDArray[i].length; j++) {\n                list.add(twoDArray[i][j]);\n            }\n        }\n    return list.toArray(new Integer[list.size()]);\n    }\n</code></pre>\n"}],"owner":{"account_id":29808,"reputation":15451,"user_id":80796,"accept_rate":77,"display_name":"Jessy"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":55508,"favorite_count":0,"down_vote_count":1,"up_vote_count":30,"accepted_answer_id":2569314,"answer_count":9,"score":29,"last_activity_date":1701111671,"creation_date":1270243573,"question_id":2569279,"body_markdown":"How can I flatten the 2 dimensions array `int originalArray[][]` to 1 dimension array?\r\n\r\n        int a [] = {1,2,6,7,2};\r\n        int b [] = {2,44,55,2};\r\n        int c [] = {2,44,511,33};\r\n        \r\n        int originalArray [][] = new int[][]{a,b,c};\r\n\r\n\r\n","title":"How to flatten 2D array to 1D array?","body":"<p>How can I flatten the 2 dimensions array <code>int originalArray[][]</code> to 1 dimension array?</p>\n\n<pre><code>    int a [] = {1,2,6,7,2};\n    int b [] = {2,44,55,2};\n    int c [] = {2,44,511,33};\n\n    int originalArray [][] = new int[][]{a,b,c};\n</code></pre>\n"},{"tags":["java","spring-boot","metrics","newrelic","open-telemetry"],"answers":[{"comments":[{"owner":{"account_id":17420875,"reputation":5,"user_id":12626461,"display_name":"Marcin"},"score":0,"creation_date":1701789391,"post_id":77559316,"comment_id":136817347,"body_markdown":"Thanks. Is there any other way to change cardinality limit? (not experimental).  2000 looks like not enough for me. I don&#39;t know why default value is so small. I have metric with 4 tags (event, platform, app, region) and I get a lot of warns about &quot;Instrument app.events has exceeded the maximum allowed cardinality (1999).&quot;","body":"Thanks. Is there any other way to change cardinality limit? (not experimental).  2000 looks like not enough for me. I don&#39;t know why default value is so small. I have metric with 4 tags (event, platform, app, region) and I get a lot of warns about &quot;Instrument app.events has exceeded the maximum allowed cardinality (1999).&quot;"},{"owner":{"account_id":3053597,"reputation":580,"user_id":2587704,"accept_rate":50,"display_name":"JackB"},"score":0,"creation_date":1701792703,"post_id":77559316,"comment_id":136818045,"body_markdown":"The only other option is to use register the limit with a view, which allows you to target a narrower set of instruments than the reader, but that&#39;s experimental as well: https://github.com/open-telemetry/opentelemetry-java/blob/main/sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/internal/SdkMeterProviderUtil.java#L113-L121 There are currently no options that aren&#39;t experimental. We&#39;re waiting for the specification to stabilize before we stabilize.","body":"The only other option is to use register the limit with a view, which allows you to target a narrower set of instruments than the reader, but that&#39;s experimental as well: <a href=\"https://github.com/open-telemetry/opentelemetry-java/blob/main/sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/internal/SdkMeterProviderUtil.java#L113-L121\" rel=\"nofollow noreferrer\">github.com/open-telemetry/opentelemetry-java/blob/main/sdk/&hellip;</a> There are currently no options that aren&#39;t experimental. We&#39;re waiting for the specification to stabilize before we stabilize."}],"tags":[],"owner":{"account_id":3053597,"reputation":580,"user_id":2587704,"accept_rate":50,"display_name":"JackB"},"comment_count":2,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1701111559,"creation_date":1701111559,"answer_id":77559316,"question_id":77558008,"body_markdown":"Configuring cardinality limits is still experimental, so the APIs you call to set the limits are internal and leave a lot to be desired in terms of ergonomics. This will change when the limits are marked as stable in the specification.\r\n\r\nYou need to use [SdkMeterProviderUtil#registerMetricReaderWithCardinalitySelect](https://github.com/open-telemetry/opentelemetry-java/blob/c57ca65f7f1455e2f9d72f3d2d626aaf2f2f9a81/sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/internal/SdkMeterProviderUtil.java#L53-L67), something like:\r\n```\r\nSdkMeterProviderBuilder meterProviderBuilder = SdkMeterProvider.builder();\r\nPeriodicMetricReader periodicMetricReader = PeriodicMetricReader.builder()\r\n  // configuration omitted for brevity\r\n  .build();\r\nSdkMeterProviderUtil.registerMetricReaderWithCardinalitySelector(meterProviderBuilder, periodicMetricReader, unused -&gt; 3000);\r\n```","title":"OpenTelemetry SDK Cardinality limit change","body":"<p>Configuring cardinality limits is still experimental, so the APIs you call to set the limits are internal and leave a lot to be desired in terms of ergonomics. This will change when the limits are marked as stable in the specification.</p>\n<p>You need to use <a href=\"https://github.com/open-telemetry/opentelemetry-java/blob/c57ca65f7f1455e2f9d72f3d2d626aaf2f2f9a81/sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/internal/SdkMeterProviderUtil.java#L53-L67\" rel=\"nofollow noreferrer\">SdkMeterProviderUtil#registerMetricReaderWithCardinalitySelect</a>, something like:</p>\n<pre><code>SdkMeterProviderBuilder meterProviderBuilder = SdkMeterProvider.builder();\nPeriodicMetricReader periodicMetricReader = PeriodicMetricReader.builder()\n  // configuration omitted for brevity\n  .build();\nSdkMeterProviderUtil.registerMetricReaderWithCardinalitySelector(meterProviderBuilder, periodicMetricReader, unused -&gt; 3000);\n</code></pre>\n"}],"owner":{"account_id":17420875,"reputation":5,"user_id":12626461,"display_name":"Marcin"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":61,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":77559316,"answer_count":1,"score":0,"last_activity_date":1701111559,"creation_date":1701098226,"question_id":77558008,"body_markdown":"I set up a configuration for openTelemtry in Spring Boot (New Relic exporter). I can see the metrics in New Relic so everything works fine. Also I see a lot of warnings about &quot;Cardinality Limit (2000)&quot;. By default cardinality is set to 2000. I&#39;m not sure how can I change it. I can see in optl docs something like this:\r\n\r\n&gt; aggregation_cardinality_limit: A positive integer value defining the maximum number of data points allowed to be emitted in a collection cycle by a single instrument. See cardinality limits, below.\r\n\r\nLink: https://opentelemetry.io/docs/specs/otel/metrics/sdk/#stream-configuration\r\n\r\nMy code:\r\n\r\n```\r\n @Bean\r\n    @ConditionalOnMissingBean\r\n    public OpenTelemetry openTelemetry() {\r\n        return OpenTelemetrySdk.builder()\r\n            .setMeterProvider(\r\n                SdkMeterProvider.builder()\r\n                    .setResource(\r\n                        Resource.getDefault().toBuilder()\r\n                            .put(&quot;service.name&quot;, getAppName())\r\n                            .put(&quot;instrumentation.provider&quot;, &quot;micrometer&quot;)\r\n                            .build())\r\n                    .registerMetricReader(\r\n                        PeriodicMetricReader.builder(\r\n                                OtlpGrpcMetricExporter.builder()\r\n                                    .setCompression(&quot;gzip&quot;)\r\n                                    .setEndpoint(properties.getEndpoint())\r\n                                    .addHeader(&quot;api-key&quot;, getLicenceKey())\r\n                                    .setAggregationTemporalitySelector(AggregationTemporalitySelector.deltaPreferred())\r\n                                    .setDefaultAggregationSelector(\r\n                                        DefaultAggregationSelector.getDefault()\r\n                                            .with(InstrumentType.HISTOGRAM, Aggregation.base2ExponentialBucketHistogram()))\r\n                                    .build())\r\n                            .setInterval(Duration.ofSeconds(properties.getInterval()))\r\n                            .build())\r\n                    .build())\r\n            .build();\r\n    }\r\n```\r\n\r\n\r\nI&#39;m not sure if I can just pass another &quot;                       .put(&quot;aggregation_cardinality_limit&quot;, 3000)&quot; to Resource.","title":"OpenTelemetry SDK Cardinality limit change","body":"<p>I set up a configuration for openTelemtry in Spring Boot (New Relic exporter). I can see the metrics in New Relic so everything works fine. Also I see a lot of warnings about &quot;Cardinality Limit (2000)&quot;. By default cardinality is set to 2000. I'm not sure how can I change it. I can see in optl docs something like this:</p>\n<blockquote>\n<p>aggregation_cardinality_limit: A positive integer value defining the maximum number of data points allowed to be emitted in a collection cycle by a single instrument. See cardinality limits, below.</p>\n</blockquote>\n<p>Link: <a href=\"https://opentelemetry.io/docs/specs/otel/metrics/sdk/#stream-configuration\" rel=\"nofollow noreferrer\">https://opentelemetry.io/docs/specs/otel/metrics/sdk/#stream-configuration</a></p>\n<p>My code:</p>\n<pre><code> @Bean\n    @ConditionalOnMissingBean\n    public OpenTelemetry openTelemetry() {\n        return OpenTelemetrySdk.builder()\n            .setMeterProvider(\n                SdkMeterProvider.builder()\n                    .setResource(\n                        Resource.getDefault().toBuilder()\n                            .put(&quot;service.name&quot;, getAppName())\n                            .put(&quot;instrumentation.provider&quot;, &quot;micrometer&quot;)\n                            .build())\n                    .registerMetricReader(\n                        PeriodicMetricReader.builder(\n                                OtlpGrpcMetricExporter.builder()\n                                    .setCompression(&quot;gzip&quot;)\n                                    .setEndpoint(properties.getEndpoint())\n                                    .addHeader(&quot;api-key&quot;, getLicenceKey())\n                                    .setAggregationTemporalitySelector(AggregationTemporalitySelector.deltaPreferred())\n                                    .setDefaultAggregationSelector(\n                                        DefaultAggregationSelector.getDefault()\n                                            .with(InstrumentType.HISTOGRAM, Aggregation.base2ExponentialBucketHistogram()))\n                                    .build())\n                            .setInterval(Duration.ofSeconds(properties.getInterval()))\n                            .build())\n                    .build())\n            .build();\n    }\n</code></pre>\n<p>I'm not sure if I can just pass another &quot;                       .put(&quot;aggregation_cardinality_limit&quot;, 3000)&quot; to Resource.</p>\n"},{"tags":["java","spring","spring-boot"],"answers":[{"tags":[],"owner":{"account_id":62516,"reputation":20965,"user_id":185723,"accept_rate":89,"display_name":"dimitrisli"},"comment_count":0,"down_vote_count":0,"up_vote_count":25,"is_accepted":true,"score":25,"last_activity_date":1515138547,"creation_date":1515104550,"answer_id":48104439,"question_id":48099355,"body_markdown":"**[Edit]**\r\n\r\nEditing answer adding more info because of the downvote.\r\n\r\nThe reason why you are not getting a callback by the listener is because you are not explicitly calling the **LifeCycle** `start()` method ([JavaDoc][1]).\r\n\r\nThis cascades down to your **ApplicationContext** normally via the **AbstractApplicationContext** on in Spring Boot case via the **ConfigurableApplicationContext**.\r\n\r\nExample of working code below demonstrating how your callback would work (just explicitly call the start() method)\r\n\r\n    import org.springframework.boot.SpringApplication;\r\n    import org.springframework.boot.autoconfigure.SpringBootApplication;\r\n    import org.springframework.context.ApplicationListener;\r\n    import org.springframework.context.ConfigurableApplicationContext;\r\n    import org.springframework.context.event.ContextStartedEvent;\r\n    import org.springframework.stereotype.Component;\r\n    \r\n    @SpringBootApplication\r\n    public class DemoApplication {\r\n    \r\n    \tpublic static void main(String[] args) {\r\n    \t\tConfigurableApplicationContext applicationContext = SpringApplication.run(DemoApplication.class, args);\r\n    \t\tapplicationContext.start();\r\n    \t}\r\n    \r\n    \t@Component\r\n    \tclass ContextStartedListener implements ApplicationListener&lt;ContextStartedEvent&gt; {\r\n    \r\n    \t\t@Override\r\n    \t\tpublic void onApplicationEvent(ContextStartedEvent event) {\r\n    \t\t\tSystem.out.println(&quot;Context started&quot;);\r\n    \t\t}\r\n    \t}\r\n    }\r\n\r\nThe reason why I suggested below the `ContextRefreshedEvent` callback instead is because behind the scenes the `refresh()` code is getting invoked.\r\n\r\nIf you drill down the `SpringApplication#run()` method [you&#39;ll eventually see it][2].\r\n\r\nAgain here&#39;s a working example of how this would work using the `ContextRefreshedEvent`:\r\n\r\n    import org.springframework.boot.SpringApplication;\r\n    import org.springframework.boot.autoconfigure.SpringBootApplication;\r\n    import org.springframework.context.ApplicationListener;\r\n    import org.springframework.context.event.ContextRefreshedEvent;\r\n    import org.springframework.stereotype.Component;\r\n    \r\n    @SpringBootApplication\r\n    public class DemoApplication {\r\n    \r\n    \tpublic static void main(String[] args) {\r\n    \t\tSpringApplication.run(DemoApplication.class, args);\r\n    \t}\r\n    \r\n    \t@Component\r\n    \tclass ContextStartedListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; {\r\n    \r\n    \t\t@Override\r\n    \t\tpublic void onApplicationEvent(ContextRefreshedEvent event) {\r\n    \t\t\tSystem.out.println(&quot;Context refreshed&quot;);\r\n    \t\t}\r\n    \t}\r\n    }\r\n\r\n----------\r\n\r\n**[Before Edit]**\r\n\r\nChange the Generic type to `ContextRefreshedEvent` instead and then it should work.\r\n\r\nFor more details read [this article from the Spring Blog][3]. Just to quote the part about the `ContextRefreshedEvent`:\r\n\r\n&gt; [..]This allows MyListener to be notified when the context has *refreshed*\r\n&gt; and one can use that to run arbitrary code when the application\r\n&gt; context has fully started.[..]\r\n\r\n\r\n  [1]: https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/Lifecycle.html#start--\r\n  [2]: https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/SpringApplication.java#L327\r\n  [3]: https://spring.io/blog/2015/02/11/better-application-events-in-spring-framework-4-2","title":"ContextStartedEvent not firing in custom listener","body":"<p><strong>[Edit]</strong></p>\n\n<p>Editing answer adding more info because of the downvote.</p>\n\n<p>The reason why you are not getting a callback by the listener is because you are not explicitly calling the <strong>LifeCycle</strong> <code>start()</code> method (<a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/Lifecycle.html#start--\" rel=\"noreferrer\">JavaDoc</a>).</p>\n\n<p>This cascades down to your <strong>ApplicationContext</strong> normally via the <strong>AbstractApplicationContext</strong> on in Spring Boot case via the <strong>ConfigurableApplicationContext</strong>.</p>\n\n<p>Example of working code below demonstrating how your callback would work (just explicitly call the start() method)</p>\n\n<pre><code>import org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.ApplicationListener;\nimport org.springframework.context.ConfigurableApplicationContext;\nimport org.springframework.context.event.ContextStartedEvent;\nimport org.springframework.stereotype.Component;\n\n@SpringBootApplication\npublic class DemoApplication {\n\n    public static void main(String[] args) {\n        ConfigurableApplicationContext applicationContext = SpringApplication.run(DemoApplication.class, args);\n        applicationContext.start();\n    }\n\n    @Component\n    class ContextStartedListener implements ApplicationListener&lt;ContextStartedEvent&gt; {\n\n        @Override\n        public void onApplicationEvent(ContextStartedEvent event) {\n            System.out.println(\"Context started\");\n        }\n    }\n}\n</code></pre>\n\n<p>The reason why I suggested below the <code>ContextRefreshedEvent</code> callback instead is because behind the scenes the <code>refresh()</code> code is getting invoked.</p>\n\n<p>If you drill down the <code>SpringApplication#run()</code> method <a href=\"https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/SpringApplication.java#L327\" rel=\"noreferrer\">you'll eventually see it</a>.</p>\n\n<p>Again here's a working example of how this would work using the <code>ContextRefreshedEvent</code>:</p>\n\n<pre><code>import org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.ApplicationListener;\nimport org.springframework.context.event.ContextRefreshedEvent;\nimport org.springframework.stereotype.Component;\n\n@SpringBootApplication\npublic class DemoApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(DemoApplication.class, args);\n    }\n\n    @Component\n    class ContextStartedListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; {\n\n        @Override\n        public void onApplicationEvent(ContextRefreshedEvent event) {\n            System.out.println(\"Context refreshed\");\n        }\n    }\n}\n</code></pre>\n\n<hr>\n\n<p><strong>[Before Edit]</strong></p>\n\n<p>Change the Generic type to <code>ContextRefreshedEvent</code> instead and then it should work.</p>\n\n<p>For more details read <a href=\"https://spring.io/blog/2015/02/11/better-application-events-in-spring-framework-4-2\" rel=\"noreferrer\">this article from the Spring Blog</a>. Just to quote the part about the <code>ContextRefreshedEvent</code>:</p>\n\n<blockquote>\n  <p>[..]This allows MyListener to be notified when the context has <em>refreshed</em>\n  and one can use that to run arbitrary code when the application\n  context has fully started.[..]</p>\n</blockquote>\n"},{"tags":[],"owner":{"account_id":111563,"reputation":13269,"user_id":294657,"accept_rate":85,"display_name":"kaqqao"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701109974,"creation_date":1701109974,"answer_id":77559187,"question_id":48099355,"body_markdown":"Answer by Phil Webb (from the Spring team) on [a similar issue](https://github.com/spring-projects/spring-boot/issues/27945) on their GitHub:\r\n\r\n&gt; The `ContextStartedEvent` is being published, but it&#39;s before any beans are registered so it&#39;s already happened by the time your `ContextStartedListener` `@Component` is created. You can use `SpringApplication.addListeners` if you want to listen for early events.","title":"ContextStartedEvent not firing in custom listener","body":"<p>Answer by Phil Webb (from the Spring team) on <a href=\"https://github.com/spring-projects/spring-boot/issues/27945\" rel=\"nofollow noreferrer\">a similar issue</a> on their GitHub:</p>\n<blockquote>\n<p>The <code>ContextStartedEvent</code> is being published, but it's before any beans are registered so it's already happened by the time your <code>ContextStartedListener</code> <code>@Component</code> is created. You can use <code>SpringApplication.addListeners</code> if you want to listen for early events.</p>\n</blockquote>\n"}],"owner":{"account_id":4081547,"reputation":4204,"user_id":3351924,"accept_rate":89,"display_name":"secondbreakfast"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":8836,"favorite_count":0,"down_vote_count":0,"up_vote_count":12,"accepted_answer_id":48104439,"answer_count":2,"score":12,"last_activity_date":1701109974,"creation_date":1515082809,"question_id":48099355,"body_markdown":"I am trying to hook into the creation of the context using a custom application listener like this\r\n\r\n    @Component\r\n    public class ContextStartedListener implements ApplicationListener&lt;ContextStartedEvent&gt; {\r\n    \r\n        @Override\r\n        public void onApplicationEvent(ContextStartedEvent event) {\r\n            System.out.println(&quot;Context started&quot;); // this never happens\r\n        }\r\n    }\r\n\r\nBut the `onApplicationEvent` method never fires. If I use a different event such as `ContextRefreshedEvent` then it works just fine, but I need to hook into before it is created. Any advice? Thanks!","title":"ContextStartedEvent not firing in custom listener","body":"<p>I am trying to hook into the creation of the context using a custom application listener like this</p>\n\n<pre><code>@Component\npublic class ContextStartedListener implements ApplicationListener&lt;ContextStartedEvent&gt; {\n\n    @Override\n    public void onApplicationEvent(ContextStartedEvent event) {\n        System.out.println(\"Context started\"); // this never happens\n    }\n}\n</code></pre>\n\n<p>But the <code>onApplicationEvent</code> method never fires. If I use a different event such as <code>ContextRefreshedEvent</code> then it works just fine, but I need to hook into before it is created. Any advice? Thanks!</p>\n"},{"tags":["java","spring","spring-security"],"comments":[{"owner":{"account_id":1114420,"reputation":726,"user_id":1104124,"display_name":"brunocrt"},"score":0,"creation_date":1701109894,"post_id":77559124,"comment_id":136731959,"body_markdown":"I solved the issue reading the spring security configuration migrations page at https://docs.spring.io/spring-security/reference/5.8/migration/servlet/config.html basically I was combining wrongly the anyRequest method, so I just removed it","body":"I solved the issue reading the spring security configuration migrations page at <a href=\"https://docs.spring.io/spring-security/reference/5.8/migration/servlet/config.html\" rel=\"nofollow noreferrer\">docs.spring.io/spring-security/reference/5.8/migration/servl&zwnj;&#8203;et/&hellip;</a> basically I was combining wrongly the anyRequest method, so I just removed it"},{"owner":{"account_id":477214,"reputation":5260,"user_id":888580,"display_name":"lane.maxwell"},"score":1,"creation_date":1701109946,"post_id":77559124,"comment_id":136731968,"body_markdown":"The `anyRequest()` doesn&#39;t make sense here.  Also, come to think of it, it doesn&#39;t make sense for the `/api` endpoints either.  Do you really want to ignore security for `/api`?","body":"The <code>anyRequest()</code> doesn&#39;t make sense here.  Also, come to think of it, it doesn&#39;t make sense for the <code>&#47;api</code> endpoints either.  Do you really want to ignore security for <code>&#47;api</code>?"},{"owner":{"account_id":1114420,"reputation":726,"user_id":1104124,"display_name":"brunocrt"},"score":0,"creation_date":1701110030,"post_id":77559124,"comment_id":136731978,"body_markdown":"it was just for testing the application not for deploying it for any official environment","body":"it was just for testing the application not for deploying it for any official environment"}],"owner":{"account_id":1114420,"reputation":726,"user_id":1104124,"display_name":"brunocrt"},"comment_count":3,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":40,"favorite_count":0,"down_vote_count":2,"up_vote_count":0,"answer_count":0,"score":-2,"last_activity_date":1701109235,"creation_date":1701109235,"question_id":77559124,"body_markdown":"I&#39;m creating a Spring Boot configuration to allow/ignore HTTP requests to a specific path using the new WebSecurityCustomizer class from Spring Security 5.4 that deprecated the class WebSecurityConfigurerAdapter.\r\n\r\n```\r\n@Configuration\r\npublic class ApplicationConfiguration {\r\n    @Bean\r\n    public WebSecurityCustomizer webSecurityCustomizer() {\r\n        return (web) -&gt; web.ignoring().anyRequest().requestMatchers(&quot;/&quot;, &quot;/api&quot;);\r\n    }\r\n}\r\n```\r\n\r\nWhen I start the spring boot application it give the following Runtime error message\r\n\r\n\r\n```\r\n\tCaused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [jakarta.servlet.Filter]: Factory method &#39;springSecurityFilterChain&#39; threw exception with message: Can&#39;t configure mvcMatchers after anyRequest\r\n\t\tat org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:171)\r\n\t\tat org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:650)\r\n\t\t... 21 common frames omitted\r\n\tCaused by: java.lang.IllegalStateException: Can&#39;t configure mvcMatchers after anyRequest\r\n\t\tat org.springframework.util.Assert.state(Assert.java:76)\r\n\t\tat org.springframework.security.config.annotation.web.AbstractRequestMatcherRegistry.createMvcMatchers(AbstractRequestMatcherRegistry.java:105)\r\n\t\tat org.springframework.security.config.annotation.web.AbstractRequestMatcherRegistry.requestMatchers(AbstractRequestMatcherRegistry.java:210)\r\n\t\tat org.springframework.security.config.annotation.web.AbstractRequestMatcherRegistry.requestMatchers(AbstractRequestMatcherRegistry.java:276)\r\n```\r\n\r\n\t ","title":"How to solve java.lang.IllegalStateException: Can&#39;t configure mvcMatchers after anyRequest error?","body":"<p>I'm creating a Spring Boot configuration to allow/ignore HTTP requests to a specific path using the new WebSecurityCustomizer class from Spring Security 5.4 that deprecated the class WebSecurityConfigurerAdapter.</p>\n<pre><code>@Configuration\npublic class ApplicationConfiguration {\n    @Bean\n    public WebSecurityCustomizer webSecurityCustomizer() {\n        return (web) -&gt; web.ignoring().anyRequest().requestMatchers(&quot;/&quot;, &quot;/api&quot;);\n    }\n}\n</code></pre>\n<p>When I start the spring boot application it give the following Runtime error message</p>\n<pre><code>    Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [jakarta.servlet.Filter]: Factory method 'springSecurityFilterChain' threw exception with message: Can't configure mvcMatchers after anyRequest\n        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:171)\n        at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:650)\n        ... 21 common frames omitted\n    Caused by: java.lang.IllegalStateException: Can't configure mvcMatchers after anyRequest\n        at org.springframework.util.Assert.state(Assert.java:76)\n        at org.springframework.security.config.annotation.web.AbstractRequestMatcherRegistry.createMvcMatchers(AbstractRequestMatcherRegistry.java:105)\n        at org.springframework.security.config.annotation.web.AbstractRequestMatcherRegistry.requestMatchers(AbstractRequestMatcherRegistry.java:210)\n        at org.springframework.security.config.annotation.web.AbstractRequestMatcherRegistry.requestMatchers(AbstractRequestMatcherRegistry.java:276)\n</code></pre>\n"},{"tags":["java","android","audio","repeat"],"answers":[{"comments":[{"owner":{"account_id":29983605,"reputation":11,"user_id":22978063,"display_name":"Adham Ahmed"},"score":0,"creation_date":1701056919,"post_id":77553415,"comment_id":136723540,"body_markdown":"is that kotlin or java?","body":"is that kotlin or java?"},{"owner":{"account_id":29983605,"reputation":11,"user_id":22978063,"display_name":"Adham Ahmed"},"score":0,"creation_date":1701091800,"post_id":77553415,"comment_id":136728216,"body_markdown":"i dont really understand how i should use this sorry.","body":"i dont really understand how i should use this sorry."}],"tags":[],"owner":{"account_id":1790714,"reputation":91128,"user_id":1631193,"accept_rate":71,"display_name":"Gabe Sechan"},"comment_count":2,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1701031463,"creation_date":1701031162,"answer_id":77553415,"question_id":77553004,"body_markdown":"You should never make more than one MediaPlayer, they&#39;re heavyweight objects and take a lot of resources.  Instead, make a single media player, and use setDataSource to change the sound it&#39;s set to play (you need to stop the original sound first of course).\r\n\r\nThen the next thing to change is to structure your data.  Create a map of ids to sounds:\r\n\r\n    Map&lt;Int, Int&gt; sounds = new HashMap();\r\n    sounds.put(button1id, R.raw.hannaba);\r\n    sounds.put(button2id, R.raw.mannaba);\r\n    ...\r\n\r\nThen you can have a single click function:\r\n\r\n    public void buttonClick(View view) {\r\n       mediaPlayer.stop()\r\n       mediaPlayer.setDataSource(sounds.get(view.getId())\r\n       mediaPlayer.start()\r\n    }\r\n\r\nSet that as the onClickListener of all the buttons you want to act like that, and you only have to write it once.\r\n\r\n\r\n\r\n","title":"How to make an audio stop when another audio starts (bulk alot of audios)","body":"<p>You should never make more than one MediaPlayer, they're heavyweight objects and take a lot of resources.  Instead, make a single media player, and use setDataSource to change the sound it's set to play (you need to stop the original sound first of course).</p>\n<p>Then the next thing to change is to structure your data.  Create a map of ids to sounds:</p>\n<pre><code>Map&lt;Int, Int&gt; sounds = new HashMap();\nsounds.put(button1id, R.raw.hannaba);\nsounds.put(button2id, R.raw.mannaba);\n...\n</code></pre>\n<p>Then you can have a single click function:</p>\n<pre><code>public void buttonClick(View view) {\n   mediaPlayer.stop()\n   mediaPlayer.setDataSource(sounds.get(view.getId())\n   mediaPlayer.start()\n}\n</code></pre>\n<p>Set that as the onClickListener of all the buttons you want to act like that, and you only have to write it once.</p>\n"},{"tags":[],"owner":{"account_id":29439484,"reputation":94,"user_id":22557788,"display_name":"Davit Hovhannisyan"},"comment_count":0,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1701108818,"creation_date":1701108818,"answer_id":77559084,"question_id":77553004,"body_markdown":"Try this way:\r\n\r\n    public void button1Text(View view) {\r\n        if (media2 != null &amp;&amp; media2.isPlaying()) {\r\n            media2.stop();\r\n            media2.release();\r\n        }\r\n    \r\n        media1 = MediaPlayer.create(QuranJ30MA.this, R.raw.hannaba);\r\n        media1.start();\r\n    }\r\n    \r\n    public void button2Text(View view) {\r\n        if (media1 != null &amp;&amp; media1.isPlaying()) {\r\n            media1.stop();\r\n            media1.release();\r\n        }\r\n    \r\n        media2 = MediaPlayer.create(QuranJ30MA.this, R.raw.mannaba);\r\n        media2.start();\r\n    }\r\n\r\n","title":"How to make an audio stop when another audio starts (bulk alot of audios)","body":"<p>Try this way:</p>\n<pre><code>public void button1Text(View view) {\n    if (media2 != null &amp;&amp; media2.isPlaying()) {\n        media2.stop();\n        media2.release();\n    }\n\n    media1 = MediaPlayer.create(QuranJ30MA.this, R.raw.hannaba);\n    media1.start();\n}\n\npublic void button2Text(View view) {\n    if (media1 != null &amp;&amp; media1.isPlaying()) {\n        media1.stop();\n        media1.release();\n    }\n\n    media2 = MediaPlayer.create(QuranJ30MA.this, R.raw.mannaba);\n    media2.start();\n}\n</code></pre>\n"}],"owner":{"account_id":29983605,"reputation":11,"user_id":22978063,"display_name":"Adham Ahmed"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":46,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":2,"score":0,"last_activity_date":1701108818,"creation_date":1701024054,"question_id":77553004,"body_markdown":"I have 30-31 buttons and i want one to play at a time so if i click on a button it will play then when i click on the other button that one stops no matter which one it is it will stop this is the sample of the code its basically like this all through and repeats but just the numbers change hence 1,2,3,4 etc etc. :\r\n\r\n\r\n```\r\n    public void Button1Text(View view) {\r\n        Media1 = MediaPlayer.create(QuranJ30MA.this, R.raw.hannaba);\r\n        Media1.start();\r\n    }\r\n\r\n    public void Button1Text2(View view) {\r\n        Button1p = MediaPlayer.create(QuranJ30MA.this, R.raw.mannaba);\r\n        Button1p.start();\r\n    }\r\n```\r\n\r\n\r\nI did try to look at others which wanted to do the same but since i am not very good with java I couldnt understand how to apply it on mine please also explain how it works if its not too much to ask i just want to learn thank you :)","title":"How to make an audio stop when another audio starts (bulk alot of audios)","body":"<p>I have 30-31 buttons and i want one to play at a time so if i click on a button it will play then when i click on the other button that one stops no matter which one it is it will stop this is the sample of the code its basically like this all through and repeats but just the numbers change hence 1,2,3,4 etc etc. :</p>\n<pre><code>    public void Button1Text(View view) {\n        Media1 = MediaPlayer.create(QuranJ30MA.this, R.raw.hannaba);\n        Media1.start();\n    }\n\n    public void Button1Text2(View view) {\n        Button1p = MediaPlayer.create(QuranJ30MA.this, R.raw.mannaba);\n        Button1p.start();\n    }\n</code></pre>\n<p>I did try to look at others which wanted to do the same but since i am not very good with java I couldnt understand how to apply it on mine please also explain how it works if its not too much to ask i just want to learn thank you :)</p>\n"},{"tags":["java","visual-studio-code"],"comments":[{"owner":{"account_id":6606677,"reputation":1024,"user_id":5103317,"display_name":"Old Dog Programmer"},"score":1,"creation_date":1701108713,"post_id":77559033,"comment_id":136731748,"body_markdown":"Have you checked Stack Overflow to see if there have previously been questions about failure to find or load main class? https://stackoverflow.com/questions/18093928/what-does-could-not-find-or-load-main-class-mean","body":"Have you checked Stack Overflow to see if there have previously been questions about failure to find or load main class? <a href=\"https://stackoverflow.com/questions/18093928/what-does-could-not-find-or-load-main-class-mean\" title=\"what does could not find or load main class mean\">stackoverflow.com/questions/18093928/&hellip;</a>"},{"owner":{"account_id":25311208,"reputation":7305,"user_id":19133920,"display_name":"JialeDu"},"score":1,"creation_date":1701162369,"post_id":77559033,"comment_id":136738059,"body_markdown":"How do you execute the code? You can look at [this document](https://code.visualstudio.com/docs/java/java-tutorial) first.","body":"How do you execute the code? You can look at <a href=\"https://code.visualstudio.com/docs/java/java-tutorial\" rel=\"nofollow noreferrer\">this document</a> first."}],"owner":{"account_id":30006296,"reputation":1,"user_id":22995118,"display_name":"Nilkamal Sau"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":44,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701108376,"creation_date":1701108107,"question_id":77559033,"body_markdown":"The program is lacking details, it is showing \r\n\r\nI tried-\r\n\r\n```\r\nimport java.lang.*;\r\n\r\nclass nir4{\r\n    public static void main(String args[]){\r\n        System.out.print(&quot;hi&quot;);\r\n    }\r\n}\r\n```\r\nBut out&gt; put came - \r\n\r\n```none\r\nC:\\Users\\Admin\\Documents\\.vscode\\.vscode&gt;  &amp; &#39;C:\\Program Files\\Eclipse Adoptium\\jdk-17.0.8.7-hotspot\\bin\\java.exe&#39; &#39;-XX:+ShowCodeDetailsInExceptionMessages&#39; &#39;-cp&#39; &#39;C:\\Users\\Admin\\AppData\\Roaming\\Code\\User\\workspaceStorage\\eedc908950fb8b2a0402f354e7b375a7\\redhat.java\\jdt_ws\\jdt.ls-java-project\\bin&#39; &#39;nir4&#39;\r\n\r\nError: Could not find or load main class nir4    \r\n\r\nCaused by: java.lang.ClassNotFoundException: nir4[text]\r\n(https://stackoverflow.com)\r\n```\r\n","title":"Why is it showing error after windows update in vs code while Java programming","body":"<p>The program is lacking details, it is showing</p>\n<p>I tried-</p>\n<pre><code>import java.lang.*;\n\nclass nir4{\n    public static void main(String args[]){\n        System.out.print(&quot;hi&quot;);\n    }\n}\n</code></pre>\n<p>But out&gt; put came -</p>\n<pre class=\"lang-none prettyprint-override\"><code>C:\\Users\\Admin\\Documents\\.vscode\\.vscode&gt;  &amp; 'C:\\Program Files\\Eclipse Adoptium\\jdk-17.0.8.7-hotspot\\bin\\java.exe' '-XX:+ShowCodeDetailsInExceptionMessages' '-cp' 'C:\\Users\\Admin\\AppData\\Roaming\\Code\\User\\workspaceStorage\\eedc908950fb8b2a0402f354e7b375a7\\redhat.java\\jdt_ws\\jdt.ls-java-project\\bin' 'nir4'\n\nError: Could not find or load main class nir4    \n\nCaused by: java.lang.ClassNotFoundException: nir4[text]\n(https://stackoverflow.com)\n</code></pre>\n"},{"tags":["java","caching","java-8","caffeine-cache"],"answers":[{"comments":[{"owner":{"account_id":4890986,"reputation":1123,"user_id":3942132,"display_name":"Roie Beck"},"score":0,"creation_date":1624474287,"post_id":68105121,"comment_id":120372218,"body_markdown":"Thanks @Ben Manes, caffeine ia great, say another request if I may, would it be possible to add an addedListener that will run on the same executor service as the removeListener, currently I have to call runAsync manually every time I want to fire an event after adding it to the cache, an addListener will solve this ugly method... Can it be done?","body":"Thanks @Ben Manes, caffeine ia great, say another request if I may, would it be possible to add an addedListener that will run on the same executor service as the removeListener, currently I have to call runAsync manually every time I want to fire an event after adding it to the cache, an addListener will solve this ugly method... Can it be done?"},{"owner":{"account_id":10326,"reputation":9293,"user_id":19450,"display_name":"Ben Manes"},"score":1,"creation_date":1624474869,"post_id":68105121,"comment_id":120372455,"body_markdown":"Listeners are a slippery slope (add, update, replace, etc), so only removal is provided as often needed for cleanup. If you think of the cache as a fancy `ConcurrentHashMap` (which `cache.asMap()` is), then you wouldn&#39;t expect a listener on it natively. You might use a decorator to add it or do so in your code. We try to only implement advanced features, where simple cases can be left to user code as there is no ambiguity of the behavior.","body":"Listeners are a slippery slope (add, update, replace, etc), so only removal is provided as often needed for cleanup. If you think of the cache as a fancy <code>ConcurrentHashMap</code> (which <code>cache.asMap()</code> is), then you wouldn&#39;t expect a listener on it natively. You might use a decorator to add it or do so in your code. We try to only implement advanced features, where simple cases can be left to user code as there is no ambiguity of the behavior."},{"owner":{"account_id":4890986,"reputation":1123,"user_id":3942132,"display_name":"Roie Beck"},"score":0,"creation_date":1624517259,"post_id":68105121,"comment_id":120381133,"body_markdown":"tnx for the response @Ben Manes, last question, In case of java 8(no Sys.scheduler),\nis there any added benefits to use a multiple thread pool scheduler and not a single threaded scheduler? the way I see it any pool bigger than 1 even for multiple caffeine caches(lets say ~5) is an over kill, or am I mistaken?","body":"tnx for the response @Ben Manes, last question, In case of java 8(no Sys.scheduler), is there any added benefits to use a multiple thread pool scheduler and not a single threaded scheduler? the way I see it any pool bigger than 1 even for multiple caffeine caches(lets say ~5) is an over kill, or am I mistaken?"},{"owner":{"account_id":10326,"reputation":9293,"user_id":19450,"display_name":"Ben Manes"},"score":1,"creation_date":1624519897,"post_id":68105121,"comment_id":120382059,"body_markdown":"@RoieBeck You&#39;re right, and the recommended Java 9+ system scheduler is single threaded. Similarly, you may not need a powerful `Executor` as the cache&#39;s own work is very cheap, but we don&#39;t know the cost of user callbacks (like your removal listener). You can use a direct executor (`Runnable::run`) that runs on the calling thread and most of the time that is perfectly fine.","body":"@RoieBeck You&#39;re right, and the recommended Java 9+ system scheduler is single threaded. Similarly, you may not need a powerful <code>Executor</code> as the cache&#39;s own work is very cheap, but we don&#39;t know the cost of user callbacks (like your removal listener). You can use a direct executor (<code>Runnable::run</code>) that runs on the calling thread and most of the time that is perfectly fine."}],"tags":[],"owner":{"account_id":10326,"reputation":9293,"user_id":19450,"display_name":"Ben Manes"},"comment_count":4,"down_vote_count":0,"up_vote_count":5,"is_accepted":true,"score":5,"last_activity_date":1701108166,"creation_date":1624471793,"answer_id":68105121,"question_id":68101454,"body_markdown":"Your assumption is close, except that it is slightly more optimized in practice.\r\n\r\n1. Cache reads and writes are performed on the underlying hash table and appended to internal ring buffers.\r\n2. When the buffers reach thresholds then a task is submitted to `Caffeine.executor` to call `Cache.cleanUp`. \r\n3. When this maintenance cycle runs (under a lock),\r\n    - The buffers are drained and the events replayed against the eviction policies (e.g. LRU reordering)\r\n    - Any evictable entry is discarded and a task is submitted to `Caffeine.executor` to call `RemovalListener.onRemoval`.\r\n    - The duration until the next entry will expire is [calculated][calculated] and submitted to the scheduler. This is guarded by a [pacer][pacer] so avoid excessive scheduling by ensuring that ~1s occurs between scheduled tasks.\r\n4. When the scheduler runs, a task is submitted to `Caffeine.executor` to call `Cache.cleanUp` (see #3).\r\n\r\nThe scheduler does the minimal amount of work and any processing is deferred to the executor. That maintenance work is cheap due to using O(1) algorithms so it may occur often based on the usage activity. It is optimized for small batches of work, so the enforced ~1s delay between scheduled calls helps capture more work per invocation. If the next expiration event is in the distant future then the scheduler won&#39;t run until then, though calling threads may trigger a maintenance cycle due to their activity on the cache (see #1,2).\r\n\r\n[calculated]: https://github.com/ben-manes/caffeine/blob/7bca129d01c9b6a3cb16454e2fa5ee0f4d00dd31/caffeine/src/main/java/com/github/benmanes/caffeine/cache/BoundedLocalCache.java#L835-L851 \r\n[pacer]: https://github.com/ben-manes/caffeine/blob/master/caffeine/src/main/java/com/github/benmanes/caffeine/cache/Pacer.java","title":"Caffeine combining both scheduler and executor service","body":"<p>Your assumption is close, except that it is slightly more optimized in practice.</p>\n<ol>\n<li>Cache reads and writes are performed on the underlying hash table and appended to internal ring buffers.</li>\n<li>When the buffers reach thresholds then a task is submitted to <code>Caffeine.executor</code> to call <code>Cache.cleanUp</code>.</li>\n<li>When this maintenance cycle runs (under a lock),\n<ul>\n<li>The buffers are drained and the events replayed against the eviction policies (e.g. LRU reordering)</li>\n<li>Any evictable entry is discarded and a task is submitted to <code>Caffeine.executor</code> to call <code>RemovalListener.onRemoval</code>.</li>\n<li>The duration until the next entry will expire is <a href=\"https://github.com/ben-manes/caffeine/blob/7bca129d01c9b6a3cb16454e2fa5ee0f4d00dd31/caffeine/src/main/java/com/github/benmanes/caffeine/cache/BoundedLocalCache.java#L835-L851\" rel=\"nofollow noreferrer\">calculated</a> and submitted to the scheduler. This is guarded by a <a href=\"https://github.com/ben-manes/caffeine/blob/master/caffeine/src/main/java/com/github/benmanes/caffeine/cache/Pacer.java\" rel=\"nofollow noreferrer\">pacer</a> so avoid excessive scheduling by ensuring that ~1s occurs between scheduled tasks.</li>\n</ul>\n</li>\n<li>When the scheduler runs, a task is submitted to <code>Caffeine.executor</code> to call <code>Cache.cleanUp</code> (see #3).</li>\n</ol>\n<p>The scheduler does the minimal amount of work and any processing is deferred to the executor. That maintenance work is cheap due to using O(1) algorithms so it may occur often based on the usage activity. It is optimized for small batches of work, so the enforced ~1s delay between scheduled calls helps capture more work per invocation. If the next expiration event is in the distant future then the scheduler won't run until then, though calling threads may trigger a maintenance cycle due to their activity on the cache (see #1,2).</p>\n"}],"owner":{"account_id":4890986,"reputation":1123,"user_id":3942132,"display_name":"Roie Beck"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":2695,"favorite_count":0,"down_vote_count":0,"up_vote_count":2,"accepted_answer_id":68105121,"answer_count":1,"score":2,"last_activity_date":1701108166,"creation_date":1624457215,"question_id":68101454,"body_markdown":"I am using caffeine in the following configuration:\r\n\r\n```\r\n    Cache&lt;String, String&gt; cache = Caffeine.newBuilder()\r\n                .executor(newWorkStealingPool(15))\r\n                .scheduler(createScheduler())\r\n                .expireAfterWrite(10, TimeUnit.SECONDS)\r\n                .maximumSize(MAXIMUM_CACHE_SIZE)\r\n                .removalListener(this::onRemoval)\r\n                .build();\r\n\r\n\r\n    private Scheduler createScheduler() {\r\n        return forScheduledExecutorService(newSingleThreadScheduledExecutor());\r\n    }\r\n```\r\n\r\nwill I be correct to assume that ```onRemoval``` method will be executed on the ```newWorkStealingPool(15)``` ForkJoinPool, and the scheduler will be invoked only to find the expired entries that needs to be evicted? \r\n\r\nmeaning it will go something like this:\r\n\r\n\r\n1. single thread scheduler is invoked (every  ~ 1 second)\r\n2. find all the expired entries to be evicted \r\n3. execute onRemoval for each of the evicted entries in the ```newWorkStealingPool(15)``` define in the cache builder?\r\n\r\nI didn&#39;t found documentation that explains this behavior, so I am asking here\r\n\r\nTnx ","title":"Caffeine combining both scheduler and executor service","body":"<p>I am using caffeine in the following configuration:</p>\n<pre><code>    Cache&lt;String, String&gt; cache = Caffeine.newBuilder()\n                .executor(newWorkStealingPool(15))\n                .scheduler(createScheduler())\n                .expireAfterWrite(10, TimeUnit.SECONDS)\n                .maximumSize(MAXIMUM_CACHE_SIZE)\n                .removalListener(this::onRemoval)\n                .build();\n\n\n    private Scheduler createScheduler() {\n        return forScheduledExecutorService(newSingleThreadScheduledExecutor());\n    }\n</code></pre>\n<p>will I be correct to assume that <code>onRemoval</code> method will be executed on the <code>newWorkStealingPool(15)</code> ForkJoinPool, and the scheduler will be invoked only to find the expired entries that needs to be evicted?</p>\n<p>meaning it will go something like this:</p>\n<ol>\n<li>single thread scheduler is invoked (every  ~ 1 second)</li>\n<li>find all the expired entries to be evicted</li>\n<li>execute onRemoval for each of the evicted entries in the <code>newWorkStealingPool(15)</code> define in the cache builder?</li>\n</ol>\n<p>I didn't found documentation that explains this behavior, so I am asking here</p>\n<p>Tnx</p>\n"},{"tags":["java","maven","spring-boot"],"comments":[{"owner":{"account_id":115767,"reputation":42976,"user_id":303810,"accept_rate":84,"display_name":"lexicore"},"score":0,"creation_date":1524413196,"post_id":49967207,"comment_id":86951583,"body_markdown":"First, any particular reason you need a `SNAPSHOT` version?","body":"First, any particular reason you need a <code>SNAPSHOT</code> version?"},{"owner":{"account_id":115767,"reputation":42976,"user_id":303810,"accept_rate":84,"display_name":"lexicore"},"score":0,"creation_date":1524413225,"post_id":49967207,"comment_id":86951592,"body_markdown":"Second, try with direct connection, without a proxy. Most of the time the problem is in the proxy.","body":"Second, try with direct connection, without a proxy. Most of the time the problem is in the proxy."},{"owner":{"account_id":13413346,"reputation":11,"user_id":9678891,"display_name":"elham"},"score":0,"creation_date":1524424632,"post_id":49967207,"comment_id":86955513,"body_markdown":"that is just a blind copy. i need to work with spring-boot immediately for a little project. but i dont know maven well.","body":"that is just a blind copy. i need to work with spring-boot immediately for a little project. but i dont know maven well."},{"owner":{"account_id":13413346,"reputation":11,"user_id":9678891,"display_name":"elham"},"score":0,"creation_date":1524425044,"post_id":49967207,"comment_id":86955653,"body_markdown":"this is the error i get without settings.xml.                                       Non-resolvable import POM:could not transfer artifact org.springframework.boot:spring-boot-dependencies:pom:2.1.0.BUILD-SNAPSHOT from/to spring-snapshots &lt;https://repo.spring.io/snapshot&gt; Access denied to: https://repo.spring.io/snapshot/org/springframework/boot/spring-boot-dependencies/2.1.0.BUILD-SNAPSHOT/spring-boot-dependencies-2.1.0.BUILD-SNAPSHOT.pom, ReasonPhrase:Forbidden @line 20 column 15","body":"this is the error i get without settings.xml.                                       Non-resolvable import POM:could not transfer artifact org.springframework.boot:spring-boot-dependencies:pom:2.1.0.&zwnj;&#8203;BUILD-SNAPSHOT from/to spring-snapshots &lt;<a href=\"https://repo.spring.io/snapshot\" rel=\"nofollow noreferrer\">repo.spring.io/snapshot</a>&gt; Access denied to: <a href=\"https://repo.spring.io/snapshot/org/springframework/boot/spring-boot-dependencies/2.1.0.BUILD-SNAPSHOT/spring-boot-dependencies-2.1.0.BUILD-SNAPSHOT.pom\" rel=\"nofollow noreferrer\">repo.spring.io/snapshot/org/springframework/boot/&hellip;</a>, ReasonPhrase:Forbidden @line 20 column 15"},{"owner":{"account_id":115767,"reputation":42976,"user_id":303810,"accept_rate":84,"display_name":"lexicore"},"score":0,"creation_date":1524426188,"post_id":49967207,"comment_id":86955981,"body_markdown":"So maybe you *don&#39;t* need the `SNAPSHOT` version in first place? Try `2.0.1.RELEASE` - it is available from the central Maven repo.","body":"So maybe you <i>don&#39;t</i> need the <code>SNAPSHOT</code> version in first place? Try <code>2.0.1.RELEASE</code> - it is available from the central Maven repo."}],"answers":[{"tags":[],"owner":{"account_id":13825062,"reputation":1,"user_id":9979606,"display_name":"Vidhyo kochi"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1529688853,"creation_date":1529688853,"answer_id":50993028,"question_id":49967207,"body_markdown":"I faced the same issue. Got it resolved by adding maven-compiler-plugin in POM for java version 1.8 followed by a Maven force update.\r\n\r\n    &lt;plugin&gt;\r\n    \t&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\r\n    \t&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\r\n    \t&lt;configuration&gt;\r\n    \t  &lt;source&gt;1.8&lt;/source&gt;\r\n    \t  &lt;target&gt;1.8&lt;/target&gt;\r\n    \t&lt;/configuration&gt;\r\n    &lt;/plugin&gt;\r\n\r\nInitially I configured my web project&#39;s JRE System library from SE 1.5 to 1.8 through IDE. But after updating project from Maven ( project -&gt; Maven -&gt; Update), the system library was automatically returning to older version - 1.5. \r\n\r\nAs spring boot 2.1.0 requires JDK 1.8+, added the compiler plugin and updated the project. It worked.","title":"Non-resolvable parent POM: Could not transfer artifact org.springframework.boot:spring-boot-dependencies:pom","body":"<p>I faced the same issue. Got it resolved by adding maven-compiler-plugin in POM for java version 1.8 followed by a Maven force update.</p>\n\n<pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n    &lt;configuration&gt;\n      &lt;source&gt;1.8&lt;/source&gt;\n      &lt;target&gt;1.8&lt;/target&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;\n</code></pre>\n\n<p>Initially I configured my web project's JRE System library from SE 1.5 to 1.8 through IDE. But after updating project from Maven ( project -> Maven -> Update), the system library was automatically returning to older version - 1.5. </p>\n\n<p>As spring boot 2.1.0 requires JDK 1.8+, added the compiler plugin and updated the project. It worked.</p>\n"}],"owner":{"account_id":13413346,"reputation":11,"user_id":9678891,"display_name":"elham"},"comment_count":5,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":8257,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701108125,"creation_date":1524408484,"question_id":49967207,"body_markdown":"this is my pom.xml where i copied from [here][1]\r\n\r\n    &lt;groupId&gt;com.example&lt;/groupId&gt;\r\n\t&lt;artifactId&gt;myproject&lt;/artifactId&gt;\r\n\t&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\r\n\r\n\t&lt;dependencyManagement&gt;\r\n\t&lt;dependencies&gt;\r\n\t\t&lt;!-- Override Spring Data release train provided by Spring Boot --&gt;\r\n\t\t&lt;dependency&gt;\r\n\t\t\t&lt;groupId&gt;org.springframework.data&lt;/groupId&gt;\r\n\t\t\t&lt;artifactId&gt;spring-data-releasetrain&lt;/artifactId&gt;\r\n\t\t\t&lt;version&gt;Fowler-SR2&lt;/version&gt;\r\n\t\t\t&lt;type&gt;pom&lt;/type&gt;\r\n\t\t\t&lt;scope&gt;import&lt;/scope&gt;\r\n\t\t&lt;/dependency&gt;\r\n\t\t&lt;dependency&gt;\r\n\t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n\t\t\t&lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;\r\n\t\t\t&lt;version&gt;2.1.0.BUILD-SNAPSHOT&lt;/version&gt;\r\n\t\t\t&lt;type&gt;pom&lt;/type&gt;\r\n\t\t\t&lt;scope&gt;import&lt;/scope&gt;\r\n\t\t&lt;/dependency&gt;\r\n\t&lt;/dependencies&gt;\r\n&lt;/dependencyManagement&gt;\r\n\r\n\t&lt;!-- Additional lines to be added here... --&gt;\r\n\r\n\t&lt;!-- (you don&#39;t need this if you are using a .RELEASE version) --&gt;\r\n\t&lt;repositories&gt;\r\n\t\t&lt;repository&gt;\r\n\t\t\t&lt;id&gt;spring-snapshots&lt;/id&gt;\r\n\t\t\t&lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;\r\n\t\t\t&lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;\r\n\t\t&lt;/repository&gt;\r\n\t\t&lt;repository&gt;\r\n\t\t\t&lt;id&gt;spring-milestones&lt;/id&gt;\r\n\t\t\t&lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;\r\n\t\t&lt;/repository&gt;\r\n\t&lt;/repositories&gt;\r\n\t&lt;pluginRepositories&gt;\r\n\t\t&lt;pluginRepository&gt;\r\n\t\t\t&lt;id&gt;spring-snapshots&lt;/id&gt;\r\n\t\t\t&lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;\r\n\t\t&lt;/pluginRepository&gt;\r\n\t\t&lt;pluginRepository&gt;\r\n\t\t\t&lt;id&gt;spring-milestones&lt;/id&gt;\r\n\t\t\t&lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;\r\n\t\t&lt;/pluginRepository&gt;\r\n\t&lt;/pluginRepositories&gt;\r\nwhen i write mvn package in command line i get the following error:\r\n\r\nNon-resolvable import POM:could not transfer artifact org.springframework.boot:spring-boot-dependencies:pom:2.1.0.BUILD-SNAPSHOT from/to spring-snapshots&lt;https://repo.spring.io/snapshot&gt; proxy.example.com @line 20 column 15\r\n\r\nand i also add a settings.xml in my home/.m2 with the following code\r\n\r\n   \r\n  \r\n\r\n    &lt;proxies&gt;\r\n       &lt;proxy&gt;\r\n          &lt;id&gt;example-proxy&lt;/id&gt;\r\n          &lt;active&gt;true&lt;/active&gt;\r\n          &lt;protocol&gt;http&lt;/protocol&gt;\r\n          &lt;host&gt;proxy.example.com&lt;/host&gt;\r\n          &lt;port&gt;8080&lt;/port&gt;          \r\n          &lt;nonProxyHosts&gt;www.google.com|*.example.com&lt;/nonProxyHosts&gt;\r\n        &lt;/proxy&gt;\r\n      &lt;/proxies&gt;\r\n\r\n\r\n  [1]: https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-documentation-getting-help\r\n","title":"Non-resolvable parent POM: Could not transfer artifact org.springframework.boot:spring-boot-dependencies:pom","body":"<p>this is my pom.xml where i copied from <a href=\"https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-documentation-getting-help\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>&lt;groupId&gt;com.example&lt;/groupId&gt;\n&lt;artifactId&gt;myproject&lt;/artifactId&gt;\n&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n\n&lt;dependencyManagement&gt;\n&lt;dependencies&gt;\n    &lt;!-- Override Spring Data release train provided by Spring Boot --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-data-releasetrain&lt;/artifactId&gt;\n        &lt;version&gt;Fowler-SR2&lt;/version&gt;\n        &lt;type&gt;pom&lt;/type&gt;\n        &lt;scope&gt;import&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;\n        &lt;version&gt;2.1.0.BUILD-SNAPSHOT&lt;/version&gt;\n        &lt;type&gt;pom&lt;/type&gt;\n        &lt;scope&gt;import&lt;/scope&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre>\n\n<p></p>\n\n<pre><code>&lt;!-- Additional lines to be added here... --&gt;\n\n&lt;!-- (you don't need this if you are using a .RELEASE version) --&gt;\n&lt;repositories&gt;\n    &lt;repository&gt;\n        &lt;id&gt;spring-snapshots&lt;/id&gt;\n        &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;\n        &lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;\n    &lt;/repository&gt;\n    &lt;repository&gt;\n        &lt;id&gt;spring-milestones&lt;/id&gt;\n        &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;\n    &lt;/repository&gt;\n&lt;/repositories&gt;\n&lt;pluginRepositories&gt;\n    &lt;pluginRepository&gt;\n        &lt;id&gt;spring-snapshots&lt;/id&gt;\n        &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;\n    &lt;/pluginRepository&gt;\n    &lt;pluginRepository&gt;\n        &lt;id&gt;spring-milestones&lt;/id&gt;\n        &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;\n    &lt;/pluginRepository&gt;\n&lt;/pluginRepositories&gt;\n</code></pre>\n\n<p>when i write mvn package in command line i get the following error:</p>\n\n<p>Non-resolvable import POM:could not transfer artifact org.springframework.boot:spring-boot-dependencies:pom:2.1.0.BUILD-SNAPSHOT from/to spring-snapshots<a href=\"https://repo.spring.io/snapshot\" rel=\"nofollow noreferrer\">https://repo.spring.io/snapshot</a> proxy.example.com @line 20 column 15</p>\n\n<p>and i also add a settings.xml in my home/.m2 with the following code</p>\n\n<pre><code>&lt;proxies&gt;\n   &lt;proxy&gt;\n      &lt;id&gt;example-proxy&lt;/id&gt;\n      &lt;active&gt;true&lt;/active&gt;\n      &lt;protocol&gt;http&lt;/protocol&gt;\n      &lt;host&gt;proxy.example.com&lt;/host&gt;\n      &lt;port&gt;8080&lt;/port&gt;          \n      &lt;nonProxyHosts&gt;www.google.com|*.example.com&lt;/nonProxyHosts&gt;\n    &lt;/proxy&gt;\n  &lt;/proxies&gt;\n</code></pre>\n"},{"tags":["java","mysql","servlets","taglib"],"owner":{"account_id":30006094,"reputation":1,"user_id":22994959,"display_name":"Dương Đức"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":30,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"closed_date":1701107492,"answer_count":0,"score":-1,"last_activity_date":1701107722,"creation_date":1701106281,"question_id":77558861,"body_markdown":"[enter image description here](https://i.stack.imgur.com/YfCiP.png)\r\nMy Tomcat local server doesn&#39;t see my MySQL database problem...\r\n&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;\r\n\t\tConnection c = null;\r\n\t\t\r\n\t\tString url = &quot;jdbc:mysql:://localhost:3306/db_khoangsan&quot;;\r\n\t\tString user = &quot;root&quot;;\r\n\t\tString password = &quot;29012020&quot;;\r\n\t\t\r\n\t\ttry {\r\n\t\t\tClass.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);\r\n\t\t\tc = DriverManager.getConnection( url, user, password);\r\n\t\t} catch (SQLException e) {\r\n\t\t\te.printStackTrace();\r\n\t\t\t// TODO: handle exception\r\n\t}\r\n\r\n","title":"I am using Tomcat 8.5.96 and I cannot connect JDBC to my database with Tomcat. My Tomcat local server doesn&#39;t see my MySQL database problem","body":"<p><a href=\"https://i.stack.imgur.com/YfCiP.png\" rel=\"nofollow noreferrer\">enter image description here</a>\nMy Tomcat local server doesn't see my MySQL database problem...\n&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;\nConnection c = null;</p>\n<pre><code>    String url = &quot;jdbc:mysql:://localhost:3306/db_khoangsan&quot;;\n    String user = &quot;root&quot;;\n    String password = &quot;29012020&quot;;\n    \n    try {\n        Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);\n        c = DriverManager.getConnection( url, user, password);\n    } catch (SQLException e) {\n        e.printStackTrace();\n        // TODO: handle exception\n}\n</code></pre>\n"},{"tags":["java","spring","microservices","spring-cloud"],"comments":[{"owner":{"account_id":7783967,"reputation":360,"user_id":5889494,"display_name":"Arpit"},"score":0,"creation_date":1701101605,"post_id":77558341,"comment_id":136730431,"body_markdown":"This question seems more suited for the SE stack exchange - https://softwareengineering.stackexchange.com/","body":"This question seems more suited for the SE stack exchange - <a href=\"https://softwareengineering.stackexchange.com/\">softwareengineering.stackexchange.com</a>"}],"answers":[{"tags":[],"owner":{"account_id":3618847,"reputation":867,"user_id":17695211,"display_name":"Alexey Veleshko"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701106148,"creation_date":1701106148,"answer_id":77558848,"question_id":77558341,"body_markdown":"Normally a user in the authentication service is identified by a unique synthetic key (user ID) which is created during the user registration. You can store the value of this key in your `createdBy` column of the product service. The necessary key should be passed to the product service as an argument of its REST API.\r\n\r\nIf case the product service needs more information about the user than just that user ID, you should foresee a dedicated REST API endpoint in the authentication service which returns the necessary info by the user ID.\r\n\r\nI believe you should look into Spring Security, it supports many typical authentication workflows. For more info see, for example, a [series of videos](https://www.youtube.com/playlist?list=PLEocw3gLFc8XRaRBZkhBEZ_R3tmvfkWZz) by Laurentiu Spilca on the subject, particularly regarding OAuth2 authentication server.\r\n","title":"How to share data between other microservices in spring boot?","body":"<p>Normally a user in the authentication service is identified by a unique synthetic key (user ID) which is created during the user registration. You can store the value of this key in your <code>createdBy</code> column of the product service. The necessary key should be passed to the product service as an argument of its REST API.</p>\n<p>If case the product service needs more information about the user than just that user ID, you should foresee a dedicated REST API endpoint in the authentication service which returns the necessary info by the user ID.</p>\n<p>I believe you should look into Spring Security, it supports many typical authentication workflows. For more info see, for example, a <a href=\"https://www.youtube.com/playlist?list=PLEocw3gLFc8XRaRBZkhBEZ_R3tmvfkWZz\" rel=\"nofollow noreferrer\">series of videos</a> by Laurentiu Spilca on the subject, particularly regarding OAuth2 authentication server.</p>\n"},{"tags":[],"owner":{"account_id":308139,"reputation":8199,"user_id":619830,"accept_rate":75,"display_name":"ch4mp"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1701107419,"creation_date":1701107093,"answer_id":77558942,"question_id":77558341,"body_markdown":"Your use case is typically what OAuth2 solves: you `authenticate` service looks pretty much like an *OAuth2 authorization server* and your `product` service like an *OAuth2 resource server*.\r\n\r\nIf you had an *OAuth2 client* (like the gateway could be), then it could get an access token from the authorization server and authorize its requests to the resource server using this token. Resource server gets the info it needs about the client and the resource owner (authenticated user in your case) from the token (decoding it if it&#39;s a JWT or introspecting it on the authorization server otherwize).\r\n\r\nThe bad news is you can probably trash your `authenticate` service as OIDC providers like Keycloak or cloud offers like Cognito, Auth0, Okta, etc. do probably more and better than what you did. The good news being that this services exist already, actually do a lot (user registration, clients management, identity federation, multi-factor authentication, ...), are well documented, and are not that difficult to configure.\r\n\r\nMore details in my [OAuth2 essentials](https://github.com/ch4mpy/spring-addons/tree/master/samples/tutorials#oauth_essentials) and tutorials.","title":"How to share data between other microservices in spring boot?","body":"<p>Your use case is typically what OAuth2 solves: you <code>authenticate</code> service looks pretty much like an <em>OAuth2 authorization server</em> and your <code>product</code> service like an <em>OAuth2 resource server</em>.</p>\n<p>If you had an <em>OAuth2 client</em> (like the gateway could be), then it could get an access token from the authorization server and authorize its requests to the resource server using this token. Resource server gets the info it needs about the client and the resource owner (authenticated user in your case) from the token (decoding it if it's a JWT or introspecting it on the authorization server otherwize).</p>\n<p>The bad news is you can probably trash your <code>authenticate</code> service as OIDC providers like Keycloak or cloud offers like Cognito, Auth0, Okta, etc. do probably more and better than what you did. The good news being that this services exist already, actually do a lot (user registration, clients management, identity federation, multi-factor authentication, ...), are well documented, and are not that difficult to configure.</p>\n<p>More details in my <a href=\"https://github.com/ch4mpy/spring-addons/tree/master/samples/tutorials#oauth_essentials\" rel=\"nofollow noreferrer\">OAuth2 essentials</a> and tutorials.</p>\n"}],"owner":{"account_id":17514675,"reputation":23,"user_id":12701892,"display_name":"Nam Nguyen"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":65,"favorite_count":0,"down_vote_count":4,"up_vote_count":1,"closed_date":1701109131,"answer_count":2,"score":-3,"last_activity_date":1701107419,"creation_date":1701101418,"question_id":77558341,"body_markdown":"I am learning about microservices through spring boot cloud. I have 2 services `authenticate` and `product` and I call them both through the `gateway`, I encounter the following problem:\r\n\r\n - How can the product service know which user has logged in from the    authenticate service and retrieve that user&#39;s login information?\r\n\r\n - In the `product service`, I have a `products table` and it has a `createdBy column` that is the user stored in the `users table` at the `authenticate service`. How can I get creator information when getting list of products similar to Left Join?\r\n\r\n - How to share data between other services?\r\n              \r\nIn my project, each service will have a separate database, is that optimal?\r\n\r\nI&#39;ve been working on this for a few hours and still have no results, it seems quite difficult to do. Select the solution you&#39;re using. Thank you and happy coding\r\n","title":"How to share data between other microservices in spring boot?","body":"<p>I am learning about microservices through spring boot cloud. I have 2 services <code>authenticate</code> and <code>product</code> and I call them both through the <code>gateway</code>, I encounter the following problem:</p>\n<ul>\n<li><p>How can the product service know which user has logged in from the    authenticate service and retrieve that user's login information?</p>\n</li>\n<li><p>In the <code>product service</code>, I have a <code>products table</code> and it has a <code>createdBy column</code> that is the user stored in the <code>users table</code> at the <code>authenticate service</code>. How can I get creator information when getting list of products similar to Left Join?</p>\n</li>\n<li><p>How to share data between other services?</p>\n</li>\n</ul>\n<p>In my project, each service will have a separate database, is that optimal?</p>\n<p>I've been working on this for a few hours and still have no results, it seems quite difficult to do. Select the solution you're using. Thank you and happy coding</p>\n"},{"tags":["java","serializable"],"comments":[{"owner":{"account_id":85947,"reputation":5959,"user_id":239333,"accept_rate":95,"display_name":"Ritwik Bose"},"score":12,"creation_date":1281174073,"post_id":3429921,"comment_id":3571652,"body_markdown":"@skaffman Here&#39;s what it says for the class `Serializable`:\n\n`Serializability of a class is enabled by the class implementing the java.io.Serializable interface. Classes that do not implement this interface will not have any of their state serialized or deserialized. All subtypes of a serializable class are themselves serializable. The serialization interface has no methods or fields and serves only to identify the semantics of being serializable.`","body":"@skaffman Here&#39;s what it says for the class <code>Serializable</code>:  <code>Serializability of a class is enabled by the class implementing the java.io.Serializable interface. Classes that do not implement this interface will not have any of their state serialized or deserialized. All subtypes of a serializable class are themselves serializable. The serialization interface has no methods or fields and serves only to identify the semantics of being serializable.</code>"},{"owner":{"account_id":541586,"reputation":15722,"user_id":910201,"accept_rate":73,"display_name":"Xonatron"},"score":41,"creation_date":1329239218,"post_id":3429921,"comment_id":11701534,"body_markdown":"A great explanation if you already know what serialized and deserialized mean. (Not a compliment.) Such definitions help you understand the issue better technically once, and only once, you already have some knowledge on it.","body":"A great explanation if you already know what serialized and deserialized mean. (Not a compliment.) Such definitions help you understand the issue better technically once, and only once, you already have some knowledge on it."},{"owner":{"account_id":9288944,"reputation":1498,"user_id":6897913,"display_name":"linjiejun"},"score":0,"creation_date":1609222680,"post_id":3429921,"comment_id":115779986,"body_markdown":"@RitwikBose So , java.io.Serializable is a tag interface","body":"@RitwikBose So , java.io.Serializable is a tag interface"},{"owner":{"account_id":8782213,"reputation":972,"user_id":6565511,"accept_rate":100,"display_name":"Nathan majicvr.com"},"score":0,"creation_date":1673310785,"post_id":3429921,"comment_id":132466036,"body_markdown":"If you&#39;re new to java. This is a practical application of polymorphism. If a class implements an interface then that class can be passed on to anywhere its parent can be accepted as arguments. In this case the child class could be passed on to functions like Results.writeOutput(Serializable s)","body":"If you&#39;re new to java. This is a practical application of polymorphism. If a class implements an interface then that class can be passed on to anywhere its parent can be accepted as arguments. In this case the child class could be passed on to functions like Results.writeOutput(Serializable s)"}],"answers":[{"tags":[],"owner":{"account_id":65027,"reputation":2841,"user_id":191641,"display_name":"David"},"comment_count":0,"down_vote_count":0,"up_vote_count":43,"is_accepted":false,"score":43,"last_activity_date":1281173947,"creation_date":1281173947,"answer_id":3429935,"question_id":3429921,"body_markdown":"It means that instances of the class can be turned into a byte-stream (for example, to be saved to a file) and then converted back into classes again. This reloading could happen in a different instance of the program, or even on a different machine. Serialisation (in any language) involves all sorts of issues, though, especially when you&#39;ve got references to other objects inside the serialisable one.","title":"What does Serializable mean?","body":"<p>It means that instances of the class can be turned into a byte-stream (for example, to be saved to a file) and then converted back into classes again. This reloading could happen in a different instance of the program, or even on a different machine. Serialisation (in any language) involves all sorts of issues, though, especially when you've got references to other objects inside the serialisable one.</p>\n"},{"comments":[{"owner":{"account_id":21994,"reputation":73808,"user_id":53897,"accept_rate":56,"display_name":"Thorbj&#248;rn Ravn Andersen"},"score":2,"creation_date":1281179236,"post_id":3429939,"comment_id":3571938,"body_markdown":"Also note that all fields not explicitly marked otherwise will be serialized too.  This means that you can save a complex datastructure easily just by serializing the root object.","body":"Also note that all fields not explicitly marked otherwise will be serialized too.  This means that you can save a complex datastructure easily just by serializing the root object."},{"owner":{"account_id":13832275,"reputation":561,"user_id":9984792,"display_name":"Vandrey"},"score":1,"creation_date":1584714435,"post_id":3429939,"comment_id":107528789,"body_markdown":"So when we&#39;re talking about &quot;Objects&quot;, do we mean the object instantiated by a class, or just any &quot;Software Objects&quot; like assemblies, files, etc.? And if its the latter, is it just a standardized way of sending data between programs and environments?","body":"So when we&#39;re talking about &quot;Objects&quot;, do we mean the object instantiated by a class, or just any &quot;Software Objects&quot; like assemblies, files, etc.? And if its the latter, is it just a standardized way of sending data between programs and environments?"},{"owner":{"account_id":1190,"reputation":492175,"user_id":1583,"accept_rate":100,"display_name":"Oded"},"score":1,"creation_date":1584715085,"post_id":3429939,"comment_id":107529109,"body_markdown":"@Sunburst275 - in this case, this is the in memory representation of a class in memory - i.e. an instance of a class (there isn&#39;t a real point to talking about serialization of assemblies, as they are usually on disk as files which can simply be sent around as is).","body":"@Sunburst275 - in this case, this is the in memory representation of a class in memory - i.e. an instance of a class (there isn&#39;t a real point to talking about serialization of assemblies, as they are usually on disk as files which can simply be sent around as is)."}],"tags":[],"owner":{"account_id":1190,"reputation":492175,"user_id":1583,"accept_rate":100,"display_name":"Oded"},"comment_count":3,"down_vote_count":2,"up_vote_count":160,"is_accepted":true,"score":158,"last_activity_date":1473776577,"creation_date":1281174009,"answer_id":3429939,"question_id":3429921,"body_markdown":"[Serialization][1] is persisting an object from memory to a sequence of bits, for instance for saving onto the disk. Deserialization is the opposite - reading data from the disk to hydrate/create an object.\r\n\r\nIn the context of your question, it is an interface that if implemented in a class, this class can automatically be serialized and deserialized by different serializers.\r\n\r\n\r\n  [1]: http://en.wikipedia.org/wiki/Serialization","title":"What does Serializable mean?","body":"<p><a href=\"http://en.wikipedia.org/wiki/Serialization\">Serialization</a> is persisting an object from memory to a sequence of bits, for instance for saving onto the disk. Deserialization is the opposite - reading data from the disk to hydrate/create an object.</p>\n\n<p>In the context of your question, it is an interface that if implemented in a class, this class can automatically be serialized and deserialized by different serializers.</p>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":6,"creation_date":1281186546,"post_id":3429940,"comment_id":3572348,"body_markdown":"It is not a &#39;flag to the compiler&#39;. It is a flag to the Serialization subsystem, at runtime.","body":"It is not a &#39;flag to the compiler&#39;. It is a flag to the Serialization subsystem, at runtime."},{"owner":{"account_id":66751,"reputation":401,"user_id":195674,"accept_rate":100,"display_name":"AphexMunky"},"score":21,"creation_date":1281273492,"post_id":3429940,"comment_id":3577512,"body_markdown":"If I hadn&#39;t of wrote it I wouldn&#39;t of been corrected and would be worse off. All the other answers have left off transient too. You didn&#39;t even write an answer, you&#39;re just trolling other peoples.","body":"If I hadn&#39;t of wrote it I wouldn&#39;t of been corrected and would be worse off. All the other answers have left off transient too. You didn&#39;t even write an answer, you&#39;re just trolling other peoples."}],"tags":[],"owner":{"account_id":66751,"reputation":401,"user_id":195674,"accept_rate":100,"display_name":"AphexMunky"},"comment_count":2,"down_vote_count":2,"up_vote_count":8,"is_accepted":false,"score":6,"last_activity_date":1596093115,"creation_date":1281174018,"answer_id":3429940,"question_id":3429921,"body_markdown":"Serializable is called in like an interface but its more like a flag to the the Serialization subsystem, at runtime. It says this object can be saved. All the Objects instance variables with the exception of none serializable objects and ones mark volatile will be saved.\r\n\r\nImagine your application can change colour as an option, without keeping that setting external you would need to change the colour every time you ran it.","title":"What does Serializable mean?","body":"<p>Serializable is called in like an interface but its more like a flag to the the Serialization subsystem, at runtime. It says this object can be saved. All the Objects instance variables with the exception of none serializable objects and ones mark volatile will be saved.</p>\n<p>Imagine your application can change colour as an option, without keeping that setting external you would need to change the colour every time you ran it.</p>\n"},{"comments":[{"owner":{"account_id":15115227,"reputation":25341,"user_id":10907864,"display_name":"Promise Preston"},"score":1,"creation_date":1566044388,"post_id":3429969,"comment_id":101537019,"body_markdown":"This definition seems more precise. Thank you.","body":"This definition seems more precise. Thank you."}],"tags":[],"owner":{"account_id":95910,"reputation":238649,"user_id":260990,"accept_rate":81,"display_name":"jmj"},"comment_count":1,"down_vote_count":1,"up_vote_count":14,"is_accepted":false,"score":13,"last_activity_date":1281174460,"creation_date":1281174460,"answer_id":3429969,"question_id":3429921,"body_markdown":"Serialization involves saving the current state of an object to a stream, and restoring an equivalent object from that stream. The stream functions as a container for the object","title":"What does Serializable mean?","body":"<p>Serialization involves saving the current state of an object to a stream, and restoring an equivalent object from that stream. The stream functions as a container for the object</p>\n"},{"tags":[],"owner":{"account_id":10725,"reputation":9219,"user_id":20388,"accept_rate":100,"display_name":"Greg Sexton"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1281182008,"creation_date":1281182008,"answer_id":3430300,"question_id":3429921,"body_markdown":"Just to add to the other answers and with regards to generality. Serialization is sometimes known as archiving, for example in Objective-C. ","title":"What does Serializable mean?","body":"<p>Just to add to the other answers and with regards to generality. Serialization is sometimes known as archiving, for example in Objective-C. </p>\n"},{"tags":[],"owner":{"account_id":1003835,"reputation":1376,"user_id":1018075,"accept_rate":74,"display_name":"Mdhar9e"},"comment_count":0,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1326445827,"creation_date":1326445827,"answer_id":8848161,"question_id":3429921,"body_markdown":"Serialization is a technique to storing or writing  the objects and data in to files. By using `ObjectOutputStream` and `FileOutputStream` classes. These classes having their specific methods to persist the objects. like `writeObject();`\r\n\r\nfor clear explantaion with figures . [See Here for more info][1]\r\n\r\n\r\n  [1]: http://javabynataraj.blogspot.com/2011/04/what-is-serialization-write-simple.html","title":"What does Serializable mean?","body":"<p>Serialization is a technique to storing or writing  the objects and data in to files. By using <code>ObjectOutputStream</code> and <code>FileOutputStream</code> classes. These classes having their specific methods to persist the objects. like <code>writeObject();</code></p>\n\n<p>for clear explantaion with figures . <a href=\"http://javabynataraj.blogspot.com/2011/04/what-is-serialization-write-simple.html\" rel=\"nofollow\">See Here for more info</a></p>\n"},{"tags":[],"owner":{"account_id":920174,"reputation":3438,"user_id":951984,"accept_rate":50,"display_name":"nanospeck"},"comment_count":0,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1401702592,"creation_date":1401702075,"answer_id":23991535,"question_id":3429921,"body_markdown":"To present from another perspective. Serialization is a kind of interface called &#39;marker interface&#39;. A marker interface is an interface that contains no method declarations, but\r\nmerely designates (or “marks”) a class that implements the interface as having\r\nsome property. If you understand polymorphism this will make very much sense. In the case of the Serializable marker interface, the ObjectOutputStream.write(Object) method will fail if its argument does not implement the interface. This is a potential mistake in java, it could have been ObjectOutputStream.write(Serializable) \r\n\r\nHighly Recommended : Reading Item 37 from **Effective Java by Joshua Bloch** to learn more. ","title":"What does Serializable mean?","body":"<p>To present from another perspective. Serialization is a kind of interface called 'marker interface'. A marker interface is an interface that contains no method declarations, but\nmerely designates (or “marks”) a class that implements the interface as having\nsome property. If you understand polymorphism this will make very much sense. In the case of the Serializable marker interface, the ObjectOutputStream.write(Object) method will fail if its argument does not implement the interface. This is a potential mistake in java, it could have been ObjectOutputStream.write(Serializable) </p>\n\n<p>Highly Recommended : Reading Item 37 from <strong>Effective Java by Joshua Bloch</strong> to learn more. </p>\n"},{"comments":[{"owner":{"account_id":13832275,"reputation":561,"user_id":9984792,"display_name":"Vandrey"},"score":0,"creation_date":1584716042,"post_id":32182901,"comment_id":107529606,"body_markdown":"Thank you. I think I got it now.","body":"Thank you. I think I got it now."},{"owner":{"account_id":13210522,"reputation":414,"user_id":9540910,"display_name":"Collin"},"score":0,"creation_date":1674781914,"post_id":32182901,"comment_id":132792090,"body_markdown":"So basically you can only print an object to a file in the form of its object properties if you add &quot;implements Serializable&quot; to the beginning of your Java class? ok...","body":"So basically you can only print an object to a file in the form of its object properties if you add &quot;implements Serializable&quot; to the beginning of your Java class? ok..."}],"tags":[],"owner":{"account_id":1465379,"reputation":28229,"user_id":1378388,"accept_rate":92,"display_name":"William Kinaan"},"comment_count":2,"down_vote_count":0,"up_vote_count":53,"is_accepted":false,"score":53,"last_activity_date":1440420964,"creation_date":1440420964,"answer_id":32182901,"question_id":3429921,"body_markdown":"Though most of the users have already given the answer, but I would like to add an example for those who need it in order to explain the idea:\r\n\r\nLet&#39;s say you have a class person like the following:\r\n\r\n    public class Person implements java.io.Serializable {\r\n    \t/**\r\n    \t * \r\n    \t */\r\n    \tprivate static final long serialVersionUID = 1L;\r\n    \tpublic String firstName;\r\n    \tpublic String lastName;\r\n    \tpublic int age;\r\n    \tpublic String address;\r\n    \r\n    \tpublic void play() {\r\n    \t\tSystem.out.println(String.format(\r\n    \t\t\t\t&quot;If I win, send me the trophy to this address: %s&quot;, address));\r\n    \t}\r\n    \t@Override\r\n    \tpublic String toString() {\r\n    \t\treturn String.format(&quot;.....Person......\\nFirst Name = %s\\nLast Name = %s&quot;, firstName, lastName);\r\n    \t}\r\n    }\r\n\r\nand then you create an object like this:\r\n\r\n    Person william = new Person();\r\n    \t\twilliam.firstName = &quot;William&quot;;\r\n    \t\twilliam.lastName = &quot;Kinaan&quot;;\r\n    \t\twilliam.age = 26;\r\n    \t\twilliam.address = &quot;Lisbon, Portugal&quot;;\r\n\r\nYou can serialise that object to many streams. I will do that to two streams:\r\n\r\n**Serialization to standard output:**\r\n\r\n    public static void serializeToStandardOutput(Person person)\r\n    \t\t\tthrows IOException {\r\n    \t\tOutputStream outStream = System.out;\r\n    \t\tObjectOutputStream stdObjectOut = new ObjectOutputStream(outStream);\r\n    \t\tstdObjectOut.writeObject(person);\r\n    \t\tstdObjectOut.close();\r\n    \t\toutStream.close();\r\n    \t}\r\n\r\n**Serialization to a file:**\r\n\r\n    public static void serializeToFile(Person person) throws IOException {\r\n    \t\tOutputStream outStream = new FileOutputStream(&quot;person.ser&quot;);\r\n    \t\tObjectOutputStream fileObjectOut = new ObjectOutputStream(outStream);\r\n    \t\tfileObjectOut.writeObject(person);\r\n    \t\tfileObjectOut.close();\r\n    \t\toutStream.close();\r\n    \t}\r\nThen:\r\n\r\n**Deserialize from file:**\r\n\r\n    public static void deserializeFromFile() throws IOException,\r\n    \t\t\tClassNotFoundException {\r\n    \t\tInputStream inStream = new FileInputStream(&quot;person.ser&quot;);\r\n    \t\tObjectInputStream fileObjectIn = new ObjectInputStream(inStream);\r\n    \t\tPerson person = (Person) fileObjectIn.readObject();\r\n    \t\tSystem.out.println(person);\r\n    \t\tfileObjectIn.close();\r\n    \t\tinStream.close();\r\n    \t}","title":"What does Serializable mean?","body":"<p>Though most of the users have already given the answer, but I would like to add an example for those who need it in order to explain the idea:</p>\n\n<p>Let's say you have a class person like the following:</p>\n\n<pre><code>public class Person implements java.io.Serializable {\n    /**\n     * \n     */\n    private static final long serialVersionUID = 1L;\n    public String firstName;\n    public String lastName;\n    public int age;\n    public String address;\n\n    public void play() {\n        System.out.println(String.format(\n                \"If I win, send me the trophy to this address: %s\", address));\n    }\n    @Override\n    public String toString() {\n        return String.format(\".....Person......\\nFirst Name = %s\\nLast Name = %s\", firstName, lastName);\n    }\n}\n</code></pre>\n\n<p>and then you create an object like this:</p>\n\n<pre><code>Person william = new Person();\n        william.firstName = \"William\";\n        william.lastName = \"Kinaan\";\n        william.age = 26;\n        william.address = \"Lisbon, Portugal\";\n</code></pre>\n\n<p>You can serialise that object to many streams. I will do that to two streams:</p>\n\n<p><strong>Serialization to standard output:</strong></p>\n\n<pre><code>public static void serializeToStandardOutput(Person person)\n            throws IOException {\n        OutputStream outStream = System.out;\n        ObjectOutputStream stdObjectOut = new ObjectOutputStream(outStream);\n        stdObjectOut.writeObject(person);\n        stdObjectOut.close();\n        outStream.close();\n    }\n</code></pre>\n\n<p><strong>Serialization to a file:</strong></p>\n\n<pre><code>public static void serializeToFile(Person person) throws IOException {\n        OutputStream outStream = new FileOutputStream(\"person.ser\");\n        ObjectOutputStream fileObjectOut = new ObjectOutputStream(outStream);\n        fileObjectOut.writeObject(person);\n        fileObjectOut.close();\n        outStream.close();\n    }\n</code></pre>\n\n<p>Then:</p>\n\n<p><strong>Deserialize from file:</strong></p>\n\n<pre><code>public static void deserializeFromFile() throws IOException,\n            ClassNotFoundException {\n        InputStream inStream = new FileInputStream(\"person.ser\");\n        ObjectInputStream fileObjectIn = new ObjectInputStream(inStream);\n        Person person = (Person) fileObjectIn.readObject();\n        System.out.println(person);\n        fileObjectIn.close();\n        inStream.close();\n    }\n</code></pre>\n"},{"tags":[],"owner":{"account_id":3291773,"reputation":3668,"user_id":2769917,"accept_rate":65,"display_name":"Asif Mushtaq"},"comment_count":0,"down_vote_count":0,"up_vote_count":3,"is_accepted":false,"score":3,"last_activity_date":1445798931,"creation_date":1445798931,"answer_id":33333604,"question_id":3429921,"body_markdown":"**Serialization:** Writing State of Object to File/Network or anywhere. ( Mean Java Object Supported form to File Supported Form or Network Supported Form )\r\n\r\n**Deserialization:** Reading State of Object from File/Network or anywhere. ( Mean File/Network Supported form to Java Object Supported Form )","title":"What does Serializable mean?","body":"<p><strong>Serialization:</strong> Writing State of Object to File/Network or anywhere. ( Mean Java Object Supported form to File Supported Form or Network Supported Form )</p>\n\n<p><strong>Deserialization:</strong> Reading State of Object from File/Network or anywhere. ( Mean File/Network Supported form to Java Object Supported Form )</p>\n"},{"comments":[{"owner":{"account_id":13832275,"reputation":561,"user_id":9984792,"display_name":"Vandrey"},"score":2,"creation_date":1584716392,"post_id":43622908,"comment_id":107529742,"body_markdown":"This is a nice explanation! Thank you! But to be honest, this entry looks much cleaner than the one on your blog. Anyways, this helped a lot!","body":"This is a nice explanation! Thank you! But to be honest, this entry looks much cleaner than the one on your blog. Anyways, this helped a lot!"}],"tags":[],"owner":{"account_id":1592127,"reputation":18171,"user_id":1475228,"accept_rate":84,"display_name":"Pritam Banerjee"},"comment_count":1,"down_vote_count":0,"up_vote_count":22,"is_accepted":false,"score":22,"last_activity_date":1493165460,"creation_date":1493165460,"answer_id":43622908,"question_id":3429921,"body_markdown":"[Here is a detailed explanation of the Serialization][1]: (my own blog)\r\n\r\n\r\n**Serialization:**\r\n\r\nSerialization is the process of serializing the state of an object is represented and stored in the form of a sequence of bytes. This can be stored in a file. The process to read the state of the object from the file and restoring it is called deserialization.\r\n\r\n\r\n**What is the need of Serialization?**\r\n\r\nIn modern day architecture, there is always a need to store object state and then retrieve it. For example in Hibernate, to store a object we should make the class Serializable. What it does, is that once the object state is saved in the form of bytes it can be transferred to another system which can then read from the state and retrieve the class. The object state can come from a database or a different jvm or from a separate component. With the help of Serialization we can retrieve the Object state.  \r\n\r\n\r\n**Code Example and explanation:**\r\n\r\nFirst let&#39;s have a look at the Item Class:\r\n\r\n    public class Item implements Serializable{\r\n    \r\n        /**\r\n        *  This is the Serializable class\r\n        */\r\n        private static final long serialVersionUID = 475918891428093041L;\r\n        private Long itemId;\r\n        private String itemName;\r\n        private transient Double itemCostPrice;\r\n        public Item(Long itemId, String itemName, Double itemCostPrice) {\r\n            super();\r\n            this.itemId = itemId;\r\n            this.itemName = itemName;\r\n            this.itemCostPrice = itemCostPrice;\r\n          }\r\n    \r\n          public Long getItemId() {\r\n              return itemId;\r\n          }\r\n    \r\n         @Override\r\n          public String toString() {\r\n              return &quot;Item [itemId=&quot; + itemId + &quot;, itemName=&quot; + itemName + &quot;, itemCostPrice=&quot; + itemCostPrice + &quot;]&quot;;\r\n           }\r\n    \r\n    \r\n           public void setItemId(Long itemId) {\r\n               this.itemId = itemId;\r\n           }\r\n    \r\n           public String getItemName() {\r\n               return itemName;\r\n           }\r\n           public void setItemName(String itemName) {\r\n                this.itemName = itemName;\r\n            }\r\n    \r\n           public Double getItemCostPrice() {\r\n                return itemCostPrice;\r\n            }\r\n    \r\n            public void setItemCostPrice(Double itemCostPrice) {\r\n                 this.itemCostPrice = itemCostPrice;\r\n            }\r\n    }\r\n\r\nIn the above code it can be seen that *Item* class implements *Serializable*. \r\n\r\nThis is the interface that enables a class to be serializable. \r\n\r\nNow we can see a variable called *serialVersionUID* is initialized to Long variable. This number is calculated by the compiler based on the state of the class and the class attributes. This is the number that will help the jvm identify the state of an object when it reads the state of the object from file. \r\n\r\nFor that we can have a look at the official Oracle Documentation:\r\n\r\n&gt; The serialization runtime associates with each serializable class a\r\n&gt; version number, called a serialVersionUID, which is used during\r\n&gt; deserialization to verify that the sender and receiver of a serialized\r\n&gt; object have loaded classes for that object that are compatible with\r\n&gt; respect to serialization. If the receiver has loaded a class for the\r\n&gt; object that has a different serialVersionUID than that of the\r\n&gt; corresponding sender&#39;s class, then deserialization will result in an\r\n&gt; InvalidClassException. A serializable class can declare its own\r\n&gt; serialVersionUID explicitly by declaring a field named\r\n&gt; &quot;serialVersionUID&quot; that must be static, final, and of type long:\r\n&gt; ANY-ACCESS-MODIFIER static final long serialVersionUID = 42L; If a\r\n&gt; serializable class does not explicitly declare a serialVersionUID,\r\n&gt; then the serialization runtime will calculate a default\r\n&gt; serialVersionUID value for that class based on various aspects of the\r\n&gt; class, as described in the Java(TM) Object Serialization\r\n&gt; Specification. However, it is strongly recommended that all\r\n&gt; serializable classes explicitly declare serialVersionUID values, since\r\n&gt; the default serialVersionUID computation is highly sensitive to class\r\n&gt; details that may vary depending on compiler implementations, and can\r\n&gt; thus result in unexpected InvalidClassExceptions during\r\n&gt; deserialization. Therefore, to guarantee a consistent serialVersionUID\r\n&gt; value across different java compiler implementations, a serializable\r\n&gt; class must declare an explicit serialVersionUID value. It is also\r\n&gt; strongly advised that explicit serialVersionUID declarations use the\r\n&gt; private modifier where possible, since such declarations apply only to\r\n&gt; the immediately declaring class--serialVersionUID fields are not\r\n&gt; useful as inherited members.\r\n\r\n\r\nIf you have noticed there is another keyword we have used which is *transient*.\r\n\r\nIf a field is not serializable, it must be marked transient. Here we marked the *itemCostPrice* as transient and don&#39;t want it to be written in a file\r\n\r\nNow let&#39;s have a look on how to write the state of an object in the file and then read it from there.\r\n\r\n    public class SerializationExample {\r\n    \r\n        public static void main(String[] args){\r\n            serialize();\r\n           deserialize();\r\n        } \r\n    \r\n        public static void serialize(){\r\n    \r\n             Item item = new Item(1L,&quot;Pen&quot;, 12.55);\r\n             System.out.println(&quot;Before Serialization&quot; + item);\r\n    \r\n             FileOutputStream fileOut;\r\n             try {\r\n                 fileOut = new FileOutputStream(&quot;/tmp/item.ser&quot;);\r\n                 ObjectOutputStream out = new ObjectOutputStream(fileOut);\r\n                 out.writeObject(item);\r\n                 out.close();\r\n                 fileOut.close();\r\n                 System.out.println(&quot;Serialized data is saved in /tmp/item.ser&quot;);\r\n               } catch (FileNotFoundException e) {\r\n    \r\n                      e.printStackTrace();\r\n               } catch (IOException e) {\r\n    \r\n                      e.printStackTrace();\r\n               }\r\n          }\r\n    \r\n        public static void deserialize(){\r\n            Item item;\r\n    \r\n            try {\r\n                    FileInputStream fileIn = new FileInputStream(&quot;/tmp/item.ser&quot;);\r\n                    ObjectInputStream in = new ObjectInputStream(fileIn);\r\n                    item = (Item) in.readObject();\r\n                    System.out.println(&quot;Serialized data is read from /tmp/item.ser&quot;);\r\n                    System.out.println(&quot;After Deserialization&quot; + item);\r\n            } catch (FileNotFoundException e) {\r\n                    e.printStackTrace();\r\n            } catch (IOException e) {\r\n                   e.printStackTrace();\r\n            } catch (ClassNotFoundException e) {\r\n                   e.printStackTrace();\r\n            }\r\n         }\r\n    }\r\n\r\nIn the above we can see an example of serialization and deserialization of an object. \r\n\r\nFor that we used two classes. For serializing the object we have used ObjectOutputStream. We have used the method writeObject to write the object in the file. \r\n\r\nFor Deserializing we have used ObjectInputStream which reads from the object from the file. It uses readObject to read the object data from the file. \r\n\r\nThe output of the above code would be like:\r\n\r\n    Before SerializationItem [itemId=1, itemName=Pen, itemCostPrice=12.55]\r\n    Serialized data is saved in /tmp/item.ser\r\n    After DeserializationItem [itemId=1, itemName=Pen, itemCostPrice=null]\r\n\r\nNotice that *itemCostPrice* from deserialized object is *null* as it was not written.\r\n\r\n\r\n  [1]: http://prinavtech.blogspot.com/2017/04/java-serialization-and-deserialization.html","title":"What does Serializable mean?","body":"<p><a href=\"http://prinavtech.blogspot.com/2017/04/java-serialization-and-deserialization.html\" rel=\"noreferrer\">Here is a detailed explanation of the Serialization</a>: (my own blog)</p>\n\n<p><strong>Serialization:</strong></p>\n\n<p>Serialization is the process of serializing the state of an object is represented and stored in the form of a sequence of bytes. This can be stored in a file. The process to read the state of the object from the file and restoring it is called deserialization.</p>\n\n<p><strong>What is the need of Serialization?</strong></p>\n\n<p>In modern day architecture, there is always a need to store object state and then retrieve it. For example in Hibernate, to store a object we should make the class Serializable. What it does, is that once the object state is saved in the form of bytes it can be transferred to another system which can then read from the state and retrieve the class. The object state can come from a database or a different jvm or from a separate component. With the help of Serialization we can retrieve the Object state.  </p>\n\n<p><strong>Code Example and explanation:</strong></p>\n\n<p>First let's have a look at the Item Class:</p>\n\n<pre><code>public class Item implements Serializable{\n\n    /**\n    *  This is the Serializable class\n    */\n    private static final long serialVersionUID = 475918891428093041L;\n    private Long itemId;\n    private String itemName;\n    private transient Double itemCostPrice;\n    public Item(Long itemId, String itemName, Double itemCostPrice) {\n        super();\n        this.itemId = itemId;\n        this.itemName = itemName;\n        this.itemCostPrice = itemCostPrice;\n      }\n\n      public Long getItemId() {\n          return itemId;\n      }\n\n     @Override\n      public String toString() {\n          return \"Item [itemId=\" + itemId + \", itemName=\" + itemName + \", itemCostPrice=\" + itemCostPrice + \"]\";\n       }\n\n\n       public void setItemId(Long itemId) {\n           this.itemId = itemId;\n       }\n\n       public String getItemName() {\n           return itemName;\n       }\n       public void setItemName(String itemName) {\n            this.itemName = itemName;\n        }\n\n       public Double getItemCostPrice() {\n            return itemCostPrice;\n        }\n\n        public void setItemCostPrice(Double itemCostPrice) {\n             this.itemCostPrice = itemCostPrice;\n        }\n}\n</code></pre>\n\n<p>In the above code it can be seen that <em>Item</em> class implements <em>Serializable</em>. </p>\n\n<p>This is the interface that enables a class to be serializable. </p>\n\n<p>Now we can see a variable called <em>serialVersionUID</em> is initialized to Long variable. This number is calculated by the compiler based on the state of the class and the class attributes. This is the number that will help the jvm identify the state of an object when it reads the state of the object from file. </p>\n\n<p>For that we can have a look at the official Oracle Documentation:</p>\n\n<blockquote>\n  <p>The serialization runtime associates with each serializable class a\n  version number, called a serialVersionUID, which is used during\n  deserialization to verify that the sender and receiver of a serialized\n  object have loaded classes for that object that are compatible with\n  respect to serialization. If the receiver has loaded a class for the\n  object that has a different serialVersionUID than that of the\n  corresponding sender's class, then deserialization will result in an\n  InvalidClassException. A serializable class can declare its own\n  serialVersionUID explicitly by declaring a field named\n  \"serialVersionUID\" that must be static, final, and of type long:\n  ANY-ACCESS-MODIFIER static final long serialVersionUID = 42L; If a\n  serializable class does not explicitly declare a serialVersionUID,\n  then the serialization runtime will calculate a default\n  serialVersionUID value for that class based on various aspects of the\n  class, as described in the Java(TM) Object Serialization\n  Specification. However, it is strongly recommended that all\n  serializable classes explicitly declare serialVersionUID values, since\n  the default serialVersionUID computation is highly sensitive to class\n  details that may vary depending on compiler implementations, and can\n  thus result in unexpected InvalidClassExceptions during\n  deserialization. Therefore, to guarantee a consistent serialVersionUID\n  value across different java compiler implementations, a serializable\n  class must declare an explicit serialVersionUID value. It is also\n  strongly advised that explicit serialVersionUID declarations use the\n  private modifier where possible, since such declarations apply only to\n  the immediately declaring class--serialVersionUID fields are not\n  useful as inherited members.</p>\n</blockquote>\n\n<p>If you have noticed there is another keyword we have used which is <em>transient</em>.</p>\n\n<p>If a field is not serializable, it must be marked transient. Here we marked the <em>itemCostPrice</em> as transient and don't want it to be written in a file</p>\n\n<p>Now let's have a look on how to write the state of an object in the file and then read it from there.</p>\n\n<pre><code>public class SerializationExample {\n\n    public static void main(String[] args){\n        serialize();\n       deserialize();\n    } \n\n    public static void serialize(){\n\n         Item item = new Item(1L,\"Pen\", 12.55);\n         System.out.println(\"Before Serialization\" + item);\n\n         FileOutputStream fileOut;\n         try {\n             fileOut = new FileOutputStream(\"/tmp/item.ser\");\n             ObjectOutputStream out = new ObjectOutputStream(fileOut);\n             out.writeObject(item);\n             out.close();\n             fileOut.close();\n             System.out.println(\"Serialized data is saved in /tmp/item.ser\");\n           } catch (FileNotFoundException e) {\n\n                  e.printStackTrace();\n           } catch (IOException e) {\n\n                  e.printStackTrace();\n           }\n      }\n\n    public static void deserialize(){\n        Item item;\n\n        try {\n                FileInputStream fileIn = new FileInputStream(\"/tmp/item.ser\");\n                ObjectInputStream in = new ObjectInputStream(fileIn);\n                item = (Item) in.readObject();\n                System.out.println(\"Serialized data is read from /tmp/item.ser\");\n                System.out.println(\"After Deserialization\" + item);\n        } catch (FileNotFoundException e) {\n                e.printStackTrace();\n        } catch (IOException e) {\n               e.printStackTrace();\n        } catch (ClassNotFoundException e) {\n               e.printStackTrace();\n        }\n     }\n}\n</code></pre>\n\n<p>In the above we can see an example of serialization and deserialization of an object. </p>\n\n<p>For that we used two classes. For serializing the object we have used ObjectOutputStream. We have used the method writeObject to write the object in the file. </p>\n\n<p>For Deserializing we have used ObjectInputStream which reads from the object from the file. It uses readObject to read the object data from the file. </p>\n\n<p>The output of the above code would be like:</p>\n\n<pre><code>Before SerializationItem [itemId=1, itemName=Pen, itemCostPrice=12.55]\nSerialized data is saved in /tmp/item.ser\nAfter DeserializationItem [itemId=1, itemName=Pen, itemCostPrice=null]\n</code></pre>\n\n<p>Notice that <em>itemCostPrice</em> from deserialized object is <em>null</em> as it was not written.</p>\n"},{"tags":[],"owner":{"account_id":2758007,"reputation":1760,"user_id":2375535,"accept_rate":57,"display_name":"Nomade"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1612458013,"creation_date":1612458013,"answer_id":66050293,"question_id":3429921,"body_markdown":"To serialize an object means to convert its state to a byte stream so that the byte stream can be reverted back into a copy of the object. A Java object is serializable if its class or any of its superclasses implements either the java.io.Serializable interface or its subinterface, java.io.Externalizable. Deserialization is the process of converting the serialized form of an object back into a copy of the object\r\n\r\nClick [here](https://docs.oracle.com/javase/tutorial/jndi/objects/serial.html#:~:text=To%20serialize%20an%20object%20means,interface%20or%20its%20subinterface%2C%20java) to see more.","title":"What does Serializable mean?","body":"<p>To serialize an object means to convert its state to a byte stream so that the byte stream can be reverted back into a copy of the object. A Java object is serializable if its class or any of its superclasses implements either the java.io.Serializable interface or its subinterface, java.io.Externalizable. Deserialization is the process of converting the serialized form of an object back into a copy of the object</p>\n<p>Click <a href=\"https://docs.oracle.com/javase/tutorial/jndi/objects/serial.html#:%7E:text=To%20serialize%20an%20object%20means,interface%20or%20its%20subinterface%2C%20java\" rel=\"nofollow noreferrer\">here</a> to see more.</p>\n"},{"tags":[],"owner":{"account_id":18552307,"reputation":441,"user_id":13518297,"display_name":"Ragab Mohamad"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1675777765,"creation_date":1675777765,"answer_id":75374284,"question_id":3429921,"body_markdown":"**Serialization** is used to export application data into a file.\r\n \r\n**deserialization** to extract the data from the application .\r\n\r\nExample : \r\n\r\n    namespace DemoApplication\r\n    {\r\n      [Serializable]\r\n      class Tutorial\r\n      {\r\n      public int ID;\r\n      public String Name;\r\n       static void Main(string[] args)\r\n       {\r\n        Tutorial obj = new Tutorial();\r\n        obj.ID = 1;\r\n        obj.Name = &quot;.Net&quot;;\r\n    \r\n        IFormatter formatter = new BinaryFormatter();\r\n        Stream stream = new FileStream(@&quot;E:\\ExampleNew.txt&quot;,FileMode.Create,FileAccess.Write);\r\n    \r\n        formatter.Serialize(stream, obj);\r\n        stream.Close();\r\n    \r\n        stream = new FileStream(@&quot;E:\\ExampleNew.txt&quot;,FileMode.Open,FileAccess.Read);\r\n        Tutorial objnew = (Tutorial)formatter.Deserialize(stream);\r\n    \r\n        Console.WriteLine(objnew.ID);\r\n        Console.WriteLine(objnew.Name);\r\n    \r\n        Console.ReadKey();\r\n      }\r\n     }\r\n    }","title":"What does Serializable mean?","body":"<p><strong>Serialization</strong> is used to export application data into a file.</p>\n<p><strong>deserialization</strong> to extract the data from the application .</p>\n<p>Example :</p>\n<pre><code>namespace DemoApplication\n{\n  [Serializable]\n  class Tutorial\n  {\n  public int ID;\n  public String Name;\n   static void Main(string[] args)\n   {\n    Tutorial obj = new Tutorial();\n    obj.ID = 1;\n    obj.Name = &quot;.Net&quot;;\n\n    IFormatter formatter = new BinaryFormatter();\n    Stream stream = new FileStream(@&quot;E:\\ExampleNew.txt&quot;,FileMode.Create,FileAccess.Write);\n\n    formatter.Serialize(stream, obj);\n    stream.Close();\n\n    stream = new FileStream(@&quot;E:\\ExampleNew.txt&quot;,FileMode.Open,FileAccess.Read);\n    Tutorial objnew = (Tutorial)formatter.Deserialize(stream);\n\n    Console.WriteLine(objnew.ID);\n    Console.WriteLine(objnew.Name);\n\n    Console.ReadKey();\n  }\n }\n}\n</code></pre>\n"},{"tags":[],"owner":{"account_id":11418021,"reputation":4780,"user_id":8370334,"display_name":"Abd Abughazaleh"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701107167,"creation_date":1701075581,"answer_id":77555620,"question_id":3429921,"body_markdown":"`Serializable` is an interface called `marker-interface` just to tell Java I want to make **serialization** and **de-serialization** using this Java calss.\r\n\r\n**Serialization:**\r\nWrite to the file or any other storage like a database.\r\n\r\n**De-serialization:** read from a file or any other storage like a database.","title":"What does Serializable mean?","body":"<p><code>Serializable</code> is an interface called <code>marker-interface</code> just to tell Java I want to make <strong>serialization</strong> and <strong>de-serialization</strong> using this Java calss.</p>\n<p><strong>Serialization:</strong>\nWrite to the file or any other storage like a database.</p>\n<p><strong>De-serialization:</strong> read from a file or any other storage like a database.</p>\n"}],"owner":{"account_id":85947,"reputation":5959,"user_id":239333,"accept_rate":95,"display_name":"Ritwik Bose"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":127989,"favorite_count":0,"down_vote_count":2,"up_vote_count":170,"accepted_answer_id":3429939,"answer_count":13,"score":168,"last_activity_date":1701107167,"creation_date":1281173768,"question_id":3429921,"body_markdown":"What exactly does it mean for a class to be `Serializable` in Java?  Or in general, for that matter... ","title":"What does Serializable mean?","body":"<p>What exactly does it mean for a class to be <code>Serializable</code> in Java?  Or in general, for that matter... </p>\n"},{"tags":["java","spring-security","single-sign-on","saml-2.0","spring-security-saml2"],"answers":[{"tags":[],"owner":{"account_id":24440940,"reputation":3132,"user_id":18364656,"display_name":"Andrei Lisa"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1701107144,"creation_date":1701107144,"answer_id":77558951,"question_id":77557593,"body_markdown":"As an answer to your question I want to say that \r\n\r\n    org.springframework.security.extensions:spring-security-saml2-core:2.0.0.M31\r\n\r\nand\r\n\r\n    org.springframework.security.extensions:%20spring-security-saml%3A1.0.10.RELEASE\r\n\r\nWere removed from support more details you will be able to find [spring-security-saml-extensions-1-x-eol-on-october-6-2021][1]\r\n\r\n\r\nIt could also be seeing into [maven repository][2]\r\n\r\n\r\nBased on it you have to use \r\n\r\n    org.springframework.security:spring-security-saml2-service-provider\r\n\r\nThat is currently maintained you can check it also on [maven central repository][3] \r\n\r\nAlso a reference to [documentation][4]\r\n\r\n\r\n  [1]: https://spring.io/blog/2020/09/22/spring-security-saml-extensions-1-x-eol-on-october-6-2021\r\n  [2]: https://mvnrepository.com/artifact/org.springframework.security.extensions/spring-security-saml\r\n  [3]: https://mvnrepository.com/artifact/org.springframework.security/spring-security-saml2-service-provider\r\n  [4]: https://docs.spring.io/spring-security/reference/servlet/saml2/index.html","title":"Spring security SAML : Which lib to create an Identity provider to connect to service provider","body":"<p>As an answer to your question I want to say that</p>\n<pre><code>org.springframework.security.extensions:spring-security-saml2-core:2.0.0.M31\n</code></pre>\n<p>and</p>\n<pre><code>org.springframework.security.extensions:%20spring-security-saml%3A1.0.10.RELEASE\n</code></pre>\n<p>Were removed from support more details you will be able to find <a href=\"https://spring.io/blog/2020/09/22/spring-security-saml-extensions-1-x-eol-on-october-6-2021\" rel=\"nofollow noreferrer\">spring-security-saml-extensions-1-x-eol-on-october-6-2021</a></p>\n<p>It could also be seeing into <a href=\"https://mvnrepository.com/artifact/org.springframework.security.extensions/spring-security-saml\" rel=\"nofollow noreferrer\">maven repository</a></p>\n<p>Based on it you have to use</p>\n<pre><code>org.springframework.security:spring-security-saml2-service-provider\n</code></pre>\n<p>That is currently maintained you can check it also on <a href=\"https://mvnrepository.com/artifact/org.springframework.security/spring-security-saml2-service-provider\" rel=\"nofollow noreferrer\">maven central repository</a></p>\n<p>Also a reference to <a href=\"https://docs.spring.io/spring-security/reference/servlet/saml2/index.html\" rel=\"nofollow noreferrer\">documentation</a></p>\n"}],"owner":{"account_id":10826565,"reputation":3,"user_id":22993862,"display_name":"user22993862"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":1,"is_answered":true,"view_count":43,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"accepted_answer_id":77558951,"answer_count":1,"score":-1,"last_activity_date":1701107144,"creation_date":1701094663,"question_id":77557593,"body_markdown":"I want to create an identityprovider to authenticate to an sso server using Spring security saml2. Can I create an ID using the &#39;org.springframework.security:spring-security-saml2-service-provider&#39; library or should I do this using &#39;org.springframework.security.extensions: spring-security-saml:1.0.10.RELEASE&#39; or &#39;org.springframework.security.extensions:spring-security-saml2-core:2.0.0.M31&#39;\r\n\r\nI have the impression that the documentation is mainly around setting up service providers","title":"Spring security SAML : Which lib to create an Identity provider to connect to service provider","body":"<p>I want to create an identityprovider to authenticate to an sso server using Spring security saml2. Can I create an ID using the 'org.springframework.security:spring-security-saml2-service-provider' library or should I do this using 'org.springframework.security.extensions: spring-security-saml:1.0.10.RELEASE' or 'org.springframework.security.extensions:spring-security-saml2-core:2.0.0.M31'</p>\n<p>I have the impression that the documentation is mainly around setting up service providers</p>\n"},{"tags":["java","spring-boot","api-gateway","spring-cloud-gateway"],"comments":[{"owner":{"account_id":25926563,"reputation":119,"user_id":19648355,"display_name":"Irremediable"},"score":0,"creation_date":1701108307,"post_id":77558926,"comment_id":136731680,"body_markdown":"&quot;but with no success&quot; is not describes your issue","body":"&quot;but with no success&quot; is not describes your issue"}],"owner":{"account_id":26315271,"reputation":1,"user_id":19978152,"display_name":"jacksparrow777"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":22,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701106936,"creation_date":1701106936,"question_id":77558926,"body_markdown":"I am trying to modify the response body which is currently gzipped text/html format. As first step i want to log it in abstract filter factory class. \r\n\r\nSo far i have tried [https://stackoverflow.com/questions/68741402/how-to-set-request-body-in-gatewayfilter-with-spring-cloud-gateway](https://stackoverflow.com) and [https://stackoverflow.com/questions/71465870/how-to-get-original-response-body-in-spring-cloud-gateway-webflux-post-filter](https://stackoverflow.com) but with no success. The rewrite response itself do not work.  \r\n\r\n```\r\n@Component\r\npublic class ReportingGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;ReportingGatewayFilterFactory.Config&gt; {\r\n\r\n    private static final Logger logger = LoggerFactory.getLogger(ReportingGatewayFilterFactory.class);\r\n\r\n    public ReportingGatewayFilterFactory() {\r\n        super(Config.class);\r\n    }\r\n\r\n\r\n    @Configuration\r\n    @ConfigurationProperties(prefix = &quot;custom-properties&quot;)\r\n    public static class Config {\r\n        ;\r\n    }\r\n\r\n    @Override\r\n    public GatewayFilter apply(Config config) {\r\n        return (exchange, chain) -&gt; {\r\n\r\n            String originalUriString = exchange.getRequest().getURI().toString();\r\n            String rewrittenUriString = originalUriString.replace(&quot;/mygateway/central_reporting/public/dashboards&quot;, &quot;/public/dashboards&quot;);\r\n            URI rewrittenUri = URI.create(rewrittenUriString); \r\n\r\n            ServerHttpRequest mutatedRequest = exchange.getRequest().mutate().uri(rewrittenUri).headers(headers -&gt; headers.remove(&quot;Authorization&quot;)).build();\r\n            ServerWebExchange mutatedExchange = exchange.mutate().request(mutatedRequest).build();\r\n\r\n            return chain.filter(mutatedExchange);\r\n\r\n        };\r\n    }\r\n    \r\n}\r\n```\r\n","title":"Log response body in spring cloud gateway in filterfactory class","body":"<p>I am trying to modify the response body which is currently gzipped text/html format. As first step i want to log it in abstract filter factory class.</p>\n<p>So far i have tried <a href=\"https://stackoverflow.com\">https://stackoverflow.com/questions/68741402/how-to-set-request-body-in-gatewayfilter-with-spring-cloud-gateway</a> and <a href=\"https://stackoverflow.com\">https://stackoverflow.com/questions/71465870/how-to-get-original-response-body-in-spring-cloud-gateway-webflux-post-filter</a> but with no success. The rewrite response itself do not work.</p>\n<pre><code>@Component\npublic class ReportingGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;ReportingGatewayFilterFactory.Config&gt; {\n\n    private static final Logger logger = LoggerFactory.getLogger(ReportingGatewayFilterFactory.class);\n\n    public ReportingGatewayFilterFactory() {\n        super(Config.class);\n    }\n\n\n    @Configuration\n    @ConfigurationProperties(prefix = &quot;custom-properties&quot;)\n    public static class Config {\n        ;\n    }\n\n    @Override\n    public GatewayFilter apply(Config config) {\n        return (exchange, chain) -&gt; {\n\n            String originalUriString = exchange.getRequest().getURI().toString();\n            String rewrittenUriString = originalUriString.replace(&quot;/mygateway/central_reporting/public/dashboards&quot;, &quot;/public/dashboards&quot;);\n            URI rewrittenUri = URI.create(rewrittenUriString); \n\n            ServerHttpRequest mutatedRequest = exchange.getRequest().mutate().uri(rewrittenUri).headers(headers -&gt; headers.remove(&quot;Authorization&quot;)).build();\n            ServerWebExchange mutatedExchange = exchange.mutate().request(mutatedRequest).build();\n\n            return chain.filter(mutatedExchange);\n\n        };\n    }\n    \n}\n</code></pre>\n"},{"tags":["java","kotlin","thread-safety","blockchain","corda"],"answers":[{"tags":[],"owner":{"account_id":17248886,"reputation":105,"user_id":12489459,"display_name":"Benjamin"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1678896540,"creation_date":1678896540,"answer_id":75747279,"question_id":75385788,"body_markdown":"When we call a flow from service it good practice to call it from its own Thread to avoid Dead locks of transaction update.\r\n\r\nInside @CordaService class\r\n\r\n  \r\n\r\n    private companion object {\r\n            val executor: Executor = Executors.newCachedThreadPool()\r\n          }\r\n        -------------------------------------------------------------------\r\n          executor.execute {\r\n            serviceHub.startFlow(RegisterCarFlow(update))\r\n          }","title":"serviceHub.startFlow from a cordaService class versus subFlow calling from Corda flow","body":"<p>When we call a flow from service it good practice to call it from its own Thread to avoid Dead locks of transaction update.</p>\n<p>Inside @CordaService class</p>\n<pre><code>private companion object {\n        val executor: Executor = Executors.newCachedThreadPool()\n      }\n    -------------------------------------------------------------------\n      executor.execute {\n        serviceHub.startFlow(RegisterCarFlow(update))\n      }\n</code></pre>\n"},{"tags":[],"owner":{"account_id":11113076,"reputation":563,"user_id":8158136,"display_name":"Veerabala J"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701106542,"creation_date":1701106542,"answer_id":77558889,"question_id":75385788,"body_markdown":"One problem associated with using custom threadPool is that it is complex to get the results back from the subFlow within the service or the flow which initiates the service. If we were to use Future or CompletableFuture then it would defeat the purpose of running these subflows concurrently.\r\nWe can use this approach more easily only when the subflow results are not needed for the initiator or the service.","title":"serviceHub.startFlow from a cordaService class versus subFlow calling from Corda flow","body":"<p>One problem associated with using custom threadPool is that it is complex to get the results back from the subFlow within the service or the flow which initiates the service. If we were to use Future or CompletableFuture then it would defeat the purpose of running these subflows concurrently.\nWe can use this approach more easily only when the subflow results are not needed for the initiator or the service.</p>\n"}],"owner":{"account_id":17248886,"reputation":105,"user_id":12489459,"display_name":"Benjamin"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":62,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":75747279,"answer_count":2,"score":0,"last_activity_date":1701106542,"creation_date":1675859267,"question_id":75385788,"body_markdown":"Is there a difference in calling one flow as **subflow** from another corda flow versus calling the same flow from a cordaservice class as **serviceHub.startFlow**?\r\n\r\nIn terms of thread utilization or suspending etc? \r\n\r\nI encountered a scenario where calling a flow from CordaService function got me error like \r\n`java.lang.IllegalArgumentException: Transaction context is missing. This might happen if a suspendable method is not annotated with @Suspendable annotation.`\r\n\r\nwhereas calling the same flows from another flow using subflows worked fine. ","title":"serviceHub.startFlow from a cordaService class versus subFlow calling from Corda flow","body":"<p>Is there a difference in calling one flow as <strong>subflow</strong> from another corda flow versus calling the same flow from a cordaservice class as <strong>serviceHub.startFlow</strong>?</p>\n<p>In terms of thread utilization or suspending etc?</p>\n<p>I encountered a scenario where calling a flow from CordaService function got me error like\n<code>java.lang.IllegalArgumentException: Transaction context is missing. This might happen if a suspendable method is not annotated with @Suspendable annotation.</code></p>\n<p>whereas calling the same flows from another flow using subflows worked fine.</p>\n"},{"tags":["java","spring-boot","spring-data-cassandra","jakarta-validation"],"comments":[{"owner":{"account_id":25926563,"reputation":119,"user_id":19648355,"display_name":"Irremediable"},"score":0,"creation_date":1701106809,"post_id":77558870,"comment_id":136731405,"body_markdown":"Try to check whether isValid() method get invoked. If not, most likely you need to add @Validated on your controller","body":"Try to check whether isValid() method get invoked. If not, most likely you need to add @Validated on your controller"}],"owner":{"account_id":42916,"reputation":22357,"user_id":125212,"accept_rate":52,"display_name":"Jackie"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":25,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701106326,"creation_date":1701106326,"question_id":77558870,"body_markdown":"I have the following...\r\n\r\n```java\r\n\r\n@Column\r\n@ContactInfo\r\nprivate String contactInfo;\r\n...\r\nprivate static final String EMAIL_PATTERN = &quot;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,6}$&quot;;\r\n    \r\n@Override\r\npublic boolean isValid(String value, ConstraintValidatorContext context) {\r\n        if (value == null) {\r\n            return false;\r\n        }\r\n        PhoneNumberUtil phoneUtil = PhoneNumberUtil.getInstance();\r\n        try {\r\n            Phonenumber.PhoneNumber phoneNumber = phoneUtil.parse(value, &quot;US&quot;); // Specify default country code\r\n            if (phoneUtil.isValidNumber(phoneNumber)) {\r\n                return true; // Valid phone number\r\n            }\r\n        } catch (Exception e) {\r\n            // Not a valid phone number, try email next\r\n        }\r\n\r\n        // Next, try to validate as an email\r\n        return Pattern.matches(EMAIL_PATTERN, value);\r\n}\r\n\r\n@PostMapping(consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE)\r\npublic void addContact(@Valid PotentialContact contact) {\r\n        contact.setId(Uuids.timeBased());\r\n        potentialContactRepo.save(contact);\r\n}\r\n```\r\n\r\nBut when I run and pass sadsadsadsadsadas as contact info like this...\r\n\r\n```\r\nPOST http://localhost:8080/contact\r\n200\r\n36 ms\r\nPOST /contact HTTP/1.1\r\nUser-Agent: PostmanRuntime/7.31.0\r\nAccept: */*\r\nCache-Control: no-cache\r\nHost: localhost:8080\r\nAccept-Encoding: gzip, deflate, br\r\nConnection: keep-alive\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 109\r\nCookie: JSESSIONID=5CF0280370CFA0403A4645392E34A907\r\n \r\nname=sadsadsadsadsadas&amp;contactInfo=sadsadsadsadsadas&amp;location=sadsadsadsadsadas&amp;description=sadsadsadsadsadas\r\n \r\nHTTP/1.1 200 OK\r\n```\r\n\r\nI would expect to get a 400 but instead I get a 200. What am I missing? Is there a more native way to handle this in Spring?","title":"How do I properly fail a validation of spring data cassandra using jakarta validations when passed to controller?","body":"<p>I have the following...</p>\n<pre class=\"lang-java prettyprint-override\"><code>\n@Column\n@ContactInfo\nprivate String contactInfo;\n...\nprivate static final String EMAIL_PATTERN = &quot;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,6}$&quot;;\n    \n@Override\npublic boolean isValid(String value, ConstraintValidatorContext context) {\n        if (value == null) {\n            return false;\n        }\n        PhoneNumberUtil phoneUtil = PhoneNumberUtil.getInstance();\n        try {\n            Phonenumber.PhoneNumber phoneNumber = phoneUtil.parse(value, &quot;US&quot;); // Specify default country code\n            if (phoneUtil.isValidNumber(phoneNumber)) {\n                return true; // Valid phone number\n            }\n        } catch (Exception e) {\n            // Not a valid phone number, try email next\n        }\n\n        // Next, try to validate as an email\n        return Pattern.matches(EMAIL_PATTERN, value);\n}\n\n@PostMapping(consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE)\npublic void addContact(@Valid PotentialContact contact) {\n        contact.setId(Uuids.timeBased());\n        potentialContactRepo.save(contact);\n}\n</code></pre>\n<p>But when I run and pass sadsadsadsadsadas as contact info like this...</p>\n<pre><code>POST http://localhost:8080/contact\n200\n36 ms\nPOST /contact HTTP/1.1\nUser-Agent: PostmanRuntime/7.31.0\nAccept: */*\nCache-Control: no-cache\nHost: localhost:8080\nAccept-Encoding: gzip, deflate, br\nConnection: keep-alive\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 109\nCookie: JSESSIONID=5CF0280370CFA0403A4645392E34A907\n \nname=sadsadsadsadsadas&amp;contactInfo=sadsadsadsadsadas&amp;location=sadsadsadsadsadas&amp;description=sadsadsadsadsadas\n \nHTTP/1.1 200 OK\n</code></pre>\n<p>I would expect to get a 400 but instead I get a 200. What am I missing? Is there a more native way to handle this in Spring?</p>\n"},{"tags":["java","android","xml","kotlin","android-studio"],"owner":{"account_id":28193143,"reputation":39,"user_id":21548222,"display_name":"siflJebatkundy"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":16,"favorite_count":0,"down_vote_count":2,"up_vote_count":0,"answer_count":0,"score":-2,"last_activity_date":1701106200,"creation_date":1701106200,"question_id":77558853,"body_markdown":"I have an issue with animations on some android devices. \r\n\r\nFor example I have Infinix X6516 where all animations are working fine. Then I have 8A and there is not working a single animation. To be more precise, animations such as PopupWindow.setAnimationStyle() or ActivityOptions.makeCustomAnimation() and so on. Does anybody has solution for this? Ive seen a case https://stackoverflow.com/questions/11904656/animation-not-working-on-all-devices, but I found no answer for my this.","title":"Animations not working on all android devices","body":"<p>I have an issue with animations on some android devices.</p>\n<p>For example I have Infinix X6516 where all animations are working fine. Then I have 8A and there is not working a single animation. To be more precise, animations such as PopupWindow.setAnimationStyle() or ActivityOptions.makeCustomAnimation() and so on. Does anybody has solution for this? Ive seen a case <a href=\"https://stackoverflow.com/questions/11904656/animation-not-working-on-all-devices\">Animation not working on all devices</a>, but I found no answer for my this.</p>\n"},{"tags":["java","project-reactor"],"comments":[{"owner":{"account_id":8986202,"reputation":194,"user_id":6699701,"display_name":"Amol Gharpure"},"score":0,"creation_date":1701096274,"post_id":77557671,"comment_id":136729162,"body_markdown":"check JMH Benchmarking Project :- https://github.com/openjdk/jmh","body":"check JMH Benchmarking Project :- <a href=\"https://github.com/openjdk/jmh\" rel=\"nofollow noreferrer\">github.com/openjdk/jmh</a>"},{"owner":{"account_id":18241932,"reputation":33,"user_id":13278813,"display_name":"piotrd"},"score":0,"creation_date":1701097446,"post_id":77557671,"comment_id":136729398,"body_markdown":"@AmolGharpure thanks for commenting. I am looking for a tool that will work as jprofiler/asyncprofiler in nin-reactive apps. More like flame graphs that show which methods take most time and where are the hotspots that I could optimize. As far as I know jmh is a benchmark that can be used to find whether given workflow meets timing criteria, but it will not find the exact spot that is responsible for poor performance","body":"@AmolGharpure thanks for commenting. I am looking for a tool that will work as jprofiler/asyncprofiler in nin-reactive apps. More like flame graphs that show which methods take most time and where are the hotspots that I could optimize. As far as I know jmh is a benchmark that can be used to find whether given workflow meets timing criteria, but it will not find the exact spot that is responsible for poor performance"},{"owner":{"account_id":372682,"reputation":22461,"user_id":721855,"display_name":"aled"},"score":0,"creation_date":1701099536,"post_id":77557671,"comment_id":136729940,"body_markdown":"Questions asking us to [recommend or find a book](https://stackoverflow.com/help/on-topic), tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam. Instead, describe the problem and what has been done so far to solve it.","body":"Questions asking us to <a href=\"https://stackoverflow.com/help/on-topic\">recommend or find a book</a>, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam. Instead, describe the problem and what has been done so far to solve it."},{"owner":{"account_id":18241932,"reputation":33,"user_id":13278813,"display_name":"piotrd"},"score":0,"creation_date":1701103042,"post_id":77557671,"comment_id":136730676,"body_markdown":"@aled I appreciate your answer, but have you really read my question? The problem: finding hotspots in reactive application. What has been tried: I have used typical tools like visualVm to sample cpu. But the nature of reactive application makes it unusable","body":"@aled I appreciate your answer, but have you really read my question? The problem: finding hotspots in reactive application. What has been tried: I have used typical tools like visualVm to sample cpu. But the nature of reactive application makes it unusable"},{"owner":{"account_id":372682,"reputation":22461,"user_id":721855,"display_name":"aled"},"score":0,"creation_date":1701103773,"post_id":77557671,"comment_id":136730832,"body_markdown":"I was answering more to your previous comment: &quot;I am looking for a tool that will work as jprofiler/asyncprofiler in nin-reactive apps&quot;","body":"I was answering more to your previous comment: &quot;I am looking for a tool that will work as jprofiler/asyncprofiler in nin-reactive apps&quot;"}],"answers":[{"comments":[{"owner":{"account_id":18241932,"reputation":33,"user_id":13278813,"display_name":"piotrd"},"score":0,"creation_date":1701103402,"post_id":77558393,"comment_id":136730759,"body_markdown":"I know that zipkin automatically can track external calls (via grpc) or to db (littleharder, but doable with r2dbc).  How would you get timing of internal calls withing reactive application, like you mentioned, calls to services inside the app? Have you inserted some probes  by yourself in code?","body":"I know that zipkin automatically can track external calls (via grpc) or to db (littleharder, but doable with r2dbc).  How would you get timing of internal calls withing reactive application, like you mentioned, calls to services inside the app? Have you inserted some probes  by yourself in code?"},{"owner":{"account_id":1698812,"reputation":50,"user_id":1559510,"display_name":"Cojy"},"score":0,"creation_date":1701105975,"post_id":77558393,"comment_id":136731266,"body_markdown":"Edited post for tracking calls inside the app","body":"Edited post for tracking calls inside the app"},{"owner":{"account_id":18241932,"reputation":33,"user_id":13278813,"display_name":"piotrd"},"score":0,"creation_date":1701107288,"post_id":77558393,"comment_id":136731500,"body_markdown":"That looks really good. This could be the answer","body":"That looks really good. This could be the answer"}],"tags":[],"owner":{"account_id":1698812,"reputation":50,"user_id":1559510,"display_name":"Cojy"},"comment_count":3,"down_vote_count":0,"up_vote_count":1,"is_accepted":true,"score":1,"last_activity_date":1701105952,"creation_date":1701101878,"answer_id":77558393,"question_id":77557671,"body_markdown":"Maybe one solution could be to use a tracing system like sleuth/zipkin that would give you times across services and external calls.\r\nThen track down which service takes time depending on the request and then track with your visualvm\r\nAlso the zipkin can be used on prod afterwards if needed to keep tracking bottlenecks\r\n\r\nFor example a /first calls a /second service, all in reactor. The first has a sleep of 1.5s to simulate a slow response time.\r\n[![enter image description here][1]][1]\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/AvCNt.png\r\n\r\n**To add specific method tracking**\r\neither register a bean\r\n\r\n    @Bean\r\n        public ObservedAspect observedAspect(ObservationRegistry observationRegistry) {\r\n            return new ObservedAspect(observationRegistry);\r\n        }\r\n\r\nthen you can use the **@Observed** annotation on the method you want to track.\r\n\r\nor use a decorator around a specific method (or directly create in the method but it&#39;s not clean)\r\n\r\n    Observation observation = Observation.start(&quot;MyImpl.findOne&quot;, observationRegistry);\r\n\r\nand do not forget to observation.stop()","title":"Performance profiling java reactive application","body":"<p>Maybe one solution could be to use a tracing system like sleuth/zipkin that would give you times across services and external calls.\nThen track down which service takes time depending on the request and then track with your visualvm\nAlso the zipkin can be used on prod afterwards if needed to keep tracking bottlenecks</p>\n<p>For example a /first calls a /second service, all in reactor. The first has a sleep of 1.5s to simulate a slow response time.\n<a href=\"https://i.stack.imgur.com/AvCNt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/AvCNt.png\" alt=\"enter image description here\" /></a></p>\n<p><strong>To add specific method tracking</strong>\neither register a bean</p>\n<pre><code>@Bean\n    public ObservedAspect observedAspect(ObservationRegistry observationRegistry) {\n        return new ObservedAspect(observationRegistry);\n    }\n</code></pre>\n<p>then you can use the <strong>@Observed</strong> annotation on the method you want to track.</p>\n<p>or use a decorator around a specific method (or directly create in the method but it's not clean)</p>\n<pre><code>Observation observation = Observation.start(&quot;MyImpl.findOne&quot;, observationRegistry);\n</code></pre>\n<p>and do not forget to observation.stop()</p>\n"}],"owner":{"account_id":18241932,"reputation":33,"user_id":13278813,"display_name":"piotrd"},"comment_count":5,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":60,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":77558393,"answer_count":1,"score":0,"last_activity_date":1701105952,"creation_date":1701095451,"question_id":77557671,"body_markdown":"JVM has a great set of tools to find the hotspots in your application.\r\nBy enabling JMX and connecting with JProfiler / VisualVm we can quite quickly find methods that take most time in our workflow. \r\n\r\nHowever, reactive application (project-reactor) slices our workflow in unnamed tasks that may accept random threads. What is more, waiting for external resources is done in reactive manner, so we won&#39;t see that given access has blocked our workflow. \r\n\r\nDo you have any ideas how to profile reactive application efficiently?\r\nI would like to avoid inserting some probes in code and doing it by logging. \r\n\r\nProject reactor solved problem with shuttered stacktraces by introducing agent that gathers stacktraces when bubbling the error up, thus we can see the whole image of where was our program at the time of an error.\r\n\r\nWhat about profiling? Although methods that take some time by themselves (like fanaout when iterating on collections) will be spotted, most common problems that involve db or external services access will be not. \r\n\r\nLooking for your opinions.\r\nRegards","title":"Performance profiling java reactive application","body":"<p>JVM has a great set of tools to find the hotspots in your application.\nBy enabling JMX and connecting with JProfiler / VisualVm we can quite quickly find methods that take most time in our workflow.</p>\n<p>However, reactive application (project-reactor) slices our workflow in unnamed tasks that may accept random threads. What is more, waiting for external resources is done in reactive manner, so we won't see that given access has blocked our workflow.</p>\n<p>Do you have any ideas how to profile reactive application efficiently?\nI would like to avoid inserting some probes in code and doing it by logging.</p>\n<p>Project reactor solved problem with shuttered stacktraces by introducing agent that gathers stacktraces when bubbling the error up, thus we can see the whole image of where was our program at the time of an error.</p>\n<p>What about profiling? Although methods that take some time by themselves (like fanaout when iterating on collections) will be spotted, most common problems that involve db or external services access will be not.</p>\n<p>Looking for your opinions.\nRegards</p>\n"},{"tags":["java"],"comments":[{"owner":{"account_id":785560,"reputation":14879,"user_id":845414,"display_name":"Johannes Kuhn"},"score":4,"creation_date":1701105802,"post_id":77558789,"comment_id":136731243,"body_markdown":"https://docs.oracle.com/javase/specs/jls/se21/html/jls-9.html#jls-9.8","body":"<a href=\"https://docs.oracle.com/javase/specs/jls/se21/html/jls-9.html#jls-9.8\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/specs/jls/se21/html/jls-9.html#jls-9.&zwnj;&#8203;8</a>"},{"owner":{"account_id":1992310,"reputation":11172,"user_id":1786065,"accept_rate":91,"display_name":"Rogue"},"score":1,"creation_date":1701106870,"post_id":77558789,"comment_id":136731418,"body_markdown":"The `Comparator` does not represent `Object#equals`, that method exists for _every_ object. Rather, `Comparator&lt;T&gt;` provides an `int compare(T left, T right);` abstract method (and explicitly re-states the `#equals` method). Note that you can have more than one method in a functional interface, but they must be static or defaulted. You can only have _one_ abstract method for an interface to be a _functional_ interface. The JLS link above adds an exception: public methods of `Object` are excluded (so 1:1 re-declaration of them will not count).","body":"The <code>Comparator</code> does not represent <code>Object#equals</code>, that method exists for <i>every</i> object. Rather, <code>Comparator&lt;T&gt;</code> provides an <code>int compare(T left, T right);</code> abstract method (and explicitly re-states the <code>#equals</code> method). Note that you can have more than one method in a functional interface, but they must be static or defaulted. You can only have <i>one</i> abstract method for an interface to be a <i>functional</i> interface. The JLS link above adds an exception: public methods of <code>Object</code> are excluded (so 1:1 re-declaration of them will not count)."},{"owner":{"account_id":18348479,"reputation":1986,"user_id":13363175,"display_name":"notaorb"},"score":0,"creation_date":1701109509,"post_id":77558789,"comment_id":136731886,"body_markdown":"@Rogue https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html indicates equal and compare are both abstract so doesn’t Comparator have two abstract methods?","body":"@Rogue <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/8/docs/api/java/util/Comparator.html</a> indicates equal and compare are both abstract so doesn’t Comparator have two abstract methods?"},{"owner":{"account_id":1992310,"reputation":11172,"user_id":1786065,"accept_rate":91,"display_name":"Rogue"},"score":0,"creation_date":1701112342,"post_id":77558789,"comment_id":136732342,"body_markdown":"@notaorb hence the exception from the JLS link: public methods of `Object` are excluded from this &quot;1 abstract method&quot; rule. Since `boolean equals(Object other)` is defined in `Object` (and no Object method is abstract to begin with, but that&#39;s an aside), then the abstract method `boolean equals(Object other);` isn&#39;t counted: it&#39;s already implicitly covered/implemented by anything that could implement the interface, including lambdas.","body":"@notaorb hence the exception from the JLS link: public methods of <code>Object</code> are excluded from this &quot;1 abstract method&quot; rule. Since <code>boolean equals(Object other)</code> is defined in <code>Object</code> (and no Object method is abstract to begin with, but that&#39;s an aside), then the abstract method <code>boolean equals(Object other);</code> isn&#39;t counted: it&#39;s already implicitly covered/implemented by anything that could implement the interface, including lambdas."}],"owner":{"account_id":18348479,"reputation":1986,"user_id":13363175,"display_name":"notaorb"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":48,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701105634,"creation_date":1701105634,"question_id":77558789,"body_markdown":"What happens if `Predicate&lt;T&gt;` contains multiple methods?  It&#39;s my understanding if they have the same argument signature this is not allowed.\r\n\r\nI ask because I&#39;m considering the `Comparator&lt;T&gt;` interface and it has multiple methods in the interface, but with different signatures.  I look at `TreeSet&lt;T&gt;` constructor `TreeSet(Comparator&lt;? super E&gt; comparator)` and it accepts a lambda, yet I&#39;m confused how that lambda represents `equals(Object obj)`.  Can anyone clarify this?\r\n\r\n    interface Predicate&lt;T&gt; {\r\n        boolean test(T t);\r\n    }\r\n    \r\n    public static void printPersons(\r\n        List&lt;Person&gt; roster, Predicate&lt;Person&gt; tester) {\r\n    \r\n        for (Person p : roster) {\r\n            if (tester.test(p)) {\r\n                p.printPerson();\r\n            }\r\n        }\r\n    }\r\n    \r\n    printPersons(\r\n        roster,\r\n        (Person p) -&gt; p.getGender() == Person.Sex.MALE\r\n            &amp;&amp; p.getAge() &gt;= 18\r\n            &amp;&amp; p.getAge() &lt;= 25\r\n    );\r\n\r\n","title":"Anonymous functions using interface with multiple methods?","body":"<p>What happens if <code>Predicate&lt;T&gt;</code> contains multiple methods?  It's my understanding if they have the same argument signature this is not allowed.</p>\n<p>I ask because I'm considering the <code>Comparator&lt;T&gt;</code> interface and it has multiple methods in the interface, but with different signatures.  I look at <code>TreeSet&lt;T&gt;</code> constructor <code>TreeSet(Comparator&lt;? super E&gt; comparator)</code> and it accepts a lambda, yet I'm confused how that lambda represents <code>equals(Object obj)</code>.  Can anyone clarify this?</p>\n<pre><code>interface Predicate&lt;T&gt; {\n    boolean test(T t);\n}\n\npublic static void printPersons(\n    List&lt;Person&gt; roster, Predicate&lt;Person&gt; tester) {\n\n    for (Person p : roster) {\n        if (tester.test(p)) {\n            p.printPerson();\n        }\n    }\n}\n\nprintPersons(\n    roster,\n    (Person p) -&gt; p.getGender() == Person.Sex.MALE\n        &amp;&amp; p.getAge() &gt;= 18\n        &amp;&amp; p.getAge() &lt;= 25\n);\n</code></pre>\n"},{"tags":["java","soap","digital-signature","xml-signature"],"owner":{"account_id":12696165,"reputation":27,"user_id":9224530,"display_name":"Michele Raso"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":32,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701105442,"creation_date":1701084677,"question_id":77556545,"body_markdown":"hello i am developing a service for a SOAP call with x509 authentication and i need to sign the body and timestamp, but i can&#39;t get it to work java side while in SoapUI it does.\r\n\r\n\r\nThe error (with java code) is SSF_API_SIGNER_ERORS A signing opration not be performed or failed\r\n\r\n\r\nthe configuration in soapUi is this\r\n\r\n[![enter image description here][1]][1]\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/HXtLp.png\r\n\r\nwhile my signature code is this\r\n\r\n\r\n          private void createDetachedSignature(SOAPElement signatureElement, PrivateKey privateKey, SOAPElement securityTokenReference, SOAPBody soapBody, SOAPElement timestamp) throws Exception {\r\n            \r\n            \r\n                String providerName = System.getProperty\r\n                        (&quot;jsr105Provider&quot;, &quot;org.jcp.xml.dsig.internal.dom.XMLDSigRI&quot;);\r\n                XMLSignatureFactory xmlSignatureFactory = XMLSignatureFactory.getInstance(&quot;DOM&quot;,\r\n                        (Provider) Class.forName(providerName).newInstance());\r\n            \r\n            \r\n                //Digest method\r\n                javax.xml.crypto.dsig.DigestMethod digestMethod = xmlSignatureFactory.newDigestMethod(&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;, null);\r\n                ArrayList&lt;Transform&gt; transformList = new ArrayList&lt;Transform&gt;();\r\n            \r\n            \r\n                //Transform\r\n                Transform envTransform = xmlSignatureFactory.newTransform(&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;, (TransformParameterSpec) null);\r\n                transformList.add(envTransform);\r\n            \r\n            \r\n                //References\r\n            \r\n                ArrayList&lt;Reference&gt; refList = new ArrayList&lt;Reference&gt;();\r\n                Reference refTS = xmlSignatureFactory.newReference(&quot;#TS&quot;+UUID, digestMethod, transformList, null, null);\r\n                Reference refBody = xmlSignatureFactory.newReference(&quot;#Body&quot;+UUID, digestMethod, transformList, null, null);\r\n            \r\n            \r\n                refList.add(refBody);\r\n                refList.add(refTS);\r\n            \r\n            \r\n                javax.xml.crypto.dsig.CanonicalizationMethod cm = xmlSignatureFactory.newCanonicalizationMethod(&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;,\r\n                        (C14NMethodParameterSpec) null);\r\n            \r\n                javax.xml.crypto.dsig.SignatureMethod sm = xmlSignatureFactory.newSignatureMethod(&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;, null);\r\n                SignedInfo signedInfo = xmlSignatureFactory.newSignedInfo(cm, sm, refList);\r\n            \r\n                signatureElement.setAttribute(&quot;Id&quot;, &quot;SIG&quot; + UUID);\r\n            \r\n                DOMSignContext signContext = new DOMSignContext(privateKey, signatureElement);\r\n                signContext.setDefaultNamespacePrefix(&quot;ds&quot;);\r\n                signContext.putNamespacePrefix(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;ds&quot;);\r\n            \r\n            \r\n                //These are required for new Java versions\r\n                signContext.setIdAttributeNS\r\n                        (soapBody,\r\n                                &quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;, &quot;Id&quot;);\r\n            \r\n            \r\n                signContext.setIdAttributeNS\r\n                        (timestamp,\r\n                                &quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;, &quot;Id&quot;);\r\n            \r\n            \r\n                KeyInfoFactory keyFactory = KeyInfoFactory.getInstance();\r\n                DOMStructure domKeyInfo = new DOMStructure(securityTokenReference);\r\n                javax.xml.crypto.dsig.keyinfo.KeyInfo keyInfo = keyFactory.newKeyInfo(java.util.Collections.singletonList(domKeyInfo));\r\n                if (securityTokenReference instanceof Element) {\r\n                    Element keyInfoElement = (Element) securityTokenReference;\r\n                    keyInfoElement.setAttribute(&quot;Id&quot;, &quot;KI&quot; + UUID);\r\n                }\r\n                javax.xml.crypto.dsig.XMLSignature signature = xmlSignatureFactory.newXMLSignature(signedInfo, keyInfo);\r\n                signContext.setBaseURI(&quot;&quot;);\r\n            \r\n            \r\n                signature.sign(signContext);\r\n                String signatureValue = getSignatureValueAsString(signatureElement);\r\n                System.out.println(&quot;Signature Value: &quot; + signatureValue);\r\n            \r\n            \r\n                Element canonicalizationMethodElement = (Element) signatureElement.getElementsByTagNameNS(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;CanonicalizationMethod&quot;).item(0);\r\n                addInclusiveNamespaces(canonicalizationMethodElement, &quot;soapenv urn&quot;);\r\n            \r\n                NodeList referenceNodes = signatureElement.getElementsByTagNameNS(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;Reference&quot;);\r\n                for (int i = 0; i &lt; referenceNodes.getLength(); i++) {\r\n                    Element referenceElement = (Element) referenceNodes.item(i);\r\n                    Element transformsElement = (Element) referenceElement.getElementsByTagNameNS(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;Transforms&quot;).item(0);\r\n                    Element transformElement = (Element) transformsElement.getElementsByTagNameNS(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;Transform&quot;).item(0);\r\n            \r\n                    addInclusiveNamespaces(transformElement, &quot;wsse soapenv urn&quot;);\r\n                }\r\n            \r\n            \r\n            }\r\n\r\nI tried to compare the two requests and now I attach them to you\r\n\r\n\r\nSOAP UI REQUEST \r\n\r\n            &lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;\r\n            xmlns:urn=&quot;urn:sap-com:document:sap:rfc:functions&quot;&gt;\r\n            &lt;soapenv:Header&gt;\r\n                &lt;wsse:Security\r\n                    xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;\r\n                    xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&gt;\r\n                    &lt;wsse:BinarySecurityToken\r\n                        EncodingType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary&quot;\r\n                        ValueType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3&quot;\r\n                        wsu:Id=&quot;X509-8C92EF6DC231D5F4321700816423308691&quot;&gt;\r\n                        MIIIEjCCBfqgAwIBAgITHQAAZ/wkXidRhqKJ2wADAABn/DANBgkqhkiG...........&lt;/wsse:BinarySecurityToken&gt;\r\n                    &lt;wsu:Timestamp wsu:Id=&quot;TS-8C92EF6DC231D5F4321700816423307690&quot;&gt;\r\n                        &lt;wsu:Created&gt;2023-11-24T09:00:23Z&lt;/wsu:Created&gt;\r\n                        &lt;wsu:Expires&gt;2024-02-15T17:00:23Z&lt;/wsu:Expires&gt;\r\n                    &lt;/wsu:Timestamp&gt;\r\n                    &lt;ds:Signature Id=&quot;SIG-8C92EF6DC231D5F4321700816423348695&quot;\r\n                        xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;\r\n                        &lt;ds:SignedInfo&gt;\r\n                            &lt;ds:CanonicalizationMethod Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\r\n                                &lt;ec:InclusiveNamespaces PrefixList=&quot;soapenv urn&quot;\r\n                                    xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot; /&gt;\r\n                            &lt;/ds:CanonicalizationMethod&gt;\r\n                            &lt;ds:SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot; /&gt;\r\n                            &lt;ds:Reference URI=&quot;#TS-8C92EF6DC231D5F4321700816423307690&quot;&gt;\r\n                                &lt;ds:Transforms&gt;\r\n                                    &lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\r\n                                        &lt;ec:InclusiveNamespaces PrefixList=&quot;wsse soapenv urn&quot;\r\n                                            xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot; /&gt;\r\n                                    &lt;/ds:Transform&gt;\r\n                                &lt;/ds:Transforms&gt;\r\n                                &lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&gt;\r\n                                &lt;ds:DigestValue&gt;7KhZ1yTPuNhQ7OtTn32HcJQQ04U=&lt;/ds:DigestValue&gt;\r\n                            &lt;/ds:Reference&gt;\r\n                            &lt;ds:Reference URI=&quot;#id-8C92EF6DC231D5F4321700816423308694&quot;&gt;\r\n                                &lt;ds:Transforms&gt;\r\n                                    &lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\r\n                                        &lt;ec:InclusiveNamespaces PrefixList=&quot;&quot;\r\n                                            xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot; /&gt;\r\n                                    &lt;/ds:Transform&gt;\r\n                                &lt;/ds:Transforms&gt;\r\n                                &lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&gt;\r\n                                &lt;ds:DigestValue&gt;t5f22r+WwrehIN/rbI7EFwLq7tM=&lt;/ds:DigestValue&gt;\r\n                            &lt;/ds:Reference&gt;\r\n                        &lt;/ds:SignedInfo&gt;\r\n                        &lt;ds:SignatureValue&gt;\r\n                            KRttsmdFmqCRQyTmo6/Cgs1Vj8EZ1y9YbObETjtcvhNQUBRny7tIKZE3bH4TwR69L2x0MsosaAcefeuT/OkowAa............&lt;/ds:SignatureValue&gt;\r\n                        &lt;ds:KeyInfo Id=&quot;KI-8C92EF6DC231D5F4321700816423308692&quot;&gt;\r\n                            &lt;wsse:SecurityTokenReference wsu:Id=&quot;STR-8C92EF6DC231D5F4321700816423308693&quot;&gt;\r\n                                &lt;wsse:Reference URI=&quot;#X509-8C92EF6DC231D5F4321700816423308691&quot;\r\n                                    ValueType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3&quot; /&gt;\r\n                            &lt;/wsse:SecurityTokenReference&gt;\r\n                        &lt;/ds:KeyInfo&gt;\r\n                    &lt;/ds:Signature&gt;\r\n                &lt;/wsse:Security&gt;\r\n            &lt;/soapenv:Header&gt;\r\n            &lt;soapenv:Body wsu:Id=&quot;id-8C92EF6DC231D5F4321700816423308694&quot;\r\n                xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&gt;\r\n                &lt;urn:SCHEMA_CC&gt;\r\n                    &lt;IV_BP&gt;3960915933&lt;/IV_BP&gt;\r\n                &lt;/urn:SCHEMA_CC&gt;\r\n            &lt;/soapenv:Body&gt;\r\n        &lt;/soapenv:Envelope&gt;\r\n\r\n\r\nMy request java \r\n\r\n \r\n\r\n                &lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;\r\n                xmlns:urn=&quot;urn:sap-com:document:sap:rfc:functions&quot;&gt;\r\n                &lt;soapenv:Header&gt;\r\n                    &lt;wsse:Security\r\n                        xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;\r\n                        xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;\r\n                        Id=&quot;SIG-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\r\n                        &lt;wsu:Timestamp wsu:Id=&quot;TS-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\r\n                            &lt;wsu:Created&gt;2023-11-24T08:18:32Z&lt;/wsu:Created&gt;\r\n                            &lt;wsu:Expires&gt;2023-11-24T08:19:02Z&lt;/wsu:Expires&gt;\r\n                        &lt;/wsu:Timestamp&gt;\r\n                        &lt;wsse:BinarySecurityToken\r\n                            EncodingType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary&quot;\r\n                            ValueType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3&quot;\r\n                            wsu:Id=&quot;X509Token-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\r\n                            MIIIEjCCBfqgAwIBAgITHQAAZ/wkXidRhqKJ2wADAABn..........&lt;/wsse:BinarySecurityToken&gt;\r\n                        &lt;ds:Signature xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;\r\n                            &lt;ds:SignedInfo&gt;\r\n                                &lt;ds:CanonicalizationMethod Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\r\n                                    &lt;ec:InclusiveNamespaces xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;\r\n                                        PrefixList=&quot;soapenv urn&quot; /&gt;\r\n                                &lt;/ds:CanonicalizationMethod&gt;\r\n                                &lt;ds:SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot; /&gt;\r\n                                &lt;ds:Reference URI=&quot;#Body-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\r\n                                    &lt;ds:Transforms&gt;\r\n                                        &lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\r\n                                            &lt;ec:InclusiveNamespaces\r\n                                                xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;\r\n                                                PrefixList=&quot;wsse soapenv urn&quot; /&gt;\r\n                                        &lt;/ds:Transform&gt;\r\n                                    &lt;/ds:Transforms&gt;\r\n                                    &lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&gt;\r\n                                    &lt;ds:DigestValue&gt;qOQ+Nv9QAe63RePMKZkCfn2a8xI=&lt;/ds:DigestValue&gt;\r\n                                &lt;/ds:Reference&gt;\r\n                                &lt;ds:Reference URI=&quot;#TS-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\r\n                                    &lt;ds:Transforms&gt;\r\n                                        &lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\r\n                                            &lt;ec:InclusiveNamespaces\r\n                                                xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;\r\n                                                PrefixList=&quot;wsse soapenv urn&quot; /&gt;\r\n                                        &lt;/ds:Transform&gt;\r\n                                    &lt;/ds:Transforms&gt;\r\n                                    &lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&gt;\r\n                                    &lt;ds:DigestValue&gt;grbt4GpvYhKKUaetcW2HHMm91Mw=&lt;/ds:DigestValue&gt;\r\n                                &lt;/ds:Reference&gt;\r\n                            &lt;/ds:SignedInfo&gt;\r\n                            &lt;ds:SignatureValue&gt;agesPe4aOZPE9m1aI17MDz+oE5V7YNk7ox6q1WvmHWjd7EdH4XdqVq62dMnqkE2RRbI5TafX1qnK&amp;#13;\r\n                                udGLnMFcZu/gIYMUYmZ1RrwO6y39tLDWii8hEIZMYj/jIzAqi6d1jXh8GOjtmflYnIsRnidFgokV&amp;#13;\r\n                                /fgoMn7c548QlvEPyCokgFlS/aF4OF5uKqnb/yJ2ilRbeJBlG9QCO5rEUGmgeZ0untABzP+w76yg&amp;#13;\r\n                                PTkPaDTC8UHDQsG4XWMTYL+dyGfnHpYdqz5v+4BI53KfG0V7eqbdCZj9dzYN2MEel1NrgqQP2uQ8&amp;#13;\r\n                                .........&lt;/ds:SignatureValue&gt;\r\n                            &lt;ds:KeyInfo&gt;\r\n                                &lt;wsse:SecurityTokenReference Id=&quot;KI-1B1352404FC17AFA99AD1B962FA2A67E&quot;\r\n                                    wsu:Id=&quot;STR-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\r\n                                    &lt;wsse:Reference URI=&quot;#X509Token-1B1352404FC17AFA99AD1B962FA2A67E&quot;\r\n                                        ValueType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3&quot; /&gt;\r\n                                &lt;/wsse:SecurityTokenReference&gt;\r\n                            &lt;/ds:KeyInfo&gt;\r\n                        &lt;/ds:Signature&gt;\r\n                    &lt;/wsse:Security&gt;\r\n                &lt;/soapenv:Header&gt;\r\n                &lt;soapenv:Body\r\n                    xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;\r\n                    wsu:Id=&quot;Body-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\r\n                    &lt;urn:GET_SCHEMA_CC xmlns:urn=&quot;http://www.example.com/urn&quot;&gt;\r\n                            &lt;IV_BP&gt;3960915933&lt;/IV_BP&gt;\r\n                    \r\n                    &lt;/urn:GET_SCHEMA_CC&gt;\r\n                &lt;/soapenv:Body&gt;\r\n            &lt;/soapenv:Envelope&gt;\r\n\r\nThe way to put the certificate in the securityBinaryToken seems correct to me, while the signature I don&#39;t know if it is the correct way to do it.\r\n\r\n","title":"SOAP SW-SECURITY SIGNATURE BINARY_TOKEN AND TIMESTAMP","body":"<p>hello i am developing a service for a SOAP call with x509 authentication and i need to sign the body and timestamp, but i can't get it to work java side while in SoapUI it does.</p>\n<p>The error (with java code) is SSF_API_SIGNER_ERORS A signing opration not be performed or failed</p>\n<p>the configuration in soapUi is this</p>\n<p><a href=\"https://i.stack.imgur.com/HXtLp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/HXtLp.png\" alt=\"enter image description here\" /></a></p>\n<p>while my signature code is this</p>\n<pre><code>      private void createDetachedSignature(SOAPElement signatureElement, PrivateKey privateKey, SOAPElement securityTokenReference, SOAPBody soapBody, SOAPElement timestamp) throws Exception {\n        \n        \n            String providerName = System.getProperty\n                    (&quot;jsr105Provider&quot;, &quot;org.jcp.xml.dsig.internal.dom.XMLDSigRI&quot;);\n            XMLSignatureFactory xmlSignatureFactory = XMLSignatureFactory.getInstance(&quot;DOM&quot;,\n                    (Provider) Class.forName(providerName).newInstance());\n        \n        \n            //Digest method\n            javax.xml.crypto.dsig.DigestMethod digestMethod = xmlSignatureFactory.newDigestMethod(&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;, null);\n            ArrayList&lt;Transform&gt; transformList = new ArrayList&lt;Transform&gt;();\n        \n        \n            //Transform\n            Transform envTransform = xmlSignatureFactory.newTransform(&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;, (TransformParameterSpec) null);\n            transformList.add(envTransform);\n        \n        \n            //References\n        \n            ArrayList&lt;Reference&gt; refList = new ArrayList&lt;Reference&gt;();\n            Reference refTS = xmlSignatureFactory.newReference(&quot;#TS&quot;+UUID, digestMethod, transformList, null, null);\n            Reference refBody = xmlSignatureFactory.newReference(&quot;#Body&quot;+UUID, digestMethod, transformList, null, null);\n        \n        \n            refList.add(refBody);\n            refList.add(refTS);\n        \n        \n            javax.xml.crypto.dsig.CanonicalizationMethod cm = xmlSignatureFactory.newCanonicalizationMethod(&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;,\n                    (C14NMethodParameterSpec) null);\n        \n            javax.xml.crypto.dsig.SignatureMethod sm = xmlSignatureFactory.newSignatureMethod(&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;, null);\n            SignedInfo signedInfo = xmlSignatureFactory.newSignedInfo(cm, sm, refList);\n        \n            signatureElement.setAttribute(&quot;Id&quot;, &quot;SIG&quot; + UUID);\n        \n            DOMSignContext signContext = new DOMSignContext(privateKey, signatureElement);\n            signContext.setDefaultNamespacePrefix(&quot;ds&quot;);\n            signContext.putNamespacePrefix(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;ds&quot;);\n        \n        \n            //These are required for new Java versions\n            signContext.setIdAttributeNS\n                    (soapBody,\n                            &quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;, &quot;Id&quot;);\n        \n        \n            signContext.setIdAttributeNS\n                    (timestamp,\n                            &quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;, &quot;Id&quot;);\n        \n        \n            KeyInfoFactory keyFactory = KeyInfoFactory.getInstance();\n            DOMStructure domKeyInfo = new DOMStructure(securityTokenReference);\n            javax.xml.crypto.dsig.keyinfo.KeyInfo keyInfo = keyFactory.newKeyInfo(java.util.Collections.singletonList(domKeyInfo));\n            if (securityTokenReference instanceof Element) {\n                Element keyInfoElement = (Element) securityTokenReference;\n                keyInfoElement.setAttribute(&quot;Id&quot;, &quot;KI&quot; + UUID);\n            }\n            javax.xml.crypto.dsig.XMLSignature signature = xmlSignatureFactory.newXMLSignature(signedInfo, keyInfo);\n            signContext.setBaseURI(&quot;&quot;);\n        \n        \n            signature.sign(signContext);\n            String signatureValue = getSignatureValueAsString(signatureElement);\n            System.out.println(&quot;Signature Value: &quot; + signatureValue);\n        \n        \n            Element canonicalizationMethodElement = (Element) signatureElement.getElementsByTagNameNS(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;CanonicalizationMethod&quot;).item(0);\n            addInclusiveNamespaces(canonicalizationMethodElement, &quot;soapenv urn&quot;);\n        \n            NodeList referenceNodes = signatureElement.getElementsByTagNameNS(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;Reference&quot;);\n            for (int i = 0; i &lt; referenceNodes.getLength(); i++) {\n                Element referenceElement = (Element) referenceNodes.item(i);\n                Element transformsElement = (Element) referenceElement.getElementsByTagNameNS(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;Transforms&quot;).item(0);\n                Element transformElement = (Element) transformsElement.getElementsByTagNameNS(&quot;http://www.w3.org/2000/09/xmldsig#&quot;, &quot;Transform&quot;).item(0);\n        \n                addInclusiveNamespaces(transformElement, &quot;wsse soapenv urn&quot;);\n            }\n        \n        \n        }\n</code></pre>\n<p>I tried to compare the two requests and now I attach them to you</p>\n<p>SOAP UI REQUEST</p>\n<pre><code>        &lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;\n        xmlns:urn=&quot;urn:sap-com:document:sap:rfc:functions&quot;&gt;\n        &lt;soapenv:Header&gt;\n            &lt;wsse:Security\n                xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;\n                xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&gt;\n                &lt;wsse:BinarySecurityToken\n                    EncodingType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary&quot;\n                    ValueType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3&quot;\n                    wsu:Id=&quot;X509-8C92EF6DC231D5F4321700816423308691&quot;&gt;\n                    MIIIEjCCBfqgAwIBAgITHQAAZ/wkXidRhqKJ2wADAABn/DANBgkqhkiG...........&lt;/wsse:BinarySecurityToken&gt;\n                &lt;wsu:Timestamp wsu:Id=&quot;TS-8C92EF6DC231D5F4321700816423307690&quot;&gt;\n                    &lt;wsu:Created&gt;2023-11-24T09:00:23Z&lt;/wsu:Created&gt;\n                    &lt;wsu:Expires&gt;2024-02-15T17:00:23Z&lt;/wsu:Expires&gt;\n                &lt;/wsu:Timestamp&gt;\n                &lt;ds:Signature Id=&quot;SIG-8C92EF6DC231D5F4321700816423348695&quot;\n                    xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;\n                    &lt;ds:SignedInfo&gt;\n                        &lt;ds:CanonicalizationMethod Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\n                            &lt;ec:InclusiveNamespaces PrefixList=&quot;soapenv urn&quot;\n                                xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot; /&gt;\n                        &lt;/ds:CanonicalizationMethod&gt;\n                        &lt;ds:SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot; /&gt;\n                        &lt;ds:Reference URI=&quot;#TS-8C92EF6DC231D5F4321700816423307690&quot;&gt;\n                            &lt;ds:Transforms&gt;\n                                &lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\n                                    &lt;ec:InclusiveNamespaces PrefixList=&quot;wsse soapenv urn&quot;\n                                        xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot; /&gt;\n                                &lt;/ds:Transform&gt;\n                            &lt;/ds:Transforms&gt;\n                            &lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&gt;\n                            &lt;ds:DigestValue&gt;7KhZ1yTPuNhQ7OtTn32HcJQQ04U=&lt;/ds:DigestValue&gt;\n                        &lt;/ds:Reference&gt;\n                        &lt;ds:Reference URI=&quot;#id-8C92EF6DC231D5F4321700816423308694&quot;&gt;\n                            &lt;ds:Transforms&gt;\n                                &lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\n                                    &lt;ec:InclusiveNamespaces PrefixList=&quot;&quot;\n                                        xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot; /&gt;\n                                &lt;/ds:Transform&gt;\n                            &lt;/ds:Transforms&gt;\n                            &lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&gt;\n                            &lt;ds:DigestValue&gt;t5f22r+WwrehIN/rbI7EFwLq7tM=&lt;/ds:DigestValue&gt;\n                        &lt;/ds:Reference&gt;\n                    &lt;/ds:SignedInfo&gt;\n                    &lt;ds:SignatureValue&gt;\n                        KRttsmdFmqCRQyTmo6/Cgs1Vj8EZ1y9YbObETjtcvhNQUBRny7tIKZE3bH4TwR69L2x0MsosaAcefeuT/OkowAa............&lt;/ds:SignatureValue&gt;\n                    &lt;ds:KeyInfo Id=&quot;KI-8C92EF6DC231D5F4321700816423308692&quot;&gt;\n                        &lt;wsse:SecurityTokenReference wsu:Id=&quot;STR-8C92EF6DC231D5F4321700816423308693&quot;&gt;\n                            &lt;wsse:Reference URI=&quot;#X509-8C92EF6DC231D5F4321700816423308691&quot;\n                                ValueType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3&quot; /&gt;\n                        &lt;/wsse:SecurityTokenReference&gt;\n                    &lt;/ds:KeyInfo&gt;\n                &lt;/ds:Signature&gt;\n            &lt;/wsse:Security&gt;\n        &lt;/soapenv:Header&gt;\n        &lt;soapenv:Body wsu:Id=&quot;id-8C92EF6DC231D5F4321700816423308694&quot;\n            xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&gt;\n            &lt;urn:SCHEMA_CC&gt;\n                &lt;IV_BP&gt;3960915933&lt;/IV_BP&gt;\n            &lt;/urn:SCHEMA_CC&gt;\n        &lt;/soapenv:Body&gt;\n    &lt;/soapenv:Envelope&gt;\n</code></pre>\n<p>My request java</p>\n<pre><code>            &lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;\n            xmlns:urn=&quot;urn:sap-com:document:sap:rfc:functions&quot;&gt;\n            &lt;soapenv:Header&gt;\n                &lt;wsse:Security\n                    xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;\n                    xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;\n                    Id=&quot;SIG-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\n                    &lt;wsu:Timestamp wsu:Id=&quot;TS-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\n                        &lt;wsu:Created&gt;2023-11-24T08:18:32Z&lt;/wsu:Created&gt;\n                        &lt;wsu:Expires&gt;2023-11-24T08:19:02Z&lt;/wsu:Expires&gt;\n                    &lt;/wsu:Timestamp&gt;\n                    &lt;wsse:BinarySecurityToken\n                        EncodingType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary&quot;\n                        ValueType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3&quot;\n                        wsu:Id=&quot;X509Token-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\n                        MIIIEjCCBfqgAwIBAgITHQAAZ/wkXidRhqKJ2wADAABn..........&lt;/wsse:BinarySecurityToken&gt;\n                    &lt;ds:Signature xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;\n                        &lt;ds:SignedInfo&gt;\n                            &lt;ds:CanonicalizationMethod Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\n                                &lt;ec:InclusiveNamespaces xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;\n                                    PrefixList=&quot;soapenv urn&quot; /&gt;\n                            &lt;/ds:CanonicalizationMethod&gt;\n                            &lt;ds:SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot; /&gt;\n                            &lt;ds:Reference URI=&quot;#Body-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\n                                &lt;ds:Transforms&gt;\n                                    &lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\n                                        &lt;ec:InclusiveNamespaces\n                                            xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;\n                                            PrefixList=&quot;wsse soapenv urn&quot; /&gt;\n                                    &lt;/ds:Transform&gt;\n                                &lt;/ds:Transforms&gt;\n                                &lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&gt;\n                                &lt;ds:DigestValue&gt;qOQ+Nv9QAe63RePMKZkCfn2a8xI=&lt;/ds:DigestValue&gt;\n                            &lt;/ds:Reference&gt;\n                            &lt;ds:Reference URI=&quot;#TS-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\n                                &lt;ds:Transforms&gt;\n                                    &lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&gt;\n                                        &lt;ec:InclusiveNamespaces\n                                            xmlns:ec=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;\n                                            PrefixList=&quot;wsse soapenv urn&quot; /&gt;\n                                    &lt;/ds:Transform&gt;\n                                &lt;/ds:Transforms&gt;\n                                &lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&gt;\n                                &lt;ds:DigestValue&gt;grbt4GpvYhKKUaetcW2HHMm91Mw=&lt;/ds:DigestValue&gt;\n                            &lt;/ds:Reference&gt;\n                        &lt;/ds:SignedInfo&gt;\n                        &lt;ds:SignatureValue&gt;agesPe4aOZPE9m1aI17MDz+oE5V7YNk7ox6q1WvmHWjd7EdH4XdqVq62dMnqkE2RRbI5TafX1qnK&amp;#13;\n                            udGLnMFcZu/gIYMUYmZ1RrwO6y39tLDWii8hEIZMYj/jIzAqi6d1jXh8GOjtmflYnIsRnidFgokV&amp;#13;\n                            /fgoMn7c548QlvEPyCokgFlS/aF4OF5uKqnb/yJ2ilRbeJBlG9QCO5rEUGmgeZ0untABzP+w76yg&amp;#13;\n                            PTkPaDTC8UHDQsG4XWMTYL+dyGfnHpYdqz5v+4BI53KfG0V7eqbdCZj9dzYN2MEel1NrgqQP2uQ8&amp;#13;\n                            .........&lt;/ds:SignatureValue&gt;\n                        &lt;ds:KeyInfo&gt;\n                            &lt;wsse:SecurityTokenReference Id=&quot;KI-1B1352404FC17AFA99AD1B962FA2A67E&quot;\n                                wsu:Id=&quot;STR-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\n                                &lt;wsse:Reference URI=&quot;#X509Token-1B1352404FC17AFA99AD1B962FA2A67E&quot;\n                                    ValueType=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3&quot; /&gt;\n                            &lt;/wsse:SecurityTokenReference&gt;\n                        &lt;/ds:KeyInfo&gt;\n                    &lt;/ds:Signature&gt;\n                &lt;/wsse:Security&gt;\n            &lt;/soapenv:Header&gt;\n            &lt;soapenv:Body\n                xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;\n                wsu:Id=&quot;Body-1B1352404FC17AFA99AD1B962FA2A67E&quot;&gt;\n                &lt;urn:GET_SCHEMA_CC xmlns:urn=&quot;http://www.example.com/urn&quot;&gt;\n                        &lt;IV_BP&gt;3960915933&lt;/IV_BP&gt;\n                \n                &lt;/urn:GET_SCHEMA_CC&gt;\n            &lt;/soapenv:Body&gt;\n        &lt;/soapenv:Envelope&gt;\n</code></pre>\n<p>The way to put the certificate in the securityBinaryToken seems correct to me, while the signature I don't know if it is the correct way to do it.</p>\n"},{"tags":["java","c#","serial-port","com-port"],"comments":[{"owner":{"account_id":957028,"reputation":15143,"user_id":982149,"accept_rate":100,"display_name":"Fildor"},"score":0,"creation_date":1700729898,"post_id":77535130,"comment_id":136690971,"body_markdown":"Is the behavior also inverted for other devices on the C# program? Meaning: The particular device in question results in ok output in C# and fails in java. Other devices result in ok output on java, but do they fail on C#? **If so**, then my guess would be that there is a configuration _on that particular device_ that&#39;s probably different from the others. If not, it cannot hurt to check that, anyway.","body":"Is the behavior also inverted for other devices on the C# program? Meaning: The particular device in question results in ok output in C# and fails in java. Other devices result in ok output on java, but do they fail on C#? <b>If so</b>, then my guess would be that there is a configuration <i>on that particular device</i> that&#39;s probably different from the others. If not, it cannot hurt to check that, anyway."},{"owner":{"account_id":957028,"reputation":15143,"user_id":982149,"accept_rate":100,"display_name":"Fildor"},"score":0,"creation_date":1700730103,"post_id":77535130,"comment_id":136691005,"body_markdown":"The interesting code would have been the implementations of the reading parts, btw. That&#39;s in C# the DataReceived-EventHandler, for example. _Maybe_ (have seen that in the past) it&#39;s as simple as a config for which line-endings to use...","body":"The interesting code would have been the implementations of the reading parts, btw. That&#39;s in C# the DataReceived-EventHandler, for example. <i>Maybe</i> (have seen that in the past) it&#39;s as simple as a config for which line-endings to use..."},{"owner":{"account_id":29972899,"reputation":21,"user_id":22969783,"display_name":"LEE Hin"},"score":0,"creation_date":1700795979,"post_id":77535130,"comment_id":136699862,"body_markdown":"no, there is no inverted result, i have also tested on some other device, and both java and c# can receive normal output, but only this particular device will return corrupted data in java while C# can still run normally, and I really have no idea on fixing the Java program.","body":"no, there is no inverted result, i have also tested on some other device, and both java and c# can receive normal output, but only this particular device will return corrupted data in java while C# can still run normally, and I really have no idea on fixing the Java program."},{"owner":{"account_id":957028,"reputation":15143,"user_id":982149,"accept_rate":100,"display_name":"Fildor"},"score":0,"creation_date":1700811379,"post_id":77535130,"comment_id":136701163,"body_markdown":"That is _very_ odd. But that also means that this very particular device must be sending data that is oh so _slightly_ different to the others&#39; that it affects the java but not C#. Right now, I cannot think of anything outside a line-ending that could do that, but there may be other things. So, if you cannot just use the C#, it may be worthwhile to inspect the raw data minisculy &quot;under the microscope&quot; to detect any systematic differences. When you find some, you&#39;ll probably be able to track down their cause and either account for it or change it or both.","body":"That is <i>very</i> odd. But that also means that this very particular device must be sending data that is oh so <i>slightly</i> different to the others&#39; that it affects the java but not C#. Right now, I cannot think of anything outside a line-ending that could do that, but there may be other things. So, if you cannot just use the C#, it may be worthwhile to inspect the raw data minisculy &quot;under the microscope&quot; to detect any systematic differences. When you find some, you&#39;ll probably be able to track down their cause and either account for it or change it or both."},{"owner":{"account_id":29972899,"reputation":21,"user_id":22969783,"display_name":"LEE Hin"},"score":0,"creation_date":1701048786,"post_id":77535130,"comment_id":136723036,"body_markdown":"Thank you very much, I will try to investigate in this direction","body":"Thank you very much, I will try to investigate in this direction"}],"answers":[{"comments":[{"owner":{"account_id":29972899,"reputation":21,"user_id":22969783,"display_name":"LEE Hin"},"score":0,"creation_date":1700728449,"post_id":77535254,"comment_id":136690707,"body_markdown":"I&#39;m very sorry. I just discovered that I made a typo in the C# part. In fact, when I was testing this device, the settings for both programs were exactly the same.","body":"I&#39;m very sorry. I just discovered that I made a typo in the C# part. In fact, when I was testing this device, the settings for both programs were exactly the same."},{"owner":{"account_id":9777748,"reputation":1129,"user_id":7247051,"accept_rate":100,"display_name":"Ihdina"},"score":0,"creation_date":1700730276,"post_id":77535254,"comment_id":136691037,"body_markdown":"@LEEHin Look at https://github.com/Fazecast/jSerialComm/wiki/Usage-Examples  and choose according to your needs. You can choose `Event Based Reading`, because C# uses events too.","body":"@LEEHin Look at <a href=\"https://github.com/Fazecast/jSerialComm/wiki/Usage-Examples\" rel=\"nofollow noreferrer\">github.com/Fazecast/jSerialComm/wiki/Usage-Examples</a>  and choose according to your needs. You can choose <code>Event Based Reading</code>, because C# uses events too."},{"owner":{"account_id":29972899,"reputation":21,"user_id":22969783,"display_name":"LEE Hin"},"score":0,"creation_date":1700794780,"post_id":77535254,"comment_id":136699786,"body_markdown":"I did use Event Based Reading in my java program, but still receiving the corrupted data, I just add the code section of Data listening of both program.","body":"I did use Event Based Reading in my java program, but still receiving the corrupted data, I just add the code section of Data listening of both program."},{"owner":{"account_id":9777748,"reputation":1129,"user_id":7247051,"accept_rate":100,"display_name":"Ihdina"},"score":0,"creation_date":1700804090,"post_id":77535254,"comment_id":136700378,"body_markdown":"@LEEHin I have added the code, please try it.","body":"@LEEHin I have added the code, please try it."},{"owner":{"account_id":9777748,"reputation":1129,"user_id":7247051,"accept_rate":100,"display_name":"Ihdina"},"score":0,"creation_date":1700816292,"post_id":77535254,"comment_id":136701929,"body_markdown":"@LEEHin Is the `last character` of your package a `CR LF` character? if so, you can use `ByteArrayOutputStream` to collect `readBuffer` until `CR LF` character are found. Don&#39;t forget to `reset()` the stream when the data has been found.","body":"@LEEHin Is the <code>last character</code> of your package a <code>CR LF</code> character? if so, you can use <code>ByteArrayOutputStream</code> to collect <code>readBuffer</code> until <code>CR LF</code> character are found. Don&#39;t forget to <code>reset()</code> the stream when the data has been found."},{"owner":{"account_id":29972899,"reputation":21,"user_id":22969783,"display_name":"LEE Hin"},"score":0,"creation_date":1701048661,"post_id":77535254,"comment_id":136723026,"body_markdown":"Yes, my data does contain ```CR LF```. My java program will write log and proceed to the next step after receiving ```CR LF```. And the result is shown as the above java log.","body":"Yes, my data does contain <code>CR LF</code>. My java program will write log and proceed to the next step after receiving <code>CR LF</code>. And the result is shown as the above java log."},{"owner":{"account_id":9777748,"reputation":1129,"user_id":7247051,"accept_rate":100,"display_name":"Ihdina"},"score":0,"creation_date":1701105187,"post_id":77535254,"comment_id":136731122,"body_markdown":"@LEEHin I have updated the code,","body":"@LEEHin I have updated the code,"}],"tags":[],"owner":{"account_id":9777748,"reputation":1129,"user_id":7247051,"accept_rate":100,"display_name":"Ihdina"},"comment_count":7,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701105090,"creation_date":1700727063,"answer_id":77535254,"question_id":77535130,"body_markdown":"Try like this:\r\n\r\n\timport java.io.ByteArrayOutputStream;\r\n\timport java.io.IOException;\r\n\timport java.util.Arrays;\r\n\r\n    private final static char CR = (char)0x0D;\r\n    private final static char LF = (char)0x0A;\r\n    private final static ByteArrayOutputStream stream = new ByteArrayOutputStream();\r\n\r\n    public static String bytesToHex(byte[] bytes) {\r\n        StringBuilder sb = new StringBuilder();\r\n        for (byte b : bytes) {\r\n          sb.append(String.format(&quot;%02x&quot;, b));\r\n        }\r\n        return sb.toString();\r\n    }\r\n\r\n\tpublic void readComm() {\r\n\t\ttry {\r\n\t\t\t\r\n\t\t\t// if data available\r\n\t\t\tint length = serialPort.bytesAvailable();\r\n\r\n\t\t\tif(length &gt; 0) {\t\t\r\n\r\n\t\t\t\t// read buffer\r\n\t\t\t\tbyte[] readBuffer = new byte[length];\r\n\t\t\t\t\r\n\t\t\t\t// read bytes and store in read readBuffer\r\n\t\t\t\tint numRead = serialPort.readBytes(readBuffer, readBuffer.length);\r\n\r\n\t\t\t\t// print length of data\r\n\t\t\t\tSystem.out.println(&quot;Read &quot; + numRead + &quot; bytes.&quot;);\r\n\r\n                // append data to stream \r\n                stream.write(readBuffer);\r\n\r\n                // stream to byte array\r\n                byte[] packets = stream.toByteArray();\r\n\r\n                // parsing data\r\n                for (int i = 0; i &lt; packets.length; ++i) {\t\t\t\t\r\n\r\n\t\t\t\t\t// detect CR LF on packets\r\n                    if(((char)packets[i] == CR) &amp;&amp; ((char)packets[i+1] == LF)) {\r\n\r\n\t\t\t\t\t\t// read completed data\r\n\t\t\t\t\t\tbyte[] completed = Arrays.copyOfRange(packets, 0, i);\r\n\t\t\t\t\t\tSystem.out.println(bytesToHex(completed));\r\n\r\n\t\t\t\t\t\t// stream discarded\r\n\t\t\t\t\t\tstream.reset(); \r\n\r\n                        // out looping\r\n                        break;\r\n                    }\r\n                }\r\n\t\t\t}\r\n\t\t} catch (Exception ex) {\r\n\t\t\tSystem.out.println(ex.getMessage());\r\n\t\t}\r\n\t}","title":"Data corruption issue in Java program using jSerialComm library, but in C# it is OK","body":"<p>Try like this:</p>\n<pre><code>import java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.util.Arrays;\n\nprivate final static char CR = (char)0x0D;\nprivate final static char LF = (char)0x0A;\nprivate final static ByteArrayOutputStream stream = new ByteArrayOutputStream();\n\npublic static String bytesToHex(byte[] bytes) {\n    StringBuilder sb = new StringBuilder();\n    for (byte b : bytes) {\n      sb.append(String.format(&quot;%02x&quot;, b));\n    }\n    return sb.toString();\n}\n\npublic void readComm() {\n    try {\n        \n        // if data available\n        int length = serialPort.bytesAvailable();\n\n        if(length &gt; 0) {        \n\n            // read buffer\n            byte[] readBuffer = new byte[length];\n            \n            // read bytes and store in read readBuffer\n            int numRead = serialPort.readBytes(readBuffer, readBuffer.length);\n\n            // print length of data\n            System.out.println(&quot;Read &quot; + numRead + &quot; bytes.&quot;);\n\n            // append data to stream \n            stream.write(readBuffer);\n\n            // stream to byte array\n            byte[] packets = stream.toByteArray();\n\n            // parsing data\n            for (int i = 0; i &lt; packets.length; ++i) {              \n\n                // detect CR LF on packets\n                if(((char)packets[i] == CR) &amp;&amp; ((char)packets[i+1] == LF)) {\n\n                    // read completed data\n                    byte[] completed = Arrays.copyOfRange(packets, 0, i);\n                    System.out.println(bytesToHex(completed));\n\n                    // stream discarded\n                    stream.reset(); \n\n                    // out looping\n                    break;\n                }\n            }\n        }\n    } catch (Exception ex) {\n        System.out.println(ex.getMessage());\n    }\n}\n</code></pre>\n"}],"owner":{"account_id":29972899,"reputation":21,"user_id":22969783,"display_name":"LEE Hin"},"comment_count":5,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":104,"favorite_count":0,"down_vote_count":0,"up_vote_count":2,"answer_count":1,"score":2,"last_activity_date":1701105090,"creation_date":1700725584,"question_id":77535130,"body_markdown":"I have a Java program that communicates with various devices to retrieve data via serial communication. I&#39;m using the jSerialComm library for this purpose.\r\n\r\nHowever, when I retrieve data from a particular device using this Java program, the data appears to be corrupted.\r\n\r\nSurprisingly, when I use a C# program without any external libraries to retrieve data from the same device, the data is received correctly, without any corruption.\r\n\r\nThe device configuration settings are as follows:\r\n\r\n```\r\nPort: COM3\r\nBaudRate: 2400\r\nParity: EVEN\r\nDatabits: 7\r\nStopbits: 1\r\n```\r\n- In my Java program, I&#39;m using the jSerialComm library, while in the C# program, I&#39;m not utilizing any external libraries.\r\n\r\n- My Java program can successfully detect and retrieve normal data from other devices using the same communication settings. The data corruption issue seems to be specific to this particular device.\r\n\r\nI have compared the logs from both programs and observed that the C# program consistently receives the expected data, whereas the Java program consistently receives corrupted data from this specific device. I have also attempted to modify the baud rate and parity settings in the Java program, but the issue persists.\r\n\r\nJava Program Connect Device:\r\n\r\n```\r\nSerialPort[] serialPorts = SerialPort.getCommPorts();\r\nfor (SerialPort port : serialPorts) {\r\n                if (DEVICE_PORT.equals(port.getSystemPortName())) {\r\n                    bolFound = true;\r\n                    serialPort = port;\r\n                    try {\r\n                        log.info(&quot;Opening port &#39;&quot; + DEVICE_PORT + &quot;&#39;...&quot;);\r\n                        log.info(&quot;Connecting to device &#39;&quot; + DEVICE_NAME + &quot;&#39;...&quot;);\r\n\r\n                        serialPort.setComPortParameters(DEVICE_RATE, DEVICE_DATABITS, DEVICE_STOPBITS, DEVICE_PARITY);\r\n                        serialPort.addDataListener(this);\r\n                        serialPort.openPort();\r\n\r\n...........\r\n```\r\nJava Data listening:\r\n```\r\n@Override\r\npublic int getListeningEvents() {\r\n    return SerialPort.LISTENING_EVENT_DATA_AVAILABLE;\r\n}\r\n\r\n@Override\r\npublic void serialEvent(SerialPortEvent event) {\r\n    switch (event.getEventType()) {\r\n        case SerialPort.LISTENING_EVENT_DATA_AVAILABLE:\r\n            readComm();\r\n            break;\r\n        default:\r\n            log.info(&quot;XXX default&quot;);\r\n            break;\r\n    }\r\n}\r\n\r\npublic void readComm() {\r\n\tlog.info(AppConfig.getInstance().getProperty(AppConfig.KEY_TEST_PORT, String.class) + &quot; Reading Comm...&quot;);\r\n\tbyte[] readBuffer = new byte[1024];\r\n\ttry {\r\n\t\tinputStream = serialPort.getInputStream();\r\n\t\tint len = 0;\r\n\t\t\t\r\n\t\twhile ((len = inputStream.read(readBuffer)) != -1) {\r\n\t\t\tlog.info(&quot;Real Time Response:&quot; + new String(readBuffer, 0, len));\r\n\t\t\tvalue += new String(readBuffer, 0, len);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlog.info(&quot;value:&quot; + value);\r\n\r\n\t\tif (isDataReady) {\r\n\t\t\t// process data\r\n\t\t\tvalue = &quot;&quot;; //reset data\r\n\t\t}\r\n\r\n\t} catch (IOException e) {\r\n\t\tintNumberOfFailure++;\r\n\t}\r\n}\r\n```\r\n\r\nJava Program Log File:\r\n```\r\n2023-11-09 10:38:58.165  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Trying to init Test Listener (COM5)...\r\n2023-11-09 10:38:58.350  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Opening port &#39;COM5&#39;...\r\n2023-11-09 10:38:58.350  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Connecting to device &#39;Testing&#39;...\r\n2023-11-09 10:38:58.350  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Opening port &#39;COM5&#39; Success\r\n2023-11-09 10:38:58.350  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Connecting to device &#39;Testing&#39; Success\r\n2023-11-09 10:38:59.211  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\r\n2023-11-09 10:38:59.215  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:[ \r\n2023-11-09 10:38:59.217  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ \r\n2023-11-09 10:38:59.219  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\r\n2023-11-09 10:38:59.221  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:l\r\n2023-11-09 10:38:59.222  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l\r\n2023-11-09 10:38:59.225  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\r\n2023-11-09 10:38:59.227  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:@\t1\r\n2023-11-09 10:38:59.229  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@\t1\r\n2023-11-09 10:39:00.215  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\r\n2023-11-09 10:39:00.215  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:{=Um%\r\n2023-11-09 10:39:00.226  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@\t1{=Um%\r\n2023-11-09 10:39:00.230  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\r\n2023-11-09 10:39:00.232  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:l\r\n2023-11-09 10:39:00.232  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@\t1{=Um%l\r\n2023-11-09 10:39:00.236  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\r\n2023-11-09 10:39:00.237  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response: ,a\r\n2023-11-09 10:39:00.238  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@\t1{=Um%l ,a\r\n2023-11-09 10:39:00.241  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\r\n2023-11-09 10:39:00.242  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response: \r\n2023-11-09 10:39:00.243  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@\t1{=Um%l ,a \r\n2023-11-09 10:39:01.202  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\r\n2023-11-09 10:39:01.217  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:  \r\n2023-11-09 10:39:01.217  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@\t1{=Um%l ,a   \r\n\r\n```\r\nC# Program Connect Device:\r\n\r\n```\r\nstring portName = &quot;COM3&quot;;\r\nint baudRate = 2400;\r\nParity parity = Parity.Even;\r\nint dataBits = 7;\r\nStopBits stopBits = StopBits.One;\r\n\r\n_serialPort = new SerialPort(portName, baudRate, parity, dataBits, stopBits);\r\n\r\n_serialPort.DataReceived += SerialPort_DataReceived;\r\n\r\n_serialPort.Open();\r\n```\r\nC# Program Data listening:\r\n\r\n```\r\nConsole.WriteLine(&quot;Serial port opened. Press Enter to stop reading.&quot;);\r\n        _logWriter = new StreamWriter(&quot;log.txt&quot;, true);\r\n\r\n        while (true)\r\n        {\r\n            if (_serialPort.BytesToRead &gt; 0)\r\n            {\r\n                string data = _serialPort.ReadExisting();\r\n                DateTime now = DateTime.Now;\r\n\r\n                string logMessage = $&quot;[{now}] Received data: {data}&quot;;\r\n\r\n                Console.WriteLine(logMessage);\r\n                _logWriter.WriteLine($&quot;[{now}] Received data: {data}&quot;);\r\n                _logWriter.Flush(); // Flush the buffer to ensure data is written immediately\r\n\r\n            }\r\n        }\r\n```\r\n\r\nC# Program Log File:\r\n\r\n```\r\n[09/11/2023 10:53:09] Received data: US,+000091.50 kg\r\n\r\n[09/11/2023 10:53:09] Received data: US,+000091.50 kg\r\n\r\n[09/11/2023 10:53:10] Received data: US,+000091.50 kg\r\n\r\n[09/11/2023 10:53:10] Received data: US,+000091.50 kg\r\n\r\n[09/11/2023 10:53:10] Received data: S\r\n[09/11/2023 10:53:10] Received data: T,+171.4 cm\r\n\r\n[09/11/2023 10:53:11] Received data: ST,+000091.50 kg\r\n\r\n[09/11/2023 10:53:11] Received data: US,+0000\r\n[09/11/2023 10:53:11] Received data: 91.50 kg\r\n\r\n[09/11/2023 10:53:12] Received data: US,+000091.50 kg\r\n\r\n[09/11/2023 10:53:12] Received data: US,+000091.50 kg\r\n\r\n[09/11/2023 10:53:13] Received data: US,+00\r\n[09/11/2023 10:53:13] Received data: 0091.50 kg\r\n\r\n[09/11/2023 10:53:13] Received data: US,+000091.50 kg\r\n```\r\nMy goal is to understand why the Java program using the jSerialComm library encounters data corruption only with this specific device, while it can successfully retrieve normal data from other devices. How to modify my Java program to receive the data correctly from this particular device?","title":"Data corruption issue in Java program using jSerialComm library, but in C# it is OK","body":"<p>I have a Java program that communicates with various devices to retrieve data via serial communication. I'm using the jSerialComm library for this purpose.</p>\n<p>However, when I retrieve data from a particular device using this Java program, the data appears to be corrupted.</p>\n<p>Surprisingly, when I use a C# program without any external libraries to retrieve data from the same device, the data is received correctly, without any corruption.</p>\n<p>The device configuration settings are as follows:</p>\n<pre><code>Port: COM3\nBaudRate: 2400\nParity: EVEN\nDatabits: 7\nStopbits: 1\n</code></pre>\n<ul>\n<li><p>In my Java program, I'm using the jSerialComm library, while in the C# program, I'm not utilizing any external libraries.</p>\n</li>\n<li><p>My Java program can successfully detect and retrieve normal data from other devices using the same communication settings. The data corruption issue seems to be specific to this particular device.</p>\n</li>\n</ul>\n<p>I have compared the logs from both programs and observed that the C# program consistently receives the expected data, whereas the Java program consistently receives corrupted data from this specific device. I have also attempted to modify the baud rate and parity settings in the Java program, but the issue persists.</p>\n<p>Java Program Connect Device:</p>\n<pre><code>SerialPort[] serialPorts = SerialPort.getCommPorts();\nfor (SerialPort port : serialPorts) {\n                if (DEVICE_PORT.equals(port.getSystemPortName())) {\n                    bolFound = true;\n                    serialPort = port;\n                    try {\n                        log.info(&quot;Opening port '&quot; + DEVICE_PORT + &quot;'...&quot;);\n                        log.info(&quot;Connecting to device '&quot; + DEVICE_NAME + &quot;'...&quot;);\n\n                        serialPort.setComPortParameters(DEVICE_RATE, DEVICE_DATABITS, DEVICE_STOPBITS, DEVICE_PARITY);\n                        serialPort.addDataListener(this);\n                        serialPort.openPort();\n\n...........\n</code></pre>\n<p>Java Data listening:</p>\n<pre><code>@Override\npublic int getListeningEvents() {\n    return SerialPort.LISTENING_EVENT_DATA_AVAILABLE;\n}\n\n@Override\npublic void serialEvent(SerialPortEvent event) {\n    switch (event.getEventType()) {\n        case SerialPort.LISTENING_EVENT_DATA_AVAILABLE:\n            readComm();\n            break;\n        default:\n            log.info(&quot;XXX default&quot;);\n            break;\n    }\n}\n\npublic void readComm() {\n    log.info(AppConfig.getInstance().getProperty(AppConfig.KEY_TEST_PORT, String.class) + &quot; Reading Comm...&quot;);\n    byte[] readBuffer = new byte[1024];\n    try {\n        inputStream = serialPort.getInputStream();\n        int len = 0;\n            \n        while ((len = inputStream.read(readBuffer)) != -1) {\n            log.info(&quot;Real Time Response:&quot; + new String(readBuffer, 0, len));\n            value += new String(readBuffer, 0, len);\n            break;\n        }\n        log.info(&quot;value:&quot; + value);\n\n        if (isDataReady) {\n            // process data\n            value = &quot;&quot;; //reset data\n        }\n\n    } catch (IOException e) {\n        intNumberOfFailure++;\n    }\n}\n</code></pre>\n<p>Java Program Log File:</p>\n<pre><code>2023-11-09 10:38:58.165  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Trying to init Test Listener (COM5)...\n2023-11-09 10:38:58.350  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Opening port 'COM5'...\n2023-11-09 10:38:58.350  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Connecting to device 'Testing'...\n2023-11-09 10:38:58.350  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Opening port 'COM5' Success\n2023-11-09 10:38:58.350  INFO 21320 [Thread-117 thread] h.h.c.v.l.BaseListener                   : Connecting to device 'Testing' Success\n2023-11-09 10:38:59.211  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\n2023-11-09 10:38:59.215  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:[ \n2023-11-09 10:38:59.217  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ \n2023-11-09 10:38:59.219  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\n2023-11-09 10:38:59.221  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:l\n2023-11-09 10:38:59.222  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l\n2023-11-09 10:38:59.225  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\n2023-11-09 10:38:59.227  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:@ 1\n2023-11-09 10:38:59.229  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@   1\n2023-11-09 10:39:00.215  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\n2023-11-09 10:39:00.215  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:{=Um%\n2023-11-09 10:39:00.226  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@   1{=Um%\n2023-11-09 10:39:00.230  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\n2023-11-09 10:39:00.232  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:l\n2023-11-09 10:39:00.232  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@   1{=Um%l\n2023-11-09 10:39:00.236  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\n2023-11-09 10:39:00.237  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response: ,a\n2023-11-09 10:39:00.238  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@   1{=Um%l ,a\n2023-11-09 10:39:00.241  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\n2023-11-09 10:39:00.242  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response: \n2023-11-09 10:39:00.243  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@   1{=Um%l ,a \n2023-11-09 10:39:01.202  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : COM5 Reading Comm...\n2023-11-09 10:39:01.217  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : Real Time Response:  \n2023-11-09 10:39:01.217  INFO 21320 [Thread-120 thread] h.h.c.v.l.TestListener                   : value:[ l@   1{=Um%l ,a   \n\n</code></pre>\n<p>C# Program Connect Device:</p>\n<pre><code>string portName = &quot;COM3&quot;;\nint baudRate = 2400;\nParity parity = Parity.Even;\nint dataBits = 7;\nStopBits stopBits = StopBits.One;\n\n_serialPort = new SerialPort(portName, baudRate, parity, dataBits, stopBits);\n\n_serialPort.DataReceived += SerialPort_DataReceived;\n\n_serialPort.Open();\n</code></pre>\n<p>C# Program Data listening:</p>\n<pre><code>Console.WriteLine(&quot;Serial port opened. Press Enter to stop reading.&quot;);\n        _logWriter = new StreamWriter(&quot;log.txt&quot;, true);\n\n        while (true)\n        {\n            if (_serialPort.BytesToRead &gt; 0)\n            {\n                string data = _serialPort.ReadExisting();\n                DateTime now = DateTime.Now;\n\n                string logMessage = $&quot;[{now}] Received data: {data}&quot;;\n\n                Console.WriteLine(logMessage);\n                _logWriter.WriteLine($&quot;[{now}] Received data: {data}&quot;);\n                _logWriter.Flush(); // Flush the buffer to ensure data is written immediately\n\n            }\n        }\n</code></pre>\n<p>C# Program Log File:</p>\n<pre><code>[09/11/2023 10:53:09] Received data: US,+000091.50 kg\n\n[09/11/2023 10:53:09] Received data: US,+000091.50 kg\n\n[09/11/2023 10:53:10] Received data: US,+000091.50 kg\n\n[09/11/2023 10:53:10] Received data: US,+000091.50 kg\n\n[09/11/2023 10:53:10] Received data: S\n[09/11/2023 10:53:10] Received data: T,+171.4 cm\n\n[09/11/2023 10:53:11] Received data: ST,+000091.50 kg\n\n[09/11/2023 10:53:11] Received data: US,+0000\n[09/11/2023 10:53:11] Received data: 91.50 kg\n\n[09/11/2023 10:53:12] Received data: US,+000091.50 kg\n\n[09/11/2023 10:53:12] Received data: US,+000091.50 kg\n\n[09/11/2023 10:53:13] Received data: US,+00\n[09/11/2023 10:53:13] Received data: 0091.50 kg\n\n[09/11/2023 10:53:13] Received data: US,+000091.50 kg\n</code></pre>\n<p>My goal is to understand why the Java program using the jSerialComm library encounters data corruption only with this specific device, while it can successfully retrieve normal data from other devices. How to modify my Java program to receive the data correctly from this particular device?</p>\n"},{"tags":["java","spring-boot","gradle","openapi","openapi-generator"],"comments":[{"owner":{"account_id":18136109,"reputation":21,"user_id":13190636,"display_name":"altrof"},"score":0,"creation_date":1701248601,"post_id":77557530,"comment_id":136750912,"body_markdown":"@ojacomarket Yes I tried. But ChatGPT didn&#39;t provide any good solutions. I think in this case ChatGPT can&#39;t give any solution.","body":"@ojacomarket Yes I tried. But ChatGPT didn&#39;t provide any good solutions. I think in this case ChatGPT can&#39;t give any solution."}],"owner":{"account_id":18136109,"reputation":21,"user_id":13190636,"display_name":"altrof"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":91,"favorite_count":0,"down_vote_count":0,"up_vote_count":2,"answer_count":0,"score":2,"last_activity_date":1701105048,"creation_date":1701094165,"question_id":77557530,"body_markdown":"My current setup for OpenAPI Generator in `build.gradle`.\r\n\r\n```groovy\r\ndef openApiGeneratorConfig = {\r\n    classpath configurations.openApiGenerator\r\n    systemProperties = [&quot;apis&quot;: &quot;&quot;, &quot;models&quot;: &quot;&quot;]\r\n    mainClass = &#39;org.openapitools.codegen.OpenAPIGenerator&#39;\r\n    args &#39;generate&#39;\r\n    args &#39;-o&#39;, &quot;$rootDir/external&quot;\r\n    args &#39;-t&#39;, &quot;$rootDir/external/src/main/resources/codegen/templates/&quot;\r\n    args &#39;--skip-validate-spec&#39;\r\n    args &quot;--import-mappings&quot;, &quot;Instant=java.time.Instant,YearMonth=java.time.YearMonth,LocalDateTime=java.time.LocalDateTime&quot;\r\n    args &quot;--type-mappings&quot;, &quot;double=BigDecimal&quot;\r\n}\r\n\r\ndef configFilesRoute = &quot;$rootDir/external/src/main/resources/config/swagger&quot;\r\n\r\ntask generateExternalApiClient(type: JavaExec) {\r\n    configure openApiGeneratorConfig\r\n    systemProperties = [&quot;apis&quot;: &quot;ContractSearch#findContractByCustomerId&quot;]\r\n    args &quot;-i&quot;, &quot;http://localhost:9901/v2/api-docs&quot;\r\n    args &quot;-c&quot;, &quot;$configFilesRoute/loan.json&quot;\r\n}\r\n```\r\n\r\nIn `ContractSearch` (Api) I have a lot of endpoints (operations) and I need to generate only one specific endpoint.\r\nSo before this (migrate to OpenAPI Generator), I used Swagger CodeGen and if I specified the operation after api with using symbol # as separator, then it worked fine, and it generated only one specific endpoint. \r\nBut now after migrating to OpenAPI Generator, it is not work in this behaviour. I googled and also checked documentation, didn&#39;t find any answer to my question.\r\n\r\nJava 17. Spring Boot 2.7, Gradle 8.2, OpenAPI Generator CLI 6.6.0\r\n\r\n\r\nI tried adding difference arguments in OpenAPI config, but also didn&#39;t help me.","title":"Generate only one specific endpoint from API","body":"<p>My current setup for OpenAPI Generator in <code>build.gradle</code>.</p>\n<pre><code>def openApiGeneratorConfig = {\n    classpath configurations.openApiGenerator\n    systemProperties = [&quot;apis&quot;: &quot;&quot;, &quot;models&quot;: &quot;&quot;]\n    mainClass = 'org.openapitools.codegen.OpenAPIGenerator'\n    args 'generate'\n    args '-o', &quot;$rootDir/external&quot;\n    args '-t', &quot;$rootDir/external/src/main/resources/codegen/templates/&quot;\n    args '--skip-validate-spec'\n    args &quot;--import-mappings&quot;, &quot;Instant=java.time.Instant,YearMonth=java.time.YearMonth,LocalDateTime=java.time.LocalDateTime&quot;\n    args &quot;--type-mappings&quot;, &quot;double=BigDecimal&quot;\n}\n\ndef configFilesRoute = &quot;$rootDir/external/src/main/resources/config/swagger&quot;\n\ntask generateExternalApiClient(type: JavaExec) {\n    configure openApiGeneratorConfig\n    systemProperties = [&quot;apis&quot;: &quot;ContractSearch#findContractByCustomerId&quot;]\n    args &quot;-i&quot;, &quot;http://localhost:9901/v2/api-docs&quot;\n    args &quot;-c&quot;, &quot;$configFilesRoute/loan.json&quot;\n}\n</code></pre>\n<p>In <code>ContractSearch</code> (Api) I have a lot of endpoints (operations) and I need to generate only one specific endpoint.\nSo before this (migrate to OpenAPI Generator), I used Swagger CodeGen and if I specified the operation after api with using symbol # as separator, then it worked fine, and it generated only one specific endpoint.\nBut now after migrating to OpenAPI Generator, it is not work in this behaviour. I googled and also checked documentation, didn't find any answer to my question.</p>\n<p>Java 17. Spring Boot 2.7, Gradle 8.2, OpenAPI Generator CLI 6.6.0</p>\n<p>I tried adding difference arguments in OpenAPI config, but also didn't help me.</p>\n"},{"tags":["java","sockets","tcp","netstat"],"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":1,"creation_date":1532024965,"post_id":51429224,"comment_id":89830196,"body_markdown":"What is `socket.accept(15000)`?","body":"What is <code>socket.accept(15000)</code>?"},{"owner":{"account_id":3540948,"reputation":5877,"user_id":2958086,"display_name":"Compass"},"score":0,"creation_date":1532025244,"post_id":51429224,"comment_id":89830340,"body_markdown":"Can you guarantee the service has stopped properly when told to stop?","body":"Can you guarantee the service has stopped properly when told to stop?"},{"owner":{"account_id":1977884,"reputation":346,"user_id":1775246,"display_name":"sbrisson"},"score":0,"creation_date":1532025800,"post_id":51429224,"comment_id":89830583,"body_markdown":"@EJP Fixed, I was meaning setSoTimeout(15000).","body":"@EJP Fixed, I was meaning setSoTimeout(15000)."},{"owner":{"account_id":1977884,"reputation":346,"user_id":1775246,"display_name":"sbrisson"},"score":0,"creation_date":1532025944,"post_id":51429224,"comment_id":89830656,"body_markdown":"@Compass The process is no longer listed in Task Manager nor ProcessExplorer.  I also get my last log message 2018-07-19 04:05:02,875 [main] INFO  CommunicationCoreServer - has shut down.","body":"@Compass The process is no longer listed in Task Manager nor ProcessExplorer.  I also get my last log message 2018-07-19 04:05:02,875 [main] INFO  CommunicationCoreServer - has shut down."},{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1532025986,"post_id":51429224,"comment_id":89830675,"body_markdown":"What does setting an accept timeout have to do with it?","body":"What does setting an accept timeout have to do with it?"},{"owner":{"account_id":1977884,"reputation":346,"user_id":1775246,"display_name":"sbrisson"},"score":0,"creation_date":1532026389,"post_id":51429224,"comment_id":89830891,"body_markdown":"@EJP  I had read that we should never do a infinite timeout on accept.  Somebody saw issues (socket remained opened) with multi-core processors and infinite accept on socket.","body":"@EJP  I had read that we should never do a infinite timeout on accept.  Somebody saw issues (socket remained opened) with multi-core processors and infinite accept on socket."},{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1532026530,"post_id":51429224,"comment_id":89830954,"body_markdown":"Read it where? Somebody such as who?","body":"Read it where? Somebody such as who?"},{"owner":{"account_id":1977884,"reputation":346,"user_id":1775246,"display_name":"sbrisson"},"score":0,"creation_date":1532027627,"post_id":51429224,"comment_id":89831465,"body_markdown":"@EJP Did a lot of search.  Can&#39;t find back the link.  Anyway, I agree that it shouldn&#39;t be related to the issue.  It did not fixed the problem anyway.","body":"@EJP Did a lot of search.  Can&#39;t find back the link.  Anyway, I agree that it shouldn&#39;t be related to the issue.  It did not fixed the problem anyway."}],"answers":[{"comments":[{"owner":{"account_id":1977884,"reputation":346,"user_id":1775246,"display_name":"sbrisson"},"score":0,"creation_date":1535033031,"post_id":51669524,"comment_id":90924843,"body_markdown":"Did you found a solution ?  Or maybe which Windows KB cause the issue ?","body":"Did you found a solution ?  Or maybe which Windows KB cause the issue ?"}],"tags":[],"owner":{"account_id":1008829,"reputation":151,"user_id":1021863,"display_name":"JoSeMa"},"comment_count":1,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1533288628,"creation_date":1533288628,"answer_id":51669524,"question_id":51429224,"body_markdown":"\r\nI am on the same problem here. I&#39;ve got several Java instances running as servers but as soon as any of those Java applications is killed and restarted then they fail to do so complaining that the port is still in use. Never happened before and I used to restart them every now and then.\r\n\r\nMy Windows server machine also received some new updates a few days ago.\r\n\r\nBy the way, I am using a tool to monitor ports and applications and those ports are not being used by any program, so the application is actually killed.\r\n\r\n","title":"Address already in use: JVM_Bind but no process is listed using port with netstat","body":"<p>I am on the same problem here. I've got several Java instances running as servers but as soon as any of those Java applications is killed and restarted then they fail to do so complaining that the port is still in use. Never happened before and I used to restart them every now and then.</p>\n\n<p>My Windows server machine also received some new updates a few days ago.</p>\n\n<p>By the way, I am using a tool to monitor ports and applications and those ports are not being used by any program, so the application is actually killed.</p>\n"},{"comments":[{"owner":{"account_id":4791763,"reputation":5956,"user_id":3870761,"accept_rate":75,"display_name":"sergioFC"},"score":0,"creation_date":1580579444,"post_id":52059620,"comment_id":106146958,"body_markdown":"Updating windows 7, as per the linked answer, solved our problem too. Thank you","body":"Updating windows 7, as per the linked answer, solved our problem too. Thank you"}],"tags":[],"owner":{"account_id":1977884,"reputation":346,"user_id":1775246,"display_name":"sbrisson"},"comment_count":1,"down_vote_count":0,"up_vote_count":2,"is_accepted":true,"score":2,"last_activity_date":1535464496,"creation_date":1535464496,"answer_id":52059620,"question_id":51429224,"body_markdown":"\r\nA windows update affected the release of address/port after process shutdown.\r\n\r\nRefer to https://stackoverflow.com/questions/51666952/address-bind-exception-in-tomcat for solution.\r\n","title":"Address already in use: JVM_Bind but no process is listed using port with netstat","body":"<p>A windows update affected the release of address/port after process shutdown.</p>\n\n<p>Refer to <a href=\"https://stackoverflow.com/questions/51666952/address-bind-exception-in-tomcat\">Address Bind exception in Tomcat</a> for solution.</p>\n"},{"tags":[],"owner":{"account_id":19257070,"reputation":45,"user_id":14073726,"display_name":"Hackerman"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1701104970,"creation_date":1701104970,"answer_id":77558730,"question_id":51429224,"body_markdown":"I just ran into a similar scenario. I am building a java webserver, it uses mysql-j-connector for sql. \r\n\r\nMy goal was to upgrade the server, so first I shut it down via the administrative client. I compiled and tried to run the new version but it returned an error saying the address was already in use. I tried  using multiple tools (with and without root access) to try to shut down the process using the target port, but nothing worked. \r\n\r\nWhat I did to fix it was to use Htop\r\n\r\n    htop\r\n\r\nturns out the mysql-j-connectior was still running, am not sure why. I killed that process (which as mentioned before did not register as using the desired port number) and after that I was able to run the server. ","title":"Address already in use: JVM_Bind but no process is listed using port with netstat","body":"<p>I just ran into a similar scenario. I am building a java webserver, it uses mysql-j-connector for sql.</p>\n<p>My goal was to upgrade the server, so first I shut it down via the administrative client. I compiled and tried to run the new version but it returned an error saying the address was already in use. I tried  using multiple tools (with and without root access) to try to shut down the process using the target port, but nothing worked.</p>\n<p>What I did to fix it was to use Htop</p>\n<pre><code>htop\n</code></pre>\n<p>turns out the mysql-j-connectior was still running, am not sure why. I killed that process (which as mentioned before did not register as using the desired port number) and after that I was able to run the server.</p>\n"}],"owner":{"account_id":1977884,"reputation":346,"user_id":1775246,"display_name":"sbrisson"},"comment_count":8,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":1829,"favorite_count":0,"down_vote_count":1,"up_vote_count":4,"accepted_answer_id":52059620,"answer_count":3,"score":3,"last_activity_date":1701104970,"creation_date":1532023452,"question_id":51429224,"body_markdown":"I have a java process that make use of ServerSocket API (Java 8) and bind to the local port 12000.  Process runs under a Windows service Wrapper (exe4j).  I have a scheduled task that runs at 4am that stop the service and restart it after a couple of seconds.  That process is installed over 400 customers locations.\r\n\r\nEverything was running smooth until about last friday.  A few processes failed to restart properly at 4am.  On 2 servers I was able to connect and verify, the restart failed with both a &quot;Address already in use: JVM_Bind&quot;.  It&#39;s seems that the port 12000 was still in use by a the system.  \r\n\r\nI used every tools (processexplorer, tcpview, netstat -ano, name it) I know to try to find the process... with no success.  Only a machine reboot fixed the issue.  But problem came back a night or two later.  \r\n\r\nAfter some reading, I saw that I was doing a `sockect.accept()` with infinite timeout so I changed it for \r\n`\r\nsocket.setSoTimeout(15000);\r\nsocket.accept();\r\n` \r\ninstead.\r\n\r\nI putted the new version in place but the problem is still there.\r\n\r\nMachines got Windows updates. I did tests with the same Windows version fully updated but I can&#39;t reproduce.\r\n\r\nI&#39;m out of solution now.\r\n\r\nAny ideas\r\nThanks","title":"Address already in use: JVM_Bind but no process is listed using port with netstat","body":"<p>I have a java process that make use of ServerSocket API (Java 8) and bind to the local port 12000.  Process runs under a Windows service Wrapper (exe4j).  I have a scheduled task that runs at 4am that stop the service and restart it after a couple of seconds.  That process is installed over 400 customers locations.</p>\n\n<p>Everything was running smooth until about last friday.  A few processes failed to restart properly at 4am.  On 2 servers I was able to connect and verify, the restart failed with both a \"Address already in use: JVM_Bind\".  It's seems that the port 12000 was still in use by a the system.  </p>\n\n<p>I used every tools (processexplorer, tcpview, netstat -ano, name it) I know to try to find the process... with no success.  Only a machine reboot fixed the issue.  But problem came back a night or two later.  </p>\n\n<p>After some reading, I saw that I was doing a <code>sockect.accept()</code> with infinite timeout so I changed it for \n<code>\nsocket.setSoTimeout(15000);\nsocket.accept();\n</code> \ninstead.</p>\n\n<p>I putted the new version in place but the problem is still there.</p>\n\n<p>Machines got Windows updates. I did tests with the same Windows version fully updated but I can't reproduce.</p>\n\n<p>I'm out of solution now.</p>\n\n<p>Any ideas\nThanks</p>\n"},{"tags":["java","spring-boot","mockito"],"comments":[{"owner":{"account_id":4819600,"reputation":56500,"user_id":3890632,"display_name":"khelwood"},"score":0,"creation_date":1701105013,"post_id":77558718,"comment_id":136731088,"body_markdown":"To what null fields are you referring?","body":"To what null fields are you referring?"},{"owner":{"account_id":25926563,"reputation":119,"user_id":19648355,"display_name":"Irremediable"},"score":1,"creation_date":1701106463,"post_id":77558718,"comment_id":136731350,"body_markdown":"Spring validation works only with AOP proxied beans. @InjectMocks creates simple object instance, so validation will not work. You must get NovaConferenciaGateway instance from the Spring context.","body":"Spring validation works only with AOP proxied beans. @InjectMocks creates simple object instance, so validation will not work. You must get NovaConferenciaGateway instance from the Spring context."},{"owner":{"account_id":2280475,"reputation":2631,"user_id":2005682,"accept_rate":34,"display_name":"Fabio Ebner"},"score":0,"creation_date":1701108964,"post_id":77558718,"comment_id":136731792,"body_markdown":"tks @Irremediable","body":"tks @Irremediable"}],"owner":{"account_id":2280475,"reputation":2631,"user_id":2005682,"accept_rate":34,"display_name":"Fabio Ebner"},"comment_count":3,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":1,"is_answered":false,"view_count":37,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"answer_count":0,"score":-1,"last_activity_date":1701104837,"creation_date":1701104837,"question_id":77558718,"body_markdown":"I have this class in a springboot project:\r\n\r\n\r\n\r\n    @Service\r\n    @Validated\r\n    public class NovaConferenciaGatewayImpl implements NovaConferenciaGateway {\r\n        private final ConferenciaMapper conferenciaMapper;\r\n        private final ConferenciaRepositoryGateway conferenciaRepositoryGateway;\r\n        private final ConferenciaItemRepositoryGateway conferenciaItemRepositoryGateway;\r\n    \r\n        public NovaConferenciaGatewayImpl(ConferenciaMapper conferenciaMapper, ConferenciaRepositoryGateway conferenciaRepositoryGateway, ConferenciaItemRepositoryGateway conferenciaItemRepositoryGateway) {\r\n            this.conferenciaMapper = conferenciaMapper;\r\n            this.conferenciaRepositoryGateway = conferenciaRepositoryGateway;\r\n            this.conferenciaItemRepositoryGateway = conferenciaItemRepositoryGateway;\r\n        }\r\n    \r\n        @Override\r\n        public Conferencia cadastrarConferencia(@NotNull UUID empresaId, @NotNull UUID usuarioId, @NotNull @Valid NovaConferenciaRequest novaConferenciaRequest) {\r\n            Conferencia novaConferencia = conferenciaMapper.fromRequest(novaConferenciaRequest);\r\n            novaConferencia.setCriado(LocalDateTime.now());\r\n            novaConferencia.setEmpresaId(empresaId);\r\n            novaConferencia.setUsuarioId(usuarioId);\r\n            return conferenciaRepositoryGateway.novaConferencia(novaConferencia);\r\n    \r\n        }\r\n    }\r\n\r\nIt&#39;s possibel to the @Valid in method cadastrarConferencia?\r\n\r\nI trying with this class\r\n\r\n    @ExtendWith(MockitoExtension.class)\r\n    @SpringBootTest\r\n    public class NovaConferenciaGatewayImplTest {\r\n    \r\n        @Spy\r\n        private  ConferenciaMapper conferenciaMapper = new ConferenciaMapperImpl();\r\n        @Mock\r\n        private  ConferenciaRepositoryGateway conferenciaRepositoryGateway;\r\n        @Mock\r\n        private  ConferenciaItemRepositoryGateway conferenciaItemRepositoryGateway;\r\n    \r\n        @InjectMocks\r\n        private NovaConferenciaGatewayImpl novaConferenciaGateway;\r\n    \r\n        @Test\r\n        public void cadastrarConferencia(){\r\n            @NotNull NovaConferenciaRequest novo = new NovaConferenciaRequest();\r\n            novo.setNome(&quot;Nome&quot;);\r\n            Conferencia conferencia = novaConferenciaGateway.cadastrarConferencia(UUID.fromString(&quot;e95d1fca-49fe-458e-92e2-df85b0786b49&quot;), UUID.fromString(&quot;2d1987af-b76a-4268-92da-1f37b7001ac5&quot;), novo);\r\n            Mockito.verify(conferenciaMapper).fromRequest(novo);\r\n        }\r\n    \r\n    }\r\n\r\n\r\nand this is my class NovaConferencia\r\n\r\n    @Data\r\n    @AllArgsConstructor\r\n    @NoArgsConstructor\r\n    public class NovaConferenciaRequest {\r\n        @NotBlank\r\n        private String nome;\r\n        @NotEmpty\r\n        @Valid\r\n        private Endereco endereco;\r\n        private Point localizacao;\r\n        @NotEmpty\r\n        @Valid\r\n        private List&lt;Informacao&gt; informacoes;\r\n        @NotEmpty\r\n        @Valid\r\n        private List&lt;NovaConferenciaItemRequest&gt; itens;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\nShouldn&#39;t my test return an error because of null fields?\r\n\r\ntks\r\n","title":"Test method in springboot with @Valid","body":"<p>I have this class in a springboot project:</p>\n<pre><code>@Service\n@Validated\npublic class NovaConferenciaGatewayImpl implements NovaConferenciaGateway {\n    private final ConferenciaMapper conferenciaMapper;\n    private final ConferenciaRepositoryGateway conferenciaRepositoryGateway;\n    private final ConferenciaItemRepositoryGateway conferenciaItemRepositoryGateway;\n\n    public NovaConferenciaGatewayImpl(ConferenciaMapper conferenciaMapper, ConferenciaRepositoryGateway conferenciaRepositoryGateway, ConferenciaItemRepositoryGateway conferenciaItemRepositoryGateway) {\n        this.conferenciaMapper = conferenciaMapper;\n        this.conferenciaRepositoryGateway = conferenciaRepositoryGateway;\n        this.conferenciaItemRepositoryGateway = conferenciaItemRepositoryGateway;\n    }\n\n    @Override\n    public Conferencia cadastrarConferencia(@NotNull UUID empresaId, @NotNull UUID usuarioId, @NotNull @Valid NovaConferenciaRequest novaConferenciaRequest) {\n        Conferencia novaConferencia = conferenciaMapper.fromRequest(novaConferenciaRequest);\n        novaConferencia.setCriado(LocalDateTime.now());\n        novaConferencia.setEmpresaId(empresaId);\n        novaConferencia.setUsuarioId(usuarioId);\n        return conferenciaRepositoryGateway.novaConferencia(novaConferencia);\n\n    }\n}\n</code></pre>\n<p>It's possibel to the @Valid in method cadastrarConferencia?</p>\n<p>I trying with this class</p>\n<pre><code>@ExtendWith(MockitoExtension.class)\n@SpringBootTest\npublic class NovaConferenciaGatewayImplTest {\n\n    @Spy\n    private  ConferenciaMapper conferenciaMapper = new ConferenciaMapperImpl();\n    @Mock\n    private  ConferenciaRepositoryGateway conferenciaRepositoryGateway;\n    @Mock\n    private  ConferenciaItemRepositoryGateway conferenciaItemRepositoryGateway;\n\n    @InjectMocks\n    private NovaConferenciaGatewayImpl novaConferenciaGateway;\n\n    @Test\n    public void cadastrarConferencia(){\n        @NotNull NovaConferenciaRequest novo = new NovaConferenciaRequest();\n        novo.setNome(&quot;Nome&quot;);\n        Conferencia conferencia = novaConferenciaGateway.cadastrarConferencia(UUID.fromString(&quot;e95d1fca-49fe-458e-92e2-df85b0786b49&quot;), UUID.fromString(&quot;2d1987af-b76a-4268-92da-1f37b7001ac5&quot;), novo);\n        Mockito.verify(conferenciaMapper).fromRequest(novo);\n    }\n\n}\n</code></pre>\n<p>and this is my class NovaConferencia</p>\n<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class NovaConferenciaRequest {\n    @NotBlank\n    private String nome;\n    @NotEmpty\n    @Valid\n    private Endereco endereco;\n    private Point localizacao;\n    @NotEmpty\n    @Valid\n    private List&lt;Informacao&gt; informacoes;\n    @NotEmpty\n    @Valid\n    private List&lt;NovaConferenciaItemRequest&gt; itens;\n}\n</code></pre>\n<p>Shouldn't my test return an error because of null fields?</p>\n<p>tks</p>\n"},{"tags":["java","apache-spark"],"comments":[{"owner":{"account_id":1017255,"reputation":1526,"user_id":1028537,"display_name":"Chris"},"score":0,"creation_date":1701102595,"post_id":77558340,"comment_id":136730605,"body_markdown":"does sparkSession.sparkContext.setLogLevel(loggingLevel) work for you?","body":"does sparkSession.sparkContext.setLogLevel(loggingLevel) work for you?"},{"owner":{"account_id":5150443,"reputation":34158,"user_id":4125191,"display_name":"RealSkeptic"},"score":0,"creation_date":1701103513,"post_id":77558340,"comment_id":136730785,"body_markdown":"`log4j.xml` works for me, but you need to know the exact names of the loggers, as apparently the setup for root doesn&#39;t work for all of them.","body":"<code>log4j.xml</code> works for me, but you need to know the exact names of the loggers, as apparently the setup for root doesn&#39;t work for all of them."}],"owner":{"account_id":13474905,"reputation":19,"user_id":9722217,"display_name":"Tristpost"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":24,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701104490,"creation_date":1701101415,"question_id":77558340,"body_markdown":"I run Spark 3.5.0 on a single Ubuntu Linux machine in local mode (no Hadoop). I build, package and execute the application with Maven, but no matter what I do, the console output from my application drowns in page after page of Spark logs that I want to stop.\r\n\r\n - First I tried copying and editing the Spark provided log4j template file, setting all log levels to warn - for good measure I stored the edited version as both log4j2.properties &amp; log4j.properties in the spark conf directory - no luck same non-relevant logs still printed.\r\n - Then I tried various programmatic answers like for instance `Configurator.setRootLevel(Level.ERROR)` or `LogManager.getLogger(&quot;org&quot;).setLevel(Level.WARN)` and other - no luck there either.\r\n\r\nAny suggestions that actually work for this setup are very much appreciated!","title":"How to set the log level from Spark in local mode from a Java application?","body":"<p>I run Spark 3.5.0 on a single Ubuntu Linux machine in local mode (no Hadoop). I build, package and execute the application with Maven, but no matter what I do, the console output from my application drowns in page after page of Spark logs that I want to stop.</p>\n<ul>\n<li>First I tried copying and editing the Spark provided log4j template file, setting all log levels to warn - for good measure I stored the edited version as both log4j2.properties &amp; log4j.properties in the spark conf directory - no luck same non-relevant logs still printed.</li>\n<li>Then I tried various programmatic answers like for instance <code>Configurator.setRootLevel(Level.ERROR)</code> or <code>LogManager.getLogger(&quot;org&quot;).setLevel(Level.WARN)</code> and other - no luck there either.</li>\n</ul>\n<p>Any suggestions that actually work for this setup are very much appreciated!</p>\n"},{"tags":["java","mapstruct","object-object-mapping"],"answers":[{"comments":[{"owner":{"account_id":17966800,"reputation":409,"user_id":13056526,"display_name":"Alberto San Jos&#233;"},"score":1,"creation_date":1673954674,"post_id":70785046,"comment_id":132607058,"body_markdown":"This is NOT what is being asked: what we are looking for is a way to COMBINE properties from 2 sources to calculate 1 property in the target bean. And what you are saying here is how to get the value of one target from one source property and another target property from a second source property; that&#39;s straightforward.","body":"This is NOT what is being asked: what we are looking for is a way to COMBINE properties from 2 sources to calculate 1 property in the target bean. And what you are saying here is how to get the value of one target from one source property and another target property from a second source property; that&#39;s straightforward."}],"tags":[],"owner":{"account_id":23977205,"reputation":136,"user_id":17965148,"display_name":"Optimizer"},"comment_count":1,"down_vote_count":2,"up_vote_count":1,"is_accepted":false,"score":-1,"last_activity_date":1642676612,"creation_date":1642676612,"answer_id":70785046,"question_id":70783906,"body_markdown":" Mapper Interface to map two objects into one will be like:\r\n  \r\n    @Mapper\r\n    public interface CalculateTimeMapper{\r\n         @Mapping(source = &quot;schedule.timezoneId&quot;, target = &quot;timezone&quot;)\r\n         @Mapping(source = &quot;availabilityRule.startEpoch&quot;, target = &quot;startTime&quot;)\r\n         AvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule\r\n                                                availabilityRule, Schedule schedule);\r\n    }\r\n\r\n\r\n\r\nYou can use below for reference:\r\n\r\n&lt;https://www.tutorialspoint.com/tutorial_view.htm?cid=mapstruct&amp;pid=mapstruct_mapping_multiple.htm&gt;","title":"Map multiple sources from multiple objects to one target","body":"<p>Mapper Interface to map two objects into one will be like:</p>\n<pre><code>@Mapper\npublic interface CalculateTimeMapper{\n     @Mapping(source = &quot;schedule.timezoneId&quot;, target = &quot;timezone&quot;)\n     @Mapping(source = &quot;availabilityRule.startEpoch&quot;, target = &quot;startTime&quot;)\n     AvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule\n                                            availabilityRule, Schedule schedule);\n}\n</code></pre>\n<p>You can use below for reference:</p>\n<p><a href=\"https://www.tutorialspoint.com/tutorial_view.htm?cid=mapstruct&amp;pid=mapstruct_mapping_multiple.htm\" rel=\"nofollow noreferrer\">https://www.tutorialspoint.com/tutorial_view.htm?cid=mapstruct&amp;pid=mapstruct_mapping_multiple.htm</a></p>\n"},{"comments":[{"owner":{"account_id":6981250,"reputation":629,"user_id":5524175,"display_name":"duplex143"},"score":0,"creation_date":1643785553,"post_id":70948648,"comment_id":125428312,"body_markdown":"The code you&#39;ve mentioned is converting `AvailabilityRule` to `AvailabilityRuleDTO` properly.\n\nHow do I convert `Schedule` to `Schedule DTO`?\n```\n    @Mapping(source = &quot;timeZone&quot;, target = &quot;timeZone&quot;, qualifiedByName = &quot;zoneIdToString&quot;)\n    ScheduleDTO toScheduleDTO(Schedule schedule);\n``` isn&#39;t working fine.","body":"The code you&#39;ve mentioned is converting <code>AvailabilityRule</code> to <code>AvailabilityRuleDTO</code> properly.  How do I convert <code>Schedule</code> to <code>Schedule DTO</code>? ```     @Mapping(source = &quot;timeZone&quot;, target = &quot;timeZone&quot;, qualifiedByName = &quot;zoneIdToString&quot;)     ScheduleDTO toScheduleDTO(Schedule schedule); ``` isn&#39;t working fine."},{"owner":{"account_id":6981250,"reputation":629,"user_id":5524175,"display_name":"duplex143"},"score":0,"creation_date":1643786377,"post_id":70948648,"comment_id":125428472,"body_markdown":"I&#39;m not able to use `toAvailabilityRuleDTO ` in conjunction with `toScheduleDTO`. My goal is to convert Schedule to ScheduleDTO.","body":"I&#39;m not able to use <code>toAvailabilityRuleDTO </code> in conjunction with <code>toScheduleDTO</code>. My goal is to convert Schedule to ScheduleDTO."},{"owner":{"account_id":23191137,"reputation":1266,"user_id":17287498,"display_name":"Ben Zegveld"},"score":1,"creation_date":1643788673,"post_id":70948648,"comment_id":125429142,"body_markdown":"I&#39;ve added an example that contains the complete mapper that also maps schedule.","body":"I&#39;ve added an example that contains the complete mapper that also maps schedule."},{"owner":{"account_id":6981250,"reputation":629,"user_id":5524175,"display_name":"duplex143"},"score":0,"creation_date":1643816216,"post_id":70948648,"comment_id":125440561,"body_markdown":"Thanks. This is what I&#39;m looking for. Is there any way `expression = &quot;java(toAvailabilityRuleDTOs(schedule.getRules(), schedule))&quot;` can be avoided and replaced with `qualifiedByName` ?","body":"Thanks. This is what I&#39;m looking for. Is there any way <code>expression = &quot;java(toAvailabilityRuleDTOs(schedule.getRules(), schedule))&quot;</code> can be avoided and replaced with <code>qualifiedByName</code> ?"},{"owner":{"account_id":23191137,"reputation":1266,"user_id":17287498,"display_name":"Ben Zegveld"},"score":1,"creation_date":1643820173,"post_id":70948648,"comment_id":125442355,"body_markdown":"I do not think that is possible at the moment, but create an issue at https://github.com/mapstruct/mapstruct/issues about it. Perhaps it is possible and I do not know about it, or otherwise it might be possible to add it in the future.","body":"I do not think that is possible at the moment, but create an issue at <a href=\"https://github.com/mapstruct/mapstruct/issues\" rel=\"nofollow noreferrer\">github.com/mapstruct/mapstruct/issues</a> about it. Perhaps it is possible and I do not know about it, or otherwise it might be possible to add it in the future."}],"tags":[],"owner":{"account_id":23191137,"reputation":1266,"user_id":17287498,"display_name":"Ben Zegveld"},"comment_count":5,"down_vote_count":0,"up_vote_count":17,"is_accepted":true,"score":17,"last_activity_date":1643788630,"creation_date":1643756257,"answer_id":70948648,"question_id":70783906,"body_markdown":"This can be done in several ways. Below you see 2 options. They do the same thing only one uses `qualifiedByName` while the other uses `expression`. Depending on your need one might fit better then the other.\r\n\r\n# Using a custom method found by mapstruct\r\n\r\n`qualifiedByName` required because otherwise mapstruct does not know which method to use.\r\n```\r\n    @Mapping(source = &quot;.&quot;, target = &quot;startTime&quot;, qualifiedByName = &quot;startTime&quot;)\r\n    @Mapping(source = &quot;.&quot;, target = &quot;endTime&quot;, qualifiedByName = &quot;endTime&quot;)\r\n    AvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule availabilityRule, @Context Schedule schedule);\r\n\r\n    @Named(&quot;startTime&quot;)\r\n    protected ZonedDateTime startTime(AvailabilityRule availabilityRule, @Context Schedule schedule) {\r\n        return convertTime(availabilityRule.startEpoch, schedule.timezoneId);\r\n    }\r\n\r\n    @Named(&quot;endTime&quot;)\r\n    protected ZonedDateTime endTime(AvailabilityRule availabilityRule, @Context Schedule schedule) {\r\n        return convertTime(availabilityRule.endEpoch, schedule.timezoneId);\r\n    }\r\n\r\n    private ZonedDateTime convertTime(long epoch, String timezoneId) {\r\n        Instant instant = Instant.ofEpochMilli(epoch);\r\n        ZonedDateTime time = LocalDateTime.from(instant).atZone(timezoneId);\r\n        return time;\r\n    }\r\n\r\n```\r\n\r\n# Using a custom method configured by an expression\r\n`@Named` used here to prevent mapstruct from accidentally using this method for other mapping actions. Without it it will most likely still work.\r\n```\r\n    @Mapping(target = &quot;startTime&quot;, expression = &quot;java(convertTime(availabilityRule.startEpoch, schedule.timezoneId))&quot; )\r\n    @Mapping(target = &quot;endTime&quot;, expression = &quot;java(convertTime(availabilityRule.endEpoch, schedule.timezoneId))&quot; )\r\n    AvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule\r\n                                                availabilityRule, Schedule schedule);\r\n\r\n\r\n    @Named(&quot;time&quot;)\r\n    protected ZonedDateTime convertTime(long epoch, String timezoneId) {\r\n        Instant instant = Instant.ofEpochMilli(epoch);\r\n        ZonedDateTime time = LocalDateTime.from(instant).atZone(timezoneId);\r\n        return time;\r\n    }\r\n```\r\n\r\n# Complete mapper including schedule\r\n```\r\n\r\n@Mapper\r\npublic abstract class ScheduleMapper {\r\n    @Mapping(target = &quot;timezone&quot;, source = &quot;timezoneId&quot;)\r\n    @Mapping(target = &quot;rules&quot;, expression = &quot;java(toAvailabilityRuleDTOs(schedule.getRules(), schedule))&quot;)\r\n    abstract ScheduleDTO toScheduleDTO(Schedule schedule);\r\n\r\n    @Named(&quot;rules&quot;)\r\n    abstract List&lt;AvailabilityRuleDTO&gt; toAvailabilityRuleDTOs(List&lt;AvailabilityRule&gt; rules, @Context Schedule schedule);\r\n\r\n    @Mapping(target = &quot;startTime&quot;, expression = &quot;java(convertTime(availabilityRule.startEpoch, schedule.timezoneId))&quot;)\r\n    @Mapping(target = &quot;endTime&quot;, expression = &quot;java(convertTime(availabilityRule.endEpoch, schedule.timezoneId))&quot;)\r\n    abstract AvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule availabilityRule, @Context Schedule schedule);\r\n\r\n    @Named(&quot;time&quot;)\r\n    protected ZonedDateTime convertTime(long epoch, ZoneId timezoneId) {\r\n        Instant instant = Instant.ofEpochMilli(epoch);\r\n        ZonedDateTime time = LocalDateTime.from(instant).atZone(timezoneId);\r\n        return time;\r\n    }\r\n\r\n    String map(ZoneId zoneId) {\r\n        return zoneId == null ? null : zoneId.getId();\r\n    }\r\n}\r\n```","title":"Map multiple sources from multiple objects to one target","body":"<p>This can be done in several ways. Below you see 2 options. They do the same thing only one uses <code>qualifiedByName</code> while the other uses <code>expression</code>. Depending on your need one might fit better then the other.</p>\n<h1>Using a custom method found by mapstruct</h1>\n<p><code>qualifiedByName</code> required because otherwise mapstruct does not know which method to use.</p>\n<pre><code>    @Mapping(source = &quot;.&quot;, target = &quot;startTime&quot;, qualifiedByName = &quot;startTime&quot;)\n    @Mapping(source = &quot;.&quot;, target = &quot;endTime&quot;, qualifiedByName = &quot;endTime&quot;)\n    AvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule availabilityRule, @Context Schedule schedule);\n\n    @Named(&quot;startTime&quot;)\n    protected ZonedDateTime startTime(AvailabilityRule availabilityRule, @Context Schedule schedule) {\n        return convertTime(availabilityRule.startEpoch, schedule.timezoneId);\n    }\n\n    @Named(&quot;endTime&quot;)\n    protected ZonedDateTime endTime(AvailabilityRule availabilityRule, @Context Schedule schedule) {\n        return convertTime(availabilityRule.endEpoch, schedule.timezoneId);\n    }\n\n    private ZonedDateTime convertTime(long epoch, String timezoneId) {\n        Instant instant = Instant.ofEpochMilli(epoch);\n        ZonedDateTime time = LocalDateTime.from(instant).atZone(timezoneId);\n        return time;\n    }\n\n</code></pre>\n<h1>Using a custom method configured by an expression</h1>\n<p><code>@Named</code> used here to prevent mapstruct from accidentally using this method for other mapping actions. Without it it will most likely still work.</p>\n<pre><code>    @Mapping(target = &quot;startTime&quot;, expression = &quot;java(convertTime(availabilityRule.startEpoch, schedule.timezoneId))&quot; )\n    @Mapping(target = &quot;endTime&quot;, expression = &quot;java(convertTime(availabilityRule.endEpoch, schedule.timezoneId))&quot; )\n    AvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule\n                                                availabilityRule, Schedule schedule);\n\n\n    @Named(&quot;time&quot;)\n    protected ZonedDateTime convertTime(long epoch, String timezoneId) {\n        Instant instant = Instant.ofEpochMilli(epoch);\n        ZonedDateTime time = LocalDateTime.from(instant).atZone(timezoneId);\n        return time;\n    }\n</code></pre>\n<h1>Complete mapper including schedule</h1>\n<pre><code>\n@Mapper\npublic abstract class ScheduleMapper {\n    @Mapping(target = &quot;timezone&quot;, source = &quot;timezoneId&quot;)\n    @Mapping(target = &quot;rules&quot;, expression = &quot;java(toAvailabilityRuleDTOs(schedule.getRules(), schedule))&quot;)\n    abstract ScheduleDTO toScheduleDTO(Schedule schedule);\n\n    @Named(&quot;rules&quot;)\n    abstract List&lt;AvailabilityRuleDTO&gt; toAvailabilityRuleDTOs(List&lt;AvailabilityRule&gt; rules, @Context Schedule schedule);\n\n    @Mapping(target = &quot;startTime&quot;, expression = &quot;java(convertTime(availabilityRule.startEpoch, schedule.timezoneId))&quot;)\n    @Mapping(target = &quot;endTime&quot;, expression = &quot;java(convertTime(availabilityRule.endEpoch, schedule.timezoneId))&quot;)\n    abstract AvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule availabilityRule, @Context Schedule schedule);\n\n    @Named(&quot;time&quot;)\n    protected ZonedDateTime convertTime(long epoch, ZoneId timezoneId) {\n        Instant instant = Instant.ofEpochMilli(epoch);\n        ZonedDateTime time = LocalDateTime.from(instant).atZone(timezoneId);\n        return time;\n    }\n\n    String map(ZoneId zoneId) {\n        return zoneId == null ? null : zoneId.getId();\n    }\n}\n</code></pre>\n"}],"owner":{"account_id":6981250,"reputation":629,"user_id":5524175,"display_name":"duplex143"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":18755,"favorite_count":0,"down_vote_count":0,"up_vote_count":8,"accepted_answer_id":70948648,"answer_count":2,"score":8,"last_activity_date":1701104075,"creation_date":1642671699,"question_id":70783906,"body_markdown":"I want to map the following classes\r\n```\r\nclass Schedule {\r\n    ZoneId timezoneId;\r\n    List&lt;AvailabilityRule&gt; rules;\r\n}\r\n```\r\n\r\n```\r\nclass AvailabilityRule {\r\n    long startEpoch;\r\n    long endEpoch;\r\n}\r\n```\r\nto these classes.\r\n```\r\nclass ScheduleDTO {\r\n    String timezone;\r\n    List&lt;AvailabilityRuleDTO&gt; rules;\r\n}\r\n```\r\n\r\n```\r\nclass AvailabilityRuleDTO {\r\n    ZonedDateTime startTime;\r\n    ZonedDateTime endTime;\r\n}\r\n```\r\n\r\nBoth `timezoneId` and `startEpoch` are needed for calculating `startTime`. \r\n\r\n```\r\nInstant instant = Instant.ofEpochMilli(startEpoch);\r\nZonedDateTime zonedDateTime = instant.atZone(timezoneId);\r\n        \r\n```\r\n\r\nHow can I achieve this using mapstruct? \r\n\r\nPseudo code of what I want\r\n```\r\n@Mapping(source = {&quot;startEpoch&quot;, &quot;timezoneId&quot;}, target = &quot;startTime&quot;, qualifiedByName = &quot;epochToString&quot;)\r\nAvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule\r\n                                            availabilityRule, Schedule schedule);\r\n```\r\n","title":"Map multiple sources from multiple objects to one target","body":"<p>I want to map the following classes</p>\n<pre><code>class Schedule {\n    ZoneId timezoneId;\n    List&lt;AvailabilityRule&gt; rules;\n}\n</code></pre>\n<pre><code>class AvailabilityRule {\n    long startEpoch;\n    long endEpoch;\n}\n</code></pre>\n<p>to these classes.</p>\n<pre><code>class ScheduleDTO {\n    String timezone;\n    List&lt;AvailabilityRuleDTO&gt; rules;\n}\n</code></pre>\n<pre><code>class AvailabilityRuleDTO {\n    ZonedDateTime startTime;\n    ZonedDateTime endTime;\n}\n</code></pre>\n<p>Both <code>timezoneId</code> and <code>startEpoch</code> are needed for calculating <code>startTime</code>.</p>\n<pre><code>Instant instant = Instant.ofEpochMilli(startEpoch);\nZonedDateTime zonedDateTime = instant.atZone(timezoneId);\n        \n</code></pre>\n<p>How can I achieve this using mapstruct?</p>\n<p>Pseudo code of what I want</p>\n<pre><code>@Mapping(source = {&quot;startEpoch&quot;, &quot;timezoneId&quot;}, target = &quot;startTime&quot;, qualifiedByName = &quot;epochToString&quot;)\nAvailabilityRuleDTO toAvailabilityRuleDTO(AvailabilityRule\n                                            availabilityRule, Schedule schedule);\n</code></pre>\n"},{"tags":["java","gradle","compiler-errors","compilation","minecraft"],"comments":[{"owner":{"account_id":45213,"reputation":26348,"user_id":133203,"accept_rate":97,"display_name":"Federico klez Culloca"},"score":0,"creation_date":1626792425,"post_id":68456894,"comment_id":120984675,"body_markdown":"Part of those 100 errors would probably be more useful in understanding what&#39;s wrong. Start with a couple from the top, for example.","body":"Part of those 100 errors would probably be more useful in understanding what&#39;s wrong. Start with a couple from the top, for example."},{"owner":{"account_id":22256600,"reputation":19,"user_id":16488683,"display_name":"Universe filatov"},"score":0,"creation_date":1626792463,"post_id":68456894,"comment_id":120984691,"body_markdown":"https://pastebin.com/Nrjje3Dn complete error","body":"<a href=\"https://pastebin.com/Nrjje3Dn\" rel=\"nofollow noreferrer\">pastebin.com/Nrjje3Dn</a> complete error"},{"owner":{"account_id":319873,"reputation":87612,"user_id":637853,"accept_rate":50,"display_name":"Thomas"},"score":2,"creation_date":1626792466,"post_id":68456894,"comment_id":120984693,"body_markdown":"Also please don&#39;t post text as images but post the text itself (nicely formatted of course to make it readable). And don&#39;t post links to code or text as those can break and other users might be wary of following them (or can&#39;t due to firewall rules). Do yourself a favor and put some effort into the question.","body":"Also please don&#39;t post text as images but post the text itself (nicely formatted of course to make it readable). And don&#39;t post links to code or text as those can break and other users might be wary of following them (or can&#39;t due to firewall rules). Do yourself a favor and put some effort into the question."},{"owner":{"account_id":45213,"reputation":26348,"user_id":133203,"accept_rate":97,"display_name":"Federico klez Culloca"},"score":3,"creation_date":1626792542,"post_id":68456894,"comment_id":120984738,"body_markdown":"Looks like this is using features from a java version that is higher than the one you&#39;re using.","body":"Looks like this is using features from a java version that is higher than the one you&#39;re using."},{"owner":{"account_id":17835,"reputation":303905,"user_id":40342,"accept_rate":62,"display_name":"Joachim Sauer"},"score":0,"creation_date":1626793282,"post_id":68456894,"comment_id":120985115,"body_markdown":"@Universefilatov: please don&#39;t use external links or images instead of updating your question to contain the relevant error messages. Edit your question to contain them instead. And if there are too many error messages for that, then just post the first few (like 10). It&#39;s unlikely that anyone&#39;s going to read all of them anyway. [Please do not upload images of code/errors when asking a question.](//meta.stackoverflow.com/q/285551)","body":"@Universefilatov: please don&#39;t use external links or images instead of updating your question to contain the relevant error messages. Edit your question to contain them instead. And if there are too many error messages for that, then just post the first few (like 10). It&#39;s unlikely that anyone&#39;s going to read all of them anyway. <a href=\"//meta.stackoverflow.com/q/285551\">Please do not upload images of code/errors when asking a question.</a>"},{"owner":{"account_id":1119690,"reputation":15787,"user_id":1108305,"accept_rate":47,"display_name":"M. Justin"},"score":1,"creation_date":1626821081,"post_id":68456894,"comment_id":120994067,"body_markdown":"I strongly suspect that @FedericoklezCulloca is absolutely correct.  The compilation failure is due to a [pattern matching `instanceof` operator](https://docs.oracle.com/en/java/javase/16/language/pattern-matching-instanceof-operator.html) not being recognized by the compiler.  This feature was not added to the Java language until Java 16.  I&#39;m guessing the project&#39;s `build.gradle` isn&#39;t enforcing that version of Java, so it uses whatever version you&#39;re running the build as.  What version of Java are you using?  What do you get when you run `java --version`?","body":"I strongly suspect that @FedericoklezCulloca is absolutely correct.  The compilation failure is due to a <a href=\"https://docs.oracle.com/en/java/javase/16/language/pattern-matching-instanceof-operator.html\" rel=\"nofollow noreferrer\">pattern matching <code>instanceof</code> operator</a> not being recognized by the compiler.  This feature was not added to the Java language until Java 16.  I&#39;m guessing the project&#39;s <code>build.gradle</code> isn&#39;t enforcing that version of Java, so it uses whatever version you&#39;re running the build as.  What version of Java are you using?  What do you get when you run <code>java --version</code>?"},{"owner":{"account_id":213468,"reputation":103500,"user_id":466862,"display_name":"Mark Rotteveel"},"score":1,"creation_date":1627123197,"post_id":68456894,"comment_id":121075935,"body_markdown":"Please provide a [mre], including a build.gradle script, and specify the Java version you&#39;re using.","body":"Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, including a build.gradle script, and specify the Java version you&#39;re using."}],"answers":[{"tags":[],"owner":{"account_id":1119690,"reputation":15787,"user_id":1108305,"accept_rate":47,"display_name":"M. Justin"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1701103740,"creation_date":1627312930,"answer_id":68532485,"question_id":68456894,"body_markdown":"This appears to be due to an older version of Java being used to compile the code, when at least Java 16 must be used.  Using a new enough version of Java should fix this particular issue.\r\n\r\nThe compiler output is failing on some newer Java features: the [pattern matching `instanceof` operator](https://docs.oracle.com/en/java/javase/16/language/pattern-matching-instanceof-operator.html) added in Java 16, and [switch expressions](https://docs.oracle.com/en/java/javase/14/language/switch-expressions.html) added in Java 14.\r\n\r\n```lang-none\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:52: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\n```\r\n\r\n```lang-none\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:17: error: &#39;;&#39; expected\r\n            CustomAction action = switch (params[0]) {\r\n                                                    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:18: error: orphaned case\r\n                case &quot;command&quot; -&gt; new CommandAction(params);\r\n                ^\r\n```\r\n\r\nGiven that the failures are due to newer language features, this tells me that the issue is likely due to an older version of Java being used (Java 13 or earlier).\r\n\r\nThere are two ways to address this.  The first (and less portable) way is to ensure the build is running under a new enough version of Java.  For instance, when run under the command line, the `java --version` should indicate Java version of at least 16 before running the build.  If the version is too old, a newer version must be installed first.\r\n\r\nThe second approach is to specify the version of Java to be used within the Gradle build.  This will ensure that the build is always used with the correct version of Java.  With newer versions of Gradle, the [Java Toolchain](https://docs.gradle.org/current/userguide/toolchains.html) can be configured to use the proper version:\r\n\r\n```lang-groovy\r\njava {\r\n    toolchain {\r\n        languageVersion = JavaLanguageVersion.of(16)\r\n    }\r\n}\r\n```","title":"Gradle Java compilation error using pattern matching instanceof &amp; switch expressions","body":"<p>This appears to be due to an older version of Java being used to compile the code, when at least Java 16 must be used.  Using a new enough version of Java should fix this particular issue.</p>\n<p>The compiler output is failing on some newer Java features: the <a href=\"https://docs.oracle.com/en/java/javase/16/language/pattern-matching-instanceof-operator.html\" rel=\"nofollow noreferrer\">pattern matching <code>instanceof</code> operator</a> added in Java 16, and <a href=\"https://docs.oracle.com/en/java/javase/14/language/switch-expressions.html\" rel=\"nofollow noreferrer\">switch expressions</a> added in Java 14.</p>\n<pre class=\"lang-none prettyprint-override\"><code>D:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:52: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>D:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:17: error: ';' expected\n            CustomAction action = switch (params[0]) {\n                                                    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:18: error: orphaned case\n                case &quot;command&quot; -&gt; new CommandAction(params);\n                ^\n</code></pre>\n<p>Given that the failures are due to newer language features, this tells me that the issue is likely due to an older version of Java being used (Java 13 or earlier).</p>\n<p>There are two ways to address this.  The first (and less portable) way is to ensure the build is running under a new enough version of Java.  For instance, when run under the command line, the <code>java --version</code> should indicate Java version of at least 16 before running the build.  If the version is too old, a newer version must be installed first.</p>\n<p>The second approach is to specify the version of Java to be used within the Gradle build.  This will ensure that the build is always used with the correct version of Java.  With newer versions of Gradle, the <a href=\"https://docs.gradle.org/current/userguide/toolchains.html\" rel=\"nofollow noreferrer\">Java Toolchain</a> can be configured to use the proper version:</p>\n<pre class=\"lang-groovy prettyprint-override\"><code>java {\n    toolchain {\n        languageVersion = JavaLanguageVersion.of(16)\n    }\n}\n</code></pre>\n"}],"owner":{"account_id":22256600,"reputation":19,"user_id":16488683,"display_name":"Universe filatov"},"comment_count":7,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":1320,"favorite_count":0,"down_vote_count":3,"up_vote_count":2,"answer_count":1,"score":-1,"last_activity_date":1701103740,"creation_date":1626792359,"question_id":68456894,"body_markdown":"I am getting the following error when compiling my Gradle Java project:\r\n\r\n```lang-none\r\n&gt; Task :compileJava FAILED\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:52: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:52: error: not a statement\r\n                    if (sender instanceof Player player) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:52: error: &#39;;&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:56: error: &#39;else&#39; without &#39;if&#39;\r\n                    } else\r\n                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:38: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:38: error: not a statement\r\n                    if (sender instanceof Player player) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:38: error: &#39;;&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:54: error: &#39;else&#39; without &#39;if&#39;\r\n                    } else\r\n                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:66: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:66: error: not a statement\r\n                    if (sender instanceof Player player) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:66: error: &#39;;&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:72: error: &#39;else&#39; without &#39;if&#39;\r\n                    } else\r\n                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:81: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:81: error: not a statement\r\n                    if (sender instanceof Player player) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:81: error: &#39;;&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:84: error: &#39;else&#39; without &#39;if&#39;\r\n                    } else\r\n                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:93: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:93: error: not a statement\r\n                    if (sender instanceof Player player) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:93: error: &#39;;&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:96: error: &#39;else&#39; without &#39;if&#39;\r\n                    } else\r\n                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:107: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:107: error: not a statement\r\n                    if (sender instanceof Player player) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:107: error: &#39;;&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:110: error: &#39;)&#39; expected\r\n                        if (recipe instanceof FurnaceBuilder furnace) {\r\n                                                            ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:110: error: not a statement\r\n                        if (recipe instanceof FurnaceBuilder furnace) {\r\n                                                             ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:110: error: &#39;;&#39; expected\r\n                        if (recipe instanceof FurnaceBuilder furnace) {\r\n                                                                    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:115: error: &#39;else&#39; without &#39;if&#39;\r\n                    } else\r\n                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:125: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:125: error: not a statement\r\n                    if (sender instanceof Player player) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:125: error: &#39;;&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:133: error: &#39;else&#39; without &#39;if&#39;\r\n                    } else\r\n                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: : expected\r\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\r\n                                    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: illegal start of expression\r\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\r\n                                     ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: &#39;;&#39; expected\r\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\r\n                                                   ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: not a statement\r\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\r\n                                                    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: &#39;;&#39; expected\r\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\r\n                                                          ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: : expected\r\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\r\n                                   ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: illegal start of expression\r\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\r\n                                    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: &#39;;&#39; expected\r\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: &#39;;&#39; expected\r\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\r\n                                                                    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: not a statement\r\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\r\n                                                                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: &#39;;&#39; expected\r\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\r\n                                                                            ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:25: error: : expected\r\n                        case &quot;RECIPES&quot; -&gt; RecipesManager.reload(OraxenPlugin.get());\r\n                                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:25: error: illegal start of expression\r\n                        case &quot;RECIPES&quot; -&gt; RecipesManager.reload(OraxenPlugin.get());\r\n                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:25: error: &#39;;&#39; expected\r\n                        case &quot;RECIPES&quot; -&gt; RecipesManager.reload(OraxenPlugin.get());\r\n                                                        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:26: error: : expected\r\n                        case &quot;CONFIGS&quot; -&gt; OraxenPlugin.get().reloadConfigs();\r\n                                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:26: error: illegal start of expression\r\n                        case &quot;CONFIGS&quot; -&gt; OraxenPlugin.get().reloadConfigs();\r\n                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:26: error: &#39;;&#39; expected\r\n                        case &quot;CONFIGS&quot; -&gt; OraxenPlugin.get().reloadConfigs();\r\n                                                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:27: error: : expected\r\n                        default -&gt; {\r\n                               ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:27: error: illegal start of expression\r\n                        default -&gt; {\r\n                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:27: error: &#39;;&#39; expected\r\n                        default -&gt; {\r\n                                  ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:34: error: &#39;)&#39; expected\r\n                    }\r\n                     ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:35: error: illegal start of expression\r\n                });\r\n                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:27: error: &#39;)&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:27: error: not a statement\r\n                    if (sender instanceof Player player) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:27: error: &#39;;&#39; expected\r\n                    if (sender instanceof Player player) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:55: error: &#39;else&#39; without &#39;if&#39;\r\n                    } else {\r\n                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:65: error: &#39;)&#39; expected\r\n        if (!(itemMeta instanceof Damageable damageable))\r\n                                            ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:65: error: illegal start of expression\r\n        if (!(itemMeta instanceof Damageable damageable))\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:65: error: &#39;;&#39; expected\r\n        if (!(itemMeta instanceof Damageable damageable))\r\n                                                        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:8: error: class, interface, or enum expected\r\npublic record Glyph(String name, char character, String texture, int ascent,\r\n       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:11: error: class, interface, or enum expected\r\n    public JsonObject toJson() {\r\n           ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:13: error: class, interface, or enum expected\r\n        JsonArray chars = new JsonArray();\r\n        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:14: error: class, interface, or enum expected\r\n        chars.add(String.valueOf(character));\r\n        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:15: error: class, interface, or enum expected\r\n        output.add(&quot;chars&quot;, chars);\r\n        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:16: error: class, interface, or enum expected\r\n        output.addProperty(&quot;file&quot;, texture);\r\n        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:17: error: class, interface, or enum expected\r\n        output.addProperty(&quot;ascent&quot;, 8);\r\n        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:18: error: class, interface, or enum expected\r\n        output.addProperty(&quot;height&quot;, height);\r\n        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:19: error: class, interface, or enum expected\r\n        output.addProperty(&quot;type&quot;, &quot;bitmap&quot;);\r\n        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:20: error: class, interface, or enum expected\r\n        return output;\r\n        ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:21: error: class, interface, or enum expected\r\n    }\r\n    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:23: error: class, interface, or enum expected\r\n    public boolean hasPermission(Player player) {\r\n           ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:25: error: class, interface, or enum expected\r\n    }\r\n    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:71: error: &#39;)&#39; expected\r\n        if (itemMeta instanceof PotionMeta potionMeta) {\r\n                                          ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:71: error: not a statement\r\n        if (itemMeta instanceof PotionMeta potionMeta) {\r\n                                           ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:71: error: &#39;;&#39; expected\r\n        if (itemMeta instanceof PotionMeta potionMeta) {\r\n                                                     ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:80: error: &#39;)&#39; expected\r\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\r\n                                                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:80: error: not a statement\r\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:80: error: &#39;;&#39; expected\r\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\r\n                                                                             ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:280: error: &#39;)&#39; expected\r\n        if (itemMeta instanceof Damageable damageable) {\r\n                                          ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:280: error: not a statement\r\n        if (itemMeta instanceof Damageable damageable) {\r\n                                           ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:280: error: &#39;;&#39; expected\r\n        if (itemMeta instanceof Damageable damageable) {\r\n                                                     ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:287: error: &#39;)&#39; expected\r\n        if (itemMeta instanceof LeatherArmorMeta leatherArmorMeta) {\r\n                                                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:287: error: not a statement\r\n        if (itemMeta instanceof LeatherArmorMeta leatherArmorMeta) {\r\n                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:287: error: &#39;;&#39; expected\r\n        if (itemMeta instanceof LeatherArmorMeta leatherArmorMeta) {\r\n                                                                 ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:294: error: &#39;)&#39; expected\r\n        if (itemMeta instanceof PotionMeta potionMeta) {\r\n                                          ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:294: error: not a statement\r\n        if (itemMeta instanceof PotionMeta potionMeta) {\r\n                                           ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:294: error: &#39;;&#39; expected\r\n        if (itemMeta instanceof PotionMeta potionMeta) {\r\n                                                     ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:309: error: &#39;)&#39; expected\r\n        if (itemMeta instanceof SkullMeta skullMeta) {\r\n                                         ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:309: error: not a statement\r\n        if (itemMeta instanceof SkullMeta skullMeta) {\r\n                                          ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:309: error: &#39;;&#39; expected\r\n        if (itemMeta instanceof SkullMeta skullMeta) {\r\n                                                   ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:317: error: &#39;)&#39; expected\r\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\r\n                                                      ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:317: error: not a statement\r\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\r\n                                                       ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:317: error: &#39;;&#39; expected\r\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\r\n                                                                             ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:17: error: illegal start of expression\r\n            CustomAction action = switch (params[0]) {\r\n                                  ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:17: error: not a statement\r\n            CustomAction action = switch (params[0]) {\r\n                                         ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:17: error: &#39;;&#39; expected\r\n            CustomAction action = switch (params[0]) {\r\n                                                    ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:18: error: orphaned case\r\n                case &quot;command&quot; -&gt; new CommandAction(params);\r\n                ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:18: error: : expected\r\n                case &quot;command&quot; -&gt; new CommandAction(params);\r\n                              ^\r\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:18: error: illegal start of expression\r\n                case &quot;command&quot; -&gt; new CommandAction(params);\r\n                               ^\r\n100 errors\r\n \r\nFAILURE: Build failed with an exception.\r\n \r\n* What went wrong:\r\nExecution failed for task &#39;:compileJava&#39;.\r\n&gt; Compilation failed; see the compiler error output for details.\r\n \r\n* Try:\r\nRun with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.\r\n \r\n* Get more help at https://help.gradle.org\r\n \r\nBUILD FAILED in 1s\r\n2 actionable tasks: 2 executed\r\n```","title":"Gradle Java compilation error using pattern matching instanceof &amp; switch expressions","body":"<p>I am getting the following error when compiling my Gradle Java project:</p>\n<pre class=\"lang-none prettyprint-override\"><code>&gt; Task :compileJava FAILED\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:52: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:52: error: not a statement\n                    if (sender instanceof Player player) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:52: error: ';' expected\n                    if (sender instanceof Player player) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\CommandsManager.java:56: error: 'else' without 'if'\n                    } else\n                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:38: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:38: error: not a statement\n                    if (sender instanceof Player player) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:38: error: ';' expected\n                    if (sender instanceof Player player) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:54: error: 'else' without 'if'\n                    } else\n                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:66: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:66: error: not a statement\n                    if (sender instanceof Player player) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:66: error: ';' expected\n                    if (sender instanceof Player player) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:72: error: 'else' without 'if'\n                    } else\n                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:81: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:81: error: not a statement\n                    if (sender instanceof Player player) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:81: error: ';' expected\n                    if (sender instanceof Player player) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:84: error: 'else' without 'if'\n                    } else\n                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:93: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:93: error: not a statement\n                    if (sender instanceof Player player) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:93: error: ';' expected\n                    if (sender instanceof Player player) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:96: error: 'else' without 'if'\n                    } else\n                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:107: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:107: error: not a statement\n                    if (sender instanceof Player player) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:107: error: ';' expected\n                    if (sender instanceof Player player) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:110: error: ')' expected\n                        if (recipe instanceof FurnaceBuilder furnace) {\n                                                            ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:110: error: not a statement\n                        if (recipe instanceof FurnaceBuilder furnace) {\n                                                             ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:110: error: ';' expected\n                        if (recipe instanceof FurnaceBuilder furnace) {\n                                                                    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:115: error: 'else' without 'if'\n                    } else\n                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:125: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:125: error: not a statement\n                    if (sender instanceof Player player) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:125: error: ';' expected\n                    if (sender instanceof Player player) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RecipesCommand.java:133: error: 'else' without 'if'\n                    } else\n                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: : expected\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\n                                    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: illegal start of expression\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\n                                     ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: ';' expected\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\n                                                   ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: not a statement\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\n                                                    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:23: error: ';' expected\n                        case &quot;ITEMS&quot; -&gt; reloadItems(sender);\n                                                          ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: : expected\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\n                                   ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: illegal start of expression\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\n                                    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: ';' expected\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: ';' expected\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\n                                                                    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: not a statement\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\n                                                                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:24: error: ';' expected\n                        case &quot;PACK&quot; -&gt; reloadPack(OraxenPlugin.get(), sender);\n                                                                            ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:25: error: : expected\n                        case &quot;RECIPES&quot; -&gt; RecipesManager.reload(OraxenPlugin.get());\n                                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:25: error: illegal start of expression\n                        case &quot;RECIPES&quot; -&gt; RecipesManager.reload(OraxenPlugin.get());\n                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:25: error: ';' expected\n                        case &quot;RECIPES&quot; -&gt; RecipesManager.reload(OraxenPlugin.get());\n                                                        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:26: error: : expected\n                        case &quot;CONFIGS&quot; -&gt; OraxenPlugin.get().reloadConfigs();\n                                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:26: error: illegal start of expression\n                        case &quot;CONFIGS&quot; -&gt; OraxenPlugin.get().reloadConfigs();\n                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:26: error: ';' expected\n                        case &quot;CONFIGS&quot; -&gt; OraxenPlugin.get().reloadConfigs();\n                                                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:27: error: : expected\n                        default -&gt; {\n                               ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:27: error: illegal start of expression\n                        default -&gt; {\n                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:27: error: ';' expected\n                        default -&gt; {\n                                  ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:34: error: ')' expected\n                    }\n                     ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\ReloadCommand.java:35: error: illegal start of expression\n                });\n                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:27: error: ')' expected\n                    if (sender instanceof Player player) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:27: error: not a statement\n                    if (sender instanceof Player player) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:27: error: ';' expected\n                    if (sender instanceof Player player) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:55: error: 'else' without 'if'\n                    } else {\n                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:65: error: ')' expected\n        if (!(itemMeta instanceof Damageable damageable))\n                                            ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:65: error: illegal start of expression\n        if (!(itemMeta instanceof Damageable damageable))\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\commands\\RepairCommand.java:65: error: ';' expected\n        if (!(itemMeta instanceof Damageable damageable))\n                                                        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:8: error: class, interface, or enum expected\npublic record Glyph(String name, char character, String texture, int ascent,\n       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:11: error: class, interface, or enum expected\n    public JsonObject toJson() {\n           ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:13: error: class, interface, or enum expected\n        JsonArray chars = new JsonArray();\n        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:14: error: class, interface, or enum expected\n        chars.add(String.valueOf(character));\n        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:15: error: class, interface, or enum expected\n        output.add(&quot;chars&quot;, chars);\n        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:16: error: class, interface, or enum expected\n        output.addProperty(&quot;file&quot;, texture);\n        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:17: error: class, interface, or enum expected\n        output.addProperty(&quot;ascent&quot;, 8);\n        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:18: error: class, interface, or enum expected\n        output.addProperty(&quot;height&quot;, height);\n        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:19: error: class, interface, or enum expected\n        output.addProperty(&quot;type&quot;, &quot;bitmap&quot;);\n        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:20: error: class, interface, or enum expected\n        return output;\n        ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:21: error: class, interface, or enum expected\n    }\n    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:23: error: class, interface, or enum expected\n    public boolean hasPermission(Player player) {\n           ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\font\\Glyph.java:25: error: class, interface, or enum expected\n    }\n    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:71: error: ')' expected\n        if (itemMeta instanceof PotionMeta potionMeta) {\n                                          ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:71: error: not a statement\n        if (itemMeta instanceof PotionMeta potionMeta) {\n                                           ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:71: error: ';' expected\n        if (itemMeta instanceof PotionMeta potionMeta) {\n                                                     ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:80: error: ')' expected\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\n                                                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:80: error: not a statement\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:80: error: ';' expected\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\n                                                                             ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:280: error: ')' expected\n        if (itemMeta instanceof Damageable damageable) {\n                                          ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:280: error: not a statement\n        if (itemMeta instanceof Damageable damageable) {\n                                           ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:280: error: ';' expected\n        if (itemMeta instanceof Damageable damageable) {\n                                                     ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:287: error: ')' expected\n        if (itemMeta instanceof LeatherArmorMeta leatherArmorMeta) {\n                                                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:287: error: not a statement\n        if (itemMeta instanceof LeatherArmorMeta leatherArmorMeta) {\n                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:287: error: ';' expected\n        if (itemMeta instanceof LeatherArmorMeta leatherArmorMeta) {\n                                                                 ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:294: error: ')' expected\n        if (itemMeta instanceof PotionMeta potionMeta) {\n                                          ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:294: error: not a statement\n        if (itemMeta instanceof PotionMeta potionMeta) {\n                                           ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:294: error: ';' expected\n        if (itemMeta instanceof PotionMeta potionMeta) {\n                                                     ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:309: error: ')' expected\n        if (itemMeta instanceof SkullMeta skullMeta) {\n                                         ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:309: error: not a statement\n        if (itemMeta instanceof SkullMeta skullMeta) {\n                                          ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:309: error: ';' expected\n        if (itemMeta instanceof SkullMeta skullMeta) {\n                                                   ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:317: error: ')' expected\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\n                                                      ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:317: error: not a statement\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\n                                                       ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\items\\ItemBuilder.java:317: error: ';' expected\n        if (itemMeta instanceof TropicalFishBucketMeta tropicalFishBucketMeta) {\n                                                                             ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:17: error: illegal start of expression\n            CustomAction action = switch (params[0]) {\n                                  ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:17: error: not a statement\n            CustomAction action = switch (params[0]) {\n                                         ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:17: error: ';' expected\n            CustomAction action = switch (params[0]) {\n                                                    ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:18: error: orphaned case\n                case &quot;command&quot; -&gt; new CommandAction(params);\n                ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:18: error: : expected\n                case &quot;command&quot; -&gt; new CommandAction(params);\n                              ^\nD:\\compilar\\Oraxen-master\\src\\main\\java\\io\\th0rgal\\oraxen\\mechanics\\provided\\custom\\CustomMechanicAction.java:18: error: illegal start of expression\n                case &quot;command&quot; -&gt; new CommandAction(params);\n                               ^\n100 errors\n \nFAILURE: Build failed with an exception.\n \n* What went wrong:\nExecution failed for task ':compileJava'.\n&gt; Compilation failed; see the compiler error output for details.\n \n* Try:\nRun with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.\n \n* Get more help at https://help.gradle.org\n \nBUILD FAILED in 1s\n2 actionable tasks: 2 executed\n</code></pre>\n"},{"tags":["java","exception","connection","rmi","remoteobject"],"answers":[{"comments":[{"owner":{"account_id":1598715,"reputation":143,"user_id":1480237,"accept_rate":33,"display_name":"researcher"},"score":7,"creation_date":1418216928,"post_id":15696021,"comment_id":43248386,"body_markdown":"Please, how are you rsolved this problem ? i try with: java HelloServer -Djava.rmi.server.hostname=192.168.1.5\nbut the client cant&#39; find the server  java.rmi.ConnectException: Connection refused to host: 127.0.1.1; nested exception is:\n    java.net.ConnectException: Connexion refus&#233;e","body":"Please, how are you rsolved this problem ? i try with: java HelloServer -Djava.rmi.server.hostname=192.168.1.5 but the client cant&#39; find the server  java.rmi.ConnectException: Connection refused to host: 127.0.1.1; nested exception is:     java.net.ConnectException: Connexion refus&#233;e"},{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":1,"creation_date":1435275623,"post_id":15696021,"comment_id":50145596,"body_markdown":"@researcher You have to set it at the server JVM. Not the client.","body":"@researcher You have to set it at the server JVM. Not the client."},{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":1,"creation_date":1517505214,"post_id":15696021,"comment_id":84132728,"body_markdown":"@researcher And you also have to provide JVM arguments before the class name, not afterwards.","body":"@researcher And you also have to provide JVM arguments before the class name, not afterwards."},{"owner":{"account_id":6355638,"reputation":2061,"user_id":4933053,"accept_rate":94,"display_name":"droid192"},"score":0,"creation_date":1525173684,"post_id":15696021,"comment_id":87248274,"body_markdown":"the &#39;server&#39; is the skeleton side on which the stub was originally created via .export; on the server side modify the implicitly stub embedded ip the client invokes: `System.setProperty(&quot;java.rmi.server.hostname&quot;,&quot;1.2.3.4&quot;);` meaning this is the ip the destination/skeleton/server is approachable","body":"the &#39;server&#39; is the skeleton side on which the stub was originally created via .export; on the server side modify the implicitly stub embedded ip the client invokes: <code>System.setProperty(&quot;java.rmi.server.hostname&quot;,&quot;1.2.3.4&quot;);</code> meaning this is the ip the destination/skeleton/server is approachable"},{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":2,"creation_date":1589071071,"post_id":15696021,"comment_id":109147337,"body_markdown":"@PatrickBucher The person you mention only contributed a question. You should be thanking is me.","body":"@PatrickBucher The person you mention only contributed a question. You should be thanking is me."}],"tags":[],"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"comment_count":5,"down_vote_count":1,"up_vote_count":56,"is_accepted":true,"score":55,"last_activity_date":1364520807,"creation_date":1364520807,"answer_id":15696021,"question_id":15685686,"body_markdown":"This is [item A.1 in the RMI FAQ][1]. You need to either fix your /etc/hosts file or set the `java.rmi.server.hostname` property at the server.\r\n\r\n\r\n  [1]: http://docs.oracle.com/javase/7/docs/technotes/guides/rmi/faq.html#domain","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>This is <a href=\"http://docs.oracle.com/javase/7/docs/technotes/guides/rmi/faq.html#domain\" rel=\"noreferrer\">item A.1 in the RMI FAQ</a>. You need to either fix your /etc/hosts file or set the <code>java.rmi.server.hostname</code> property at the server.</p>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1408278565,"post_id":16919422,"comment_id":39521790,"body_markdown":"The Registry does not get bound to 127.0.0.1  If the system property didn&#39;t work from the command line you did it wrong.","body":"The Registry does not get bound to 127.0.0.1  If the system property didn&#39;t work from the command line you did it wrong."}],"tags":[],"owner":{"account_id":1059715,"reputation":131,"user_id":1061601,"display_name":"SVashisth"},"comment_count":1,"down_vote_count":2,"up_vote_count":4,"is_accepted":false,"score":2,"last_activity_date":1406549880,"creation_date":1370353128,"answer_id":16919422,"question_id":15685686,"body_markdown":"If you&#39;ve tried modifying etc/hosts and adding java.rmi.server.hostname property as well but still registry is being bind to 127.0.0.1\r\n\r\nthe issue for me was resolved after explicitly setting System property through code though the same property wasn&#39;t picked from jvm args\r\n\r\n","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>If you've tried modifying etc/hosts and adding java.rmi.server.hostname property as well but still registry is being bind to 127.0.0.1</p>\n\n<p>the issue for me was resolved after explicitly setting System property through code though the same property wasn't picked from jvm args</p>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1408278503,"post_id":18139018,"comment_id":39521772,"body_markdown":"It wouldn&#39;t cause this exception with this stacktrace.","body":"It wouldn&#39;t cause this exception with this stacktrace."},{"owner":{"account_id":1324822,"reputation":2133,"user_id":1269892,"accept_rate":100,"display_name":"alisianoi"},"score":4,"creation_date":1485181567,"post_id":18139018,"comment_id":70805157,"body_markdown":"Oh but it would, observing it on my Archlinux box now. Creating the registry with `LocateRegistry.createRegistry(1099)` in my server class rather than getting it with `LocateRegistry.getRegistry()` solves the problem for me.","body":"Oh but it would, observing it on my Archlinux box now. Creating the registry with <code>LocateRegistry.createRegistry(1099)</code> in my server class rather than getting it with <code>LocateRegistry.getRegistry()</code> solves the problem for me."},{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1506209826,"post_id":18139018,"comment_id":79728507,"body_markdown":"It solves another problem. It solves &#39;connection refused&#39; *when doing the lookup*. This problem is &#39;connection refused&#39; *when calling the remote method*.","body":"It solves another problem. It solves &#39;connection refused&#39; <i>when doing the lookup</i>. This problem is &#39;connection refused&#39; <i>when calling the remote method</i>."}],"tags":[],"owner":{"account_id":2615887,"reputation":209,"user_id":2264937,"display_name":"CJeremy"},"comment_count":3,"down_vote_count":2,"up_vote_count":5,"is_accepted":false,"score":3,"last_activity_date":1376013012,"creation_date":1376013012,"answer_id":18139018,"question_id":15685686,"body_markdown":"Maybe your rmiregistry not be created before client trying connect to your server and it would lead to this exception.In Linux, you can use &quot;netstat&quot; to check your rmiregistry be bond on the right port you assigned in java code.\r\n","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>Maybe your rmiregistry not be created before client trying connect to your server and it would lead to this exception.In Linux, you can use \"netstat\" to check your rmiregistry be bond on the right port you assigned in java code.</p>\n"},{"tags":[],"owner":{"account_id":3352915,"reputation":7195,"user_id":2816571,"accept_rate":89,"display_name":"Paul"},"comment_count":0,"down_vote_count":1,"up_vote_count":10,"is_accepted":false,"score":9,"last_activity_date":1394116626,"creation_date":1394116626,"answer_id":22227585,"question_id":15685686,"body_markdown":"I found many of the Q&amp;A on this topic, not nothing was helping me - that&#39;s because my issue was more basic ( what can I say I am not a networking guru :) ).  My ip address in /etc/hosts was incorrect.  What I had tried included the following for CATALINA_OPTS:\r\n\r\n    CATALINA_OPTS=&quot;$CATALINA_OPTS -Djava.awt.headless=true -Xmx128M -server \r\n    -Dcom.sun.management.jmxremote \r\n    -Dcom.sun.management.jmxremote.port=7091 \r\n    -Dcom.sun.management.jmxremote.authenticate=false \r\n    -Dcom.sun.management.jmxremote.ssl=false\r\n    -Djava.rmi.server.hostname=A.B.C.D&quot;  #howeverI put the wrong ip here!\r\n\r\n    export CATALINA_OPTS\r\n\r\n\r\nMy problem was that I had changed my ip address many months ago, but never updated my /etc/hosts file.  it seems that by default the jconsole uses the hostname -i ip address in some fashion even though I was viewing local processes.  The best solution was to simply change the /etc/hosts file.\r\n\r\nThe other solution which can work is to get your correct ip address from /sbin/ifconfig and use that ip address when specifying the ip address in, for example, a catalina.sh script:\r\n \r\n    -Djava.rmi.server.hostname=A.B.C.D","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>I found many of the Q&amp;A on this topic, not nothing was helping me - that's because my issue was more basic ( what can I say I am not a networking guru :) ).  My ip address in /etc/hosts was incorrect.  What I had tried included the following for CATALINA_OPTS:</p>\n\n<pre><code>CATALINA_OPTS=\"$CATALINA_OPTS -Djava.awt.headless=true -Xmx128M -server \n-Dcom.sun.management.jmxremote \n-Dcom.sun.management.jmxremote.port=7091 \n-Dcom.sun.management.jmxremote.authenticate=false \n-Dcom.sun.management.jmxremote.ssl=false\n-Djava.rmi.server.hostname=A.B.C.D\"  #howeverI put the wrong ip here!\n\nexport CATALINA_OPTS\n</code></pre>\n\n<p>My problem was that I had changed my ip address many months ago, but never updated my /etc/hosts file.  it seems that by default the jconsole uses the hostname -i ip address in some fashion even though I was viewing local processes.  The best solution was to simply change the /etc/hosts file.</p>\n\n<p>The other solution which can work is to get your correct ip address from /sbin/ifconfig and use that ip address when specifying the ip address in, for example, a catalina.sh script:</p>\n\n<pre><code>-Djava.rmi.server.hostname=A.B.C.D\n</code></pre>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":5,"creation_date":1435275670,"post_id":28800991,"comment_id":50145606,"body_markdown":"It *does* work when you &#39;try to set the parameter through the JVM&#39;, by which you presumably mean on the command line. If you use `System.setProperty()`, you have to set it before exporting the remote object, not just before binding.","body":"It <i>does</i> work when you &#39;try to set the parameter through the JVM&#39;, by which you presumably mean on the command line. If you use <code>System.setProperty()</code>, you have to set it before exporting the remote object, not just before binding."}],"tags":[],"owner":{"account_id":1859530,"reputation":2250,"user_id":1684389,"display_name":"Raydelto Hernandez"},"comment_count":1,"down_vote_count":1,"up_vote_count":21,"is_accepted":false,"score":20,"last_activity_date":1425255916,"creation_date":1425255916,"answer_id":28800991,"question_id":15685686,"body_markdown":"**PROBLEM SOLVED**\r\n\r\nI had exactly the same error. When the remote object got binded to the rmiregistry it was attached with the loopback IP Address which will obviously fail if you try to invoke a method from a remote address. In order to fix this we need to set the **java.rmi.server.hostname** property to the IP address where other devices can reach your rmiregistry over the network. It doesn&#39;t work when you try to set the parameter through the JVM. **It worked for me** just by adding the following line to my code just before binding the object to the rmiregistry:\r\n\r\n`System.setProperty(&quot;java.rmi.server.hostname&quot;,&quot;192.168.1.2&quot;);`\r\n\r\nIn this case the IP address on the local network of the PC binding the remote object on the RMI Registry is 192.168.1.2. ","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p><strong>PROBLEM SOLVED</strong></p>\n\n<p>I had exactly the same error. When the remote object got binded to the rmiregistry it was attached with the loopback IP Address which will obviously fail if you try to invoke a method from a remote address. In order to fix this we need to set the <strong>java.rmi.server.hostname</strong> property to the IP address where other devices can reach your rmiregistry over the network. It doesn't work when you try to set the parameter through the JVM. <strong>It worked for me</strong> just by adding the following line to my code just before binding the object to the rmiregistry:</p>\n\n<p><code>System.setProperty(\"java.rmi.server.hostname\",\"192.168.1.2\");</code></p>\n\n<p>In this case the IP address on the local network of the PC binding the remote object on the RMI Registry is 192.168.1.2. </p>\n"},{"comments":[{"owner":{"account_id":2142422,"reputation":3442,"user_id":1900770,"display_name":"Davide"},"score":0,"creation_date":1572435291,"post_id":39358386,"comment_id":103556600,"body_markdown":"Thanks, I just modify /etc/hosts to point my localhost and hostname to the same ip, as you show, and now all works","body":"Thanks, I just modify /etc/hosts to point my localhost and hostname to the same ip, as you show, and now all works"}],"tags":[],"owner":{"account_id":5022615,"reputation":2004,"user_id":4035655,"accept_rate":25,"display_name":"Ar maj"},"comment_count":1,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1473198698,"creation_date":1473198698,"answer_id":39358386,"question_id":15685686,"body_markdown":"If you&#39;re running in a Linux environment, open the file `/etc/hosts.allow`\nadd the following line\n\n    ALL\n\n# [Wildcards][1]\n\nAlso check the `/etc/hostname` and `/etc/host` to see if there might be something wrong there.\n\nI had to change my `/ etc / host` from\n\n    127.0.0.1 localhost\n    127.0.1.1 AMK\n    \n\nto\n\n    127.0.0.1 localhost\n    127.0.0.1 AMK\n    \n\nalso wrote in `ALL` in the file `/etc/hosts.allow` which was previously completely empty\n\n# Now everything works \ndo not know how safe it is. you have to read more about possible options for `/etc/hosts.allow` to do something that requires a touch of security.\n\n  [1]: http://www.aboutlinux.info/2005/10/using-tcp-wrappers-to-secure-linux.html","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>If you're running in a Linux environment, open the file <code>/etc/hosts.allow</code>\nadd the following line</p>\n<pre><code>ALL\n</code></pre>\n<h1><a href=\"http://www.aboutlinux.info/2005/10/using-tcp-wrappers-to-secure-linux.html\" rel=\"nofollow noreferrer\">Wildcards</a></h1>\n<p>Also check the <code>/etc/hostname</code> and <code>/etc/host</code> to see if there might be something wrong there.</p>\n<p>I had to change my <code>/ etc / host</code> from</p>\n<pre><code>127.0.0.1 localhost\n127.0.1.1 AMK\n</code></pre>\n<p>to</p>\n<pre><code>127.0.0.1 localhost\n127.0.0.1 AMK\n</code></pre>\n<p>also wrote in <code>ALL</code> in the file <code>/etc/hosts.allow</code> which was previously completely empty</p>\n<h1>Now everything works</h1>\n<p>do not know how safe it is. you have to read more about possible options for <code>/etc/hosts.allow</code> to do something that requires a touch of security.</p>\n"},{"tags":[],"owner":{"account_id":3731306,"reputation":689,"user_id":3103593,"display_name":"Joshua"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1476346664,"creation_date":1476346664,"answer_id":40015727,"question_id":15685686,"body_markdown":"It works for me after getting rid of &quot;::1&quot; in /etc/hosts.","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>It works for me after getting rid of \"::1\" in /etc/hosts.</p>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1506209906,"post_id":46189761,"comment_id":79728518,"body_markdown":"There is no &#39;must&#39; about it. It&#39;s only necessary with misconfigured DNS, or in some multi-homed host situations.","body":"There is no &#39;must&#39; about it. It&#39;s only necessary with misconfigured DNS, or in some multi-homed host situations."}],"tags":[],"owner":{"account_id":3558487,"reputation":1004,"user_id":2971549,"display_name":"Saman Salehi"},"comment_count":1,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1505281787,"creation_date":1505281787,"answer_id":46189761,"question_id":15685686,"body_markdown":"when you want to connect to remote server with **RMI** you must add a system property same as:\r\n\r\n    System.setProperty(&quot;java.rmi.server.hostname&quot;,&quot;Ip or DNS of the server&quot;);\r\nor add environment variable.\r\n\r\nFor me I got **Connection Refused** and solve it by adding this line of code in server side:\r\n\r\n     java -jar -Djava.rmi.server.hostname=&quot;ip or dns of the server&quot; packageName.jar\r\nThank to other guy for guide me to solve it.","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>when you want to connect to remote server with <strong>RMI</strong> you must add a system property same as:</p>\n\n<pre><code>System.setProperty(\"java.rmi.server.hostname\",\"Ip or DNS of the server\");\n</code></pre>\n\n<p>or add environment variable.</p>\n\n<p>For me I got <strong>Connection Refused</strong> and solve it by adding this line of code in server side:</p>\n\n<pre><code> java -jar -Djava.rmi.server.hostname=\"ip or dns of the server\" packageName.jar\n</code></pre>\n\n<p>Thank to other guy for guide me to solve it.</p>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1609108285,"post_id":52552583,"comment_id":115750260,"body_markdown":"He is not getting an eror on `rebind()`.","body":"He is not getting an eror on <code>rebind()</code>."},{"owner":{"account_id":19647813,"reputation":159,"user_id":14382403,"display_name":"Lucky"},"score":0,"creation_date":1670663268,"post_id":52552583,"comment_id":131928747,"body_markdown":"I was using the Naming.rebind() method before and got a similar error posed above. I changed it and followed your code suggestion, added the port number in my Naming.lookup(), my problem is then fixed. Thanks a lot!","body":"I was using the Naming.rebind() method before and got a similar error posed above. I changed it and followed your code suggestion, added the port number in my Naming.lookup(), my problem is then fixed. Thanks a lot!"},{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1697350429,"post_id":52552583,"comment_id":136267284,"body_markdown":"@Lucky This answer does not suggest `Naming.lookup()`.","body":"@Lucky This answer does not suggest <code>Naming.lookup()</code>."}],"tags":[],"owner":{"account_id":4977610,"reputation":169,"user_id":4003515,"display_name":"Jianxing Fan"},"comment_count":3,"down_vote_count":1,"up_vote_count":14,"is_accepted":false,"score":13,"last_activity_date":1633483136,"creation_date":1538127935,"answer_id":52552583,"question_id":15685686,"body_markdown":"you can use `LocateRegistry` such as:\r\n\r\n\r\n    Registry rgsty = LocateRegistry.createRegistry(1888);\r\n    rgsty.rebind(&quot;hello&quot;, hello);\r\n\r\n\r\n","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>you can use <code>LocateRegistry</code> such as:</p>\n<pre><code>Registry rgsty = LocateRegistry.createRegistry(1888);\nrgsty.rebind(&quot;hello&quot;, hello);\n</code></pre>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1689893327,"post_id":54123177,"comment_id":135281599,"body_markdown":"They&#39;re both wrong. Those IP addresses should both map to a real hostname, and there should be another entry `127.0.0.1 localhost`.","body":"They&#39;re both wrong. Those IP addresses should both map to a real hostname, and there should be another entry <code>127.0.0.1 localhost</code>."}],"tags":[],"owner":{"account_id":8538329,"reputation":165,"user_id":6399245,"display_name":"Dinu94"},"comment_count":1,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1547102581,"creation_date":1547102581,"answer_id":54123177,"question_id":15685686,"body_markdown":"I had the same exact problem and my issue was that I had 2 IP addresses from 2 different networks configured in the etc/hosts as below.\r\n\r\n    10.xxx.x.xxx    localhost\r\n    192.xxx.x.xxx   localhost\r\n\r\nThis should be because there was a conflict as to which IP to be used for the other devices to reach the rmiregistry over the network.\r\n\r\nOnce I removed the extra-record that is not required, I was able to solve the issue.\r\n\r\nSo my etc/hosts file had only the following record.\r\n\r\n    10.xxx.x.xxx    localhost\r\n\r\n","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>I had the same exact problem and my issue was that I had 2 IP addresses from 2 different networks configured in the etc/hosts as below.</p>\n\n<pre><code>10.xxx.x.xxx    localhost\n192.xxx.x.xxx   localhost\n</code></pre>\n\n<p>This should be because there was a conflict as to which IP to be used for the other devices to reach the rmiregistry over the network.</p>\n\n<p>Once I removed the extra-record that is not required, I was able to solve the issue.</p>\n\n<p>So my etc/hosts file had only the following record.</p>\n\n<pre><code>10.xxx.x.xxx    localhost\n</code></pre>\n"},{"tags":[],"owner":{"account_id":147918,"reputation":1406,"user_id":359353,"accept_rate":57,"display_name":"Dula"},"comment_count":0,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1548133561,"creation_date":1548133561,"answer_id":54301573,"question_id":15685686,"body_markdown":"On Windows make sure your Windows firewall is correctly configure / disabled. I had to disable the Windows firewall (because I didn&#39;t bother with configuring it) to get things to work even when I was testing with localhost.","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>On Windows make sure your Windows firewall is correctly configure / disabled. I had to disable the Windows firewall (because I didn't bother with configuring it) to get things to work even when I was testing with localhost.</p>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1570177511,"post_id":57820041,"comment_id":102838844,"body_markdown":"If the port was already occupied you didn&#39;t get &#39;connection refused&#39;, and changing the Regsitry to another port didn&#39;t fix anything unless you also adjusted the code, and port 1099 was reserved for the RMI Registry by 1996, so whatever alleged process was allegedly already listening to it was severally non-compliant.","body":"If the port was already occupied you didn&#39;t get &#39;connection refused&#39;, and changing the Regsitry to another port didn&#39;t fix anything unless you also adjusted the code, and port 1099 was reserved for the RMI Registry by 1996, so whatever alleged process was allegedly already listening to it was severally non-compliant."}],"tags":[],"owner":{"account_id":4969482,"reputation":940,"user_id":3997782,"accept_rate":62,"display_name":"Leonardo Rignanese"},"comment_count":1,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1567764750,"creation_date":1567764750,"answer_id":57820041,"question_id":15685686,"body_markdown":"In my case I was unable to edit the hosts file because using a pc from the university.\r\n\r\nI fixed the problem running rmiregistry in another port (instead of 1099) with:\r\n\r\n    rmiregistry &lt;port&gt;\r\n\r\nand then running the server on that port.\r\n\r\nIt was basically an error caused by occupied port.","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>In my case I was unable to edit the hosts file because using a pc from the university.</p>\n\n<p>I fixed the problem running rmiregistry in another port (instead of 1099) with:</p>\n\n<pre><code>rmiregistry &lt;port&gt;\n</code></pre>\n\n<p>and then running the server on that port.</p>\n\n<p>It was basically an error caused by occupied port.</p>\n"},{"comments":[{"owner":{"account_id":71739,"reputation":307163,"user_id":207421,"accept_rate":82,"display_name":"user207421"},"score":0,"creation_date":1609108383,"post_id":59360887,"comment_id":115750278,"body_markdown":"This is not correct. The URL you use for the Registry does not determine what IP address the remote object is bound to. The IP bind has already happened prior to this code.","body":"This is not correct. The URL you use for the Registry does not determine what IP address the remote object is bound to. The IP bind has already happened prior to this code."}],"tags":[],"owner":{"account_id":17321602,"reputation":1,"user_id":12546933,"display_name":"Dr. Ahmad Abusukhon"},"comment_count":1,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1576515995,"creation_date":1576514668,"answer_id":59360887,"question_id":15685686,"body_markdown":"When I got the same error on my machine (&quot;connection is refused&quot;), the reason was that I had defined the following on the server side: \r\n\r\n     Naming.rebind(&quot;rmi://localhost:8080/AddService&quot;\r\n       ,addService); \r\n\r\nThus the server binds both the IP = 127.0.0.1 and the port 8080.\r\n\r\nBut on the client side I had used:\r\n\r\n    AddServerInterface st = (AddServerInterface)Naming.lookup(&quot;rmi://localhost&quot;\r\n                            +&quot;/AddService&quot;);\r\n\r\nThus I forgot to add the port number after the localhost, so I rewrote the above command and added the port number 8080 as follows:\r\n\r\n    AddServerInterface st = (AddServerInterface)Naming.lookup(&quot;rmi://localhost:8080&quot;\r\n                            +&quot;/AddService&quot;);\r\n\r\nand everything worked fine.\r\n","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>When I got the same error on my machine (\"connection is refused\"), the reason was that I had defined the following on the server side: </p>\n\n<pre><code> Naming.rebind(\"rmi://localhost:8080/AddService\"\n   ,addService); \n</code></pre>\n\n<p>Thus the server binds both the IP = 127.0.0.1 and the port 8080.</p>\n\n<p>But on the client side I had used:</p>\n\n<pre><code>AddServerInterface st = (AddServerInterface)Naming.lookup(\"rmi://localhost\"\n                        +\"/AddService\");\n</code></pre>\n\n<p>Thus I forgot to add the port number after the localhost, so I rewrote the above command and added the port number 8080 as follows:</p>\n\n<pre><code>AddServerInterface st = (AddServerInterface)Naming.lookup(\"rmi://localhost:8080\"\n                        +\"/AddService\");\n</code></pre>\n\n<p>and everything worked fine.</p>\n"},{"comments":[{"owner":{"account_id":84677,"reputation":16500,"user_id":236528,"accept_rate":100,"display_name":"mjuarez"},"score":1,"creation_date":1578987489,"post_id":59728842,"comment_id":105608019,"body_markdown":"Welcome to StackOverflow. This doesn&#39;t answer the original question.","body":"Welcome to StackOverflow. This doesn&#39;t answer the original question."}],"tags":[],"owner":{"account_id":17523593,"reputation":1,"user_id":12709109,"display_name":"Chimdesa Asebe"},"comment_count":1,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1641875999,"creation_date":1578985069,"answer_id":59728842,"question_id":15685686,"body_markdown":"You can simply use:\r\n\r\non server side:\r\n\r\n    Registry &lt;objectName1&gt; = LocateRegistry.createRegistry(1099);\r\n    Registry &lt;objectName2&gt; = LocateRegistry.getRegistry();\r\n\r\n\r\non Client Side:\r\n\r\n    Registry &lt;object name you want&gt; = LocateRegistry.getRegistry();\r\n\r\n","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<p>You can simply use:</p>\n<p>on server side:</p>\n<pre><code>Registry &lt;objectName1&gt; = LocateRegistry.createRegistry(1099);\nRegistry &lt;objectName2&gt; = LocateRegistry.getRegistry();\n</code></pre>\n<p>on Client Side:</p>\n<pre><code>Registry &lt;object name you want&gt; = LocateRegistry.getRegistry();\n</code></pre>\n"},{"tags":[],"owner":{"account_id":6696632,"reputation":3404,"user_id":5164462,"display_name":"User Rebo"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701103661,"creation_date":1701103145,"answer_id":77558535,"question_id":15685686,"body_markdown":"## IntelliJ\r\n\r\nI used these flags in IntelliJs _VM Options_ to enable IPv6 only support, which lead to this error:\r\n\r\n\r\n```cmd\r\njava.lang.RuntimeException: java.rmi.ConnectException: Connection refused to host: ::1; nested exception is: java.net.ConnectException: Connection refused: connect in ExceptionUtil.rethrow(ExceptionUtil.java:138) Caused by: java.rmi.ConnectException: Connection refused to host: ::1; nested exception is: java.net.ConnectException: Connection refused: connect at java.rmi/sun.rmi.transport.tcp.TCPEndpoint.newSocket(TCPEndpoint.java:626) at java.rmi/sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:217) at java.rmi/sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:204) at java.rmi/sun.rmi.server.UnicastRef.newCall(UnicastRef.java:344) at java.rmi/sun.rmi.registry.RegistryImpl_Stub.lookup(RegistryImpl_Stub.java:116) in RemoteProcessSupport.lambda$acquire$2(RemoteProcessSupport.java:324) Caused by: java.net.ConnectException: Connection refused: connect at java.base/sun.nio.ch.Net.connect0(Native Method) at java.base/sun.nio.ch.Net.connect(Net.java:579) at java.base/sun.nio.ch.Net.connect(Net.java:568) at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:593) at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327) at java.base/java.net.Socket.connect(Socket.java:633) at java.base/java.net.Socket.connect(Socket.java:583) at java.base/java.net.Socket. (Socket.java:507) at java.base/java.net.Socket. (Socket.java:287) in RemoteServer$1.createSocket(RemoteServer.java:156) ... 22 more Suppressed: com.intellij.database.util.AsyncTask$Companion$FrameData: Async frame data: Submit -&gt; Prepare connection -&gt; \r\n```\r\n\r\nI commented the flags out with a `#`\r\n```cmd\r\n-Djava.net.preferIPv4Stack=false\r\n-Djava.net.preferIPv6Addresses=true\r\n```\r\n\r\nAnd started the postgres server via\r\n```cmd\r\npostgres -D &quot;C:\\Program Files\\PostgreSQL\\16\\data&quot;\r\n```","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<h2>IntelliJ</h2>\n<p>I used these flags in IntelliJs <em>VM Options</em> to enable IPv6 only support, which lead to this error:</p>\n<pre><code>java.lang.RuntimeException: java.rmi.ConnectException: Connection refused to host: ::1; nested exception is: java.net.ConnectException: Connection refused: connect in ExceptionUtil.rethrow(ExceptionUtil.java:138) Caused by: java.rmi.ConnectException: Connection refused to host: ::1; nested exception is: java.net.ConnectException: Connection refused: connect at java.rmi/sun.rmi.transport.tcp.TCPEndpoint.newSocket(TCPEndpoint.java:626) at java.rmi/sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:217) at java.rmi/sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:204) at java.rmi/sun.rmi.server.UnicastRef.newCall(UnicastRef.java:344) at java.rmi/sun.rmi.registry.RegistryImpl_Stub.lookup(RegistryImpl_Stub.java:116) in RemoteProcessSupport.lambda$acquire$2(RemoteProcessSupport.java:324) Caused by: java.net.ConnectException: Connection refused: connect at java.base/sun.nio.ch.Net.connect0(Native Method) at java.base/sun.nio.ch.Net.connect(Net.java:579) at java.base/sun.nio.ch.Net.connect(Net.java:568) at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:593) at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327) at java.base/java.net.Socket.connect(Socket.java:633) at java.base/java.net.Socket.connect(Socket.java:583) at java.base/java.net.Socket. (Socket.java:507) at java.base/java.net.Socket. (Socket.java:287) in RemoteServer$1.createSocket(RemoteServer.java:156) ... 22 more Suppressed: com.intellij.database.util.AsyncTask$Companion$FrameData: Async frame data: Submit -&gt; Prepare connection -&gt; \n</code></pre>\n<p>I commented the flags out with a <code>#</code></p>\n<pre><code>-Djava.net.preferIPv4Stack=false\n-Djava.net.preferIPv6Addresses=true\n</code></pre>\n<p>And started the postgres server via</p>\n<pre><code>postgres -D &quot;C:\\Program Files\\PostgreSQL\\16\\data&quot;\n</code></pre>\n"}],"owner":{"account_id":2420278,"reputation":791,"user_id":2113403,"accept_rate":44,"display_name":"heythatsmekri"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":270063,"favorite_count":0,"down_vote_count":0,"up_vote_count":58,"accepted_answer_id":15696021,"answer_count":15,"score":58,"last_activity_date":1701103661,"creation_date":1364484147,"question_id":15685686,"body_markdown":"        java.rmi.ConnectException: Connection refused to host: 127.0.1.1; nested exception is:\r\n        java.net.ConnectException: Connection refused\r\n        at sun.rmi.transport.tcp.TCPEndpoint.newSocket(TCPEndpoint.java:619)\r\n        at sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:216)\r\n        at sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:202)\r\n        at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:128)\r\n        at java.rmi.server.RemoteObjectInvocationHandler.invokeRemoteMethod(RemoteObjectInvocationHandler.java:194)\r\n        at java.rmi.server.RemoteObjectInvocationHandler.invoke(RemoteObjectInvocationHandler.java:148)\r\n        at com.sun.proxy.$Proxy0.notifyMe(Unknown Source)\r\n        at CallbackServerImpl.doCallback(CallbackServerImpl.java:149)\r\n        at CallbackServerImpl.registerForCallback(CallbackServerImpl.java:70)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:601)\r\n        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)\r\n        at sun.rmi.transport.Transport$1.run(Transport.java:177)\r\n        at sun.rmi.transport.Transport$1.run(Transport.java:174)\r\n        at java.security.AccessController.doPrivileged(Native Method)\r\n        at sun.rmi.transport.Transport.serviceCall(Transport.java:173)\r\n        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:553)\r\n        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:808)\r\n        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:667)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\r\n        at java.lang.Thread.run(Thread.java:722)\r\n        Caused by: java.net.ConnectException: Connection refused\r\n        at java.net.PlainSocketImpl.socketConnect(Native Method)\r\n        at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\r\n        at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\r\n        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\r\n        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:391)\r\n        at java.net.Socket.connect(Socket.java:579)\r\n        at java.net.Socket.connect(Socket.java:528)\r\n        at java.net.Socket.&lt;init&gt;(Socket.java:425)\r\n        at java.net.Socket.&lt;init&gt;(Socket.java:208)\r\n        at sun.rmi.transport.proxy.RMIDirectSocketFactory.createSocket(RMIDirectSocketFactory.java:40)\r\n        at sun.rmi.transport.proxy.RMIMasterSocketFactory.createSocket(RMIMasterSocketFactory.java:146)\r\n        at sun.rmi.transport.tcp.TCPEndpoint.newSocket(TCPEndpoint.java:613)\r\n        ... 23 more\r\n\r\n\r\nI get this exception when I try to connect a remote client to my server. In both, server and client the hostName for the registryUrl of rmi is the public IP address of the server. I also tried to put localhost in server but the error doesn&#39;t change. \r\n\r\nMy java.policy is set to grant all connections to all ports and I have no firewalls enabled in the server or the client.\r\n\r\nAny suggestions what could be?","title":"java.rmi.ConnectException: Connection refused to host: 127.0.1.1;","body":"<pre><code>    java.rmi.ConnectException: Connection refused to host: 127.0.1.1; nested exception is:\n    java.net.ConnectException: Connection refused\n    at sun.rmi.transport.tcp.TCPEndpoint.newSocket(TCPEndpoint.java:619)\n    at sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:216)\n    at sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:202)\n    at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:128)\n    at java.rmi.server.RemoteObjectInvocationHandler.invokeRemoteMethod(RemoteObjectInvocationHandler.java:194)\n    at java.rmi.server.RemoteObjectInvocationHandler.invoke(RemoteObjectInvocationHandler.java:148)\n    at com.sun.proxy.$Proxy0.notifyMe(Unknown Source)\n    at CallbackServerImpl.doCallback(CallbackServerImpl.java:149)\n    at CallbackServerImpl.registerForCallback(CallbackServerImpl.java:70)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:601)\n    at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)\n    at sun.rmi.transport.Transport$1.run(Transport.java:177)\n    at sun.rmi.transport.Transport$1.run(Transport.java:174)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at sun.rmi.transport.Transport.serviceCall(Transport.java:173)\n    at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:553)\n    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:808)\n    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:667)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:722)\n    Caused by: java.net.ConnectException: Connection refused\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:391)\n    at java.net.Socket.connect(Socket.java:579)\n    at java.net.Socket.connect(Socket.java:528)\n    at java.net.Socket.&lt;init&gt;(Socket.java:425)\n    at java.net.Socket.&lt;init&gt;(Socket.java:208)\n    at sun.rmi.transport.proxy.RMIDirectSocketFactory.createSocket(RMIDirectSocketFactory.java:40)\n    at sun.rmi.transport.proxy.RMIMasterSocketFactory.createSocket(RMIMasterSocketFactory.java:146)\n    at sun.rmi.transport.tcp.TCPEndpoint.newSocket(TCPEndpoint.java:613)\n    ... 23 more\n</code></pre>\n\n<p>I get this exception when I try to connect a remote client to my server. In both, server and client the hostName for the registryUrl of rmi is the public IP address of the server. I also tried to put localhost in server but the error doesn't change. </p>\n\n<p>My java.policy is set to grant all connections to all ports and I have no firewalls enabled in the server or the client.</p>\n\n<p>Any suggestions what could be?</p>\n"},{"tags":["java","spring","security","oauth-2.0","keycloak"],"comments":[{"owner":{"account_id":24440940,"reputation":3132,"user_id":18364656,"display_name":"Andrei Lisa"},"score":0,"creation_date":1701073512,"post_id":77555031,"comment_id":136725083,"body_markdown":"In this case you have to use [resource-server](https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/index.html) part not [client](https://docs.spring.io/spring-security/reference/servlet/oauth2/client/index.html) part","body":"In this case you have to use <a href=\"https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/index.html\" rel=\"nofollow noreferrer\">resource-server</a> part not <a href=\"https://docs.spring.io/spring-security/reference/servlet/oauth2/client/index.html\" rel=\"nofollow noreferrer\">client</a> part"}],"answers":[{"tags":[],"owner":{"account_id":308139,"reputation":8199,"user_id":619830,"accept_rate":75,"display_name":"ch4mp"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701103230,"creation_date":1701103230,"answer_id":77558544,"question_id":77555031,"body_markdown":"You &quot;login&quot; to an OAuth2 client (with `authorization_code` flow), not to an OAuth2 resource server and **requests to an OAuth2 client from a browser are authorized with sessions**, not `Bearer` tokens in authorization header. Before trying to configure your app as a resource server (and use tokens security), you should be sure that you can actually send tokens from what you are trying to consume it with (browsers are very bad candidates for that).\r\n\r\nAlso, **you should not mix `oauth2Login` and `oauth2ResourceServer` in the same filter chain**, the security is too different:\r\n- `oauth2Login` is based on sessions, requires CSRF protection (disabling it like you do is a mistake), and unauthorized requests to secured routes should probably be redirected to login (`302` status)\r\n- `oauth2ResourceServer` can (should?) be configured stateless (without session), is not exposed to CSRF attacks and unauthorized requests to secured routes should probably be answered `401 Unauthorized`.\r\n\r\nI suggest that you have a look at my [OAuth2 essentials](https://github.com/ch4mpy/spring-addons/tree/master/samples/tutorials#oauth_essentials) and tutorials.","title":"Keycloak + Spring 3","body":"<p>You &quot;login&quot; to an OAuth2 client (with <code>authorization_code</code> flow), not to an OAuth2 resource server and <strong>requests to an OAuth2 client from a browser are authorized with sessions</strong>, not <code>Bearer</code> tokens in authorization header. Before trying to configure your app as a resource server (and use tokens security), you should be sure that you can actually send tokens from what you are trying to consume it with (browsers are very bad candidates for that).</p>\n<p>Also, <strong>you should not mix <code>oauth2Login</code> and <code>oauth2ResourceServer</code> in the same filter chain</strong>, the security is too different:</p>\n<ul>\n<li><code>oauth2Login</code> is based on sessions, requires CSRF protection (disabling it like you do is a mistake), and unauthorized requests to secured routes should probably be redirected to login (<code>302</code> status)</li>\n<li><code>oauth2ResourceServer</code> can (should?) be configured stateless (without session), is not exposed to CSRF attacks and unauthorized requests to secured routes should probably be answered <code>401 Unauthorized</code>.</li>\n</ul>\n<p>I suggest that you have a look at my <a href=\"https://github.com/ch4mpy/spring-addons/tree/master/samples/tutorials#oauth_essentials\" rel=\"nofollow noreferrer\">OAuth2 essentials</a> and tutorials.</p>\n"}],"owner":{"account_id":20708491,"reputation":1,"user_id":16012408,"display_name":"kifor4ik"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":44,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701103230,"creation_date":1701068643,"question_id":77555031,"body_markdown":"How I can enable **bearer-only ** mode for auth? \r\nNow when my request have no token app redirect me to KeyCloak login page but I want to get 403 forbidden.\r\n\r\nSecurityFilterChain\r\n```\r\n@Bean\r\npublic SecurityFilterChain configure(HttpSecurity http) throws Exception {\r\n    http.oauth2Login()\r\n            .and()\r\n            .csrf().disable();\r\n\r\n    http.oauth2ResourceServer().jwt();\r\n    http\r\n            .sessionManagement()\r\n            .sessionCreationPolicy(SessionCreationPolicy.ALWAYS);\r\n\r\n    http\r\n            .authorizeHttpRequests()\r\n            .requestMatchers(&quot;/test&quot;).permitAll()\r\n            .anyRequest().authenticated();\r\n\r\n    return http.build();\r\n}\r\n```\r\n\r\napplication.yml\r\n```\r\nspring:\r\n  security:\r\n    oauth2:\r\n      client:\r\n        registration:\r\n          keycloak:\r\n            client-id: paper_java\r\n            client-secret: JEEcO8mJhKzkcx2aZ2sgZ8E2JsSx4Lms\r\n            scope: openid\r\n            authorization-grant-type: authorization_code\r\n        provider:\r\n          keycloak:\r\n            issuer-uri: http://localhost:9999/realms/ss\r\n            user-name-attribute: preferred_username\r\n      resourceserver:\r\n        jwt:\r\n          issuer-uri: http://localhost:9999/realms/ss\r\n```\r\n\r\nIm trying to make keycloak only checking token validation service, but got login page.","title":"Keycloak + Spring 3","body":"<p>How I can enable **bearer-only ** mode for auth?\nNow when my request have no token app redirect me to KeyCloak login page but I want to get 403 forbidden.</p>\n<p>SecurityFilterChain</p>\n<pre><code>@Bean\npublic SecurityFilterChain configure(HttpSecurity http) throws Exception {\n    http.oauth2Login()\n            .and()\n            .csrf().disable();\n\n    http.oauth2ResourceServer().jwt();\n    http\n            .sessionManagement()\n            .sessionCreationPolicy(SessionCreationPolicy.ALWAYS);\n\n    http\n            .authorizeHttpRequests()\n            .requestMatchers(&quot;/test&quot;).permitAll()\n            .anyRequest().authenticated();\n\n    return http.build();\n}\n</code></pre>\n<p>application.yml</p>\n<pre><code>spring:\n  security:\n    oauth2:\n      client:\n        registration:\n          keycloak:\n            client-id: paper_java\n            client-secret: JEEcO8mJhKzkcx2aZ2sgZ8E2JsSx4Lms\n            scope: openid\n            authorization-grant-type: authorization_code\n        provider:\n          keycloak:\n            issuer-uri: http://localhost:9999/realms/ss\n            user-name-attribute: preferred_username\n      resourceserver:\n        jwt:\n          issuer-uri: http://localhost:9999/realms/ss\n</code></pre>\n<p>Im trying to make keycloak only checking token validation service, but got login page.</p>\n"},{"tags":["java","gradle","spotbugs"],"comments":[{"owner":{"account_id":469790,"reputation":1689,"user_id":876595,"display_name":"chehsunliu"},"score":0,"creation_date":1664300378,"post_id":73868117,"comment_id":130438495,"body_markdown":"What&#39;s the purpose of limiting SpotBugs tasks in sequential?","body":"What&#39;s the purpose of limiting SpotBugs tasks in sequential?"},{"owner":{"account_id":23204293,"reputation":66,"user_id":17298718,"display_name":"Mario Metushev"},"score":0,"creation_date":1664305413,"post_id":73868117,"comment_id":130440064,"body_markdown":"@chehsunliu SpotBugs task require a lot of resources, like 1GB of RAM. I don&#39;t have control which task will be executed at time and if gradle run more than 4 or 5 parallel Spotbugs tasks, my machine starting lock files for no reason and to fix that I need to restart the machine, nothing else helps even if you try to kill the process...\nSo that is the reason why I want only this task to run sequential :)","body":"@chehsunliu SpotBugs task require a lot of resources, like 1GB of RAM. I don&#39;t have control which task will be executed at time and if gradle run more than 4 or 5 parallel Spotbugs tasks, my machine starting lock files for no reason and to fix that I need to restart the machine, nothing else helps even if you try to kill the process... So that is the reason why I want only this task to run sequential :)"},{"owner":{"account_id":469790,"reputation":1689,"user_id":876595,"display_name":"chehsunliu"},"score":0,"creation_date":1664336038,"post_id":73868117,"comment_id":130445633,"body_markdown":"A workaround would be assigning cross-project task dependencies among all the SpotBugs tasks explicitly. But the gradle script might look ugly and not easy to maintain.\n\nIn my case, I do not run SpotBugs locally. I only run it on GitHub Actions.","body":"A workaround would be assigning cross-project task dependencies among all the SpotBugs tasks explicitly. But the gradle script might look ugly and not easy to maintain.  In my case, I do not run SpotBugs locally. I only run it on GitHub Actions."}],"answers":[{"tags":[],"owner":{"account_id":288740,"reputation":36435,"user_id":589329,"accept_rate":40,"display_name":"Vampire"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":true,"score":1,"last_activity_date":1701102948,"creation_date":1701102948,"answer_id":77558514,"question_id":73868117,"body_markdown":"To achieve what you want, you create a [shared build service](https://docs.gradle.org/current/userguide/build_services.html). This build service does not need to have any parameters and does not need to have any actual logic, it is only used for the sequencialising. You configure this build service to be used by maximum one task. And then you define all the tasks you want non-parallel to each other to use that service. This will cause only one of those tasks to run at the same time.","title":"Spotbugs sequential execution as gradle task","body":"<p>To achieve what you want, you create a <a href=\"https://docs.gradle.org/current/userguide/build_services.html\" rel=\"nofollow noreferrer\">shared build service</a>. This build service does not need to have any parameters and does not need to have any actual logic, it is only used for the sequencialising. You configure this build service to be used by maximum one task. And then you define all the tasks you want non-parallel to each other to use that service. This will cause only one of those tasks to run at the same time.</p>\n"}],"owner":{"account_id":23204293,"reputation":66,"user_id":17298718,"display_name":"Mario Metushev"},"comment_count":3,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":98,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"accepted_answer_id":77558514,"answer_count":1,"score":1,"last_activity_date":1701102948,"creation_date":1664284041,"question_id":73868117,"body_markdown":"I have a problem with running spotbugs as sequential gradle task.\r\nI want to mentioned that the project is Java multi module based.\r\nI am running parallel gradle tasks at once(up to 8 like compile,test,…) on different modules and I do not want to change that behavior.\r\nWhat I want is just one gradle task, in my case that task is spotbugs to run sequentially and the other tasks to run in parallel.\r\nDoes gradle provides some option for that?\r\n\r\n**UPDATE**:\r\nUse the Gradle feature called BuildService :)\r\nhttps://docs.gradle.org/current/userguide/build_services.html ","title":"Spotbugs sequential execution as gradle task","body":"<p>I have a problem with running spotbugs as sequential gradle task.\nI want to mentioned that the project is Java multi module based.\nI am running parallel gradle tasks at once(up to 8 like compile,test,…) on different modules and I do not want to change that behavior.\nWhat I want is just one gradle task, in my case that task is spotbugs to run sequentially and the other tasks to run in parallel.\nDoes gradle provides some option for that?</p>\n<p><strong>UPDATE</strong>:\nUse the Gradle feature called BuildService :)\n<a href=\"https://docs.gradle.org/current/userguide/build_services.html\" rel=\"nofollow noreferrer\">https://docs.gradle.org/current/userguide/build_services.html</a></p>\n"},{"tags":["java","jpa","spring-data","repository","spring-data-jpa"],"comments":[{"owner":{"account_id":277416,"reputation":681878,"user_id":571407,"accept_rate":100,"display_name":"JB Nizet"},"score":2,"creation_date":1399206696,"post_id":23456197,"comment_id":35957216,"body_markdown":"Spring Data JPA heavily relies on Java naming conventions. You chose not to respect them by having an underscore in your field and accessor names. That&#39;s why you got bitten. Respect the Java naming conventions, and Spring Data JPA will be happy, and your code will be more readable as a bonus. Not that the column can be named as you want, including with underscores. What matters is your mapped field names.","body":"Spring Data JPA heavily relies on Java naming conventions. You chose not to respect them by having an underscore in your field and accessor names. That&#39;s why you got bitten. Respect the Java naming conventions, and Spring Data JPA will be happy, and your code will be more readable as a bonus. Not that the column can be named as you want, including with underscores. What matters is your mapped field names."},{"owner":{"account_id":1139113,"reputation":18996,"user_id":1123501,"accept_rate":89,"display_name":"Georgios Syngouroglou"},"score":0,"creation_date":1399207090,"post_id":23456197,"comment_id":35957343,"body_markdown":"Thank you very much for your comment. I didn&#39;t know about the java naming conventions. I found, also, this [stackoverflow question](http://stackoverflow.com/questions/150192/using-underscores-in-java-variables-and-method-names) that helped me too.","body":"Thank you very much for your comment. I didn&#39;t know about the java naming conventions. I found, also, this <a href=\"http://stackoverflow.com/questions/150192/using-underscores-in-java-variables-and-method-names\">stackoverflow question</a> that helped me too."}],"answers":[{"comments":[{"owner":{"account_id":1764655,"reputation":2160,"user_id":1610778,"display_name":"Stan Sokolov"},"score":28,"creation_date":1460252833,"post_id":23475349,"comment_id":60654323,"body_markdown":"This does not work. Double underscore does not change anything. And fields in Java JPA object just follow the name of the fields in database that obviously does not follow Java convention. So that must be a pretty common use case.","body":"This does not work. Double underscore does not change anything. And fields in Java JPA object just follow the name of the fields in database that obviously does not follow Java convention. So that must be a pretty common use case."},{"owner":{"account_id":5264865,"reputation":782,"user_id":4205199,"accept_rate":75,"display_name":"Zomono"},"score":3,"creation_date":1512128330,"post_id":23475349,"comment_id":82142152,"body_markdown":"The double underscore solution did not worked for me too and I am not able to undo my upvote...","body":"The double underscore solution did not worked for me too and I am not able to undo my upvote..."},{"owner":{"account_id":1554391,"reputation":1540,"user_id":1445967,"accept_rate":37,"display_name":"user1445967"},"score":0,"creation_date":1566412618,"post_id":23475349,"comment_id":101652008,"body_markdown":"The double underscore did not work for me, but I also see many upvotes.  Perhaps the answer can be improved by listing the conditions required for this to work, so those for whom it doesn&#39;t apply don&#39;t attempt this solution?","body":"The double underscore did not work for me, but I also see many upvotes.  Perhaps the answer can be improved by listing the conditions required for this to work, so those for whom it doesn&#39;t apply don&#39;t attempt this solution?"},{"owner":{"account_id":3487029,"reputation":108,"user_id":2917678,"display_name":"negative"},"score":0,"creation_date":1602872626,"post_id":23475349,"comment_id":113867478,"body_markdown":"The answer is fine. Just use option 1. People spent way too much time working on conventions and providing support for it so it becomes useful. The only problem with the answer is that option 2 is mentioned, it shouldn&#39;t.","body":"The answer is fine. Just use option 1. People spent way too much time working on conventions and providing support for it so it becomes useful. The only problem with the answer is that option 2 is mentioned, it shouldn&#39;t."},{"owner":{"account_id":2900414,"reputation":5120,"user_id":2487263,"accept_rate":58,"display_name":"raspacorp"},"score":1,"creation_date":1614293652,"post_id":23475349,"comment_id":117349392,"body_markdown":"Option 1 is sometimes not possible, especially when you work with code that is supposed to follow format guidelines and which verification is done as part of the build, some code conventions in some companies require you to use prefix instance variables with &quot;_&quot; to differentiate them from method local variables and to avoid idioms like this.myVar = myVar which can become smelly. Jagannath&#39;s answer covers those cases.","body":"Option 1 is sometimes not possible, especially when you work with code that is supposed to follow format guidelines and which verification is done as part of the build, some code conventions in some companies require you to use prefix instance variables with &quot;_&quot; to differentiate them from method local variables and to avoid idioms like this.myVar = myVar which can become smelly. Jagannath&#39;s answer covers those cases."},{"owner":{"account_id":17750,"reputation":25470,"user_id":40064,"accept_rate":69,"display_name":"Wim Deblauwe"},"score":0,"creation_date":1635229948,"post_id":23475349,"comment_id":123233275,"body_markdown":"The link to the reference docs is no longer valid. This is the correct one: https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-property-expressions","body":"The link to the reference docs is no longer valid. This is the correct one: <a href=\"https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-property-expressions\" rel=\"nofollow noreferrer\">docs.spring.io/spring-data/jpa/docs/current/reference/html/&hellip;</a>"}],"tags":[],"owner":{"account_id":9744,"reputation":80816,"user_id":18122,"accept_rate":80,"display_name":"Oliver Drotbohm"},"comment_count":6,"down_vote_count":14,"up_vote_count":59,"is_accepted":true,"score":45,"last_activity_date":1399301175,"creation_date":1399301175,"answer_id":23475349,"question_id":23456197,"body_markdown":"The underscore `_` is a reserved character in Spring Data query derivation (see the [reference docs][1] for details) to potentially allow manual property path description. So there are two options you have:\r\n\r\n1. Stick to the Java naming conventions of using [camel-case][2] for member variable names and everything will work as expected.\r\n2. Escape the `_` by using an additional underscore, i.e. rename your query method to `findByMunicipal__idOrderByLastnameDesc(…)`.\r\n\r\nI&#39;d recommend the former as you&#39;re not going to alienate fellow Java developers :).\r\n\r\n\r\n  [1]: http://docs.spring.io/spring-data/jpa/docs/current/reference/html/repositories.html#repositories.query-methods.query-property-expressions\r\n  [2]: http://en.wikipedia.org/wiki/CamelCase","title":"Spring-Data-Jpa Repository - Underscore on Entity Column Name","body":"<p>The underscore <code>_</code> is a reserved character in Spring Data query derivation (see the <a href=\"http://docs.spring.io/spring-data/jpa/docs/current/reference/html/repositories.html#repositories.query-methods.query-property-expressions\">reference docs</a> for details) to potentially allow manual property path description. So there are two options you have:</p>\n\n<ol>\n<li>Stick to the Java naming conventions of using <a href=\"http://en.wikipedia.org/wiki/CamelCase\">camel-case</a> for member variable names and everything will work as expected.</li>\n<li>Escape the <code>_</code> by using an additional underscore, i.e. rename your query method to <code>findByMunicipal__idOrderByLastnameDesc(…)</code>.</li>\n</ol>\n\n<p>I'd recommend the former as you're not going to alienate fellow Java developers :).</p>\n"},{"comments":[{"owner":{"account_id":5636901,"reputation":171,"user_id":4462119,"display_name":"Thomas Carlisle"},"score":2,"creation_date":1498675264,"post_id":40426741,"comment_id":76600809,"body_markdown":"This really is the best way to handle this scenario and should be the accepted answer. I realize this answer came a few years after the question and first answer, but am putting this comment to draw attention of future visitors to this answer. Solving in this manner allows you to work with databases that name fields in a way you cannot control, without deviating from the coding standards which are generally accepted across the entire field of java developers, e.g. keeps underscores entirely out of your method and variable names.","body":"This really is the best way to handle this scenario and should be the accepted answer. I realize this answer came a few years after the question and first answer, but am putting this comment to draw attention of future visitors to this answer. Solving in this manner allows you to work with databases that name fields in a way you cannot control, without deviating from the coding standards which are generally accepted across the entire field of java developers, e.g. keeps underscores entirely out of your method and variable names."},{"owner":{"account_id":1567451,"reputation":3382,"user_id":1455919,"accept_rate":62,"display_name":"Chinthaka Dinadasa"},"score":0,"creation_date":1516787430,"post_id":40426741,"comment_id":83828410,"body_markdown":"Best way to remove error without changing database and all the mapping stuff.","body":"Best way to remove error without changing database and all the mapping stuff."},{"owner":{"account_id":1139113,"reputation":18996,"user_id":1123501,"accept_rate":89,"display_name":"Georgios Syngouroglou"},"score":0,"creation_date":1518608097,"post_id":40426741,"comment_id":84573733,"body_markdown":"Answering the first comment, the question was not &quot;how to map a db column name with underscore to a Java Entity&quot; but how to use an entity property with an underscore with spring-data. That&#39;s why this answer is not the accepted.","body":"Answering the first comment, the question was not &quot;how to map a db column name with underscore to a Java Entity&quot; but how to use an entity property with an underscore with spring-data. That&#39;s why this answer is not the accepted."},{"owner":{"account_id":1979720,"reputation":467,"user_id":1776625,"accept_rate":43,"display_name":"Khang Tran"},"score":2,"creation_date":1591141246,"post_id":40426741,"comment_id":109941690,"body_markdown":"this answer should be marked as correctly one, a very small effort to overcome problem.","body":"this answer should be marked as correctly one, a very small effort to overcome problem."}],"tags":[],"owner":{"account_id":2203785,"reputation":2039,"user_id":1947482,"display_name":"Valentyn Kolesnikov"},"comment_count":4,"down_vote_count":0,"up_vote_count":62,"is_accepted":false,"score":62,"last_activity_date":1478274328,"creation_date":1478274328,"answer_id":40426741,"question_id":23456197,"body_markdown":"I solved this error by renaming field to the name without underscore.\r\n\r\n    @Column(name = &quot;municipal_id&quot;, nullable = false)\r\n    private Integer municipalId; // &lt;-- field was renamed\r\n\r\n","title":"Spring-Data-Jpa Repository - Underscore on Entity Column Name","body":"<p>I solved this error by renaming field to the name without underscore.</p>\n\n<pre><code>@Column(name = \"municipal_id\", nullable = false)\nprivate Integer municipalId; // &lt;-- field was renamed\n</code></pre>\n"},{"comments":[{"owner":{"account_id":3342900,"reputation":428,"user_id":2808752,"display_name":"bhlowe"},"score":0,"creation_date":1545860984,"post_id":51320246,"comment_id":94715091,"body_markdown":"This works well and requires no other changes. From: https://docs.jboss.org/hibernate/orm/3.5/api/org/hibernate/cfg/ImprovedNamingStrategy.html:  \n\norg.hibernate.cfg.ImprovedNamingStrategy is an improved naming strategy that prefers embedded underscores to mixed case names.","body":"This works well and requires no other changes. From: <a href=\"https://docs.jboss.org/hibernate/orm/3.5/api/org/hibernate/cfg/ImprovedNamingStrategy.html\" rel=\"nofollow noreferrer\">docs.jboss.org/hibernate/orm/3.5/api/org/hibernate/cfg/&hellip;</a>:    org.hibernate.cfg.ImprovedNamingStrategy is an improved naming strategy that prefers embedded underscores to mixed case names."},{"owner":{"account_id":17002054,"reputation":105,"user_id":12299208,"display_name":"Sayan Dasgupta"},"score":0,"creation_date":1638644700,"post_id":51320246,"comment_id":124144844,"body_markdown":"spring.jpa.hibernate.naming-strategy is an unknown property error","body":"spring.jpa.hibernate.naming-strategy is an unknown property error"}],"tags":[],"owner":{"account_id":13951257,"reputation":71,"user_id":10074718,"display_name":"Jagannath Nanda"},"comment_count":2,"down_vote_count":0,"up_vote_count":7,"is_accepted":false,"score":7,"last_activity_date":1531470678,"creation_date":1531468429,"answer_id":51320246,"question_id":23456197,"body_markdown":"Please add the following properties to **application.properties** file:\r\n\r\n    spring.jpa.hibernate.naming-strategy=org.hibernate.cfg.ImprovedNamingStrategy","title":"Spring-Data-Jpa Repository - Underscore on Entity Column Name","body":"<p>Please add the following properties to <strong>application.properties</strong> file:</p>\n\n<pre><code>spring.jpa.hibernate.naming-strategy=org.hibernate.cfg.ImprovedNamingStrategy\n</code></pre>\n"},{"comments":[{"owner":{"account_id":18383045,"reputation":517,"user_id":13604662,"display_name":"Soumalya Bhattacharya"},"score":0,"creation_date":1700854343,"post_id":66858096,"comment_id":136707732,"body_markdown":"Same thing happens with native queries","body":"Same thing happens with native queries"}],"tags":[],"owner":{"account_id":8644989,"reputation":121,"user_id":6472461,"display_name":"C&#225;ssio Morales"},"comment_count":1,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1701102630,"creation_date":1617035840,"answer_id":66858096,"question_id":23456197,"body_markdown":"According to the [Docs](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#reference), underscore is a special character used by spring to separate properties names. If you really want to stick with snake case notation, you can set nativeQuery to true:\r\n\r\n    @Query(value = &quot;SELECT * FROM municipalperson WHERE municipal_id=?1 ORDER BY last_name DESC&quot;, nativeQuery = true)\r\n    List&lt;Municipalperson&gt; findByMunicipal_idOrderByLastnameDesc(int municipal_id);","title":"Spring-Data-Jpa Repository - Underscore on Entity Column Name","body":"<p>According to the <a href=\"https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#reference\" rel=\"nofollow noreferrer\">Docs</a>, underscore is a special character used by spring to separate properties names. If you really want to stick with snake case notation, you can set nativeQuery to true:</p>\n<pre><code>@Query(value = &quot;SELECT * FROM municipalperson WHERE municipal_id=?1 ORDER BY last_name DESC&quot;, nativeQuery = true)\nList&lt;Municipalperson&gt; findByMunicipal_idOrderByLastnameDesc(int municipal_id);\n</code></pre>\n"},{"comments":[{"owner":{"account_id":12581638,"reputation":127,"user_id":9152089,"display_name":"Aravindh Sivalingam"},"score":1,"creation_date":1638160785,"post_id":67801176,"comment_id":124005204,"body_markdown":"This doesn&#39;t work when the input type is of NON JSON type ex.: application/form-urlencoded and so on .....","body":"This doesn&#39;t work when the input type is of NON JSON type ex.: application/form-urlencoded and so on ....."}],"tags":[],"owner":{"account_id":3067179,"reputation":699,"user_id":2598616,"display_name":"Gabriel Dimech"},"comment_count":1,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1622620915,"creation_date":1622620915,"answer_id":67801176,"question_id":23456197,"body_markdown":"One other approach that worked for me is to use [@JsonProperty][1] to differentiate between field name used in REST request/response and that used for database.\r\nFor example:\r\n\r\n    @JsonProperty(&quot;municipalId&quot;)\r\n    private Integer municipal_id;\r\n\r\n  [1]: https://www.baeldung.com/jackson-annotations","title":"Spring-Data-Jpa Repository - Underscore on Entity Column Name","body":"<p>One other approach that worked for me is to use <a href=\"https://www.baeldung.com/jackson-annotations\" rel=\"nofollow noreferrer\">@JsonProperty</a> to differentiate between field name used in REST request/response and that used for database.\nFor example:</p>\n<pre><code>@JsonProperty(&quot;municipalId&quot;)\nprivate Integer municipal_id;\n</code></pre>\n"},{"tags":[],"owner":{"account_id":4803963,"reputation":21,"user_id":3879692,"display_name":"Ravendra Singh"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1681282342,"creation_date":1681282342,"answer_id":75992678,"question_id":23456197,"body_markdown":"Refer to the [official documentation here][1]\r\n- Because we treat the underscore character as a reserved character, we strongly advise following standard Java naming conventions (that is, not using underscores in property names but using camel case instead).\r\n\r\n\r\n  [1]: https://docs.spring.io/spring-data/jdbc/docs/3.0.4/reference/html/#repositories.query-methods.query-property-expressions","title":"Spring-Data-Jpa Repository - Underscore on Entity Column Name","body":"<p>Refer to the <a href=\"https://docs.spring.io/spring-data/jdbc/docs/3.0.4/reference/html/#repositories.query-methods.query-property-expressions\" rel=\"nofollow noreferrer\">official documentation here</a></p>\n<ul>\n<li>Because we treat the underscore character as a reserved character, we strongly advise following standard Java naming conventions (that is, not using underscores in property names but using camel case instead).</li>\n</ul>\n"}],"owner":{"account_id":1139113,"reputation":18996,"user_id":1123501,"accept_rate":89,"display_name":"Georgios Syngouroglou"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":83858,"favorite_count":0,"down_vote_count":0,"up_vote_count":45,"accepted_answer_id":23475349,"answer_count":6,"score":45,"last_activity_date":1701102630,"creation_date":1399206357,"question_id":23456197,"body_markdown":"I am using spring-data-jpa on a spring webmvc project. I am facing an issue using [query creation](http://docs.spring.io/spring-data/data-jpa/docs/current/reference/html/jpa.repositories.html#jpa.query-methods.query-creation) on a Repository of one of my Entities. Below you can see my Entity, my Repository and the Exception.  \r\n  \r\n  My Entity:  \r\n  \r\n    @Entity\r\n    @Table(schema = &quot;mainschema&quot;)\r\n    @XmlRootElement\r\n    public class Municipalperson implements Serializable {\r\n\r\n        private static final long serialVersionUID = 1L;\r\n        @Id\r\n        @GeneratedValue(strategy = GenerationType.IDENTITY)\r\n        @Basic(optional = false)\r\n        @Column(nullable = false)\r\n        private Integer id;\r\n\r\n        @Basic(optional = false)\r\n        @Column(name = &quot;municipal_id&quot;, nullable = false)\r\n        private Integer municipal_id;\r\n\r\n        @Basic(optional = false)\r\n        @Column(nullable = false, length = 60)\r\n        private String firstname;\r\n\r\n        public Municipalperson(Integer id, Integer municipal_id, String firstname) {\r\n            this.id = id;\r\n            this.municipal_id = municipal_id;\r\n            this.firstname = firstname;\r\n        }\r\n\r\n\r\n        public Integer getId() {\r\n            return id;\r\n        }\r\n\r\n        public void setId(Integer id) {\r\n            this.id = id;\r\n        }\r\n\r\n        public Integer getMunicipal_id() {\r\n            return municipal_id;\r\n        }\r\n\r\n        public void setMunicipal_id(Integer municipal_id) {\r\n            this.municipal_id = municipal_id;\r\n        }\r\n\r\n        public String getFirstname() {\r\n            return firstname;\r\n        }\r\n\r\n        public void setFirstname(String firstname) {\r\n            this.firstname = firstname;\r\n        }\r\n    }\r\n  \r\nmy Repository:  \r\n  \r\n    @Repository\r\n    public interface MunicipalpersonRepository extends JpaRepository&lt;Municipalperson, Integer&gt; {\r\n\r\n        List&lt;Municipalperson&gt; findByMunicipal_idOrderByLastnameDesc(int municipal_id);\r\n    }\r\n  \r\nand the exception,  \r\n  \r\n    org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;municipalpersonRepository&#39;: Invocation of init method failed; nested exception is org.springframework.data.mapping.PropertyReferenceException: No property municipal found for type Municipalperson!  \r\n  \r\nI tried to set `municipal_id` as int, then as `Integer` and the same for the parameter `municipal_id` on my Repository, but none worked. Also, I renamed the Repository to `findByMunicipalidOrderByLastnameDesc` and `findByMunicipalIdOrderByLastnameDesc` but it didn&#39;t work either.  \r\n  \r\nFinally I **renamed** the `municipal_id` to `municipalId` (underscore removed) and also renamed getters/setters and the Repository (`findByMunicipalIdOrderByLastnameDesc`) and ***the issue was resolved***.  \r\n  \r\n  My question is why this is happening?","title":"Spring-Data-Jpa Repository - Underscore on Entity Column Name","body":"<p>I am using spring-data-jpa on a spring webmvc project. I am facing an issue using <a href=\"http://docs.spring.io/spring-data/data-jpa/docs/current/reference/html/jpa.repositories.html#jpa.query-methods.query-creation\" rel=\"noreferrer\">query creation</a> on a Repository of one of my Entities. Below you can see my Entity, my Repository and the Exception.  </p>\n\n<p>My Entity:  </p>\n\n<pre><code>@Entity\n@Table(schema = \"mainschema\")\n@XmlRootElement\npublic class Municipalperson implements Serializable {\n\n    private static final long serialVersionUID = 1L;\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Basic(optional = false)\n    @Column(nullable = false)\n    private Integer id;\n\n    @Basic(optional = false)\n    @Column(name = \"municipal_id\", nullable = false)\n    private Integer municipal_id;\n\n    @Basic(optional = false)\n    @Column(nullable = false, length = 60)\n    private String firstname;\n\n    public Municipalperson(Integer id, Integer municipal_id, String firstname) {\n        this.id = id;\n        this.municipal_id = municipal_id;\n        this.firstname = firstname;\n    }\n\n\n    public Integer getId() {\n        return id;\n    }\n\n    public void setId(Integer id) {\n        this.id = id;\n    }\n\n    public Integer getMunicipal_id() {\n        return municipal_id;\n    }\n\n    public void setMunicipal_id(Integer municipal_id) {\n        this.municipal_id = municipal_id;\n    }\n\n    public String getFirstname() {\n        return firstname;\n    }\n\n    public void setFirstname(String firstname) {\n        this.firstname = firstname;\n    }\n}\n</code></pre>\n\n<p>my Repository:  </p>\n\n<pre><code>@Repository\npublic interface MunicipalpersonRepository extends JpaRepository&lt;Municipalperson, Integer&gt; {\n\n    List&lt;Municipalperson&gt; findByMunicipal_idOrderByLastnameDesc(int municipal_id);\n}\n</code></pre>\n\n<p>and the exception,  </p>\n\n<pre><code>org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'municipalpersonRepository': Invocation of init method failed; nested exception is org.springframework.data.mapping.PropertyReferenceException: No property municipal found for type Municipalperson!  \n</code></pre>\n\n<p>I tried to set <code>municipal_id</code> as int, then as <code>Integer</code> and the same for the parameter <code>municipal_id</code> on my Repository, but none worked. Also, I renamed the Repository to <code>findByMunicipalidOrderByLastnameDesc</code> and <code>findByMunicipalIdOrderByLastnameDesc</code> but it didn't work either.  </p>\n\n<p>Finally I <strong>renamed</strong> the <code>municipal_id</code> to <code>municipalId</code> (underscore removed) and also renamed getters/setters and the Repository (<code>findByMunicipalIdOrderByLastnameDesc</code>) and <strong><em>the issue was resolved</em></strong>.  </p>\n\n<p>My question is why this is happening?</p>\n"},{"tags":["java","selenium-webdriver"],"comments":[{"owner":{"account_id":6077817,"reputation":1213,"user_id":4744568,"display_name":"pcalkins"},"score":1,"creation_date":1701196953,"post_id":77558376,"comment_id":136744645,"body_markdown":"WebDriverWaits are sort of pre-configured fluent waits.  Usually you&#39;d be working with WebDriverWaits.  Your question, as is, isn&#39;t very clear.  Can you copy/paste what the interviewer&#39;s question was?","body":"WebDriverWaits are sort of pre-configured fluent waits.  Usually you&#39;d be working with WebDriverWaits.  Your question, as is, isn&#39;t very clear.  Can you copy/paste what the interviewer&#39;s question was?"},{"owner":{"account_id":2427689,"reputation":664,"user_id":2119289,"accept_rate":20,"display_name":"Chandra Shekhar"},"score":0,"creation_date":1701226256,"post_id":77558376,"comment_id":136748379,"body_markdown":"Hey Cynol, If you have added code and asked for the solution , others can answer but you asked a general topic and multiple threads are already present for this. as @pcalkins suggested, in the realtime projects we gonna use customised waits as per project.","body":"Hey Cynol, If you have added code and asked for the solution , others can answer but you asked a general topic and multiple threads are already present for this. as @pcalkins suggested, in the realtime projects we gonna use customised waits as per project."}],"answers":[{"comments":[{"owner":{"account_id":2427689,"reputation":664,"user_id":2119289,"accept_rate":20,"display_name":"Chandra Shekhar"},"score":0,"creation_date":1701226488,"post_id":77558471,"comment_id":136748400,"body_markdown":"I can see you got a downvote, possible reasons are your answer is not relevant to the problem, As you are the beginner, from next time please be specific to the question and sure shot solution. Instead of writing all functions, you can simply compare important waits ( ex: here fluent vs explicit ). No need of implicit , which can help the reporter &amp; stack community and also your score.","body":"I can see you got a downvote, possible reasons are your answer is not relevant to the problem, As you are the beginner, from next time please be specific to the question and sure shot solution. Instead of writing all functions, you can simply compare important waits ( ex: here fluent vs explicit ). No need of implicit , which can help the reporter &amp; stack community and also your score."}],"tags":[],"owner":{"account_id":30001393,"reputation":1,"user_id":22991307,"display_name":"Ankit kumar"},"comment_count":1,"down_vote_count":1,"up_vote_count":0,"is_accepted":false,"score":-1,"last_activity_date":1701102549,"creation_date":1701102549,"answer_id":77558471,"question_id":77558376,"body_markdown":"Implicit Wait:\r\n\r\nImplicit wait sets a maximum time for the WebDriver to wait for an element to be present in the DOM. It is applied globally and is set once for the entire session.\r\nExplicit Wait with ExpectedConditions:\r\n\r\nUse explicit waits in combination with ExpectedConditions for more fine-grained control over waiting conditions.\r\nThread.sleep:\r\n\r\nWhile not recommended in all cases due to its static nature, you can use Thread.sleep() to pause the execution for a specified period.\r\nCustom Wait Functions:\r\n\r\nYou can create your own custom wait functions using loops and conditions based on specific requirements.\r\n","title":"What is the alternative function for fluent wait in selenium java?","body":"<p>Implicit Wait:</p>\n<p>Implicit wait sets a maximum time for the WebDriver to wait for an element to be present in the DOM. It is applied globally and is set once for the entire session.\nExplicit Wait with ExpectedConditions:</p>\n<p>Use explicit waits in combination with ExpectedConditions for more fine-grained control over waiting conditions.\nThread.sleep:</p>\n<p>While not recommended in all cases due to its static nature, you can use Thread.sleep() to pause the execution for a specified period.\nCustom Wait Functions:</p>\n<p>You can create your own custom wait functions using loops and conditions based on specific requirements.</p>\n"}],"owner":{"account_id":30005535,"reputation":1,"user_id":22994533,"display_name":"Cynol"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":25,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701102549,"creation_date":1701101712,"question_id":77558376,"body_markdown":"What is the alternative function for fluent wait in selenium java? For ex.:- We can achieve assert true using if else condition, the same way how we can achieve fluent wait?\r\n\r\nInterviewer told me that he doesn&#39;t need a fluent wait syntax.","title":"What is the alternative function for fluent wait in selenium java?","body":"<p>What is the alternative function for fluent wait in selenium java? For ex.:- We can achieve assert true using if else condition, the same way how we can achieve fluent wait?</p>\n<p>Interviewer told me that he doesn't need a fluent wait syntax.</p>\n"},{"tags":["java","open-telemetry","open-telemetry-java"],"answers":[{"tags":[],"owner":{"account_id":7034556,"reputation":12335,"user_id":5389127,"display_name":"Ga&#235;l J"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701102062,"creation_date":1701102062,"answer_id":77558409,"question_id":77545106,"body_markdown":"_Even though the question is a bit broad, let me try to give some hints to users that would read it._\r\n\r\n1. Auto instrumentation with the java agent and manual instrumentation may live together with two distinct `OpenTelemetry` instances. The java agent would instantiate and register the global instance (`GlobalOpenTelemetry`) and your code may instantiate another `OpenTelemetry` but not register it as the global one.\r\n    * **This will work but should probably be avoided as long as possible** because you may encounter situations where some telemetry data would be &quot;attached&quot; to one `OpenTelemetry` instance or the other and you&#39;d loose &quot;correlation&quot;. For instance, with traces, you may get two traces instead of one.\r\n    * In this scenario, manual instrumentation may be configured either entirely manually by instantiating a `OpenTelemetrySdk` with manual configs, or by using environment variables / system properties as the java agent is doing thanks to `opentelemetry-sdk-extension-autoconfigure` dependency.\r\n1. Another approach, better when possible, is to use the java agent, configure it with environment variables / system properties and then **reuse the global instance in your code** thanks to `GlobalOpenTelemetry.get()`.\r\n    * If you&#39;re using a DI framework (Spring, Guice...), your code should rely on having a `OpenTelemetry` instance and use your framework to provide it by calling `GlobalOpenTelemetry.get()` at startup.","title":"Opentelemetry configuration for auto and manual instrumentation","body":"<p><em>Even though the question is a bit broad, let me try to give some hints to users that would read it.</em></p>\n<ol>\n<li>Auto instrumentation with the java agent and manual instrumentation may live together with two distinct <code>OpenTelemetry</code> instances. The java agent would instantiate and register the global instance (<code>GlobalOpenTelemetry</code>) and your code may instantiate another <code>OpenTelemetry</code> but not register it as the global one.\n<ul>\n<li><strong>This will work but should probably be avoided as long as possible</strong> because you may encounter situations where some telemetry data would be &quot;attached&quot; to one <code>OpenTelemetry</code> instance or the other and you'd loose &quot;correlation&quot;. For instance, with traces, you may get two traces instead of one.</li>\n<li>In this scenario, manual instrumentation may be configured either entirely manually by instantiating a <code>OpenTelemetrySdk</code> with manual configs, or by using environment variables / system properties as the java agent is doing thanks to <code>opentelemetry-sdk-extension-autoconfigure</code> dependency.</li>\n</ul>\n</li>\n<li>Another approach, better when possible, is to use the java agent, configure it with environment variables / system properties and then <strong>reuse the global instance in your code</strong> thanks to <code>GlobalOpenTelemetry.get()</code>.\n<ul>\n<li>If you're using a DI framework (Spring, Guice...), your code should rely on having a <code>OpenTelemetry</code> instance and use your framework to provide it by calling <code>GlobalOpenTelemetry.get()</code> at startup.</li>\n</ul>\n</li>\n</ol>\n"}],"owner":{"account_id":7034556,"reputation":12335,"user_id":5389127,"display_name":"Ga&#235;l J"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":41,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"answer_count":1,"score":-1,"last_activity_date":1701102062,"creation_date":1700851053,"question_id":77545106,"body_markdown":"In an application auto instrumented with the javaagent, it looks possible to add manual instrumentation according to the documentation.\r\n\r\n- For auto instrumentation, I know we can use environment variables or system properties. For instance `OTEL_TRACES_EXPORTER=logging` to enable logging exporter for traces.\r\n- Now, for manual instrumentation, we should instantiate somehow a `OpenTelemetrySdk` and register a `SdkTracerProvider` (configured either manually or via env variables/system properties as well)\r\n\r\nWhat happens if auto instrumentation configures some exporters (logging for instance) and manual instrumentation define another one (OTLP/HTTP for instance)? \r\n\r\nIs there a unique instance of `OpenTelemetry` in this case or two living each in &quot;different contexts&quot;?\r\n\r\n**Several questions but related to the same topic: how manual and auto instrumentation live together?**\r\n\r\n_(For additional context, I&#39;m looking to have manual metrics, auto instrumented traces and potentially some manual traces as well)_","title":"Opentelemetry configuration for auto and manual instrumentation","body":"<p>In an application auto instrumented with the javaagent, it looks possible to add manual instrumentation according to the documentation.</p>\n<ul>\n<li>For auto instrumentation, I know we can use environment variables or system properties. For instance <code>OTEL_TRACES_EXPORTER=logging</code> to enable logging exporter for traces.</li>\n<li>Now, for manual instrumentation, we should instantiate somehow a <code>OpenTelemetrySdk</code> and register a <code>SdkTracerProvider</code> (configured either manually or via env variables/system properties as well)</li>\n</ul>\n<p>What happens if auto instrumentation configures some exporters (logging for instance) and manual instrumentation define another one (OTLP/HTTP for instance)?</p>\n<p>Is there a unique instance of <code>OpenTelemetry</code> in this case or two living each in &quot;different contexts&quot;?</p>\n<p><strong>Several questions but related to the same topic: how manual and auto instrumentation live together?</strong></p>\n<p><em>(For additional context, I'm looking to have manual metrics, auto instrumented traces and potentially some manual traces as well)</em></p>\n"},{"tags":["java","c#",".net","executable-jar","java-interop"],"answers":[{"comments":[{"owner":{"account_id":239789,"reputation":29819,"user_id":509627,"accept_rate":63,"display_name":"David Thielen"},"score":0,"creation_date":1556172391,"post_id":55198038,"comment_id":98348108,"body_markdown":"IKVM is not discontinued. We (Windward Studios) have taken over support for it.","body":"IKVM is not discontinued. We (Windward Studios) have taken over support for it."}],"tags":[],"owner":{"account_id":12585,"reputation":303280,"user_id":24874,"accept_rate":78,"display_name":"Drew Noakes"},"comment_count":1,"down_vote_count":0,"up_vote_count":3,"is_accepted":true,"score":3,"last_activity_date":1701101755,"creation_date":1552747743,"answer_id":55198038,"question_id":55197995,"body_markdown":"IKVM is pretty heavyweight (not to mention discontinued) so if you can avoid it then it might be easier.\r\n\r\nIf the Java program can produce its output on STDOUT (i.e. write to the console) then you could read that output via your `Process` object.\r\n\r\nFor example:\r\n\r\n```\r\nProcess myProcess = new Process();\r\nmyProcess.StartInfo.UseShellExecute = false;\r\nmyProcess.StartInfo.FileName = &quot;java&quot;;\r\nmyProcess.StartInfo.Arguments = &quot;-jar D:\\\\myjava.jar&quot;;\r\nmyProcess.StartInfo.RedirectStandardOutput = true;\r\nmyProcess.Start();\r\nvar output = myProcess.StandardOutput.ReadToEnd();\r\n```\r\n\r\nYou may need to experiment with setting other properties on your `ProcessStartInfo`.","title":"Call Java method from .Net","body":"<p>IKVM is pretty heavyweight (not to mention discontinued) so if you can avoid it then it might be easier.</p>\n<p>If the Java program can produce its output on STDOUT (i.e. write to the console) then you could read that output via your <code>Process</code> object.</p>\n<p>For example:</p>\n<pre><code>Process myProcess = new Process();\nmyProcess.StartInfo.UseShellExecute = false;\nmyProcess.StartInfo.FileName = &quot;java&quot;;\nmyProcess.StartInfo.Arguments = &quot;-jar D:\\\\myjava.jar&quot;;\nmyProcess.StartInfo.RedirectStandardOutput = true;\nmyProcess.Start();\nvar output = myProcess.StandardOutput.ReadToEnd();\n</code></pre>\n<p>You may need to experiment with setting other properties on your <code>ProcessStartInfo</code>.</p>\n"}],"owner":{"account_id":15510991,"reputation":149,"user_id":11189731,"display_name":"C. Fabiani"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":572,"favorite_count":0,"down_vote_count":0,"up_vote_count":3,"accepted_answer_id":55198038,"answer_count":1,"score":3,"last_activity_date":1701101755,"creation_date":1552747480,"question_id":55197995,"body_markdown":"I&#39;ve to call a java method from a C# .Net concole application.\r\n\r\nThe solution at the following [link][1] \r\n\r\n    Process myProcess = new Process();\r\n    Process.StartInfo.UseShellExecute = false;\r\n    myProcess.StartInfo.FileName = &quot;java&quot;;\r\n    myProcess.StartInfo.Arguments = &quot;-jar D:\\\\myjava.jar&quot;;\r\n    myProcess.Start();e\r\n\r\n\r\n\r\ndoesn&#39;t allow an usefull return value (e.g. a string object) from the jar file to the .Net console app.\r\n\r\nAnother approach could be use [IKVM][2] but the developments are over and it seems to be to old to be used in an stable enterprise solution.\r\n\r\nHow can I call a java method and geta string as result value? \r\n\r\n\r\n  [1]: https://forums.asp.net/t/2052058.aspx?How%20to%20call%20any%20Java%20method%20from%20C%20Net\r\n  [2]: https://www.ikvm.net/devguide/java2net.html","title":"Call Java method from .Net","body":"<p>I've to call a java method from a C# .Net concole application.</p>\n\n<p>The solution at the following <a href=\"https://forums.asp.net/t/2052058.aspx?How%20to%20call%20any%20Java%20method%20from%20C%20Net\" rel=\"nofollow noreferrer\">link</a> </p>\n\n<pre><code>Process myProcess = new Process();\nProcess.StartInfo.UseShellExecute = false;\nmyProcess.StartInfo.FileName = \"java\";\nmyProcess.StartInfo.Arguments = \"-jar D:\\\\myjava.jar\";\nmyProcess.Start();e\n</code></pre>\n\n<p>doesn't allow an usefull return value (e.g. a string object) from the jar file to the .Net console app.</p>\n\n<p>Another approach could be use <a href=\"https://www.ikvm.net/devguide/java2net.html\" rel=\"nofollow noreferrer\">IKVM</a> but the developments are over and it seems to be to old to be used in an stable enterprise solution.</p>\n\n<p>How can I call a java method and geta string as result value? </p>\n"},{"tags":["java","spring-boot","eclipse","debugging"],"comments":[{"owner":{"account_id":401843,"reputation":89863,"user_id":768644,"display_name":"rzwitserloot"},"score":0,"creation_date":1701092034,"post_id":77557199,"comment_id":136728250,"body_markdown":"You&#39;re running maven, and maven is launching an entirely new JVM with your actual app. Which is entirely outside of eclipse&#39;s &quot;jurisdiction&quot; so to speak, and naturally wouldn&#39;t run any breakpoints. I&#39;m not posting this as an answer, because presumably you&#39;re looking for &quot;so, how do I fix that?&quot;. I don&#39;t have experience with m2 plugin / spring boot to tell you, unfortunately.","body":"You&#39;re running maven, and maven is launching an entirely new JVM with your actual app. Which is entirely outside of eclipse&#39;s &quot;jurisdiction&quot; so to speak, and naturally wouldn&#39;t run any breakpoints. I&#39;m not posting this as an answer, because presumably you&#39;re looking for &quot;so, how do I fix that?&quot;. I don&#39;t have experience with m2 plugin / spring boot to tell you, unfortunately."},{"owner":{"account_id":8692823,"reputation":31810,"user_id":6505250,"display_name":"howlger"},"score":0,"creation_date":1701092977,"post_id":77557199,"comment_id":136728424,"body_markdown":"A call stack changes continuously during execution and is therefore only displayed for paused threads (hit the _Pause_ button to get the call stack). Please verify that the code is actually called by adding the line `System.out.println(&quot;I was here!&quot;);` or `System.err.println(&quot;I was here!&quot;);` before the first break point. What is the reason to run/debug your application via Maven (via the `exec-maven-plugin`? - please show your `pom.xml`) instead of directly?","body":"A call stack changes continuously during execution and is therefore only displayed for paused threads (hit the <i>Pause</i> button to get the call stack). Please verify that the code is actually called by adding the line <code>System.out.println(&quot;I was here!&quot;);</code> or <code>System.err.println(&quot;I was here!&quot;);</code> before the first break point. What is the reason to run/debug your application via Maven (via the <code>exec-maven-plugin</code>? - please show your <code>pom.xml</code>) instead of directly?"},{"owner":{"account_id":8692823,"reputation":31810,"user_id":6505250,"display_name":"howlger"},"score":0,"creation_date":1701094619,"post_id":77557199,"comment_id":136728781,"body_markdown":"Please show your `pom.xml` as text, not as a cropped image.","body":"Please show your <code>pom.xml</code> as text, not as a cropped image."},{"owner":{"account_id":3591100,"reputation":930,"user_id":2997147,"accept_rate":52,"display_name":"FrankelStein"},"score":0,"creation_date":1701094642,"post_id":77557199,"comment_id":136728786,"body_markdown":"@rzwitserloot I run maven from Eclipse not from outside. so normally it should still be under Eclipse&#39;s &quot;jurisdiction&quot; ?. But I agree with you upon the fact that it&#39;s a maven related issue. I run a JUnit test with a breakpoint, it works just fine.","body":"@rzwitserloot I run maven from Eclipse not from outside. so normally it should still be under Eclipse&#39;s &quot;jurisdiction&quot; ?. But I agree with you upon the fact that it&#39;s a maven related issue. I run a JUnit test with a breakpoint, it works just fine."},{"owner":{"account_id":3591100,"reputation":930,"user_id":2997147,"accept_rate":52,"display_name":"FrankelStein"},"score":0,"creation_date":1701094864,"post_id":77557199,"comment_id":136728838,"body_markdown":"@howlger my code is called. the record is well added in H2 database, and also when I add a System.out, it&#39;s well displayed. I added the pom.xml as you requested.","body":"@howlger my code is called. the record is well added in H2 database, and also when I add a System.out, it&#39;s well displayed. I added the pom.xml as you requested."},{"owner":{"account_id":31180,"reputation":29173,"user_id":85421,"display_name":"user85421"},"score":1,"creation_date":1701095418,"post_id":77557199,"comment_id":136728953,"body_markdown":"you will probably have to start the application with an option to connect a remote debugger (`-agentlib:jdwp=transport=dt_socket,server=y,address=8000` or similar) and create/start a &quot;Remote Java Application&quot; configuration in Eclipse. I do not use Maven, no idea how to do that with it","body":"you will probably have to start the application with an option to connect a remote debugger (<code>-agentlib:jdwp=transport=dt_socket,server=y,address=8000</code> or similar) and create/start a &quot;Remote Java Application&quot; configuration in Eclipse. I do not use Maven, no idea how to do that with it"},{"owner":{"account_id":3591100,"reputation":930,"user_id":2997147,"accept_rate":52,"display_name":"FrankelStein"},"score":0,"creation_date":1701096811,"post_id":77557199,"comment_id":136729278,"body_markdown":"@howlger, did the pom.xml as text give you any insights ?","body":"@howlger, did the pom.xml as text give you any insights ?"},{"owner":{"account_id":8692823,"reputation":31810,"user_id":6505250,"display_name":"howlger"},"score":0,"creation_date":1701097582,"post_id":77557199,"comment_id":136729431,"body_markdown":"You run/launch the Maven build script, which in turn executes your Spring Boot application. Better run/debug [the _start-class_](https://www.baeldung.com/spring-boot-main-class#maven) directly (in your `pom.xml` the _start-class_ is not configured; did you specified the _start-class_ via the Maven property [`loader.main`](https://www.baeldung.com/spring-boot-main-class#using-cli)?). Remote debugging is not needed, just run your Java application directly.","body":"You run/launch the Maven build script, which in turn executes your Spring Boot application. Better run/debug <a href=\"https://www.baeldung.com/spring-boot-main-class#maven\" rel=\"nofollow noreferrer\">the <i>start-class</i></a> directly (in your <code>pom.xml</code> the <i>start-class</i> is not configured; did you specified the <i>start-class</i> via the Maven property <a href=\"https://www.baeldung.com/spring-boot-main-class#using-cli\" rel=\"nofollow noreferrer\"><code>loader.main</code></a>?). Remote debugging is not needed, just run your Java application directly."},{"owner":{"account_id":3591100,"reputation":930,"user_id":2997147,"accept_rate":52,"display_name":"FrankelStein"},"score":0,"creation_date":1701098877,"post_id":77557199,"comment_id":136729790,"body_markdown":"@howlger it worked fine, thanx ! I executed the project as a Java application with the main class as an entry point, and not a maven execution. I still don&#39;t understand why the maven execution build doesn&#39;t work but, the Java app execution worked ! You can add that as an answer so that I Accept it.","body":"@howlger it worked fine, thanx ! I executed the project as a Java application with the main class as an entry point, and not a maven execution. I still don&#39;t understand why the maven execution build doesn&#39;t work but, the Java app execution worked ! You can add that as an answer so that I Accept it."},{"owner":{"account_id":3591100,"reputation":930,"user_id":2997147,"accept_rate":52,"display_name":"FrankelStein"},"score":0,"creation_date":1701101830,"post_id":77557199,"comment_id":136730468,"body_markdown":"I guess too (as @rzwitserloot suggested also). Although that&#39;s not what I would expect since maven is launched from Eclipse. I guess there might be an extra missing configuration somewhere to make the debug work from maven goal, or to &quot;synchronize&quot; the JVM launched by maven and Eclipse if I shall say.","body":"I guess too (as @rzwitserloot suggested also). Although that&#39;s not what I would expect since maven is launched from Eclipse. I guess there might be an extra missing configuration somewhere to make the debug work from maven goal, or to &quot;synchronize&quot; the JVM launched by maven and Eclipse if I shall say."},{"owner":{"account_id":8692823,"reputation":31810,"user_id":6505250,"display_name":"howlger"},"score":0,"creation_date":1701160007,"post_id":77557199,"comment_id":136737661,"body_markdown":"The forked Java VM child processes are not executed by Maven core, but by a Maven plugin which is not part of Eclipse and which is downloaded into the local Maven repository first. As far as I know, Maven does not provide an API for that. Maven plugins can do what they want and a new version of a plugin can do it in a different way. In case of Maven-Surefire a Maven property tells Surefire to run the tests in debug mode. Surefire prints the info required to attach the debugger to the console from which Eclipse reads it. This works with different and hopefully with upcoming Surefire versions.","body":"The forked Java VM child processes are not executed by Maven core, but by a Maven plugin which is not part of Eclipse and which is downloaded into the local Maven repository first. As far as I know, Maven does not provide an API for that. Maven plugins can do what they want and a new version of a plugin can do it in a different way. In case of Maven-Surefire a Maven property tells Surefire to run the tests in debug mode. Surefire prints the info required to attach the debugger to the console from which Eclipse reads it. This works with different and hopefully with upcoming Surefire versions."}],"answers":[{"comments":[{"owner":{"account_id":3591100,"reputation":930,"user_id":2997147,"accept_rate":52,"display_name":"FrankelStein"},"score":0,"creation_date":1701101844,"post_id":77558333,"comment_id":136730472,"body_markdown":"Thanx for your help and your time.","body":"Thanx for your help and your time."}],"tags":[],"owner":{"account_id":8692823,"reputation":31810,"user_id":6505250,"display_name":"howlger"},"comment_count":1,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1701101310,"creation_date":1701101310,"answer_id":77558333,"question_id":77557199,"body_markdown":"You debug the Maven build script, which in turn executes your Spring Boot application. If the Spring Boot application is executed in a separate (forked) JVM process (like e.g. [Maven-Surefire does][1]), then the application runs in a different Java VM instance than the one you debug (I don&#39;t know whether this is actually the case here).\r\n\r\nWhatever, better **debug your [Spring Boot start-class][2] directly as a *Java application***.\r\n\r\n\r\n  [1]: https://github.com/eclipse-m2e/m2e-core/blob/master/RELEASE_NOTES.md#automatically-launch-and-attach-remote-application-debugger-when-maven-plug-in-starts-a-forked-jvm-that-waits-for-a-debugger\r\n  [2]: https://www.baeldung.com/spring-boot-main-class#maven","title":"Eclipse not stopping at Debug Breakpoint","body":"<p>You debug the Maven build script, which in turn executes your Spring Boot application. If the Spring Boot application is executed in a separate (forked) JVM process (like e.g. <a href=\"https://github.com/eclipse-m2e/m2e-core/blob/master/RELEASE_NOTES.md#automatically-launch-and-attach-remote-application-debugger-when-maven-plug-in-starts-a-forked-jvm-that-waits-for-a-debugger\" rel=\"nofollow noreferrer\">Maven-Surefire does</a>), then the application runs in a different Java VM instance than the one you debug (I don't know whether this is actually the case here).</p>\n<p>Whatever, better <strong>debug your <a href=\"https://www.baeldung.com/spring-boot-main-class#maven\" rel=\"nofollow noreferrer\">Spring Boot start-class</a> directly as a <em>Java application</em></strong>.</p>\n"}],"owner":{"account_id":3591100,"reputation":930,"user_id":2997147,"accept_rate":52,"display_name":"FrankelStein"},"comment_count":11,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":81,"favorite_count":0,"down_vote_count":2,"up_vote_count":1,"accepted_answer_id":77558333,"answer_count":1,"score":-1,"last_activity_date":1701101310,"creation_date":1701090887,"question_id":77557199,"body_markdown":"I have a simple java, sprint boot project and I wanted to debug the code inside but when I launch the debug, Eclipse doesn&#39;t stop at any breakpoint.\r\n\r\nI tried to **clean the workspace**, **update maven projects**, **Delete and reimport the project**. try **debugging another project**. I even **changed the eclipse version** but none of these solutions that I found on other StackOverflow posts worked.\r\n\r\nAlso, the **&quot;Skip All Breakpoints&quot; button is not toggled on**.\r\n\r\nI noticed that the callstack is empty and I wonder if the problem may come from it ?\r\n\r\nVersions used:\r\n\r\n - JDK: 17 Eclipse:\r\n - 2023-09 (4.29.0)\r\n - Spring boot: 3.0.1\r\n\r\nAny thoughts ?\r\n\r\nHere is the debug view:\r\n\r\n[![Debug view][1]][1]\r\n\r\n\r\nHere is the code sample I am trying to debug:\r\n\r\n[![Code Sample][2]][2]\r\n\r\nHere is the maven pom.xml file I&#39;m using:\r\n\r\n    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\r\n    &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\r\n    \t&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\r\n    \t&lt;parent&gt;\r\n    \t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n    \t\t&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\r\n    \t\t&lt;version&gt;3.0.1&lt;/version&gt;\r\n    \t\t&lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;\r\n    \t&lt;/parent&gt;\r\n    \t&lt;groupId&gt;com.example&lt;/groupId&gt;\r\n    \t&lt;artifactId&gt;demo&lt;/artifactId&gt;\r\n    \t&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\r\n    \t&lt;name&gt;demo&lt;/name&gt;\r\n    \t&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\r\n    \t&lt;properties&gt;\r\n    \t\t&lt;java.version&gt;17&lt;/java.version&gt;\r\n    \t&lt;/properties&gt;\r\n    \r\n    \t&lt;dependencies&gt;\r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\r\n    \t\t\t&lt;scope&gt;runtime&lt;/scope&gt;\r\n    \t\t\t&lt;optional&gt;true&lt;/optional&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;\r\n    \t\t\t&lt;optional&gt;true&lt;/optional&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;lombok&lt;/artifactId&gt;\r\n    \t\t\t&lt;optional&gt;true&lt;/optional&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\r\n    \t\t\t&lt;scope&gt;test&lt;/scope&gt;\r\n    \t\t\t&lt;exclusions&gt;\r\n    \t\t\t\t&lt;exclusion&gt;\r\n    \t\t\t\t\t&lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;\r\n    \t\t\t\t\t&lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;\r\n    \t\t\t\t&lt;/exclusion&gt;\r\n    \t\t\t&lt;/exclusions&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;org.springdoc&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt;\r\n    \t\t\t&lt;version&gt;2.2.0&lt;/version&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;com.h2database&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;h2&lt;/artifactId&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \r\n    \t\t&lt;dependency&gt;\r\n    \t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n    \t\t\t&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\r\n    \t\t&lt;/dependency&gt;\r\n    \t&lt;/dependencies&gt;\r\n    \r\n    \r\n    \t&lt;build&gt;\r\n    \t\t&lt;plugins&gt;\r\n    \t\t\t&lt;plugin&gt;\r\n    \t\t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n    \t\t\t\t&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\r\n    \t\t\t&lt;/plugin&gt;\r\n    \t\t&lt;/plugins&gt;\r\n    \t&lt;/build&gt;\r\n    \r\n    &lt;/project&gt;\r\n\r\n  [1]: https://i.stack.imgur.com/KMhCe.png\r\n  [2]: https://i.stack.imgur.com/sX08v.png\r\n\r\n","title":"Eclipse not stopping at Debug Breakpoint","body":"<p>I have a simple java, sprint boot project and I wanted to debug the code inside but when I launch the debug, Eclipse doesn't stop at any breakpoint.</p>\n<p>I tried to <strong>clean the workspace</strong>, <strong>update maven projects</strong>, <strong>Delete and reimport the project</strong>. try <strong>debugging another project</strong>. I even <strong>changed the eclipse version</strong> but none of these solutions that I found on other StackOverflow posts worked.</p>\n<p>Also, the <strong>&quot;Skip All Breakpoints&quot; button is not toggled on</strong>.</p>\n<p>I noticed that the callstack is empty and I wonder if the problem may come from it ?</p>\n<p>Versions used:</p>\n<ul>\n<li>JDK: 17 Eclipse:</li>\n<li>2023-09 (4.29.0)</li>\n<li>Spring boot: 3.0.1</li>\n</ul>\n<p>Any thoughts ?</p>\n<p>Here is the debug view:</p>\n<p><a href=\"https://i.stack.imgur.com/KMhCe.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KMhCe.png\" alt=\"Debug view\" /></a></p>\n<p>Here is the code sample I am trying to debug:</p>\n<p><a href=\"https://i.stack.imgur.com/sX08v.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sX08v.png\" alt=\"Code Sample\" /></a></p>\n<p>Here is the maven pom.xml file I'm using:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.0.1&lt;/version&gt;\n        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.example&lt;/groupId&gt;\n    &lt;artifactId&gt;demo&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;demo&lt;/name&gt;\n    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n            &lt;exclusions&gt;\n                &lt;exclusion&gt;\n                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;\n                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;\n                &lt;/exclusion&gt;\n            &lt;/exclusions&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springdoc&lt;/groupId&gt;\n            &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt;\n            &lt;version&gt;2.2.0&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.h2database&lt;/groupId&gt;\n            &lt;artifactId&gt;h2&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n"},{"tags":["java","eclipse","jsf","glassfish"],"comments":[{"owner":{"account_id":187094,"reputation":5113,"user_id":424903,"display_name":"Gimby"},"score":0,"creation_date":1457709025,"post_id":35943009,"comment_id":59543595,"body_markdown":"No Eclipse doesn&#39;t have such a wizard built-in, the fact that Netbeans has it is only a minor convenience, in the end it is going to create a regular java class with some annotations already put on it. The bigger problem your screenshot is showing is that for some reason only very old versions of JSF are supported in your project, the tutorial requires JSF 2.1 or 2.2 by the looks of it. What happens when you set the dynamic web module facet to version 3.0 ? Can you then select JSF 2.1/2.2 ?","body":"No Eclipse doesn&#39;t have such a wizard built-in, the fact that Netbeans has it is only a minor convenience, in the end it is going to create a regular java class with some annotations already put on it. The bigger problem your screenshot is showing is that for some reason only very old versions of JSF are supported in your project, the tutorial requires JSF 2.1 or 2.2 by the looks of it. What happens when you set the dynamic web module facet to version 3.0 ? Can you then select JSF 2.1/2.2 ?"},{"owner":{"account_id":5660163,"reputation":12260,"user_id":4478047,"display_name":"Kukeltje"},"score":1,"creation_date":1457709349,"post_id":35943009,"comment_id":59543836,"body_markdown":"After Kepler came Lunar and now Mars... Maybe time to upgrade? And JBossTools plugin is much better in my opinion","body":"After Kepler came Lunar and now Mars... Maybe time to upgrade? And JBossTools plugin is much better in my opinion"}],"answers":[{"tags":[],"owner":{"account_id":4922689,"reputation":624,"user_id":3964849,"display_name":"Harish Barma"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1457758685,"creation_date":1457738100,"answer_id":35951596,"question_id":35943009,"body_markdown":"I see that version of JSF in your application is 1.1 and 1.2. \r\nIt is recommended to update it to use JSF(2.0/2.1/2.2).\r\n\r\nFor your question of creating Managed bean\r\n- create a dynamic web project\r\n  +set dynamic web module facet to version 3.0.\r\n  +set java server faces to atleast 2.0.\r\n- create package of your like in src folder\r\n  +right click on src folder  new -&gt; package(eg: com.firstApp.backing).\r\n- create a java class giving name you desire\r\n-annote class by \r\n\r\n    import javax.faces.bean.ManagedBean;\r\n    @ManagedBean\r\n    public class FirstBean implements Serializable{\r\n        `// your code`\r\n       }","title":"Cannot create Class of type &quot;JSF Managed Bean&quot; in Eclipse. JavaServer Faces category Missing","body":"<p>I see that version of JSF in your application is 1.1 and 1.2. \nIt is recommended to update it to use JSF(2.0/2.1/2.2).</p>\n\n<p>For your question of creating Managed bean\n- create a dynamic web project\n  +set dynamic web module facet to version 3.0.\n  +set java server faces to atleast 2.0.\n- create package of your like in src folder\n  +right click on src folder  new -> package(eg: com.firstApp.backing).\n- create a java class giving name you desire\n-annote class by </p>\n\n<pre><code>import javax.faces.bean.ManagedBean;\n@ManagedBean\npublic class FirstBean implements Serializable{\n    `// your code`\n   }\n</code></pre>\n"}],"owner":{"account_id":6300508,"reputation":431,"user_id":4895346,"accept_rate":29,"display_name":"Arthas"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":1436,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"answer_count":1,"score":1,"last_activity_date":1701101245,"creation_date":1457707344,"question_id":35943009,"body_markdown":"I am following this [Oracle tutorial][1]\r\n\r\n\r\nOne of the Steps is: &lt;br&gt;\r\nCreate the **RequestProducerBean** class\r\nRight-click on the **obe.beans** package and select **New -&gt; Other**.\r\nChoose **JavaServer Faces** from Categories and **JSF Managed Bean** from File Types. \r\n\r\nI do not have this option in my Eclipse. I have tried several things in the last 4 hours but unable to fix it.\r\nI am using GlassFish Tools for Kepler downloaded from [this site][2]. Here&#39;s a screenshot of when I **rightclick&gt;New&gt;Other** in PackageExplorer. &lt;br&gt;\r\n\r\n[![enter image description here][3]][3]\r\n\r\nAny idea how do I get it installed?\r\n\r\nAttaching a screenshot of my ProjectFacets\r\n\r\n[![enter image description here][4]][4]\r\n\r\n\r\n  [1]: http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/JMS_pub_sub/JMS_pub_sub.html\r\n  [2]: https://glassfish.java.net/ide.html#eclipse\r\n  [3]: http://i.stack.imgur.com/qu58F.jpg\r\n  [4]: http://i.stack.imgur.com/qPRFx.jpg","title":"Cannot create Class of type &quot;JSF Managed Bean&quot; in Eclipse. JavaServer Faces category Missing","body":"<p>I am following this <a href=\"http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/JMS_pub_sub/JMS_pub_sub.html\" rel=\"nofollow noreferrer\">Oracle tutorial</a></p>\n\n<p>One of the Steps is: <br>\nCreate the <strong>RequestProducerBean</strong> class\nRight-click on the <strong>obe.beans</strong> package and select <strong>New -> Other</strong>.\nChoose <strong>JavaServer Faces</strong> from Categories and <strong>JSF Managed Bean</strong> from File Types. </p>\n\n<p>I do not have this option in my Eclipse. I have tried several things in the last 4 hours but unable to fix it.\nI am using GlassFish Tools for Kepler downloaded from <a href=\"https://glassfish.java.net/ide.html#eclipse\" rel=\"nofollow noreferrer\">this site</a>. Here's a screenshot of when I <strong>rightclick>New>Other</strong> in PackageExplorer. <br></p>\n\n<p><a href=\"https://i.stack.imgur.com/qu58F.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qu58F.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Any idea how do I get it installed?</p>\n\n<p>Attaching a screenshot of my ProjectFacets</p>\n\n<p><a href=\"https://i.stack.imgur.com/qPRFx.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qPRFx.jpg\" alt=\"enter image description here\"></a></p>\n"},{"tags":["java","mysql","eclipse","insert"],"comments":[{"owner":{"account_id":260172,"reputation":15404,"user_id":543572,"accept_rate":100,"display_name":"James-Jesse Drinkard"},"score":0,"creation_date":1344555224,"post_id":11893462,"comment_id":15829729,"body_markdown":"You need to provide more details than it doesn&#39;t work.  Is the mysql instance up and running? Can you get a connection? Where is it failing? Do you have a stack trace? Besides that, your statement: &quot;I&#39;m trying to input data into MySQL workbench through eclipse&quot; doesn&#39;t make any sense to me?","body":"You need to provide more details than it doesn&#39;t work.  Is the mysql instance up and running? Can you get a connection? Where is it failing? Do you have a stack trace? Besides that, your statement: &quot;I&#39;m trying to input data into MySQL workbench through eclipse&quot; doesn&#39;t make any sense to me?"},{"owner":{"account_id":180511,"reputation":8300,"user_id":413872,"accept_rate":95,"display_name":"travega"},"score":0,"creation_date":1344555255,"post_id":11893462,"comment_id":15829738,"body_markdown":"Ok so the terminology you need here is that you are trying to input data into you MySQL `database` rather then `workbench`. Workbench is just the name MySQL gives to their database management tool. Anyways, back to your question can you give some excerpts from the error message you get...?","body":"Ok so the terminology you need here is that you are trying to input data into you MySQL <code>database</code> rather then <code>workbench</code>. Workbench is just the name MySQL gives to their database management tool. Anyways, back to your question can you give some excerpts from the error message you get...?"},{"owner":{"account_id":1708270,"reputation":407,"user_id":1566884,"accept_rate":25,"display_name":"Ed Lee"},"score":0,"creation_date":1344555494,"post_id":11893462,"comment_id":15829796,"body_markdown":"I already have the db made. I&#39;m trying to insert the values in their respective spots.And the mysql instance is running","body":"I already have the db made. I&#39;m trying to insert the values in their respective spots.And the mysql instance is running"},{"owner":{"account_id":1708270,"reputation":407,"user_id":1566884,"accept_rate":25,"display_name":"Ed Lee"},"score":0,"creation_date":1344555569,"post_id":11893462,"comment_id":15829814,"body_markdown":"I didn&#39;t get any error messages. However when I refresh the db in MySQL workbench, the values do not appear.","body":"I didn&#39;t get any error messages. However when I refresh the db in MySQL workbench, the values do not appear."},{"owner":{"account_id":71085,"reputation":105200,"user_id":205608,"accept_rate":69,"display_name":"O. Jones"},"score":0,"creation_date":1344559174,"post_id":11893462,"comment_id":15830506,"body_markdown":"Do you need backticks rather than apostrophes in your table names? Did you check the result of your executeQuery statement? Is your connection rigged up to autocommit after each statement? It&#39;s good practice always to close your result sets and connections when you&#39;re done with them.","body":"Do you need backticks rather than apostrophes in your table names? Did you check the result of your executeQuery statement? Is your connection rigged up to autocommit after each statement? It&#39;s good practice always to close your result sets and connections when you&#39;re done with them."}],"answers":[{"comments":[{"owner":{"account_id":1708270,"reputation":407,"user_id":1566884,"accept_rate":25,"display_name":"Ed Lee"},"score":0,"creation_date":1344621792,"post_id":11895058,"comment_id":15851500,"body_markdown":"where do I put con.commit()? after what line?","body":"where do I put con.commit()? after what line?"}],"tags":[],"owner":{"account_id":1669972,"reputation":2383,"user_id":1536611,"accept_rate":86,"display_name":"km1"},"comment_count":1,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1344569241,"creation_date":1344569241,"answer_id":11895058,"question_id":11893462,"body_markdown":"Have you tried committing?\r\n      \r\n   `con.commit();`","title":"How to input data into MySQL from Eclipse","body":"<p>Have you tried committing?</p>\n\n<p><code>con.commit();</code></p>\n"},{"comments":[{"owner":{"account_id":1708270,"reputation":407,"user_id":1566884,"accept_rate":25,"display_name":"Ed Lee"},"score":0,"creation_date":1344621768,"post_id":11895551,"comment_id":15851491,"body_markdown":"there are errors with the stmt.close() and con.close() saying the stmt and con variables are not resolved. I create and initialize both variables, but it still doesn&#39;t work","body":"there are errors with the stmt.close() and con.close() saying the stmt and con variables are not resolved. I create and initialize both variables, but it still doesn&#39;t work"}],"tags":[],"owner":{"account_id":1250235,"reputation":6632,"user_id":1210779,"accept_rate":65,"display_name":"Sai Ye Yan Naing Aye"},"comment_count":1,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1344573719,"creation_date":1344573411,"answer_id":11895551,"question_id":11893462,"body_markdown":"Change your code likes this;\r\n\r\n        public class MySQL{\r\n              public static void main(String[] args)throws Exception{\r\n                  Class.forName(&quot;com.mysql.jdbc.Driver&quot;);\r\n                  try{\r\n                      Connection con = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/database&quot;,&quot;root&quot;,&quot;root&quot;);\r\n                       PreparedStatement stmt = con.prepareStatement(&quot;INSERT INTO &#39;database&#39;.&#39;Table&#39;(Account_ID,First_Name,Last_Name) VALUES (?,?,?)&quot;);\r\n                       stmt.setString(1, &quot;hello12&quot;);\r\n                       stmt.setString(2, &quot;Ed&quot;);\r\n                       stmt.setString(3, &quot;Lee&quot;);\r\n                       stmt.executeUpdate();\r\n                  } catch (Exception e) {\r\n                       e.printStackTrace();\r\n                  } finally {\r\n                       stmt.close();\r\n                       con.close();\r\n                  }\r\n              }\r\n\r\n         }\r\n","title":"How to input data into MySQL from Eclipse","body":"<p>Change your code likes this;</p>\n\n<pre><code>    public class MySQL{\n          public static void main(String[] args)throws Exception{\n              Class.forName(\"com.mysql.jdbc.Driver\");\n              try{\n                  Connection con = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/database\",\"root\",\"root\");\n                   PreparedStatement stmt = con.prepareStatement(\"INSERT INTO 'database'.'Table'(Account_ID,First_Name,Last_Name) VALUES (?,?,?)\");\n                   stmt.setString(1, \"hello12\");\n                   stmt.setString(2, \"Ed\");\n                   stmt.setString(3, \"Lee\");\n                   stmt.executeUpdate();\n              } catch (Exception e) {\n                   e.printStackTrace();\n              } finally {\n                   stmt.close();\n                   con.close();\n              }\n          }\n\n     }\n</code></pre>\n"},{"tags":[],"owner":{"account_id":2402,"reputation":14054,"user_id":3340,"accept_rate":93,"display_name":"Jacob Schoen"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1344628349,"creation_date":1344627897,"answer_id":11908259,"question_id":11893462,"body_markdown":"As suggested by others you need to commit the changes you made in your sql statements. Here is how it should look:\r\n\r\n    import java.sql.Connection;\r\n    import java.sql.DriverManager;\r\n    import java.sql.PreparedStatement;\r\n    \r\n    public class MySQL{\r\n    \r\n        public static void main(String[] args) throws Exception {\r\n            Class.forName(&quot;com.mysql.jdbc.Driver&quot;);\r\n            Connection con = null;\r\n            PreparedStatement stmt = null;\r\n            try {\r\n                con = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/database&quot;, &quot;root&quot;, &quot;root&quot;);\r\n                stmt = con.prepareStatement(&quot;INSERT INTO &#39;database&#39;.&#39;Table&#39;(Account_ID,First_Name,Last_Name) VALUES (?,?,?)&quot;);\r\n                stmt.setString(1, &quot;hello12&quot;);\r\n                stmt.setString(2, &quot;Ed&quot;);\r\n                stmt.setString(3, &quot;Lee&quot;);\r\n                stmt.executeUpdate();\r\n                conn.commit();\r\n            } catch (Exception e) {\r\n                e.printStackTrace();\r\n            } finally {\r\n                if (stmt != null) {\r\n                    try {\r\n                       stmt.close();\r\n                    } catch (SQLException ex) {\r\n                    }\r\n                }\r\n                if (con != null) {\r\n                    try {\r\n                       con.close();                    \r\n                    } catch (SQLException ex) {\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\nImport things to note that have been changed. \r\n\r\n- You declare the variables before the try block so that they are accessible in the finally block, but initialize them inside the try block in case they throw an exception.\r\n- The `PreparedStatement` replaces the new values with `?` syntax instead of being hard coded. In a real application those will end up being passed in, and if you just did String concatenation, you would be opening yourself up to SQL injection or other problems.\r\n- The finally block is used to free any resources regardless if an exception is thrown. So say you create the connection and prepared statement, but an error gets thrown executing it. The code in the finally block will still run to close the statement and connection, freeing those resources.","title":"How to input data into MySQL from Eclipse","body":"<p>As suggested by others you need to commit the changes you made in your sql statements. Here is how it should look:</p>\n\n<pre><code>import java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.PreparedStatement;\n\npublic class MySQL{\n\n    public static void main(String[] args) throws Exception {\n        Class.forName(\"com.mysql.jdbc.Driver\");\n        Connection con = null;\n        PreparedStatement stmt = null;\n        try {\n            con = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/database\", \"root\", \"root\");\n            stmt = con.prepareStatement(\"INSERT INTO 'database'.'Table'(Account_ID,First_Name,Last_Name) VALUES (?,?,?)\");\n            stmt.setString(1, \"hello12\");\n            stmt.setString(2, \"Ed\");\n            stmt.setString(3, \"Lee\");\n            stmt.executeUpdate();\n            conn.commit();\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (stmt != null) {\n                try {\n                   stmt.close();\n                } catch (SQLException ex) {\n                }\n            }\n            if (con != null) {\n                try {\n                   con.close();                    \n                } catch (SQLException ex) {\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Import things to note that have been changed. </p>\n\n<ul>\n<li>You declare the variables before the try block so that they are accessible in the finally block, but initialize them inside the try block in case they throw an exception.</li>\n<li>The <code>PreparedStatement</code> replaces the new values with <code>?</code> syntax instead of being hard coded. In a real application those will end up being passed in, and if you just did String concatenation, you would be opening yourself up to SQL injection or other problems.</li>\n<li>The finally block is used to free any resources regardless if an exception is thrown. So say you create the connection and prepared statement, but an error gets thrown executing it. The code in the finally block will still run to close the statement and connection, freeing those resources.</li>\n</ul>\n"},{"tags":[],"owner":{"account_id":3107277,"reputation":1237,"user_id":2629813,"accept_rate":100,"display_name":"Akshatha S R"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1499156585,"creation_date":1499156585,"answer_id":44900692,"question_id":11893462,"body_markdown":"Change the following line \r\n\r\n    PreparedStatement stmt = con.prepareStatement(&quot;INSERT INTO &#39;database&#39;.&#39;Table&#39;(Account_ID,First_Name,Last_Name) VALUES (&#39;hello12&#39;,&#39;Ed&#39;,&#39;Lee&#39;)&quot;);\r\n\r\nto \r\n\r\n    PreparedStatement stmt = con.prepareStatement(&quot;INSERT INTO `database`.`Table`(Account_ID,First_Name,Last_Name) VALUES (&#39;hello12&#39;,&#39;Ed&#39;,&#39;Lee&#39;)&quot;);\r\n\r\nthe single quotes used for the database name and the table name will throw a syntax error. Instead use ` this symbol. ","title":"How to input data into MySQL from Eclipse","body":"<p>Change the following line </p>\n\n<pre><code>PreparedStatement stmt = con.prepareStatement(\"INSERT INTO 'database'.'Table'(Account_ID,First_Name,Last_Name) VALUES ('hello12','Ed','Lee')\");\n</code></pre>\n\n<p>to </p>\n\n<pre><code>PreparedStatement stmt = con.prepareStatement(\"INSERT INTO `database`.`Table`(Account_ID,First_Name,Last_Name) VALUES ('hello12','Ed','Lee')\");\n</code></pre>\n\n<p>the single quotes used for the database name and the table name will throw a syntax error. Instead use ` this symbol. </p>\n"}],"owner":{"account_id":1708270,"reputation":407,"user_id":1566884,"accept_rate":25,"display_name":"Ed Lee"},"comment_count":5,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":15318,"favorite_count":0,"down_vote_count":1,"up_vote_count":1,"answer_count":4,"score":0,"last_activity_date":1701100990,"creation_date":1344555046,"question_id":11893462,"body_markdown":"I&#39;m trying to input data into MySQL database through eclipse. Here&#39;s what I have so far:\r\n\r\n    import java.sql.DriverManager;\r\n    import java.sql.Connection;\r\n    import java.sql.ResultSet;\r\n    import java.sql.PreparedStatement;\r\n    import com.mysql.jdbc.Statement;\r\n\r\n    public class MySQL{\r\n\r\n    public static void main(String[] args)throws Exception{\r\n\r\n        Class.forName(&quot;com.mysql.jdbc.Driver&quot;);\r\n    \r\n        Connection con = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/database&quot;,&quot;root&quot;,&quot;root&quot;);\r\n    \r\n        PreparedStatement stmt = con.prepareStatement(&quot;INSERT INTO &#39;database&#39;.&#39;Table&#39;(Account_ID,First_Name,Last_Name) VALUES (&#39;hello12&#39;,&#39;Ed&#39;,&#39;Lee&#39;)&quot;);\r\n  \r\n        ResultSet result = stmt.executeQuery();}\r\n\r\n     }\r\n\r\nIt doesn&#39;t work for some reason...any ideas?","title":"How to input data into MySQL from Eclipse","body":"<p>I'm trying to input data into MySQL database through eclipse. Here's what I have so far:</p>\n\n<pre><code>import java.sql.DriverManager;\nimport java.sql.Connection;\nimport java.sql.ResultSet;\nimport java.sql.PreparedStatement;\nimport com.mysql.jdbc.Statement;\n\npublic class MySQL{\n\npublic static void main(String[] args)throws Exception{\n\n    Class.forName(\"com.mysql.jdbc.Driver\");\n\n    Connection con = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/database\",\"root\",\"root\");\n\n    PreparedStatement stmt = con.prepareStatement(\"INSERT INTO 'database'.'Table'(Account_ID,First_Name,Last_Name) VALUES ('hello12','Ed','Lee')\");\n\n    ResultSet result = stmt.executeQuery();}\n\n }\n</code></pre>\n\n<p>It doesn't work for some reason...any ideas?</p>\n"},{"tags":["java"],"comments":[{"owner":{"account_id":74704,"reputation":11534,"user_id":214525,"accept_rate":100,"display_name":"f1sh"},"score":1,"creation_date":1701101255,"post_id":77558282,"comment_id":136730350,"body_markdown":"You only print something if `s==i`. Seems that never evaluates to true. Set a breakpoint, debug this.","body":"You only print something if <code>s==i</code>. Seems that never evaluates to true. Set a breakpoint, debug this."},{"owner":{"account_id":1689973,"reputation":37330,"user_id":1552534,"display_name":"WJS"},"score":1,"creation_date":1701104981,"post_id":77558282,"comment_id":136731077,"body_markdown":"You need to initialize s to 0 inside the outer loop.","body":"You need to initialize s to 0 inside the outer loop."},{"owner":{"account_id":1689973,"reputation":37330,"user_id":1552534,"display_name":"WJS"},"score":1,"creation_date":1701105369,"post_id":77558282,"comment_id":136731151,"body_markdown":"Here&#39;s a tip.  In the future, put ubiquitous print statements inside your code to see what is going on, printing out interim values of variables. That is my first goto for debugging.  A debugger as @f1sh suggested would be better but there is a learning curve there which you should try and play with `before` you need it.   The best IDE&#39;s have them built in.","body":"Here&#39;s a tip.  In the future, put ubiquitous print statements inside your code to see what is going on, printing out interim values of variables. That is my first goto for debugging.  A debugger as @f1sh suggested would be better but there is a learning curve there which you should try and play with <code>before</code> you need it.   The best IDE&#39;s have them built in."}],"owner":{"account_id":25831509,"reputation":1,"user_id":19568597,"display_name":"Jonnalagedda KESAVA UMAMAHESWA"},"comment_count":3,"delete_vote_count":1,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":23,"favorite_count":0,"down_vote_count":3,"up_vote_count":0,"closed_date":1701103651,"answer_count":0,"score":-3,"last_activity_date":1701100882,"creation_date":1701100882,"question_id":77558282,"body_markdown":"I wrote following code and Ran:\r\npublic class Forloop1 {\r\n\r\n\tpublic static void main(String[] args) {\r\n\t\tint i,n,d,s=0;\r\n\t\tfor(i=100;i&lt;1000;i++){\t\r\n\t\t\tn=i;\r\n\t\t\twhile(n&gt;0)\r\n\t\t\t{\r\n\t\t\t\td=n%10;\r\n\t\t\t\ts=s+(d*d*d);\r\n\t\t\t\tn=n/10;\r\n\t\t\t}\r\n\t\t\t\tif(s==i)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tSystem.out.println(i);\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t}\r\n\t}\r\n}\r\n\r\nNo errors shown. But, no output displayed.\r\nPlease correct.\r\n\r\nSolution / correction.\r\nTried below:\r\npublic class Forloop1 {\r\n\r\n\tpublic static void main(String[] args) {\r\n\t\tint i,n,d,s=0;\r\n\t\tfor(i=100;i&lt;1000;i++){\t\r\n\t\t\tn=i;\r\n\t\t\twhile(n&gt;0)\r\n\t\t\t{\r\n\t\t\t\td=n%10;\r\n\t\t\t\ts=s+(d*d*d);\r\n\t\t\t\tn=n/10;\r\n\t\t\t}\r\n\t\t\t\tif(s==i)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tSystem.out.println(i);\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t}\r\n\t}\r\n}","title":"Finding 3 digit armstrong numbers in Java","body":"<p>I wrote following code and Ran:\npublic class Forloop1 {</p>\n<pre><code>public static void main(String[] args) {\n    int i,n,d,s=0;\n    for(i=100;i&lt;1000;i++){  \n        n=i;\n        while(n&gt;0)\n        {\n            d=n%10;\n            s=s+(d*d*d);\n            n=n/10;\n        }\n            if(s==i)\n                {\n                    System.out.println(i);\n                }               \n    }\n}\n</code></pre>\n<p>}</p>\n<p>No errors shown. But, no output displayed.\nPlease correct.</p>\n<p>Solution / correction.\nTried below:\npublic class Forloop1 {</p>\n<pre><code>public static void main(String[] args) {\n    int i,n,d,s=0;\n    for(i=100;i&lt;1000;i++){  \n        n=i;\n        while(n&gt;0)\n        {\n            d=n%10;\n            s=s+(d*d*d);\n            n=n/10;\n        }\n            if(s==i)\n                {\n                    System.out.println(i);\n                }               \n    }\n}\n</code></pre>\n<p>}</p>\n"},{"tags":["java","android"],"comments":[{"owner":{"account_id":17835,"reputation":303905,"user_id":40342,"accept_rate":62,"display_name":"Joachim Sauer"},"score":0,"creation_date":1701094484,"post_id":77557308,"comment_id":136728748,"body_markdown":"The Gradle build configuration has traditionally been Groovy and Kotlin is the &quot;new&quot; joiner. There was never a Java option, so either you are misremembering or you used a different tool. It seems like you&#39;re confusing the language for your application code with the language you use to configure your build. Please show us what your full code looks like and where you placed it relative to your project directory.","body":"The Gradle build configuration has traditionally been Groovy and Kotlin is the &quot;new&quot; joiner. There was never a Java option, so either you are misremembering or you used a different tool. It seems like you&#39;re confusing the language for your application code with the language you use to configure your build. Please show us what your full code looks like and where you placed it relative to your project directory."}],"answers":[{"comments":[{"owner":{"account_id":177027,"reputation":1133,"user_id":408112,"accept_rate":59,"display_name":"Dean-O"},"score":0,"creation_date":1701186141,"post_id":77558255,"comment_id":136742546,"body_markdown":"marcinj thanks for the Kotlin function info.... a few years back java was the default language and you could check a box to add Kotlin support.  So that is why I was confused.  How do I create a java app not a Kotlin app with android studio?","body":"marcinj thanks for the Kotlin function info.... a few years back java was the default language and you could check a box to add Kotlin support.  So that is why I was confused.  How do I create a java app not a Kotlin app with android studio?"},{"owner":{"account_id":216120,"reputation":49213,"user_id":471160,"accept_rate":90,"display_name":"marcinj"},"score":0,"creation_date":1701191200,"post_id":77558255,"comment_id":136743680,"body_markdown":"@Dean-O You can choose File-&gt;New-&gt;New Project, choose for example &quot;Empty Views Activity&quot;, then choose Language as Java, and your preferred Build configuration language, I think Groovy DSL is more common, by that I mean you will find more examples in this language on internet.","body":"@Dean-O You can choose File-&gt;New-&gt;New Project, choose for example &quot;Empty Views Activity&quot;, then choose Language as Java, and your preferred Build configuration language, I think Groovy DSL is more common, by that I mean you will find more examples in this language on internet."},{"owner":{"account_id":177027,"reputation":1133,"user_id":408112,"accept_rate":59,"display_name":"Dean-O"},"score":0,"creation_date":1701484684,"post_id":77558255,"comment_id":136785176,"body_markdown":"Bingo thanks for the help","body":"Bingo thanks for the help"}],"tags":[],"owner":{"account_id":216120,"reputation":49213,"user_id":471160,"accept_rate":90,"display_name":"marcinj"},"comment_count":3,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701100563,"creation_date":1701100563,"answer_id":77558255,"question_id":77557308,"body_markdown":"&gt;I have been away from android studio for a bit and there used to be a Java build configuration language option.\r\n\r\nCurrently for configuring builds gradle tool is used and scripting language is groovy or kotlin. Java was never an option here. For more details look in here:\r\n\r\nhttps://developer.android.com/build\r\n\r\n&gt; I tried using kotlin and I get an error of Expecting member declaration when I use public void startGame(View view){} I also imported android.view.View and it is gray. which says unused import. What am I missing?\r\n\r\nIt looks like you are trying to use java syntax in a kotlin file (*.kt). In kotlin you dont write `public void` for declaring functions, you should use `fun` keyword. A function should look like:\r\n\r\n    fun startGame(vide: View) {\r\n    }\r\n\r\nfor learning kotlin I suggest:\r\n\r\nhttps://developer.android.com/kotlin/learn","title":"where is the java build configuration language in Android Studio Giraffe | 2022.3.1","body":"<blockquote>\n<p>I have been away from android studio for a bit and there used to be a Java build configuration language option.</p>\n</blockquote>\n<p>Currently for configuring builds gradle tool is used and scripting language is groovy or kotlin. Java was never an option here. For more details look in here:</p>\n<p><a href=\"https://developer.android.com/build\" rel=\"nofollow noreferrer\">https://developer.android.com/build</a></p>\n<blockquote>\n<p>I tried using kotlin and I get an error of Expecting member declaration when I use public void startGame(View view){} I also imported android.view.View and it is gray. which says unused import. What am I missing?</p>\n</blockquote>\n<p>It looks like you are trying to use java syntax in a kotlin file (*.kt). In kotlin you dont write <code>public void</code> for declaring functions, you should use <code>fun</code> keyword. A function should look like:</p>\n<pre><code>fun startGame(vide: View) {\n}\n</code></pre>\n<p>for learning kotlin I suggest:</p>\n<p><a href=\"https://developer.android.com/kotlin/learn\" rel=\"nofollow noreferrer\">https://developer.android.com/kotlin/learn</a></p>\n"}],"owner":{"account_id":177027,"reputation":1133,"user_id":408112,"accept_rate":59,"display_name":"Dean-O"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":55,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701100849,"creation_date":1701091871,"question_id":77557308,"body_markdown":"I have been away from android studio for a bit and there used to be a Java build configuration language option.  Not all that I see is 2 Kotlin options and one Groovy option.  I have an Udemy course I want to play with, and it is a Java based android tutorial.  I tried using Kotlin and I get an error of Expecting member declaration when I use public void startGame(View view){}  I also imported android.view.View and it is gray. Which says unused import.  What am I missing?\r\n\r\nI have googled for answers to this and have not found an option.  I have reached out to the Udemy author too and no reply.","title":"where is the java build configuration language in Android Studio Giraffe | 2022.3.1","body":"<p>I have been away from android studio for a bit and there used to be a Java build configuration language option.  Not all that I see is 2 Kotlin options and one Groovy option.  I have an Udemy course I want to play with, and it is a Java based android tutorial.  I tried using Kotlin and I get an error of Expecting member declaration when I use public void startGame(View view){}  I also imported android.view.View and it is gray. Which says unused import.  What am I missing?</p>\n<p>I have googled for answers to this and have not found an option.  I have reached out to the Udemy author too and no reply.</p>\n"},{"tags":["java","open-telemetry","open-telemetry-java"],"comments":[{"owner":{"account_id":111923,"reputation":649,"user_id":295416,"display_name":"trask"},"score":0,"creation_date":1701118323,"post_id":77558266,"comment_id":136733308,"body_markdown":"high cardinality of akka http metrics sounds like a bug, can you report an issue with more details at https://github.com/open-telemetry/opentelemetry-java-instrumentation/issues","body":"high cardinality of akka http metrics sounds like a bug, can you report an issue with more details at <a href=\"https://github.com/open-telemetry/opentelemetry-java-instrumentation/issues\" rel=\"nofollow noreferrer\">github.com/open-telemetry/opentelemetry-java-instrumentation&zwnj;&#8203;/&hellip;</a>"},{"owner":{"account_id":7034556,"reputation":12335,"user_id":5389127,"display_name":"Ga&#235;l J"},"score":0,"creation_date":1701155433,"post_id":77558266,"comment_id":136736923,"body_markdown":"@trask I opened a [discussion](https://github.com/open-telemetry/opentelemetry-java-instrumentation/discussions/9959), not sure it&#39;s necessarily a bug","body":"@trask I opened a <a href=\"https://github.com/open-telemetry/opentelemetry-java-instrumentation/discussions/9959\" rel=\"nofollow noreferrer\">discussion</a>, not sure it&#39;s necessarily a bug"}],"owner":{"account_id":7034556,"reputation":12335,"user_id":5389127,"display_name":"Ga&#235;l J"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":26,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701100789,"creation_date":1701100716,"question_id":77558266,"body_markdown":"When using OpenTelemetry Java agent, we get many libraries auto instrumented.\r\n\r\nIt&#39;s possible to disable a library instrumentation with `OTEL_INSTRUMENTATION_[NAME]_ENABLED` but this disables all sorts of instrumentation: metrics and traces for instance.\r\n\r\n**Is there a way to disable a library instrumentation for only for some &quot;scope&quot; like only disable metrics but keep traces?**\r\n\r\nOr is the only way out of this to implement some filtering later (in OpenTelemetry collector for instance if using it)?\r\n\r\n---\r\n\r\nThe concrete use case for this is that I&#39;m using Akka HTTP in my application and I do want to collect its traces, but I really don&#39;t care about its metrics (there&#39;s a label with the route which makes it have a huge cardinality moreover).","title":"How to disable auto instrumentation of a library but only for metrics and keep traces","body":"<p>When using OpenTelemetry Java agent, we get many libraries auto instrumented.</p>\n<p>It's possible to disable a library instrumentation with <code>OTEL_INSTRUMENTATION_[NAME]_ENABLED</code> but this disables all sorts of instrumentation: metrics and traces for instance.</p>\n<p><strong>Is there a way to disable a library instrumentation for only for some &quot;scope&quot; like only disable metrics but keep traces?</strong></p>\n<p>Or is the only way out of this to implement some filtering later (in OpenTelemetry collector for instance if using it)?</p>\n<hr />\n<p>The concrete use case for this is that I'm using Akka HTTP in my application and I do want to collect its traces, but I really don't care about its metrics (there's a label with the route which makes it have a huge cardinality moreover).</p>\n"},{"tags":["java","spring","spring-security"],"comments":[{"owner":{"account_id":6463892,"reputation":15974,"user_id":5277820,"accept_rate":68,"display_name":"dur"},"score":3,"creation_date":1701079079,"post_id":77554644,"comment_id":136726074,"body_markdown":"Show your Spring Security `TRACE` logs. It shoud show the reason. But probably it is the missing CSRF token.","body":"Show your Spring Security <code>TRACE</code> logs. It shoud show the reason. But probably it is the missing CSRF token."},{"owner":{"account_id":42916,"reputation":22357,"user_id":125212,"accept_rate":52,"display_name":"Jackie"},"score":0,"creation_date":1701099070,"post_id":77554644,"comment_id":136729837,"body_markdown":"@dur The answer in my case wasn&#39;t telling me the csrf thing because I had accidentally deleted that while I was debugging a 415 issue. See post for full explanation but yeah thank you for that direction.","body":"@dur The answer in my case wasn&#39;t telling me the csrf thing because I had accidentally deleted that while I was debugging a 415 issue. See post for full explanation but yeah thank you for that direction."}],"answers":[{"comments":[{"owner":{"account_id":14583346,"reputation":863,"user_id":10533012,"display_name":"Elyorbek Ibrokhimov"},"score":1,"creation_date":1701066357,"post_id":77554692,"comment_id":136724236,"body_markdown":"Spring Boot doesn&#39;t need any `@Enable*` annotations","body":"Spring Boot doesn&#39;t need any <code>@Enable*</code> annotations"},{"owner":{"account_id":11464827,"reputation":391,"user_id":8403338,"display_name":"Mohamd Imran"},"score":0,"creation_date":1701067193,"post_id":77554692,"comment_id":136724313,"body_markdown":"@ElyorbekIbrokhimov It depends ,Now cause the OP question talking about security issue as a solation he might need a  custom security configurations as an extra solation for his issue","body":"@ElyorbekIbrokhimov It depends ,Now cause the OP question talking about security issue as a solation he might need a  custom security configurations as an extra solation for his issue"},{"owner":{"account_id":42916,"reputation":22357,"user_id":125212,"accept_rate":52,"display_name":"Jackie"},"score":0,"creation_date":1701098114,"post_id":77554692,"comment_id":136729568,"body_markdown":"I take that back I must have deleted it one sec to find out the modern way","body":"I take that back I must have deleted it one sec to find out the modern way"},{"owner":{"account_id":42916,"reputation":22357,"user_id":125212,"accept_rate":52,"display_name":"Jackie"},"score":0,"creation_date":1701098524,"post_id":77554692,"comment_id":136729687,"body_markdown":"I would also make sure to update to `.csrf(AbstractHttpConfigurer::disable)`","body":"I would also make sure to update to <code>.csrf(AbstractHttpConfigurer::disable)</code>"}],"tags":[],"owner":{"account_id":11464827,"reputation":391,"user_id":8403338,"display_name":"Mohamd Imran"},"comment_count":4,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1701063101,"creation_date":1701063101,"answer_id":77554692,"question_id":77554644,"body_markdown":"It seems like Spring Security configuration what might be the cause for the 403 Forbidden response for your POST request. The `authorizeHttpRequests` method you&#39;ve shared is granting all requests `permitAll()` , so it should not be causing the issue. So i think Spring Security may be expecting a CSRF token for the POST request, and in Postman might not be sending it. Try disabling CSRF for now to see if it resolves the issue. You can do this by modifying your security configuration `.csrf().disable()` .\r\nAdd to your `authorizeHttpRequests` chain ::\r\n\r\n    .authorizeHttpRequests((authz) -&gt; authz\r\n        .anyRequest().permitAll()\r\n    )\r\n    .csrf().disable();\r\n\r\n\r\n\r\nSide Note : It is not a good idea Disabling CSRF for production, but it helps you in debugging\r\n\r\nAlso please check that you have the `@EnableWebSecurity` annotation added to your configuration class. This annotation enables Spring Security&#39;s web security support.\r\ne.g.\r\n\r\n    @EnableWebSecurity\r\n    public class SecurityConfig extends WebSecurityConfigurerAdapter {}\r\n\r\nHope this helps you \r\n\r\n","title":"Why is Spring Boot returning a 403 on POST when permitAll is being used?","body":"<p>It seems like Spring Security configuration what might be the cause for the 403 Forbidden response for your POST request. The <code>authorizeHttpRequests</code> method you've shared is granting all requests <code>permitAll()</code> , so it should not be causing the issue. So i think Spring Security may be expecting a CSRF token for the POST request, and in Postman might not be sending it. Try disabling CSRF for now to see if it resolves the issue. You can do this by modifying your security configuration <code>.csrf().disable()</code> .\nAdd to your <code>authorizeHttpRequests</code> chain ::</p>\n<pre><code>.authorizeHttpRequests((authz) -&gt; authz\n    .anyRequest().permitAll()\n)\n.csrf().disable();\n</code></pre>\n<p>Side Note : It is not a good idea Disabling CSRF for production, but it helps you in debugging</p>\n<p>Also please check that you have the <code>@EnableWebSecurity</code> annotation added to your configuration class. This annotation enables Spring Security's web security support.\ne.g.</p>\n<pre><code>@EnableWebSecurity\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {}\n</code></pre>\n<p>Hope this helps you</p>\n"},{"tags":[],"owner":{"account_id":42916,"reputation":22357,"user_id":125212,"accept_rate":52,"display_name":"Jackie"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701099220,"creation_date":1701099220,"answer_id":77558121,"question_id":77554644,"body_markdown":"In my case the real answer that helped was from @dur I added \r\n\r\n```\r\nlogging:\r\n  level:\r\n    org.springframework: TRACE\r\n```\r\n\r\nand without going down a rabbit hole this lead me to finally see...\r\n\r\n```\r\nContent-Type &#39;application/x-www-form-urlencoded;charset=UTF-8&#39; is not supported\r\n```\r\n\r\nWhich lead me to [this answer][1]\r\n\r\nMoral in my case was don&#39;t use `@RequestBody` with form encoded.\r\n\r\n  [1]: https://stackoverflow.com/questions/34782025/http-post-request-with-content-type-application-x-www-form-urlencoded-not-workin","title":"Why is Spring Boot returning a 403 on POST when permitAll is being used?","body":"<p>In my case the real answer that helped was from @dur I added</p>\n<pre><code>logging:\n  level:\n    org.springframework: TRACE\n</code></pre>\n<p>and without going down a rabbit hole this lead me to finally see...</p>\n<pre><code>Content-Type 'application/x-www-form-urlencoded;charset=UTF-8' is not supported\n</code></pre>\n<p>Which lead me to <a href=\"https://stackoverflow.com/questions/34782025/http-post-request-with-content-type-application-x-www-form-urlencoded-not-workin\">this answer</a></p>\n<p>Moral in my case was don't use <code>@RequestBody</code> with form encoded.</p>\n"}],"owner":{"account_id":42916,"reputation":22357,"user_id":125212,"accept_rate":52,"display_name":"Jackie"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":90,"favorite_count":0,"down_vote_count":1,"up_vote_count":1,"answer_count":2,"score":0,"last_activity_date":1701099220,"creation_date":1701062190,"question_id":77554644,"body_markdown":"Ok I am a little confused, to debug I have reverted to this...\r\n\r\n```java \r\n.authorizeHttpRequests((authz) -&gt; authz.anyRequest().permitAll())\r\n```\r\n\r\nAnd I have the following\r\n\r\n```java\r\n@RestController\r\n@RequestMapping(&quot;contact&quot;)\r\npublic class LeadController {\r\n    @Autowired\r\n    private PotentialContactRepo potentialContactRepo;\r\n\r\n    @PostMapping(consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE)\r\n    public void addContact(@RequestBody PotentialContact contact) {\r\n        potentialContactRepo.save(contact);\r\n    }\r\n\r\n    @GetMapping\r\n    public ResponseEntity&lt;String&gt; getContact() {\r\n        return ResponseEntity.ok(&quot;Hello&quot;);\r\n    }\r\n}\r\n```\r\n\r\nBut when I call the post endpoint with postman I get a 403 but when I call the get I get a 200.\r\n\r\n```\r\nPOST /contact HTTP/1.1\r\nUser-Agent: PostmanRuntime/7.31.0\r\nAccept: */*\r\nCache-Control: no-cache\r\nHost: localhost:8080\r\nAccept-Encoding: gzip, deflate, br\r\nConnection: keep-alive\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 151\r\n \r\nname=...&amp;contactInfo=...&amp;location=Wherever&amp;description=This%20is%20the%20description%3B!%40%23%24%23%24%40%24%40%23%24%40%23\r\n \r\nHTTP/1.1 403 Forbidden\r\nSet-Cookie: Path=/; HttpOnly\r\nX-Content-Type-Options: nosniff\r\nX-XSS-Protection: 0\r\nCache-Control: no-cache, no-store, max-age=0, must-revalidate\r\nPragma: no-cache\r\nExpires: 0\r\nX-Frame-Options: DENY\r\nContent-Type: application/json\r\nTransfer-Encoding: chunked\r\nDate: Mon, 27 Nov 2023 05:10:11 GMT\r\nKeep-Alive: timeout=60\r\nConnection: keep-alive\r\n```\r\n\r\nWhat am I missing?","title":"Why is Spring Boot returning a 403 on POST when permitAll is being used?","body":"<p>Ok I am a little confused, to debug I have reverted to this...</p>\n<pre class=\"lang-java prettyprint-override\"><code>.authorizeHttpRequests((authz) -&gt; authz.anyRequest().permitAll())\n</code></pre>\n<p>And I have the following</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RestController\n@RequestMapping(&quot;contact&quot;)\npublic class LeadController {\n    @Autowired\n    private PotentialContactRepo potentialContactRepo;\n\n    @PostMapping(consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE)\n    public void addContact(@RequestBody PotentialContact contact) {\n        potentialContactRepo.save(contact);\n    }\n\n    @GetMapping\n    public ResponseEntity&lt;String&gt; getContact() {\n        return ResponseEntity.ok(&quot;Hello&quot;);\n    }\n}\n</code></pre>\n<p>But when I call the post endpoint with postman I get a 403 but when I call the get I get a 200.</p>\n<pre><code>POST /contact HTTP/1.1\nUser-Agent: PostmanRuntime/7.31.0\nAccept: */*\nCache-Control: no-cache\nHost: localhost:8080\nAccept-Encoding: gzip, deflate, br\nConnection: keep-alive\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 151\n \nname=...&amp;contactInfo=...&amp;location=Wherever&amp;description=This%20is%20the%20description%3B!%40%23%24%23%24%40%24%40%23%24%40%23\n \nHTTP/1.1 403 Forbidden\nSet-Cookie: Path=/; HttpOnly\nX-Content-Type-Options: nosniff\nX-XSS-Protection: 0\nCache-Control: no-cache, no-store, max-age=0, must-revalidate\nPragma: no-cache\nExpires: 0\nX-Frame-Options: DENY\nContent-Type: application/json\nTransfer-Encoding: chunked\nDate: Mon, 27 Nov 2023 05:10:11 GMT\nKeep-Alive: timeout=60\nConnection: keep-alive\n</code></pre>\n<p>What am I missing?</p>\n"},{"tags":["java","multithreading","hibernate","spring"],"answers":[{"comments":[{"owner":{"account_id":53163,"reputation":1161,"user_id":158911,"accept_rate":42,"display_name":"Diablo.Wu"},"score":0,"creation_date":1282629734,"post_id":3553861,"comment_id":3723653,"body_markdown":"My dao class extends HibernateDaoSupport,how to bind the new session ?","body":"My dao class extends HibernateDaoSupport,how to bind the new session ?"}],"tags":[],"owner":{"account_id":186532,"reputation":13518,"user_id":423991,"accept_rate":91,"display_name":"K Erlandsson"},"comment_count":1,"down_vote_count":0,"up_vote_count":3,"is_accepted":false,"score":3,"last_activity_date":1282629426,"creation_date":1282629426,"answer_id":3553861,"question_id":3553845,"body_markdown":"[SessionFactory.openSession][1] creates a new session if that is all you need to know. If you need anything more, please elaborate.\r\n\r\n\r\n  [1]: http://docs.jboss.org/hibernate/stable/core/api/org/hibernate/SessionFactory.html#openSession()","title":"create a new hibernate session in multi-thread program","body":"<p><a href=\"http://docs.jboss.org/hibernate/stable/core/api/org/hibernate/SessionFactory.html#openSession()\" rel=\"nofollow noreferrer\">SessionFactory.openSession</a> creates a new session if that is all you need to know. If you need anything more, please elaborate.</p>\n"},{"tags":[],"owner":{"account_id":295514,"reputation":2157,"user_id":599971,"accept_rate":55,"display_name":"ejaenv"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701099215,"creation_date":1701099215,"answer_id":77558120,"question_id":3553845,"body_markdown":"To use multiple sessions and avoid LazyInitiazationException, you can simulate what OpenSessionInViewFilter does (one session per http request):\r\n\r\n\r\n    public class HibernateSessionManager {\r\n    \r\n        private final SessionFactory sessionFactory;\r\n    \r\n        public HibernateSessionManager(SessionFactory sessionFactory) {\r\n            this.sessionFactory = sessionFactory;\r\n        }\r\n    \r\n        public void openSession() {\r\n            // Obtain the current Hibernate session factory\r\n            Session session = sessionFactory.openSession();\r\n    \r\n            // Create a SessionHolder and associate it with the current thread\r\n            SessionHolder sessionHolder = new SessionHolder(session);\r\n            TransactionSynchronizationManager.bindResource(sessionFactory, sessionHolder);\r\n        }\r\n    \r\n        public Session getCurrentSession() {\r\n            // Retrieve the Hibernate session from the current SessionHolder\r\n            SessionHolder sessionHolder = (SessionHolder) TransactionSynchronizationManager.getResource(sessionFactory);\r\n            if (sessionHolder != null) {\r\n                return sessionHolder.getSession();\r\n            }\r\n            return null;\r\n        }\r\n    \r\n        public void closeSession() {\r\n            // Unbind the SessionHolder from the current thread and close the session\r\n            SessionHolder sessionHolder = (SessionHolder) TransactionSynchronizationManager.unbindResource(sessionFactory);\r\n            if (sessionHolder != null) {\r\n                Session session = sessionHolder.getSession();\r\n                session.close();\r\n            }\r\n        }\r\n    }\r\n\r\n(code generated with chatgpt)\r\n","title":"create a new hibernate session in multi-thread program","body":"<p>To use multiple sessions and avoid LazyInitiazationException, you can simulate what OpenSessionInViewFilter does (one session per http request):</p>\n<pre><code>public class HibernateSessionManager {\n\n    private final SessionFactory sessionFactory;\n\n    public HibernateSessionManager(SessionFactory sessionFactory) {\n        this.sessionFactory = sessionFactory;\n    }\n\n    public void openSession() {\n        // Obtain the current Hibernate session factory\n        Session session = sessionFactory.openSession();\n\n        // Create a SessionHolder and associate it with the current thread\n        SessionHolder sessionHolder = new SessionHolder(session);\n        TransactionSynchronizationManager.bindResource(sessionFactory, sessionHolder);\n    }\n\n    public Session getCurrentSession() {\n        // Retrieve the Hibernate session from the current SessionHolder\n        SessionHolder sessionHolder = (SessionHolder) TransactionSynchronizationManager.getResource(sessionFactory);\n        if (sessionHolder != null) {\n            return sessionHolder.getSession();\n        }\n        return null;\n    }\n\n    public void closeSession() {\n        // Unbind the SessionHolder from the current thread and close the session\n        SessionHolder sessionHolder = (SessionHolder) TransactionSynchronizationManager.unbindResource(sessionFactory);\n        if (sessionHolder != null) {\n            Session session = sessionHolder.getSession();\n            session.close();\n        }\n    }\n}\n</code></pre>\n<p>(code generated with chatgpt)</p>\n"}],"owner":{"account_id":53163,"reputation":1161,"user_id":158911,"accept_rate":42,"display_name":"Diablo.Wu"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":1118,"favorite_count":0,"down_vote_count":0,"up_vote_count":2,"answer_count":2,"score":2,"last_activity_date":1701099215,"creation_date":1282629097,"question_id":3553845,"body_markdown":"How to create a new hibernate session at a new thread ? The SessionFacatory was managed by Spring.","title":"create a new hibernate session in multi-thread program","body":"<p>How to create a new hibernate session at a new thread ? The SessionFacatory was managed by Spring.</p>\n"},{"tags":["java","jvm","jmap"],"comments":[{"owner":{"account_id":1710481,"reputation":22873,"user_id":1568658,"accept_rate":82,"display_name":"Eric"},"score":1,"creation_date":1484120446,"post_id":36764336,"comment_id":70374368,"body_markdown":"This is weird, seems you actual SurvivorRation is 6, not 8.","body":"This is weird, seems you actual SurvivorRation is 6, not 8."}],"answers":[{"tags":[],"owner":{"account_id":23121,"reputation":527376,"user_id":57695,"accept_rate":75,"display_name":"Peter Lawrey"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1461229224,"creation_date":1461228972,"answer_id":36764592,"question_id":36764336,"body_markdown":"Your eden to survivor ratio is 6:1, as the there is two survivors, the ratio of the survivors to young space is 1/8th\r\n\r\nThe Eden has a capacity of 1024.5 MB and 1024.5 / 6 = 107.75 which is pretty close to the 107.5 MB for each survivor spaces.","title":"Why does the ratio between each survivor space and eden does not match SurvivorRatio?","body":"<p>Your eden to survivor ratio is 6:1, as the there is two survivors, the ratio of the survivors to young space is 1/8th</p>\n\n<p>The Eden has a capacity of 1024.5 MB and 1024.5 / 6 = 107.75 which is pretty close to the 107.5 MB for each survivor spaces.</p>\n"},{"comments":[{"owner":{"account_id":319873,"reputation":87612,"user_id":637853,"accept_rate":50,"display_name":"Thomas"},"score":0,"creation_date":1461230832,"post_id":36764618,"comment_id":61108684,"body_markdown":"@YanhuiZhou the problem is: you set  `SurvivorRatio=6` but jmap reports `SurvivorRatio=8` - that indicates your settings are not used (8 is the default). Note that the documentation you posted is 6 years old and probably doesn&#39;t apply to current JVMs anymore .","body":"@YanhuiZhou the problem is: you set  <code>SurvivorRatio=6</code> but jmap reports <code>SurvivorRatio=8</code> - that indicates your settings are not used (8 is the default). Note that the documentation you posted is 6 years old and probably doesn&#39;t apply to current JVMs anymore ."},{"owner":{"account_id":319873,"reputation":87612,"user_id":637853,"accept_rate":50,"display_name":"Thomas"},"score":1,"creation_date":1461231220,"post_id":36764618,"comment_id":61108998,"body_markdown":"@YanhuiZhou also look here: http://stackoverflow.com/questions/3634465/useadaptivesizepolicy-and-other-jvm-opts - Chances are you didn&#39;t disable `UseAdaptiveSizePolicy` so setting the survior ratio won&#39;t work.","body":"@YanhuiZhou also look here: <a href=\"http://stackoverflow.com/questions/3634465/useadaptivesizepolicy-and-other-jvm-opts\" title=\"useadaptivesizepolicy and other jvm opts\">stackoverflow.com/questions/3634465/&hellip;</a> - Chances are you didn&#39;t disable <code>UseAdaptiveSizePolicy</code> so setting the survior ratio won&#39;t work."},{"owner":{"account_id":7938945,"reputation":870,"user_id":5993797,"accept_rate":64,"display_name":"Yanhui Zhou"},"score":0,"creation_date":1461231339,"post_id":36764618,"comment_id":61109072,"body_markdown":"I am not set SurvivorRatio=6, that is just the reference content from the url.","body":"I am not set SurvivorRatio=6, that is just the reference content from the url."},{"owner":{"account_id":319873,"reputation":87612,"user_id":637853,"accept_rate":50,"display_name":"Thomas"},"score":0,"creation_date":1461232209,"post_id":36764618,"comment_id":61109666,"body_markdown":"@YanhuiZhou I updated the answer, there was a misconception. With the default survivor ratio of 8 each survivor space has a maximum of 10% of the young generation (1 + 1 + 8). If the values you get don&#39;t match that simply means the spaces didn&#39;t require their maximum capacity yet.","body":"@YanhuiZhou I updated the answer, there was a misconception. With the default survivor ratio of 8 each survivor space has a maximum of 10% of the young generation (1 + 1 + 8). If the values you get don&#39;t match that simply means the spaces didn&#39;t require their maximum capacity yet."},{"owner":{"account_id":319873,"reputation":87612,"user_id":637853,"accept_rate":50,"display_name":"Thomas"},"score":0,"creation_date":1461233610,"post_id":36764618,"comment_id":61110670,"body_markdown":"@YanhuiZhou I added another 2 updates on tests I did on my machine. Those indicate the ratio of 8 being reported in your case is wrong (setting the ratio to 8 explicitly yields the correct sizes).","body":"@YanhuiZhou I added another 2 updates on tests I did on my machine. Those indicate the ratio of 8 being reported in your case is wrong (setting the ratio to 8 explicitly yields the correct sizes)."},{"owner":{"account_id":13946209,"reputation":1093,"user_id":11389917,"display_name":"Kashinath Patekar"},"score":0,"creation_date":1701017425,"post_id":36764618,"comment_id":136720155,"body_markdown":"I have added explanation for the difference in explicit and implicit ratio cases in an answer below","body":"I have added explanation for the difference in explicit and implicit ratio cases in an answer below"}],"tags":[],"owner":{"account_id":319873,"reputation":87612,"user_id":637853,"accept_rate":50,"display_name":"Thomas"},"comment_count":6,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1461234163,"creation_date":1461229013,"answer_id":36764618,"question_id":36764336,"body_markdown":"&lt;strike&gt;`SurvivorRatio = 8` means that each survivor space takes 1/8th of the young generation whose size is Eden + To + From. In your case The young generation size is 1365.5 MB and 1/8th of that would be 170,69 - assuming there&#39;s some rounding involved (or some other small space) the values are sound.&lt;/strike&gt;\r\n\r\n__Update:__ I had some misconception here. The values in your case would be valid, the spaces probably just haven&#39;t used their maximum capacity yet.\r\n\r\nTry running a test with `Xms=&lt;value of Xmx&gt;`.\r\n\r\nIn my case (with a jdk 1.6, 1.7 and 1.8) I used `SurvivorRatio=10` and got the following results (Java 8 had some slight differences):\r\n\r\n    Heap Configuration:\r\n      ...   \r\n      SurvivorRatio    = 10\r\n      ...\r\n\r\n    Heap Usage:\r\n    PS Young Generation\r\n    Eden Space:\r\n      capacity = 596508672 (568.875MB)  //Java 8 reported 569.5 here\r\n      used     = 536159440 (511.3214874267578MB)\r\n      free     = 60349232 (57.55351257324219MB)\r\n      89.8829246190741% used\r\n    From Space:\r\n      capacity = 59637760 (56.875MB)    //Java 8 reported 56.5 here\r\n      used     = 59626360 (56.86412811279297MB)\r\n      free     = 11400 (0.01087188720703125MB)\r\n      99.9808845939217% used\r\n    To Space:\r\n      capacity = 59637760 (56.875MB)    //Java 8 reported 56.5 here\r\n      used     = 0 (0.0MB)\r\n      free     = 59637760 (56.875MB)\r\n      0.0% used\r\n\r\nAs you can see, both survivor spaces are exactly 10% the size of the eden space. Without `Xms=&lt;Xmx&gt;` I got way lower percentages as the spaces didn&#39;t have to be increased yet.\r\n\r\n__Update 2:__\r\n\r\nApparantly the OP&#39;s spaces already aquired their maximum capacity with young generation having 1365 MB max (which is 33% of the 4096 MB max heap size). In that case the values look like the survivor ratio being 6 (i.e. each survivor space taking 1/8th of eden space) but jmap reporting a ratio of 8 indicates some kind of error/bug here (I did my tests with JVM version 21.0-b17 and 25.40-b25, i.e. the OP&#39;s version 24.80-b11 is somewhere in between).\r\n\r\n__Update 3:__\r\n\r\nI reran my tests twice with jdk 7:\r\n\r\nNo 1.: no `SurvivorRatio` set, i.e. default of 8 should be used:\r\n\r\n    Heap Configuration:\r\n       ...\r\n       SurvivorRatio    = 8\r\n       ...\r\n    \r\n    Heap Usage:\r\n    PS Young Generation\r\n    Eden Space:\r\n       capacity = 536870912 (512.0MB)\r\n       ...\r\n    From Space:\r\n       capacity = 89456640 (85.3125MB)\r\n       ...\r\n    To Space:\r\n       capacity = 89456640 (85.3125MB)\r\n       ...\r\n    \r\nNo 2.: explicit `SurvivorRatio=8` set:\r\n\r\n    Heap Configuration:\r\n       ...\r\n       SurvivorRatio    = 8\r\n       ...\r\n    \r\n    Heap Usage:\r\n    PS Young Generation\r\n    Eden Space:\r\n       capacity = 572653568 (546.125MB)\r\n       ...\r\n    From Space:\r\n       capacity = 71565312 (68.25MB)\r\n       ...\r\n    To Space:\r\n       capacity = 71565312 (68.25MB)\r\n       ...\r\n\r\nAs you can see there&#39;s a difference in the ratio even though a value of 8 is reported for both cases. Only the second case where the ratio was explicitly set to 8 fits the equation provided in the documentation which indicates in the default case there&#39;s some other ratio being used and jmap either reports a wrong ratio or the actual size calculation use a different value/formula. \r\n\r\nFrom the values the formulas look like this:\r\n\r\n- explicit survivor ratio: `size(survior space) = size(eden space)/survivorRatio` (example: `546.125 / 8 = 68.25` - see test 2)\r\n- implicit/default survivor ratio: `size(survior space) = size(young generation)/survivorRatio` (example: `682 / 8 = 85.25`- see test 1, values rounded a bit)\r\n\r\nNote: this also is true for jdk 1.8.","title":"Why does the ratio between each survivor space and eden does not match SurvivorRatio?","body":"<p><strike><code>SurvivorRatio = 8</code> means that each survivor space takes 1/8th of the young generation whose size is Eden + To + From. In your case The young generation size is 1365.5 MB and 1/8th of that would be 170,69 - assuming there's some rounding involved (or some other small space) the values are sound.</strike></p>\n\n<p><strong>Update:</strong> I had some misconception here. The values in your case would be valid, the spaces probably just haven't used their maximum capacity yet.</p>\n\n<p>Try running a test with <code>Xms=&lt;value of Xmx&gt;</code>.</p>\n\n<p>In my case (with a jdk 1.6, 1.7 and 1.8) I used <code>SurvivorRatio=10</code> and got the following results (Java 8 had some slight differences):</p>\n\n<pre><code>Heap Configuration:\n  ...   \n  SurvivorRatio    = 10\n  ...\n\nHeap Usage:\nPS Young Generation\nEden Space:\n  capacity = 596508672 (568.875MB)  //Java 8 reported 569.5 here\n  used     = 536159440 (511.3214874267578MB)\n  free     = 60349232 (57.55351257324219MB)\n  89.8829246190741% used\nFrom Space:\n  capacity = 59637760 (56.875MB)    //Java 8 reported 56.5 here\n  used     = 59626360 (56.86412811279297MB)\n  free     = 11400 (0.01087188720703125MB)\n  99.9808845939217% used\nTo Space:\n  capacity = 59637760 (56.875MB)    //Java 8 reported 56.5 here\n  used     = 0 (0.0MB)\n  free     = 59637760 (56.875MB)\n  0.0% used\n</code></pre>\n\n<p>As you can see, both survivor spaces are exactly 10% the size of the eden space. Without <code>Xms=&lt;Xmx&gt;</code> I got way lower percentages as the spaces didn't have to be increased yet.</p>\n\n<p><strong>Update 2:</strong></p>\n\n<p>Apparantly the OP's spaces already aquired their maximum capacity with young generation having 1365 MB max (which is 33% of the 4096 MB max heap size). In that case the values look like the survivor ratio being 6 (i.e. each survivor space taking 1/8th of eden space) but jmap reporting a ratio of 8 indicates some kind of error/bug here (I did my tests with JVM version 21.0-b17 and 25.40-b25, i.e. the OP's version 24.80-b11 is somewhere in between).</p>\n\n<p><strong>Update 3:</strong></p>\n\n<p>I reran my tests twice with jdk 7:</p>\n\n<p>No 1.: no <code>SurvivorRatio</code> set, i.e. default of 8 should be used:</p>\n\n<pre><code>Heap Configuration:\n   ...\n   SurvivorRatio    = 8\n   ...\n\nHeap Usage:\nPS Young Generation\nEden Space:\n   capacity = 536870912 (512.0MB)\n   ...\nFrom Space:\n   capacity = 89456640 (85.3125MB)\n   ...\nTo Space:\n   capacity = 89456640 (85.3125MB)\n   ...\n</code></pre>\n\n<p>No 2.: explicit <code>SurvivorRatio=8</code> set:</p>\n\n<pre><code>Heap Configuration:\n   ...\n   SurvivorRatio    = 8\n   ...\n\nHeap Usage:\nPS Young Generation\nEden Space:\n   capacity = 572653568 (546.125MB)\n   ...\nFrom Space:\n   capacity = 71565312 (68.25MB)\n   ...\nTo Space:\n   capacity = 71565312 (68.25MB)\n   ...\n</code></pre>\n\n<p>As you can see there's a difference in the ratio even though a value of 8 is reported for both cases. Only the second case where the ratio was explicitly set to 8 fits the equation provided in the documentation which indicates in the default case there's some other ratio being used and jmap either reports a wrong ratio or the actual size calculation use a different value/formula. </p>\n\n<p>From the values the formulas look like this:</p>\n\n<ul>\n<li>explicit survivor ratio: <code>size(survior space) = size(eden space)/survivorRatio</code> (example: <code>546.125 / 8 = 68.25</code> - see test 2)</li>\n<li>implicit/default survivor ratio: <code>size(survior space) = size(young generation)/survivorRatio</code> (example: <code>682 / 8 = 85.25</code>- see test 1, values rounded a bit)</li>\n</ul>\n\n<p>Note: this also is true for jdk 1.8.</p>\n"},{"comments":[{"owner":{"account_id":319873,"reputation":87612,"user_id":637853,"accept_rate":50,"display_name":"Thomas"},"score":0,"creation_date":1461231287,"post_id":36765487,"comment_id":61109038,"body_markdown":"That&#39;s exactly what I suspected and was looking for. As in &quot;read the code, the documentation lies&quot; ;)","body":"That&#39;s exactly what I suspected and was looking for. As in &quot;read the code, the documentation lies&quot; ;)"},{"owner":{"account_id":1056871,"reputation":117749,"user_id":1059372,"accept_rate":97,"display_name":"Eugene"},"score":0,"creation_date":1493990428,"post_id":36765487,"comment_id":74651014,"body_markdown":"@ThomasKl&#228;ger I accidentally stumbled against this, but i don&#39;t think this is correct. The `plus 2` is referenced here : http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/tip/src/share/vm/runtime/arguments.cpp#l1573. That&#39;s not a `SurvivorRatio - 2` at all...","body":"@ThomasKl&#228;ger I accidentally stumbled against this, but i don&#39;t think this is correct. The <code>plus 2</code> is referenced here : <a href=\"http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/tip/src/share/vm/runtime/arguments.cpp#l1573\" rel=\"nofollow noreferrer\">hg.openjdk.java.net/jdk8/jdk8/hotspot/file/tip/src/share/vm/&zwnj;&#8203;&hellip;</a>. That&#39;s not a <code>SurvivorRatio - 2</code> at all..."}],"tags":[],"owner":{"account_id":7423601,"reputation":18712,"user_id":5646962,"display_name":"Thomas Kl&#228;ger"},"comment_count":2,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1461231159,"creation_date":1461231159,"answer_id":36765487,"question_id":36764336,"body_markdown":"It seems that at some time the formula for calculating the eden / survivor space size has changed.\r\n\r\nSee to https://searchcode.com/codesearch/view/17980811/, lines 52 to 54:\r\n\r\n&gt; The survivor ratio&#39;s are calculated &quot;raw&quot;, unlike the default gc, which adds 2 to the ratio value. We need to make sure the values are valid before using them.","title":"Why does the ratio between each survivor space and eden does not match SurvivorRatio?","body":"<p>It seems that at some time the formula for calculating the eden / survivor space size has changed.</p>\n\n<p>See to <a href=\"https://searchcode.com/codesearch/view/17980811/\" rel=\"nofollow\">https://searchcode.com/codesearch/view/17980811/</a>, lines 52 to 54:</p>\n\n<blockquote>\n  <p>The survivor ratio's are calculated \"raw\", unlike the default gc, which adds 2 to the ratio value. We need to make sure the values are valid before using them.</p>\n</blockquote>\n"},{"tags":[],"owner":{"account_id":13946209,"reputation":1093,"user_id":11389917,"display_name":"Kashinath Patekar"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701098428,"creation_date":1701009888,"answer_id":77552143,"question_id":36764336,"body_markdown":"To expand upon, and to clarify the behaviour stated in [Thomas&#39;s answer][1], the difference in two cases is due to the way in which the cases of explicitly specifying `SurvivorRatio` flag and not specifying the same, are handled. Spoiler alert - jmap output (i.e. SurvivorRatio = 8) is also not exactly wrong. How, you ask? Follow along:\r\n\r\nThere are 3 options present related to Survivor ratio - `SurvivorRatio`, `MinSurvivorRatio`, and `InitialSurvivorRatio`. The defaults for these (can be found in source code [gc_globals.hpp][2]) are 8, 3, and 8 respectively. Also from source code it is clear that: \r\n\r\n - `SurvivorRatio` considers the ratio Eden:Survivor\r\n - `MinSurvivorRatio` and `InitialSurvivorRatio` consider the ratio YoungGen:Survivor\r\n\r\nAs per [this][3] Oracle bug ticket, \r\n&gt; The UseParallelGC collector uses\r\nthe command line flags `MinSurvivorRatio` and `InitialSurvivorRatio`.\r\n\r\n(Note that actually `Parallel scavenge` is the name of GC, and UseParallelGC is the flag to explicitly tell JVM to use this GC.)\r\n\r\nAnd as per [this][4] Oracle bug ticket, \r\n\r\n&gt; Assigning `SurivorRatio` a value of `k` will yield `InitialSurvivorRatio=(k+2)` and `MinSurvivorRatio=(k+2)` in case of `Parallel Scavenger`  \r\n\r\n(source code: [parallelArguments.cpp][5]) (Parallel Scavenger is default GC. As can be seen in code, the two flags will be assigned values in this manner only if the SurivorRatio is specified but these two flags are not specified.)\r\n\r\nIf `SurvivorRatio` and the other two flags are not specified, the defaults specified in `gc_globals.hpp` would be used. Parallel Scavenger would only care about `MinSurvivorRatio` and `InitialSurvivorRatio` defaults.\r\n\r\nHence,\r\n\r\n - If SurvivorRatio=8 option is specified (and the other two not), (k+2=10), it yields both min and initial YoungGen:Survivor ratio as 10:1\r\n - If none of the 3 flags specified, (no modification, use default) it yields  initial (and min) YoungGen:Survivor ratio as 8:1 (and 3:1).\r\n\r\nIn both cases, the value for SurvivorRatio is 8, hence jmap will output 8.\r\n\r\nThis answer assumes that the `XX:UseAdaptiveSizePolicy` flag is disabled (explicitly, as it is enabled by default), since as per IBM [docs][6]:\r\n&gt; Avoid trouble: -XX:SurvivorRatio= option is incompatible with the JVM parameter -XX:+UseAdaptiveSizePolicy. Please use either one according to your situation.\r\n\r\n\r\n\r\n  \r\n\r\n  [1]: https://stackoverflow.com/a/36764618/11389917\r\n  [2]: https://github.com/openjdk/jdk/blob/6aa197667ad05bd93adf3afc7b06adbfb2b18a22/src/hotspot/share/gc/shared/gc_globals.hpp#L470\r\n  [3]: https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6368557\r\n  [4]: https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6362902\r\n  [5]: https://github.com/openjdk/jdk/blob/6aa197667ad05bd93adf3afc7b06adbfb2b18a22/src/hotspot/share/gc/parallel/parallelArguments.cpp#L69\r\n  [6]: https://www.ibm.com/docs/en/was/9.0.5?topic=thjvmshu-sun-hotspot-jvm-tuning-parameters-solaris-hp-ux","title":"Why does the ratio between each survivor space and eden does not match SurvivorRatio?","body":"<p>To expand upon, and to clarify the behaviour stated in <a href=\"https://stackoverflow.com/a/36764618/11389917\">Thomas's answer</a>, the difference in two cases is due to the way in which the cases of explicitly specifying <code>SurvivorRatio</code> flag and not specifying the same, are handled. Spoiler alert - jmap output (i.e. SurvivorRatio = 8) is also not exactly wrong. How, you ask? Follow along:</p>\n<p>There are 3 options present related to Survivor ratio - <code>SurvivorRatio</code>, <code>MinSurvivorRatio</code>, and <code>InitialSurvivorRatio</code>. The defaults for these (can be found in source code <a href=\"https://github.com/openjdk/jdk/blob/6aa197667ad05bd93adf3afc7b06adbfb2b18a22/src/hotspot/share/gc/shared/gc_globals.hpp#L470\" rel=\"nofollow noreferrer\">gc_globals.hpp</a>) are 8, 3, and 8 respectively. Also from source code it is clear that:</p>\n<ul>\n<li><code>SurvivorRatio</code> considers the ratio Eden:Survivor</li>\n<li><code>MinSurvivorRatio</code> and <code>InitialSurvivorRatio</code> consider the ratio YoungGen:Survivor</li>\n</ul>\n<p>As per <a href=\"https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6368557\" rel=\"nofollow noreferrer\">this</a> Oracle bug ticket,</p>\n<blockquote>\n<p>The UseParallelGC collector uses\nthe command line flags <code>MinSurvivorRatio</code> and <code>InitialSurvivorRatio</code>.</p>\n</blockquote>\n<p>(Note that actually <code>Parallel scavenge</code> is the name of GC, and UseParallelGC is the flag to explicitly tell JVM to use this GC.)</p>\n<p>And as per <a href=\"https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6362902\" rel=\"nofollow noreferrer\">this</a> Oracle bug ticket,</p>\n<blockquote>\n<p>Assigning <code>SurivorRatio</code> a value of <code>k</code> will yield <code>InitialSurvivorRatio=(k+2)</code> and <code>MinSurvivorRatio=(k+2)</code> in case of <code>Parallel Scavenger</code></p>\n</blockquote>\n<p>(source code: <a href=\"https://github.com/openjdk/jdk/blob/6aa197667ad05bd93adf3afc7b06adbfb2b18a22/src/hotspot/share/gc/parallel/parallelArguments.cpp#L69\" rel=\"nofollow noreferrer\">parallelArguments.cpp</a>) (Parallel Scavenger is default GC. As can be seen in code, the two flags will be assigned values in this manner only if the SurivorRatio is specified but these two flags are not specified.)</p>\n<p>If <code>SurvivorRatio</code> and the other two flags are not specified, the defaults specified in <code>gc_globals.hpp</code> would be used. Parallel Scavenger would only care about <code>MinSurvivorRatio</code> and <code>InitialSurvivorRatio</code> defaults.</p>\n<p>Hence,</p>\n<ul>\n<li>If SurvivorRatio=8 option is specified (and the other two not), (k+2=10), it yields both min and initial YoungGen:Survivor ratio as 10:1</li>\n<li>If none of the 3 flags specified, (no modification, use default) it yields  initial (and min) YoungGen:Survivor ratio as 8:1 (and 3:1).</li>\n</ul>\n<p>In both cases, the value for SurvivorRatio is 8, hence jmap will output 8.</p>\n<p>This answer assumes that the <code>XX:UseAdaptiveSizePolicy</code> flag is disabled (explicitly, as it is enabled by default), since as per IBM <a href=\"https://www.ibm.com/docs/en/was/9.0.5?topic=thjvmshu-sun-hotspot-jvm-tuning-parameters-solaris-hp-ux\" rel=\"nofollow noreferrer\">docs</a>:</p>\n<blockquote>\n<p>Avoid trouble: -XX:SurvivorRatio= option is incompatible with the JVM parameter -XX:+UseAdaptiveSizePolicy. Please use either one according to your situation.</p>\n</blockquote>\n"}],"owner":{"account_id":7938945,"reputation":870,"user_id":5993797,"accept_rate":64,"display_name":"Yanhui Zhou"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":2215,"favorite_count":0,"down_vote_count":0,"up_vote_count":1,"answer_count":4,"score":1,"last_activity_date":1701098428,"creation_date":1461228344,"question_id":36764336,"body_markdown":"&gt; The [SurvivorRatio](https://docs.oracle.com/cd/E19159-01/819-3681/abeil/index.html) parameter controls the size of the two survivor spaces. For example, -XX:SurvivorRatio=6 sets the ratio between each survivor space and eden to be 1:6, each survivor space will be one eighth of the young generation.\r\n\r\nWhy does the space capacity of survivor and eden not match SurvivorRatio, as below? Produced by `jmap -heap 15760`.\r\n\r\n    Attaching to process ID 15760, please wait...\r\n    Debugger attached successfully.\r\n    Server compiler detected.\r\n    JVM version is 24.80-b11\r\n    \r\n    using thread-local object allocation.\r\n    Parallel GC with 8 thread(s)\r\n    \r\n    Heap Configuration:\r\n       MinHeapFreeRatio = 0\r\n       MaxHeapFreeRatio = 100\r\n       MaxHeapSize      = 4294967296 (4096.0MB)\r\n       NewSize          = 1310720 (1.25MB)\r\n       MaxNewSize       = 17592186044415 MB\r\n       OldSize          = 5439488 (5.1875MB)\r\n       NewRatio         = 2\r\n       SurvivorRatio    = 8\r\n       PermSize         = 21757952 (20.75MB)\r\n       MaxPermSize      = 1073741824 (1024.0MB)\r\n       G1HeapRegionSize = 0 (0.0MB)\r\n    \r\n    Heap Usage:\r\n    PS Young Generation\r\n    Eden Space:\r\n       capacity = 1074266112 (1024.5MB)\r\n       used     = 276841328 (264.01646423339844MB)\r\n       free     = 797424784 (760.4835357666016MB)\r\n       25.770274693352704% used\r\n    From Space:\r\n       capacity = 178782208 (170.5MB)\r\n       used     = 56996280 (54.35588836669922MB)\r\n       free     = 121785928 (116.14411163330078MB)\r\n       31.880286432081654% used\r\n    To Space:\r\n       capacity = 178782208 (170.5MB)\r\n       used     = 0 (0.0MB)\r\n       free     = 178782208 (170.5MB)\r\n       0.0% used\r\n    PS Old Generation\r\n       capacity = 2863661056 (2731.0MB)\r\n       used     = 98320 (0.0937652587890625MB)\r\n       free     = 2863562736 (2730.906234741211MB)\r\n       0.003433367220397748% used\r\n    PS Perm Generation\r\n       capacity = 47710208 (45.5MB)\r\n       used     = 47664440 (45.45635223388672MB)\r\n       free     = 45768 (0.04364776611328125MB)\r\n       99.90407084370707% used\r\n    \r\n    26132 interned Strings occupying 2933384 bytes.","title":"Why does the ratio between each survivor space and eden does not match SurvivorRatio?","body":"<blockquote>\n  <p>The <a href=\"https://docs.oracle.com/cd/E19159-01/819-3681/abeil/index.html\" rel=\"nofollow\">SurvivorRatio</a> parameter controls the size of the two survivor spaces. For example, -XX:SurvivorRatio=6 sets the ratio between each survivor space and eden to be 1:6, each survivor space will be one eighth of the young generation.</p>\n</blockquote>\n\n<p>Why does the space capacity of survivor and eden not match SurvivorRatio, as below? Produced by <code>jmap -heap 15760</code>.</p>\n\n<pre><code>Attaching to process ID 15760, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 24.80-b11\n\nusing thread-local object allocation.\nParallel GC with 8 thread(s)\n\nHeap Configuration:\n   MinHeapFreeRatio = 0\n   MaxHeapFreeRatio = 100\n   MaxHeapSize      = 4294967296 (4096.0MB)\n   NewSize          = 1310720 (1.25MB)\n   MaxNewSize       = 17592186044415 MB\n   OldSize          = 5439488 (5.1875MB)\n   NewRatio         = 2\n   SurvivorRatio    = 8\n   PermSize         = 21757952 (20.75MB)\n   MaxPermSize      = 1073741824 (1024.0MB)\n   G1HeapRegionSize = 0 (0.0MB)\n\nHeap Usage:\nPS Young Generation\nEden Space:\n   capacity = 1074266112 (1024.5MB)\n   used     = 276841328 (264.01646423339844MB)\n   free     = 797424784 (760.4835357666016MB)\n   25.770274693352704% used\nFrom Space:\n   capacity = 178782208 (170.5MB)\n   used     = 56996280 (54.35588836669922MB)\n   free     = 121785928 (116.14411163330078MB)\n   31.880286432081654% used\nTo Space:\n   capacity = 178782208 (170.5MB)\n   used     = 0 (0.0MB)\n   free     = 178782208 (170.5MB)\n   0.0% used\nPS Old Generation\n   capacity = 2863661056 (2731.0MB)\n   used     = 98320 (0.0937652587890625MB)\n   free     = 2863562736 (2730.906234741211MB)\n   0.003433367220397748% used\nPS Perm Generation\n   capacity = 47710208 (45.5MB)\n   used     = 47664440 (45.45635223388672MB)\n   free     = 45768 (0.04364776611328125MB)\n   99.90407084370707% used\n\n26132 interned Strings occupying 2933384 bytes.\n</code></pre>\n"},{"tags":["java","selenium","webdriver"],"comments":[{"owner":{"account_id":6701767,"reputation":47952,"user_id":5168011,"accept_rate":100,"display_name":"Guy"},"score":0,"creation_date":1452664961,"post_id":34759376,"comment_id":57264209,"body_markdown":"try `a.moveToElement(el).build().perform();`","body":"try <code>a.moveToElement(el).build().perform();</code>"},{"owner":{"account_id":3029527,"reputation":7159,"user_id":2568849,"accept_rate":79,"display_name":"Mesut GUNES"},"score":0,"creation_date":1452667015,"post_id":34759376,"comment_id":57265006,"body_markdown":"you may try sending space like `el.sendKeys(Keys.SPACE);`","body":"you may try sending space like <code>el.sendKeys(Keys.SPACE);</code>"},{"owner":{"account_id":2349610,"reputation":3207,"user_id":2058844,"accept_rate":64,"display_name":"Paras"},"score":1,"creation_date":1452668297,"post_id":34759376,"comment_id":57265588,"body_markdown":"Try `((JavascriptExecutor)driver).executeScript(&quot;window.scrollTo(0,document.body.scrollHeight);&quot;);`","body":"Try <code>((JavascriptExecutor)driver).executeScript(&quot;window.scrollTo(&zwnj;&#8203;0,document.body.scro&zwnj;&#8203;llHeight);&quot;);</code>"},{"owner":{"account_id":5494975,"reputation":227,"user_id":4366433,"accept_rate":0,"display_name":"Tanmay"},"score":0,"creation_date":1452672605,"post_id":34759376,"comment_id":57267784,"body_markdown":"I tried with a.moveToElement(el).build().perform() but it did not work. Why is that it is not working in Chrome but in Firefox only.","body":"I tried with a.moveToElement(el).build().perform() but it did not work. Why is that it is not working in Chrome but in Firefox only."},{"owner":{"account_id":6701767,"reputation":47952,"user_id":5168011,"accept_rate":100,"display_name":"Guy"},"score":0,"creation_date":1452684663,"post_id":34759376,"comment_id":57276025,"body_markdown":"Do you get any errors?","body":"Do you get any errors?"},{"owner":{"account_id":5494975,"reputation":227,"user_id":4366433,"accept_rate":0,"display_name":"Tanmay"},"score":1,"creation_date":1452685179,"post_id":34759376,"comment_id":57276390,"body_markdown":"@guy , i did not get any error. Code got executed on Chrome but the scroll down action did not happen.","body":"@guy , i did not get any error. Code got executed on Chrome but the scroll down action did not happen."},{"owner":{"account_id":7453887,"reputation":503,"user_id":5667709,"display_name":"Choi"},"score":0,"creation_date":1560500481,"post_id":34759376,"comment_id":99765045,"body_markdown":"Is it same to be a.moveByOffset(0, 1000000).release().perform(); ?","body":"Is it same to be a.moveByOffset(0, 1000000).release().perform(); ?"}],"answers":[{"comments":[{"owner":{"account_id":5494975,"reputation":227,"user_id":4366433,"accept_rate":0,"display_name":"Tanmay"},"score":0,"creation_date":1452672690,"post_id":34761101,"comment_id":57267840,"body_markdown":"Can it be not done without Javascript executor and only using Selenium APIs.","body":"Can it be not done without Javascript executor and only using Selenium APIs."},{"owner":{"account_id":2349610,"reputation":3207,"user_id":2058844,"accept_rate":64,"display_name":"Paras"},"score":1,"creation_date":1452677198,"post_id":34761101,"comment_id":57270707,"body_markdown":"you can try something like `driver.findElement(By.id(&quot;&quot;)).sendKeys(Keys.PAGE_DOWN);` for scroll down","body":"you can try something like <code>driver.findElement(By.id(&quot;&quot;)).sendKeys(Keys.PAGE_DOWN);</code> for scroll down"},{"owner":{"account_id":5494975,"reputation":227,"user_id":4366433,"accept_rate":0,"display_name":"Tanmay"},"score":0,"creation_date":1452688402,"post_id":34761101,"comment_id":57278528,"body_markdown":"I tried using sendKeys(Keys.PAGE_DOWN) but it throws error &#39;org.openqa.selenium.WebDriverException: unknown error: cannot focus element&#39; in chrome.","body":"I tried using sendKeys(Keys.PAGE_DOWN) but it throws error &#39;org.openqa.selenium.WebDriverException: unknown error: cannot focus element&#39; in chrome."},{"owner":{"account_id":2349610,"reputation":3207,"user_id":2058844,"accept_rate":64,"display_name":"Paras"},"score":0,"creation_date":1452688549,"post_id":34761101,"comment_id":57278605,"body_markdown":"if these things aren&#39;t working. then you can go with `JavaScriptExecutor`","body":"if these things aren&#39;t working. then you can go with <code>JavaScriptExecutor</code>"},{"owner":{"account_id":5494975,"reputation":227,"user_id":4366433,"accept_rate":0,"display_name":"Tanmay"},"score":1,"creation_date":1452690354,"post_id":34761101,"comment_id":57279794,"body_markdown":"I tried using JavaScriptExecutor as said above to scroll down  but it is throwing exception ** org.openqa.selenium.WebDriverException: unknown error: Runtime.evaluate threw exception: SyntaxError: missing )**","body":"I tried using JavaScriptExecutor as said above to scroll down  but it is throwing exception ** org.openqa.selenium.WebDriverException: unknown error: Runtime.evaluate threw exception: SyntaxError: missing )**"},{"owner":{"account_id":9706671,"reputation":6398,"user_id":7199922,"accept_rate":62,"display_name":"ttt"},"score":0,"creation_date":1610622951,"post_id":34761101,"comment_id":116193434,"body_markdown":"There was some weight character in the script when I copied it from this answer, so try to copy this one which has worked for me: `window.scrollTo(0,document.body.scrollHeight);`","body":"There was some weight character in the script when I copied it from this answer, so try to copy this one which has worked for me: <code>window.scrollTo(0,document.body.scrollHeight);</code>"}],"tags":[],"owner":{"account_id":2349610,"reputation":3207,"user_id":2058844,"accept_rate":64,"display_name":"Paras"},"comment_count":6,"down_vote_count":0,"up_vote_count":5,"is_accepted":false,"score":5,"last_activity_date":1452671431,"creation_date":1452671431,"answer_id":34761101,"question_id":34759376,"body_markdown":"You can use `JavaScriptExecutor` for scrolling.\r\n\r\n***Scroll Down***\r\n\r\n    ((JavascriptExecutor)driver).executeScript(&quot;window.scrollTo(0,document.body.scr‌​ollHeight);&quot;);\r\n\r\n***Scroll Up***\r\n\r\n    ((JavascriptExecutor)driver).executeScript(&quot;window.scrollTo(0,0);&quot;);","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>You can use <code>JavaScriptExecutor</code> for scrolling.</p>\n\n<p><strong><em>Scroll Down</em></strong></p>\n\n<pre><code>((JavascriptExecutor)driver).executeScript(\"window.scrollTo(0,document.body.scr‌​ollHeight);\");\n</code></pre>\n\n<p><strong><em>Scroll Up</em></strong></p>\n\n<pre><code>((JavascriptExecutor)driver).executeScript(\"window.scrollTo(0,0);\");\n</code></pre>\n"},{"tags":[],"owner":{"account_id":6736297,"reputation":348,"user_id":5190974,"accept_rate":50,"display_name":"Sarah"},"comment_count":0,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1475762338,"creation_date":1452715966,"answer_id":34776142,"question_id":34759376,"body_markdown":"Javascript Executer version (scrolls to bottom - best for my needs):\r\n\r\n    JavascriptExecutor jse = (JavascriptExecutor)driver;\r\n    jse.executeScript(&quot;window.scrollTo(0, document.body.scrollHeight);&quot;);\r\n\r\nWebdrvier only version:\r\n\r\n    driver.findElement(By.id(&quot;INSERT_A_INPUT_BOX&quot;)).sendKeys(Keys.PAGE_DOWN);\r\n\r\nThis version only scrolls down one page. At first it wouldn&#39;t work for me because I was trying to focus on a random element not an input element, but it does work when focusing on something you can type into","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>Javascript Executer version (scrolls to bottom - best for my needs):</p>\n\n<pre><code>JavascriptExecutor jse = (JavascriptExecutor)driver;\njse.executeScript(\"window.scrollTo(0, document.body.scrollHeight);\");\n</code></pre>\n\n<p>Webdrvier only version:</p>\n\n<pre><code>driver.findElement(By.id(\"INSERT_A_INPUT_BOX\")).sendKeys(Keys.PAGE_DOWN);\n</code></pre>\n\n<p>This version only scrolls down one page. At first it wouldn't work for me because I was trying to focus on a random element not an input element, but it does work when focusing on something you can type into</p>\n"},{"tags":[],"owner":{"account_id":5494975,"reputation":227,"user_id":4366433,"accept_rate":0,"display_name":"Tanmay"},"comment_count":0,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1475762243,"creation_date":1452749755,"answer_id":34782385,"question_id":34759376,"body_markdown":"So far below are my findings based on options I tired:\r\n\r\n1.**Action builder class** : Works in Firefox but not in Chrome.Not sure why it did not work in Chrome.\r\n\r\n2.`js.executeScript(&quot;window.scrollTo(0, document.body.scrollHeight);&quot;);`: It neither worked in Firefox and Chrome. I guess this is something not suitable in my case.\r\n\r\n3.`js.executeScript(&quot;arguments[0].scrollIntoView(true);&quot;,element);` :  It worked in both Firefox and Chrome.\r\n\r\n","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>So far below are my findings based on options I tired:</p>\n\n<p>1.<strong>Action builder class</strong> : Works in Firefox but not in Chrome.Not sure why it did not work in Chrome.</p>\n\n<p>2.<code>js.executeScript(\"window.scrollTo(0, document.body.scrollHeight);\");</code>: It neither worked in Firefox and Chrome. I guess this is something not suitable in my case.</p>\n\n<p>3.<code>js.executeScript(\"arguments[0].scrollIntoView(true);\",element);</code> :  It worked in both Firefox and Chrome.</p>\n"},{"tags":[],"owner":{"account_id":6731826,"reputation":71,"user_id":5187862,"display_name":"CJDownUnder"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1476390527,"creation_date":1476390527,"answer_id":40030383,"question_id":34759376,"body_markdown":"I had a similar problem in Selenium (wrapped in Selenide):\r\n\r\nThis worked for me to scroll to a link that was off the bottom of the page:\r\n\r\n    if (isPhantomjs()){\r\n        $(byText(linkType)).scrollTo().click();\r\n    } else {\r\n        executeJavaScript(&quot;arguments[0].scrollIntoView(true);&quot;, $(byText(linkType)));\r\n        $(byText(linkType)).click();\r\n    }","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>I had a similar problem in Selenium (wrapped in Selenide):</p>\n\n<p>This worked for me to scroll to a link that was off the bottom of the page:</p>\n\n<pre><code>if (isPhantomjs()){\n    $(byText(linkType)).scrollTo().click();\n} else {\n    executeJavaScript(\"arguments[0].scrollIntoView(true);\", $(byText(linkType)));\n    $(byText(linkType)).click();\n}\n</code></pre>\n"},{"tags":[],"owner":{"account_id":5740823,"reputation":544,"user_id":4533583,"display_name":"Anuraj R"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1476624817,"creation_date":1476624817,"answer_id":40070855,"question_id":34759376,"body_markdown":"For Scroll down:\r\n\r\n    WebDriver driver = new ChromeDriver();\r\n    JavascriptExecutor jse = (JavascriptExecutor)driver;\r\n    jse.executeScript(&quot;window.scrollBy(0,250)&quot;, &quot;&quot;);\r\n\r\nOR,also\r\n\r\n    jse.executeScript(&quot;scroll(0, 250);&quot;);\r\n\r\nFor Scroll up:\r\n\r\n    jse.executeScript(&quot;window.scrollBy(0,-250)&quot;, &quot;&quot;);\r\n\r\nOR,\r\n\r\n    jse.executeScript(&quot;scroll(0, -250);&quot;);\r\n\r\n\r\nHope it will help you","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>For Scroll down:</p>\n\n<pre><code>WebDriver driver = new ChromeDriver();\nJavascriptExecutor jse = (JavascriptExecutor)driver;\njse.executeScript(\"window.scrollBy(0,250)\", \"\");\n</code></pre>\n\n<p>OR,also</p>\n\n<pre><code>jse.executeScript(\"scroll(0, 250);\");\n</code></pre>\n\n<p>For Scroll up:</p>\n\n<pre><code>jse.executeScript(\"window.scrollBy(0,-250)\", \"\");\n</code></pre>\n\n<p>OR,</p>\n\n<pre><code>jse.executeScript(\"scroll(0, -250);\");\n</code></pre>\n\n<p>Hope it will help you</p>\n"},{"tags":[],"owner":{"account_id":20299347,"reputation":1,"user_id":14889145,"display_name":"user14889145"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1608923791,"creation_date":1608923791,"answer_id":65451038,"question_id":34759376,"body_markdown":"I am not a specialist at all of java but I use chromedriver from vba and face the same problem. As I am not able to locate the webelements by XPATH / JSON, I use the source code of the page instead, senkeys tab until the webelement I search get the focus then this element becomes the ***activeelement*** so the ***scrollintoview*** on the element is accessible and I can refresh the source code of the page...\r\n","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>I am not a specialist at all of java but I use chromedriver from vba and face the same problem. As I am not able to locate the webelements by XPATH / JSON, I use the source code of the page instead, senkeys tab until the webelement I search get the focus then this element becomes the <em><strong>activeelement</strong></em> so the <em><strong>scrollintoview</strong></em> on the element is accessible and I can refresh the source code of the page...</p>\n"},{"tags":[],"owner":{"account_id":6792992,"reputation":166,"user_id":5229380,"display_name":"Unnati Solanki"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1609087977,"creation_date":1609087977,"answer_id":65468136,"question_id":34759376,"body_markdown":"If you are trying to click the element after scrolling then try below snippet. \r\n\r\n&gt; Actions action = new Actions(driver);\r\n&gt; \r\n&gt; action.moveToElement(element).click().perform();","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>If you are trying to click the element after scrolling then try below snippet.</p>\n<blockquote>\n<p>Actions action = new Actions(driver);</p>\n<p>action.moveToElement(element).click().perform();</p>\n</blockquote>\n"},{"tags":[],"owner":{"account_id":16209077,"reputation":389,"user_id":11703579,"display_name":"gbossa"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701097413,"creation_date":1701097413,"answer_id":77557906,"question_id":34759376,"body_markdown":"This is what worked for me.\r\n\r\n    Actions action = new Actions(driver);\r\n    action.sendKeys(Keys.PAGE_DOWN).perform();","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>This is what worked for me.</p>\n<pre><code>Actions action = new Actions(driver);\naction.sendKeys(Keys.PAGE_DOWN).perform();\n</code></pre>\n"}],"owner":{"account_id":5494975,"reputation":227,"user_id":4366433,"accept_rate":0,"display_name":"Tanmay"},"comment_count":7,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":31262,"favorite_count":0,"down_vote_count":0,"up_vote_count":7,"answer_count":8,"score":7,"last_activity_date":1701098383,"creation_date":1452664582,"question_id":34759376,"body_markdown":"I&#39;m trying to test scrolling functionality by selenium webdriver. Same is working in Firefox but not in chrome driver. Here is basic code I&#39;m using for scrolling.\r\n\r\n    Actions a = new Actions(driver);\r\n    WebElement el = driver.findElement(By.xpath(&quot;//*[@id=&#39;dsm-frame&#39;]&quot;));\r\n    a.moveToElement(el).clickAndHold().moveByOffset(0, 1000000).release().perform();\r\n\r\nIs there any specific reason that Action builder does not work in chrome? Kindly advise how it can be worked in Chrome driver.\r\n\r\nThanks","title":"Not able to scroll down in Chromedriver by selenium webdriver(Java)","body":"<p>I'm trying to test scrolling functionality by selenium webdriver. Same is working in Firefox but not in chrome driver. Here is basic code I'm using for scrolling.</p>\n\n<pre><code>Actions a = new Actions(driver);\nWebElement el = driver.findElement(By.xpath(\"//*[@id='dsm-frame']\"));\na.moveToElement(el).clickAndHold().moveByOffset(0, 1000000).release().perform();\n</code></pre>\n\n<p>Is there any specific reason that Action builder does not work in chrome? Kindly advise how it can be worked in Chrome driver.</p>\n\n<p>Thanks</p>\n"},{"tags":["java","docker","kubernetes","minikube"],"comments":[{"owner":{"account_id":2256817,"reputation":12199,"user_id":1987838,"accept_rate":100,"display_name":"Hackerman"},"score":0,"creation_date":1615668941,"post_id":66607112,"comment_id":117764813,"body_markdown":"Create another terminak tab and exceute the following command  `minikube tunnel`...then try to ping minikube","body":"Create another terminak tab and exceute the following command  <code>minikube tunnel</code>...then try to ping minikube"}],"answers":[{"comments":[{"owner":{"account_id":15982217,"reputation":61,"user_id":11533655,"display_name":"Mirosław Haręza"},"score":0,"creation_date":1615810032,"post_id":66621325,"comment_id":117797812,"body_markdown":"hagrawal, I tried to apply the workaround using command ```minikube service calendar-ui``` where calendar-ui is my service connected with pod - frontend application, but the only result I obtained was that popup browser window with message &#39;Not found, nginx/1.18.0&#39; and url &#39;127.0.0.1:55614&#39;. I was trying to access the app using &#39;127.0.0.1:55614/calendar&#39;, but with no success","body":"hagrawal, I tried to apply the workaround using command <code>minikube service calendar-ui</code> where calendar-ui is my service connected with pod - frontend application, but the only result I obtained was that popup browser window with message &#39;Not found, nginx/1.18.0&#39; and url &#39;127.0.0.1:55614&#39;. I was trying to access the app using &#39;127.0.0.1:55614/calendar&#39;, but with no success"},{"owner":{"account_id":5968065,"reputation":14213,"user_id":4691279,"accept_rate":58,"display_name":"hagrawal7777"},"score":0,"creation_date":1615816558,"post_id":66621325,"comment_id":117800933,"body_markdown":"@MirosławHaręza Don&#39;t access this in IE, access it in Chrome.. if still it doesn&#39;t work then make sure you don&#39;t have any client proxy.","body":"@MirosławHaręza Don&#39;t access this in IE, access it in Chrome.. if still it doesn&#39;t work then make sure you don&#39;t have any client proxy."},{"owner":{"account_id":15982217,"reputation":61,"user_id":11533655,"display_name":"Mirosław Haręza"},"score":0,"creation_date":1615901997,"post_id":66621325,"comment_id":117831251,"body_markdown":"I&#39;ve accessed it in Firefox","body":"I&#39;ve accessed it in Firefox"},{"owner":{"account_id":10249553,"reputation":371,"user_id":9813932,"display_name":"Arximede"},"score":2,"creation_date":1633452184,"post_id":66621325,"comment_id":122761585,"body_markdown":"`minikube service &lt;&lt;name&gt;&gt;`  worked for me! thank you. this should be accepted as correct answer","body":"<code>minikube service &lt;&lt;name&gt;&gt;</code>  worked for me! thank you. this should be accepted as correct answer"},{"owner":{"account_id":3322011,"reputation":3158,"user_id":9263418,"display_name":"Anonymous Creator"},"score":0,"creation_date":1647769746,"post_id":66621325,"comment_id":126450167,"body_markdown":"I am unable to do this on windows 11 somehow. Minikube service service name gets timedout.","body":"I am unable to do this on windows 11 somehow. Minikube service service name gets timedout."}],"tags":[],"owner":{"account_id":5968065,"reputation":14213,"user_id":4691279,"accept_rate":58,"display_name":"hagrawal7777"},"comment_count":5,"down_vote_count":0,"up_vote_count":11,"is_accepted":false,"score":11,"last_activity_date":1615699074,"creation_date":1615699074,"answer_id":66621325,"question_id":66607112,"body_markdown":"Recall that minikube is local Kubernetes - it runs a single-node Kubernetes cluster on your personal computer so that you can try out Kubernetes. Now, it doesn&#39;t run the Kubernetes cluster in your local box, it runs it inside a VM.\r\n\r\nThat is why you can&#39;t simply access Node IP from your local. Another way to see it is that in Kubernetes you can create NodePort Service to access your workload outside of your cluster but this doesn&#39;t work when you are running Kubernetes using minikube - and the reason is the same as mentioned above. \r\n\r\nNow, how you work around that is by using `minikube service &lt;&lt;YOUR_SERVICE_NAME&gt;&gt;` command.  This will create a tunnel to access your application - which is exposed using the Service - from outside of the K8S cluster.\r\n\r\n\r\n\r\n----------\r\n\r\nYou can try `minikube tunnel` as mentioned by @Hackerman but I have never tried it.","title":"minikube on WSL2 (windows 10) - minikube ip not reachable","body":"<p>Recall that minikube is local Kubernetes - it runs a single-node Kubernetes cluster on your personal computer so that you can try out Kubernetes. Now, it doesn't run the Kubernetes cluster in your local box, it runs it inside a VM.</p>\n<p>That is why you can't simply access Node IP from your local. Another way to see it is that in Kubernetes you can create NodePort Service to access your workload outside of your cluster but this doesn't work when you are running Kubernetes using minikube - and the reason is the same as mentioned above.</p>\n<p>Now, how you work around that is by using <code>minikube service &lt;&lt;YOUR_SERVICE_NAME&gt;&gt;</code> command.  This will create a tunnel to access your application - which is exposed using the Service - from outside of the K8S cluster.</p>\n<hr />\n<p>You can try <code>minikube tunnel</code> as mentioned by @Hackerman but I have never tried it.</p>\n"},{"comments":[{"owner":{"account_id":15982217,"reputation":61,"user_id":11533655,"display_name":"Mirosław Haręza"},"score":1,"creation_date":1615808144,"post_id":66634409,"comment_id":117796989,"body_markdown":"I&#39;ve executed this ```minikube tunnel``` command to running instance of minikube and it didn&#39;t help. I tried to run both app on minikube ip (192.168.49.2) as on localhost. Pinging doesn&#39;t work either. You wrote that tunneling exposes external ip and in my case there is internal ip which is not reachable, I suspect (but I&#39;m not sure, I&#39;m new in this subject). I tried also run this addon but timeout occurs when I run it.","body":"I&#39;ve executed this <code>minikube tunnel</code> command to running instance of minikube and it didn&#39;t help. I tried to run both app on minikube ip (192.168.49.2) as on localhost. Pinging doesn&#39;t work either. You wrote that tunneling exposes external ip and in my case there is internal ip which is not reachable, I suspect (but I&#39;m not sure, I&#39;m new in this subject). I tried also run this addon but timeout occurs when I run it."}],"tags":[],"owner":{"account_id":16854443,"reputation":6417,"user_id":12186585,"display_name":"acid_fuji"},"comment_count":1,"down_vote_count":0,"up_vote_count":4,"is_accepted":false,"score":4,"last_activity_date":1615796117,"creation_date":1615796117,"answer_id":66634409,"question_id":66607112,"body_markdown":"Just to add a bit on top of the previous answer. There is docker bridge limitation that makes it impossible to [route the traffic to Linux containers](https://docs.docker.com/docker-for-windows/networking/#i-cannot-ping-my-containers).  That is why the minikube tunnel and service were implemented as workaround for that. \r\n\r\n&gt; `minikube tunnel` runs as a process, creating a network route on the\r\n&gt; host to the service CIDR of the cluster using the cluster’s IP address\r\n&gt; as a gateway. The tunnel command exposes the external IP directly to\r\n&gt; any program running on the host operating system.\r\n\r\nAlternative way to that you may find interesting would be using an ingress which was enabled in [#9761](https://github.com/kubernetes/minikube/pull/9761) pull request: \r\n\r\n```bash \r\n.\\minikube-windows-amd64.exe addons enable ingress                                                                                           I1121 00:59:39.443965    3000 translate.go:89] Failed to load translation file for en: Asset translations/en.json not found\r\n* After the addon is enabled, please run &quot;minikube tunnel&quot; and your ingress resources would be available at &quot;127.0.0.1&quot;\r\n* Verifying ingress addon...\r\n* The &#39;ingress&#39; addon is enabled\r\n```\r\n","title":"minikube on WSL2 (windows 10) - minikube ip not reachable","body":"<p>Just to add a bit on top of the previous answer. There is docker bridge limitation that makes it impossible to <a href=\"https://docs.docker.com/docker-for-windows/networking/#i-cannot-ping-my-containers\" rel=\"nofollow noreferrer\">route the traffic to Linux containers</a>.  That is why the minikube tunnel and service were implemented as workaround for that.</p>\n<blockquote>\n<p><code>minikube tunnel</code> runs as a process, creating a network route on the\nhost to the service CIDR of the cluster using the cluster’s IP address\nas a gateway. The tunnel command exposes the external IP directly to\nany program running on the host operating system.</p>\n</blockquote>\n<p>Alternative way to that you may find interesting would be using an ingress which was enabled in <a href=\"https://github.com/kubernetes/minikube/pull/9761\" rel=\"nofollow noreferrer\">#9761</a> pull request:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>.\\minikube-windows-amd64.exe addons enable ingress                                                                                           I1121 00:59:39.443965    3000 translate.go:89] Failed to load translation file for en: Asset translations/en.json not found\n* After the addon is enabled, please run &quot;minikube tunnel&quot; and your ingress resources would be available at &quot;127.0.0.1&quot;\n* Verifying ingress addon...\n* The 'ingress' addon is enabled\n</code></pre>\n"},{"tags":[],"owner":{"account_id":9091772,"reputation":585,"user_id":7539092,"display_name":"SteveSims"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1629155916,"creation_date":1629155572,"answer_id":68810071,"question_id":66607112,"body_markdown":"On your windows system, after the creation of the container that is created by the initial &quot;minikube start&quot;, you can see the &quot;minikube instance&quot; by typing &quot;docker ps&quot;.   This is the minikube &#39;master&#39; node running in this container.\r\n\r\nIt would look something like this:\r\n\r\n    CONTAINER ID   IMAGE                                 COMMAND                  CREATED       STATUS             PORTS                                                                                                                                  NAMES\r\n    6293ca0ba5b0   gcr.io/k8s-minikube/kicbase:v0.0.25   &quot;/usr/local/bin/entr…&quot;   2 hours ago   Up About an hour   127.0.0.1:59539-&gt;22/tcp, 127.0.0.1:59540-&gt;2376/tcp, 127.0.0.1:59537-&gt;5000/tcp, 127.0.0.1:59538-&gt;8443/tcp, 127.0.0.1:59536-&gt;32443/tcp   minikube\r\n\r\nIn the PORTS column you will see ports that are forwarded by virtue of the way that minikube start the docker container.  You can see these kinds of forwards are handled by docker the same as for any contain that you might do a &quot;docker run -p port:port&quot;\r\n\r\nNotice that the first port forward in this list is the ssh port: &quot;127.0.0.1:59539-&gt;22/tcp&quot;.\r\n\r\nWhen you do a &quot;minikube tunnel&quot;, minikube will open ssh.exe instances that you can see in your windows task manager if you enable the Command Line display in the column settings.\r\n\r\nThose &#39;tunnels&#39; would look like this:\r\n\r\n    ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -N docker@127.0.0.1 -p 59539 -i C:\\Users\\steve.sims\\.minikube\\machines\\minikube\\id_rsa &quot;-L 8080:10.102.174.166:8080&quot;\r\n\r\nIf I take that command apart and only run this from the command prompt:\r\n\r\n    ssh docker@127.0.0.1 -p 59539 -i C:\\users\\steve.sims\\.minikube\\machines\\minikube\\id_rsa\r\n\r\nThen I get an interactive remote window into the minikube VM (or node).  Typing &#39;ifconfig eth0&#39; I get:\r\n\r\n    eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\r\n            inet 192.168.49.2  netmask 255.255.255.0  broadcast 192.168.49.255\r\n\r\nSo, indeed my minikube ip _is_ 192.168.49.2, but it is an internal address as the folks above mentioned.\r\n\r\nOther than that, the -N parameter on the ssh means &quot;no command&quot; and the -L on the end is the port forward flag in port-to-forward:destination-socket format.  Of course, so all of the tunnels are coming across that initial docker -p port:port forward that minikube established when the container was started.\r\n\r\nIf it is useful, you can create your own ssh instances from that line&#39;s format by script and they will work just as well.\r\n\r\n","title":"minikube on WSL2 (windows 10) - minikube ip not reachable","body":"<p>On your windows system, after the creation of the container that is created by the initial &quot;minikube start&quot;, you can see the &quot;minikube instance&quot; by typing &quot;docker ps&quot;.   This is the minikube 'master' node running in this container.</p>\n<p>It would look something like this:</p>\n<pre><code>CONTAINER ID   IMAGE                                 COMMAND                  CREATED       STATUS             PORTS                                                                                                                                  NAMES\n6293ca0ba5b0   gcr.io/k8s-minikube/kicbase:v0.0.25   &quot;/usr/local/bin/entr…&quot;   2 hours ago   Up About an hour   127.0.0.1:59539-&gt;22/tcp, 127.0.0.1:59540-&gt;2376/tcp, 127.0.0.1:59537-&gt;5000/tcp, 127.0.0.1:59538-&gt;8443/tcp, 127.0.0.1:59536-&gt;32443/tcp   minikube\n</code></pre>\n<p>In the PORTS column you will see ports that are forwarded by virtue of the way that minikube start the docker container.  You can see these kinds of forwards are handled by docker the same as for any contain that you might do a &quot;docker run -p port:port&quot;</p>\n<p>Notice that the first port forward in this list is the ssh port: &quot;127.0.0.1:59539-&gt;22/tcp&quot;.</p>\n<p>When you do a &quot;minikube tunnel&quot;, minikube will open ssh.exe instances that you can see in your windows task manager if you enable the Command Line display in the column settings.</p>\n<p>Those 'tunnels' would look like this:</p>\n<pre><code>ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -N docker@127.0.0.1 -p 59539 -i C:\\Users\\steve.sims\\.minikube\\machines\\minikube\\id_rsa &quot;-L 8080:10.102.174.166:8080&quot;\n</code></pre>\n<p>If I take that command apart and only run this from the command prompt:</p>\n<pre><code>ssh docker@127.0.0.1 -p 59539 -i C:\\users\\steve.sims\\.minikube\\machines\\minikube\\id_rsa\n</code></pre>\n<p>Then I get an interactive remote window into the minikube VM (or node).  Typing 'ifconfig eth0' I get:</p>\n<pre><code>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.49.2  netmask 255.255.255.0  broadcast 192.168.49.255\n</code></pre>\n<p>So, indeed my minikube ip <em>is</em> 192.168.49.2, but it is an internal address as the folks above mentioned.</p>\n<p>Other than that, the -N parameter on the ssh means &quot;no command&quot; and the -L on the end is the port forward flag in port-to-forward:destination-socket format.  Of course, so all of the tunnels are coming across that initial docker -p port:port forward that minikube established when the container was started.</p>\n<p>If it is useful, you can create your own ssh instances from that line's format by script and they will work just as well.</p>\n"},{"tags":[],"owner":{"account_id":3573563,"reputation":837,"user_id":2983359,"accept_rate":40,"display_name":"bizimunda"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1686817409,"creation_date":1686817409,"answer_id":76480507,"question_id":66607112,"body_markdown":"**Solution is to run by the name of your service**\r\n\r\n    minikube service &lt;&lt;*your_service_name*&gt;&gt; \r\nhas worked for me as well. And this is the same solution I have seen on the minikube&#39;s official website. They have given an example of how to create a service. And if you want to expose that service then you have run the same command as above.\r\n\r\n[![enter image description here][1]][1]\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/VNIYl.png","title":"minikube on WSL2 (windows 10) - minikube ip not reachable","body":"<p><strong>Solution is to run by the name of your service</strong></p>\n<pre><code>minikube service &lt;&lt;*your_service_name*&gt;&gt; \n</code></pre>\n<p>has worked for me as well. And this is the same solution I have seen on the minikube's official website. They have given an example of how to create a service. And if you want to expose that service then you have run the same command as above.</p>\n<p><a href=\"https://i.stack.imgur.com/VNIYl.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/VNIYl.png\" alt=\"enter image description here\" /></a></p>\n"},{"tags":[],"owner":{"account_id":49726,"reputation":1669,"user_id":148203,"accept_rate":88,"display_name":"Hossein"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701098303,"creation_date":1701098303,"answer_id":77558015,"question_id":66607112,"body_markdown":"Run this command:\r\n\r\n    minikube service --all\r\n\r\nThis is a sample output:\r\n\r\n    |-----------|------------|-------------|--------------|\r\n    | NAMESPACE |    NAME    | TARGET PORT |     URL      |\r\n    |-----------|------------|-------------|--------------|\r\n    | default   | kubernetes |             | No node port |\r\n    |-----------|------------|-------------|--------------|\r\n    &#128575;  service default/kubernetes has no node port\r\n    |-----------|---------------|-------------|--------------|\r\n    | NAMESPACE |     NAME      | TARGET PORT |     URL      |\r\n    |-----------|---------------|-------------|--------------|\r\n    | default   | mongo-service |             | No node port |\r\n    |-----------|---------------|-------------|--------------|\r\n    &#128575;  service default/mongo-service has no node port\r\n    |-----------|----------------|-------------|---------------------------|\r\n    | NAMESPACE |      NAME      | TARGET PORT |            URL            |\r\n    |-----------|----------------|-------------|---------------------------|\r\n    | default   | webapp-service |        3000 | http://192.168.49.2:30100 |\r\n    |-----------|----------------|-------------|---------------------------|\r\n    &#127939;  Starting tunnel for service kubernetes.\r\n    &#127939;  Starting tunnel for service mongo-service.\r\n    &#127939;  Starting tunnel for service webapp-service.\r\n    |-----------|----------------|-------------|------------------------|\r\n    | NAMESPACE |      NAME      | TARGET PORT |          URL           |\r\n    |-----------|----------------|-------------|------------------------|\r\n    | default   | kubernetes     |             | http://127.0.0.1:34355 |\r\n    | default   | mongo-service  |             | http://127.0.0.1:43027 |\r\n    | default   | webapp-service |             | http://127.0.0.1:45361 |\r\n    |-----------|----------------|-------------|------------------------|\r\n    &#127881;  Opening service default/kubernetes in default browser...\r\n    &#128073;  http://127.0.0.1:34355\r\n    &#127881;  Opening service default/mongo-service in default browser...\r\n    &#128073;  http://127.0.0.1:43027\r\n    &#127881;  Opening service default/webapp-service in default browser...\r\n    &#128073;  http://127.0.0.1:45361\r\n    ❗  Because you are using a Docker driver on linux, the terminal needs to be open to run it.\r\n\r\nAnd at the end you can see list of ip/ports that you can access from Windows. For example, I can open my &quot;default/webapp-service&quot; service using &quot;http://127.0.0.1:45361&quot;. It will go throught the tunnel made by minikube. No extra configuration is needed.\r\n\r\n\r\nAnd here is the command documentation and details:\r\n\r\n    Returns the Kubernetes URL(s) for service(s) in your local cluster. In the case\r\n    of multiple URLs they will be printed one at a time.\r\n    \r\n    Available Commands:\r\n      list          Lists the URLs for the services in your local cluster\r\n    \r\n    Options:\r\n        --all=false:\r\n            Forwards all services in a namespace (defaults to &quot;false&quot;)\r\n    \r\n        --https=false:\r\n            Open the service URL with https instead of http (defaults to &quot;false&quot;)\r\n    \r\n        --interval=1:\r\n            The initial time interval for each check that wait performs in seconds\r\n    \r\n        -n, --namespace=&#39;default&#39;:\r\n            The service namespace\r\n    \r\n        --url=false:\r\n            Display the Kubernetes service URL in the CLI instead of opening it in\r\n            the default browser\r\n    \r\n        --wait=2:\r\n            Amount of time to wait for a service in seconds\r\n    \r\n    Usage:\r\n      minikube service [flags] SERVICE [options]\r\n    \r\n    Use &quot;minikube service &lt;command&gt; --help&quot; for more information about a given\r\n    command.\r\n    Use &quot;minikube options&quot; for a list of global command-line options (applies to all\r\n    commands).\r\n\r\n","title":"minikube on WSL2 (windows 10) - minikube ip not reachable","body":"<p>Run this command:</p>\n<pre><code>minikube service --all\n</code></pre>\n<p>This is a sample output:</p>\n<pre><code>|-----------|------------|-------------|--------------|\n| NAMESPACE |    NAME    | TARGET PORT |     URL      |\n|-----------|------------|-------------|--------------|\n| default   | kubernetes |             | No node port |\n|-----------|------------|-------------|--------------|\n😿  service default/kubernetes has no node port\n|-----------|---------------|-------------|--------------|\n| NAMESPACE |     NAME      | TARGET PORT |     URL      |\n|-----------|---------------|-------------|--------------|\n| default   | mongo-service |             | No node port |\n|-----------|---------------|-------------|--------------|\n😿  service default/mongo-service has no node port\n|-----------|----------------|-------------|---------------------------|\n| NAMESPACE |      NAME      | TARGET PORT |            URL            |\n|-----------|----------------|-------------|---------------------------|\n| default   | webapp-service |        3000 | http://192.168.49.2:30100 |\n|-----------|----------------|-------------|---------------------------|\n🏃  Starting tunnel for service kubernetes.\n🏃  Starting tunnel for service mongo-service.\n🏃  Starting tunnel for service webapp-service.\n|-----------|----------------|-------------|------------------------|\n| NAMESPACE |      NAME      | TARGET PORT |          URL           |\n|-----------|----------------|-------------|------------------------|\n| default   | kubernetes     |             | http://127.0.0.1:34355 |\n| default   | mongo-service  |             | http://127.0.0.1:43027 |\n| default   | webapp-service |             | http://127.0.0.1:45361 |\n|-----------|----------------|-------------|------------------------|\n🎉  Opening service default/kubernetes in default browser...\n👉  http://127.0.0.1:34355\n🎉  Opening service default/mongo-service in default browser...\n👉  http://127.0.0.1:43027\n🎉  Opening service default/webapp-service in default browser...\n👉  http://127.0.0.1:45361\n❗  Because you are using a Docker driver on linux, the terminal needs to be open to run it.\n</code></pre>\n<p>And at the end you can see list of ip/ports that you can access from Windows. For example, I can open my &quot;default/webapp-service&quot; service using &quot;http://127.0.0.1:45361&quot;. It will go throught the tunnel made by minikube. No extra configuration is needed.</p>\n<p>And here is the command documentation and details:</p>\n<pre><code>Returns the Kubernetes URL(s) for service(s) in your local cluster. In the case\nof multiple URLs they will be printed one at a time.\n\nAvailable Commands:\n  list          Lists the URLs for the services in your local cluster\n\nOptions:\n    --all=false:\n        Forwards all services in a namespace (defaults to &quot;false&quot;)\n\n    --https=false:\n        Open the service URL with https instead of http (defaults to &quot;false&quot;)\n\n    --interval=1:\n        The initial time interval for each check that wait performs in seconds\n\n    -n, --namespace='default':\n        The service namespace\n\n    --url=false:\n        Display the Kubernetes service URL in the CLI instead of opening it in\n        the default browser\n\n    --wait=2:\n        Amount of time to wait for a service in seconds\n\nUsage:\n  minikube service [flags] SERVICE [options]\n\nUse &quot;minikube service &lt;command&gt; --help&quot; for more information about a given\ncommand.\nUse &quot;minikube options&quot; for a list of global command-line options (applies to all\ncommands).\n</code></pre>\n"}],"owner":{"account_id":15982217,"reputation":61,"user_id":11533655,"display_name":"Mirosław Haręza"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":9301,"favorite_count":0,"down_vote_count":0,"up_vote_count":6,"answer_count":5,"score":6,"last_activity_date":1701098303,"creation_date":1615582611,"question_id":66607112,"body_markdown":"I&#39;ve installed the minikube instance on my local computer (--driver=docker). The minikube ip is 192.168.49.2. When I start minikube (minikube start --memory 7168) I get no errors on console. But trying to ping the minikube ip fails. What I do wrong?\r\n```\r\n$ kubectl get nodes -o wide\r\nNAME       STATUS   ROLES                  AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION                   CONTAINER-RUNTIME\r\nminikube   Ready    control-plane,master   9d    v1.20.2   192.168.49.2   &lt;none&gt;        Ubuntu 20.04.1 LTS   5.4.72-microsoft-standard-WSL2   docker://20.10.3\r\n```\r\n","title":"minikube on WSL2 (windows 10) - minikube ip not reachable","body":"<p>I've installed the minikube instance on my local computer (--driver=docker). The minikube ip is 192.168.49.2. When I start minikube (minikube start --memory 7168) I get no errors on console. But trying to ping the minikube ip fails. What I do wrong?</p>\n<pre><code>$ kubectl get nodes -o wide\nNAME       STATUS   ROLES                  AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION                   CONTAINER-RUNTIME\nminikube   Ready    control-plane,master   9d    v1.20.2   192.168.49.2   &lt;none&gt;        Ubuntu 20.04.1 LTS   5.4.72-microsoft-standard-WSL2   docker://20.10.3\n</code></pre>\n"},{"tags":["java","spring","spring-security","security-context"],"comments":[{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":1,"creation_date":1701098519,"post_id":77541213,"comment_id":136729684,"body_markdown":"Why are you writing this yourself? There is cors support in Spring Security / Spring MVC. Your `SessionFilter` seems like to interfere with Spring Session and I don&#39;t get your authentication provider. Feels like you are trying to work around the frameworks you are using.","body":"Why are you writing this yourself? There is cors support in Spring Security / Spring MVC. Your <code>SessionFilter</code> seems like to interfere with Spring Session and I don&#39;t get your authentication provider. Feels like you are trying to work around the frameworks you are using."},{"owner":{"account_id":29977679,"reputation":1,"user_id":22973488,"display_name":"Sugali Yougender"},"score":0,"creation_date":1701100220,"post_id":77541213,"comment_id":136730103,"body_markdown":"can you please add the correct code for session filter and cors support. Also for security context for springboot. I also have one question that, in springboot should i use UserDetailsService interface of springboot or my custom user entity is enough??","body":"can you please add the correct code for session filter and cors support. Also for security context for springboot. I also have one question that, in springboot should i use UserDetailsService interface of springboot or my custom user entity is enough??"},{"owner":{"account_id":2064278,"reputation":13138,"user_id":1840146,"accept_rate":86,"display_name":"Toerktumlare"},"score":0,"creation_date":1701103370,"post_id":77541213,"comment_id":136730751,"body_markdown":"can i ask why you havnt read the documentation before asking here?","body":"can i ask why you havnt read the documentation before asking here?"},{"owner":{"account_id":29977679,"reputation":1,"user_id":22973488,"display_name":"Sugali Yougender"},"score":0,"creation_date":1701104040,"post_id":77541213,"comment_id":136730881,"body_markdown":"I have read and implemented but it seems not working. can you suggest why my authentication information is not getting stored in security context for other pages after login??","body":"I have read and implemented but it seems not working. can you suggest why my authentication information is not getting stored in security context for other pages after login??"},{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":0,"creation_date":1701157686,"post_id":77541213,"comment_id":136737246,"body_markdown":"You don&#39;t need to implement anything, cors support is build into Spring Security as well as Spring MVC. Your session filter is something that is already being handled by Spring Session itself. Why you chose to implement them yourself defeats me, the same for the authentication provider. You should just implement a `UserDetailsService` and use that (or just provide the queries to Spring Security to map your data to the Sring Security user).","body":"You don&#39;t need to implement anything, cors support is build into Spring Security as well as Spring MVC. Your session filter is something that is already being handled by Spring Session itself. Why you chose to implement them yourself defeats me, the same for the authentication provider. You should just implement a <code>UserDetailsService</code> and use that (or just provide the queries to Spring Security to map your data to the Sring Security user)."},{"owner":{"account_id":29977679,"reputation":1,"user_id":22973488,"display_name":"Sugali Yougender"},"score":0,"creation_date":1701182021,"post_id":77541213,"comment_id":136741681,"body_markdown":"@M.Deinum so is it mandatory to implement UserDetailsService of spring security?? without implementing it we can&#39;t authenticate or authorize user??","body":"@M.Deinum so is it mandatory to implement UserDetailsService of spring security?? without implementing it we can&#39;t authenticate or authorize user??"},{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":0,"creation_date":1701182757,"post_id":77541213,"comment_id":136741860,"body_markdown":"You don&#39;t need to implement it you can provide queries if they come from a database. You could also use an `AuthenticationProvider` but yours doesn&#39;t make sense, nor does it add anything to the regular one if you would wrap your `CustomerRepository` with a `UserDetailsService`.","body":"You don&#39;t need to implement it you can provide queries if they come from a database. You could also use an <code>AuthenticationProvider</code> but yours doesn&#39;t make sense, nor does it add anything to the regular one if you would wrap your <code>CustomerRepository</code> with a <code>UserDetailsService</code>."},{"owner":{"account_id":29977679,"reputation":1,"user_id":22973488,"display_name":"Sugali Yougender"},"score":0,"creation_date":1701183957,"post_id":77541213,"comment_id":136742106,"body_markdown":"I don&#39;t understant you @M.Deinum. can you provide any example code if possible please","body":"I don&#39;t understant you @M.Deinum. can you provide any example code if possible please"},{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":0,"creation_date":1701184126,"post_id":77541213,"comment_id":136742133,"body_markdown":"What is it you don&#39;t understand? Ditch the code you have, create a `UserDetailsService` that uses your `CustomerREpository` to retrieve the user and that is it. Spring Security will do all the other things (password checks, user validation etc. etc.). What you are doing and writing is already provided by all the other frameworks and libraries you are using, you are working around them by your implementations of the filters, authentication providers etc.","body":"What is it you don&#39;t understand? Ditch the code you have, create a <code>UserDetailsService</code> that uses your <code>CustomerREpository</code> to retrieve the user and that is it. Spring Security will do all the other things (password checks, user validation etc. etc.). What you are doing and writing is already provided by all the other frameworks and libraries you are using, you are working around them by your implementations of the filters, authentication providers etc."},{"owner":{"account_id":29977679,"reputation":1,"user_id":22973488,"display_name":"Sugali Yougender"},"score":0,"creation_date":1701230527,"post_id":77541213,"comment_id":136748765,"body_markdown":"Can you please provide any link for the same","body":"Can you please provide any link for the same"}],"owner":{"account_id":29977679,"reputation":1,"user_id":22973488,"display_name":"Sugali Yougender"},"comment_count":10,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":49,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"answer_count":0,"score":-1,"last_activity_date":1701098301,"creation_date":1700808793,"question_id":77541213,"body_markdown":"I am not able to set the authentication information in security context for whole application.but I am able to do it in /login page but after login when I access other pages it is giving me null. Why? What is this behaviour.please help me. I am stuck in this issue.\r\nPlease find below code for reference \r\n\r\n```\r\n@Component\r\n@Order(Ordered.HIGHEST_PRECEDENCE+2) \r\npublic class CorsFilter implements Filter{\r\n\t\r\n\t@Autowired\r\n\tprivate LoginAuthenticationProvider loginAuthenticationProvider;\r\n\t\r\n\t@Override\r\n\tpublic void doFilter(ServletRequest req,ServletResponse res, FilterChain chain) throws IOException,ServletException{\r\n\t\tfinal HttpServletRequest request = (HttpServletRequest) req;\r\n\t\tfinal HttpServletResponse response = (HttpServletResponse) res;\r\n \r\n\t\tresponse.addHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);\r\n\t\tresponse.addHeader(&quot;Access-Control-Allow-Methods&quot;,&quot;GET,POST,PUT,DELETE,OPTIONS&quot;);\r\n\t\tresponse.addHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;Authorization,Content-Type,CustomerID&quot;);\r\n\t\tresponse.addHeader(&quot;Access-Control-Max-Age&quot;, &quot;3600&quot;);\r\n \r\n\t\tif(&quot;OPTIONS&quot;.equalsIgnoreCase(((HttpServletRequest)req).getMethod()))\r\n\t\t\tresponse.setStatus(HttpServletResponse.SC_OK);\r\n\t\telse\r\n\t\t  chain.doFilter(req, res);\r\n\t}\r\n\r\n}\r\n```\r\n\r\nBelow is my session filter\r\n\r\n```\r\n@Component\r\n@Order(Ordered.HIGHEST_PRECEDENCE+1)\r\npublic class SessionFilter implements Filter {\r\n\t\r\n\tprivate final Logger logger = LoggerFactory.getLogger(&quot;sessionFilterLogger&quot;);\r\n\tprivate boolean isCookiePresent = false;\r\n\tprivate String cookie = &quot;&quot;;\r\n\tprivate final long SESSION_TIMEOUT = 30*60*1000;\r\n\t\r\n\t\r\n\t@Autowired\r\n\tprivate UserSessionRepository sessionRepository;\r\n\r\n\t@Override\r\n\tpublic void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\r\n\t\t\tthrows IOException, ServletException {\r\n \r\n\t\tHttpServletRequest httpRequest = (HttpServletRequest) request;\r\n\t\tHttpServletResponse httpResponse = (HttpServletResponse) response;\r\n \r\n\t\tCookie[] cookies = httpRequest.getCookies();\r\n\t\tif(cookies==null) {\r\n\t\t\tlogger.debug(request.toString());\r\n\t\t\tchain.doFilter(request,response);\r\n\t\t\treturn;\r\n\t\t}\r\n \r\n\t\telse {\r\n\t\t\tfor(Cookie cookie:cookies) {\r\n\t\t\t\tif(cookie.getName().equals(&quot;username_session&quot;)) {\r\n\t\t\t\t\tthis.isCookiePresent = true;\r\n\t\t\t\t\tthis.cookie = cookie.getValue();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\r\n \r\n\t\tif(this.isCookiePresent &amp;&amp; this.cookie!=null &amp;&amp; !this.cookie.isEmpty()) {\r\n\t\t\tUserSession userSession = sessionRepository.findBySession(this.cookie).get();\r\n\t\t\tlong currentTime = System.currentTimeMillis();\r\n\t\t\tlong last_access_time = userSession.getLast_access_time().getTime();\r\n\t\t\tif(currentTime-last_access_time&gt;this.SESSION_TIMEOUT) {\r\n\t\t\t\thttpResponse.sendRedirect(&quot;/login&quot;);\r\n\t\t\t\treturn;\r\n\t\t\t}else {\r\n\t\t\t\tUserSession usersession = new UserSession();\r\n\t\t\t\tusersession.setLast_access_time(new Timestamp(currentTime));\r\n\t\t\t\tsessionRepository.save(usersession);\r\n\t\t\t}\r\n\t\t}else {\r\n\t\t\thttpResponse.sendRedirect(&quot;/login&quot;);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tchain.doFilter(request, response);\r\n \r\n\t}\r\n\r\n}\r\n```\r\n\r\nBelow is my custom login provider\r\n\r\n\r\n```\r\n@Component\r\npublic class LoginAuthenticationProvider implements AuthenticationProvider {\r\n\t\r\n\t@Autowired\r\n\tprivate CustomerRepository customerRepository;\r\n\t\r\n\t@Autowired PasswordConfig passwordEncoder;\r\n\r\n\t@Override\r\n\tpublic Authentication authenticate(Authentication authentication) throws AuthenticationException {\r\n \r\n\t\tfinal Logger logger = LoggerFactory.getLogger(&quot;authProvider&quot;);\r\n \r\n\t\tString username = authentication.getName();\r\n\t\tString password = authentication.getCredentials().toString();\r\n\t\tCustomer user = customerRepository.getByUsername(username);\r\n \r\n\t\tif(password==null || password.isBlank() || password.isEmpty()) {\r\n//\t\t\tBoolean isUserExist = customerRepository.existsByUsername(username);\r\n\t\t\treturn new UsernamePasswordAuthenticationToken(username,user.getPassword());\r\n\t\t}\r\n\r\n \r\n\t\tif(passwordEncoder.encoder().matches(password, user.getPassword())) {\r\n\t\t\treturn new UsernamePasswordAuthenticationToken(username, password);\r\n\t\t}else {\r\n\t\t\tthrow new BadCredentialsException(&quot;Bad Credentials&quot;);\r\n\t\t}\r\n\t}\r\n\r\n\t@Override\r\n\tpublic boolean supports(Class&lt;?&gt; authentication) {\r\n\t\treturn UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication);\r\n\t}\r\n\r\n}\r\n```\r\nthis is &quot;CustomerManagerImpl&quot; class where i am adding the logic to store setAuthentication is secuity context using custom login provider\r\n```\tSecurityContextHolder.setStrategyName(SecurityContextHolder.MODE_INHERITABLETHREADLOCAL);\r\nSecurityContext context = SecurityContextHolder.createEmptyContext();\r\n\r\nCollection&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();\r\nauthorities.add(new SimpleGrantedAuthority(&quot;ROLE_USER&quot;));\r\nAuthentication authenticationToken = new UsernamePasswordAuthenticationToken(data.getUsername(),&quot;&quot;,authorities);\r\ncontext.setAuthentication(authenticationToken);\r\nSecurityContextHolder.setContext(context);\r\n\r\nuserSessionManager.createSession(data.getUsername(),req);\r\nString sessionID = userSessionManager.getSession(data.getUsername());\r\n\r\nAuthentication getAuthentication = SecurityContextHolder.getContext().getAuthentication();\r\n\r\nCookie cookie = new Cookie(&quot;username_session&quot;,sessionID);\r\ncookie.setPath(&quot;/&quot;);\r\ncookie.setMaxAge(1800);\r\ncookie.setHttpOnly(true);\r\nres.addCookie(cookie);\r\n```\r\n\r\nNow tell me where I am wrong. Why am I not able to set the authentication information in security context for the whole application. also why am I not able to see the cookie for all subsequent requests. Should I add the logic in a filter to add cookie to each requests? if yes consider writing the code.\r\n\r\nI tried to add authentication in security context after logging in but after logging in it is not being added in security context. It is giving me null.","title":"authentication information in security context is null for other pages like /home","body":"<p>I am not able to set the authentication information in security context for whole application.but I am able to do it in /login page but after login when I access other pages it is giving me null. Why? What is this behaviour.please help me. I am stuck in this issue.\nPlease find below code for reference</p>\n<pre><code>@Component\n@Order(Ordered.HIGHEST_PRECEDENCE+2) \npublic class CorsFilter implements Filter{\n    \n    @Autowired\n    private LoginAuthenticationProvider loginAuthenticationProvider;\n    \n    @Override\n    public void doFilter(ServletRequest req,ServletResponse res, FilterChain chain) throws IOException,ServletException{\n        final HttpServletRequest request = (HttpServletRequest) req;\n        final HttpServletResponse response = (HttpServletResponse) res;\n \n        response.addHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);\n        response.addHeader(&quot;Access-Control-Allow-Methods&quot;,&quot;GET,POST,PUT,DELETE,OPTIONS&quot;);\n        response.addHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;Authorization,Content-Type,CustomerID&quot;);\n        response.addHeader(&quot;Access-Control-Max-Age&quot;, &quot;3600&quot;);\n \n        if(&quot;OPTIONS&quot;.equalsIgnoreCase(((HttpServletRequest)req).getMethod()))\n            response.setStatus(HttpServletResponse.SC_OK);\n        else\n          chain.doFilter(req, res);\n    }\n\n}\n</code></pre>\n<p>Below is my session filter</p>\n<pre><code>@Component\n@Order(Ordered.HIGHEST_PRECEDENCE+1)\npublic class SessionFilter implements Filter {\n    \n    private final Logger logger = LoggerFactory.getLogger(&quot;sessionFilterLogger&quot;);\n    private boolean isCookiePresent = false;\n    private String cookie = &quot;&quot;;\n    private final long SESSION_TIMEOUT = 30*60*1000;\n    \n    \n    @Autowired\n    private UserSessionRepository sessionRepository;\n\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n            throws IOException, ServletException {\n \n        HttpServletRequest httpRequest = (HttpServletRequest) request;\n        HttpServletResponse httpResponse = (HttpServletResponse) response;\n \n        Cookie[] cookies = httpRequest.getCookies();\n        if(cookies==null) {\n            logger.debug(request.toString());\n            chain.doFilter(request,response);\n            return;\n        }\n \n        else {\n            for(Cookie cookie:cookies) {\n                if(cookie.getName().equals(&quot;username_session&quot;)) {\n                    this.isCookiePresent = true;\n                    this.cookie = cookie.getValue();\n                    break;\n                }\n            }           \n        }\n\n \n        if(this.isCookiePresent &amp;&amp; this.cookie!=null &amp;&amp; !this.cookie.isEmpty()) {\n            UserSession userSession = sessionRepository.findBySession(this.cookie).get();\n            long currentTime = System.currentTimeMillis();\n            long last_access_time = userSession.getLast_access_time().getTime();\n            if(currentTime-last_access_time&gt;this.SESSION_TIMEOUT) {\n                httpResponse.sendRedirect(&quot;/login&quot;);\n                return;\n            }else {\n                UserSession usersession = new UserSession();\n                usersession.setLast_access_time(new Timestamp(currentTime));\n                sessionRepository.save(usersession);\n            }\n        }else {\n            httpResponse.sendRedirect(&quot;/login&quot;);\n            return;\n        }\n\n        chain.doFilter(request, response);\n \n    }\n\n}\n</code></pre>\n<p>Below is my custom login provider</p>\n<pre><code>@Component\npublic class LoginAuthenticationProvider implements AuthenticationProvider {\n    \n    @Autowired\n    private CustomerRepository customerRepository;\n    \n    @Autowired PasswordConfig passwordEncoder;\n\n    @Override\n    public Authentication authenticate(Authentication authentication) throws AuthenticationException {\n \n        final Logger logger = LoggerFactory.getLogger(&quot;authProvider&quot;);\n \n        String username = authentication.getName();\n        String password = authentication.getCredentials().toString();\n        Customer user = customerRepository.getByUsername(username);\n \n        if(password==null || password.isBlank() || password.isEmpty()) {\n//          Boolean isUserExist = customerRepository.existsByUsername(username);\n            return new UsernamePasswordAuthenticationToken(username,user.getPassword());\n        }\n\n \n        if(passwordEncoder.encoder().matches(password, user.getPassword())) {\n            return new UsernamePasswordAuthenticationToken(username, password);\n        }else {\n            throw new BadCredentialsException(&quot;Bad Credentials&quot;);\n        }\n    }\n\n    @Override\n    public boolean supports(Class&lt;?&gt; authentication) {\n        return UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication);\n    }\n\n}\n</code></pre>\n<p>this is &quot;CustomerManagerImpl&quot; class where i am adding the logic to store setAuthentication is secuity context using custom login provider</p>\n<pre><code>SecurityContext context = SecurityContextHolder.createEmptyContext();\n\nCollection&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();\nauthorities.add(new SimpleGrantedAuthority(&quot;ROLE_USER&quot;));\nAuthentication authenticationToken = new UsernamePasswordAuthenticationToken(data.getUsername(),&quot;&quot;,authorities);\ncontext.setAuthentication(authenticationToken);\nSecurityContextHolder.setContext(context);\n\nuserSessionManager.createSession(data.getUsername(),req);\nString sessionID = userSessionManager.getSession(data.getUsername());\n\nAuthentication getAuthentication = SecurityContextHolder.getContext().getAuthentication();\n\nCookie cookie = new Cookie(&quot;username_session&quot;,sessionID);\ncookie.setPath(&quot;/&quot;);\ncookie.setMaxAge(1800);\ncookie.setHttpOnly(true);\nres.addCookie(cookie);\n</code></pre>\n<p>Now tell me where I am wrong. Why am I not able to set the authentication information in security context for the whole application. also why am I not able to see the cookie for all subsequent requests. Should I add the logic in a filter to add cookie to each requests? if yes consider writing the code.</p>\n<p>I tried to add authentication in security context after logging in but after logging in it is not being added in security context. It is giving me null.</p>\n"},{"tags":["java","android","usb","usbserial"],"comments":[{"owner":{"account_id":50585,"reputation":39940,"user_id":150978,"accept_rate":78,"display_name":"Robert"},"score":0,"creation_date":1701097315,"post_id":77557031,"comment_id":136729377,"body_markdown":"I see where you send data to the device but where do you read the response?","body":"I see where you send data to the device but where do you read the response?"},{"owner":{"account_id":30002449,"reputation":1,"user_id":22992132,"display_name":"erbl"},"score":0,"creation_date":1701098813,"post_id":77557031,"comment_id":136729766,"body_markdown":"I have forgotten to add the method to read, it&#39;s added","body":"I have forgotten to add the method to read, it&#39;s added"}],"owner":{"account_id":30002449,"reputation":1,"user_id":22992132,"display_name":"erbl"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":55,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701098267,"creation_date":1701089399,"question_id":77557031,"body_markdown":"I use usb-serial-[for-android project ](https://github.com/mik3y/usb-serial-for-android) to communicate with a device pluged in USB\r\nI can detect the device, open the port and send data BUT data received is always the data I just sent before\r\n\r\nI Also update the manifest to detect when the usb device is pluged or unpluged and run the application to manage it.\r\n\r\nThere is the code I use. Am I missing something?\r\n\r\n```\r\nUsbManager manager = (UsbManager) getSystemService(Context.USB_SERVICE);\r\n    UsbSerialProber usbDefaultProber = UsbSerialProber.getDefaultProber();\r\n\r\n    HashMap&lt;String, UsbDevice&gt; deviceList = manager.getDeviceList();\r\n    if (deviceList.isEmpty()) {\r\n        Toast.makeText(this, &quot;Aucun ph&#233;riph&#233;rique USB detect&#233;&quot;, Toast.LENGTH_LONG).show();\r\n        infos.setText(&quot;Aucun ph&#233;riph&#233;rique USB detect&#233;&quot;);\r\n    }\r\n\r\n    for (UsbDevice device : deviceList.values()) {\r\n        Toast.makeText(this, &quot;Device detect&#233; =&quot; + device.getProductName(), Toast.LENGTH_LONG).show();\r\n        Toast.makeText(this, &quot;Device Vendor =&quot; + device.getVendorId() + &quot; Product Id = &quot; + device.getProductId(), Toast.LENGTH_LONG).show();\r\n        UsbSerialDriver driver = usbDefaultProber.probeDevice(device);\r\n        if (driver == null) {\r\n            ProbeTable customTable = new ProbeTable();\r\n            customTable.addProduct(device.getVendorId(), device.getProductId(), Cp21xxSerialDriver.class);\r\n            UsbSerialProber customProber = new UsbSerialProber(customTable);\r\n            driver = customProber.probeDevice(device);\r\n        }\r\n        if (driver != null) {\r\n            Context c = getApplicationContext();\r\n            PendingIntent pendingIntent;\r\n            Intent notificationIntent = new Intent();\r\n            if (android.os.Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {\r\n                pendingIntent = PendingIntent.getActivity(c,\r\n                        0, notificationIntent, PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_MUTABLE);\r\n\r\n            } else {\r\n                pendingIntent = PendingIntent.getActivity(c,\r\n                        0, notificationIntent, PendingIntent.FLAG_UPDATE_CURRENT);\r\n\r\n            }\r\n            while (!manager.hasPermission(device)) {\r\n                manager.requestPermission(device, pendingIntent);\r\n            }\r\n            UsbDeviceConnection connection = manager.openDevice(device);\r\n            if (connection == null) {\r\n                Toast.makeText(this, &quot;Connexion impossible&quot;, Toast.LENGTH_LONG).show();\r\n                return;\r\n            }\r\n            infos.setText(&quot;Envoi en cours...&quot;);\r\n            Thread.sleep(1000);\r\n            Toast.makeText(this, &quot;Envoi en cours...&quot;, Toast.LENGTH_LONG).show();\r\n            UsbSerialPort port = driver.getPorts().get(0); // Most devices have just one port (port 0)\r\n            port.open(connection);\r\n            port.setParameters(1200, 8, UsbSerialPort.STOPBITS_2, UsbSerialPort.PARITY_NONE);\r\n            request = new byte[port.getReadEndpoint().getMaxPacketSize()];\r\n            request[0] = hexIntToByte(0x80);\r\n            request[1] = hexIntToByte(0x3F);\r\n            request[2] = hexIntToByte(0x01);           \r\n            byte crcMSByte = hexIntToByte(0x05);\r\n            byte crcLSByte = hexIntToByte(0x8A);\r\n            request[3] = crcMSByte;//CRC MSByte\r\n            request[4] = crcLSByte;//CRC LSByte\r\n            request[5] = hexIntToByte(0x0D);//Stop Byte\r\n            SerialInputOutputManager usbIoManager = new SerialInputOutputManager(port, this);\r\n            usbIoManager.start();\r\n            port.write(request, 0);\r\n            String infosText;\r\n            infosText = &quot;Informations \\n&quot;;\r\n            infosText += &quot;Data envoy&#233;e = &quot; + byteArrayToHexString(request) + &quot;\\n&quot;;\r\n            infos.setText(infosText);\r\n\r\n        } else {\r\n            Toast.makeText(this, &quot;AUCUN Driver disponible&quot;, Toast.LENGTH_LONG).show();\r\n        }\r\n    }\r\n\r\n    spinner.setVisibility(View.GONE);\r\n    } catch (Exception e) {\r\n        String erreur = e.toString();\r\n        Toast.makeText(this, &quot;Erreur = &quot; + erreur, Toast.LENGTH_LONG).show();\r\n        String erreurText;\r\n        erreurText = &quot;ERREUR \\n&quot;;\r\n        erreurText += &quot;Data envoy&#233;e = &quot; + byteArrayToHexString(request) + &quot;\\n&quot;;\r\n        erreurText += &quot;Erreur Message = &quot; + erreur + &quot;\\n&quot;;\r\n        infos.setText(erreurText);\r\n        spinner.setVisibility(View.GONE);\r\n\r\n    }  \r\n```\r\nTo read the data I have another method below\r\n\r\n    @Override\r\n    public void onNewData(byte[] data) {\r\n        runOnUiThread(() -&gt; { infos.append(byteArrayToHexString(data)); });\r\n    }","title":"USB Serial For Android - Echo only","body":"<p>I use usb-serial-<a href=\"https://github.com/mik3y/usb-serial-for-android\" rel=\"nofollow noreferrer\">for-android project </a> to communicate with a device pluged in USB\nI can detect the device, open the port and send data BUT data received is always the data I just sent before</p>\n<p>I Also update the manifest to detect when the usb device is pluged or unpluged and run the application to manage it.</p>\n<p>There is the code I use. Am I missing something?</p>\n<pre><code>UsbManager manager = (UsbManager) getSystemService(Context.USB_SERVICE);\n    UsbSerialProber usbDefaultProber = UsbSerialProber.getDefaultProber();\n\n    HashMap&lt;String, UsbDevice&gt; deviceList = manager.getDeviceList();\n    if (deviceList.isEmpty()) {\n        Toast.makeText(this, &quot;Aucun phériphérique USB detecté&quot;, Toast.LENGTH_LONG).show();\n        infos.setText(&quot;Aucun phériphérique USB detecté&quot;);\n    }\n\n    for (UsbDevice device : deviceList.values()) {\n        Toast.makeText(this, &quot;Device detecté =&quot; + device.getProductName(), Toast.LENGTH_LONG).show();\n        Toast.makeText(this, &quot;Device Vendor =&quot; + device.getVendorId() + &quot; Product Id = &quot; + device.getProductId(), Toast.LENGTH_LONG).show();\n        UsbSerialDriver driver = usbDefaultProber.probeDevice(device);\n        if (driver == null) {\n            ProbeTable customTable = new ProbeTable();\n            customTable.addProduct(device.getVendorId(), device.getProductId(), Cp21xxSerialDriver.class);\n            UsbSerialProber customProber = new UsbSerialProber(customTable);\n            driver = customProber.probeDevice(device);\n        }\n        if (driver != null) {\n            Context c = getApplicationContext();\n            PendingIntent pendingIntent;\n            Intent notificationIntent = new Intent();\n            if (android.os.Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {\n                pendingIntent = PendingIntent.getActivity(c,\n                        0, notificationIntent, PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_MUTABLE);\n\n            } else {\n                pendingIntent = PendingIntent.getActivity(c,\n                        0, notificationIntent, PendingIntent.FLAG_UPDATE_CURRENT);\n\n            }\n            while (!manager.hasPermission(device)) {\n                manager.requestPermission(device, pendingIntent);\n            }\n            UsbDeviceConnection connection = manager.openDevice(device);\n            if (connection == null) {\n                Toast.makeText(this, &quot;Connexion impossible&quot;, Toast.LENGTH_LONG).show();\n                return;\n            }\n            infos.setText(&quot;Envoi en cours...&quot;);\n            Thread.sleep(1000);\n            Toast.makeText(this, &quot;Envoi en cours...&quot;, Toast.LENGTH_LONG).show();\n            UsbSerialPort port = driver.getPorts().get(0); // Most devices have just one port (port 0)\n            port.open(connection);\n            port.setParameters(1200, 8, UsbSerialPort.STOPBITS_2, UsbSerialPort.PARITY_NONE);\n            request = new byte[port.getReadEndpoint().getMaxPacketSize()];\n            request[0] = hexIntToByte(0x80);\n            request[1] = hexIntToByte(0x3F);\n            request[2] = hexIntToByte(0x01);           \n            byte crcMSByte = hexIntToByte(0x05);\n            byte crcLSByte = hexIntToByte(0x8A);\n            request[3] = crcMSByte;//CRC MSByte\n            request[4] = crcLSByte;//CRC LSByte\n            request[5] = hexIntToByte(0x0D);//Stop Byte\n            SerialInputOutputManager usbIoManager = new SerialInputOutputManager(port, this);\n            usbIoManager.start();\n            port.write(request, 0);\n            String infosText;\n            infosText = &quot;Informations \\n&quot;;\n            infosText += &quot;Data envoyée = &quot; + byteArrayToHexString(request) + &quot;\\n&quot;;\n            infos.setText(infosText);\n\n        } else {\n            Toast.makeText(this, &quot;AUCUN Driver disponible&quot;, Toast.LENGTH_LONG).show();\n        }\n    }\n\n    spinner.setVisibility(View.GONE);\n    } catch (Exception e) {\n        String erreur = e.toString();\n        Toast.makeText(this, &quot;Erreur = &quot; + erreur, Toast.LENGTH_LONG).show();\n        String erreurText;\n        erreurText = &quot;ERREUR \\n&quot;;\n        erreurText += &quot;Data envoyée = &quot; + byteArrayToHexString(request) + &quot;\\n&quot;;\n        erreurText += &quot;Erreur Message = &quot; + erreur + &quot;\\n&quot;;\n        infos.setText(erreurText);\n        spinner.setVisibility(View.GONE);\n\n    }  \n</code></pre>\n<p>To read the data I have another method below</p>\n<pre><code>@Override\npublic void onNewData(byte[] data) {\n    runOnUiThread(() -&gt; { infos.append(byteArrayToHexString(data)); });\n}\n</code></pre>\n"},{"tags":["java","encryption","cryptography","paillier"],"comments":[{"owner":{"account_id":79153,"reputation":513965,"user_id":224671,"accept_rate":67,"display_name":"kennytm"},"score":0,"creation_date":1485628317,"post_id":41913097,"comment_id":71007945,"body_markdown":"How do you transform the big integer to byte array and back?","body":"How do you transform the big integer to byte array and back?"},{"owner":{"account_id":9568676,"reputation":3,"user_id":7107076,"display_name":"LPepe"},"score":0,"creation_date":1485875233,"post_id":41913097,"comment_id":71100474,"body_markdown":"i was using something like this `BigInteger m1 = new BigInteger(data);` and `m1.toByteArray()` but i change it as Maarten Bodewes proposed in his answer so the biginteger will always be positive","body":"i was using something like this <code>BigInteger m1 = new BigInteger(data);</code> and <code>m1.toByteArray()</code> but i change it as Maarten Bodewes proposed in his answer so the biginteger will always be positive"}],"answers":[{"tags":[],"owner":{"account_id":288696,"reputation":91230,"user_id":589259,"accept_rate":82,"display_name":"Maarten Bodewes"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":true,"score":0,"last_activity_date":1485697648,"creation_date":1485645295,"answer_id":41915938,"question_id":41913097,"body_markdown":"No, you cannot use negative numbers as everything is computed modulo n.\r\n\r\nYes, you can use any array, as long as the value, when converted to a number, is a number smaller than n.\r\n\r\nFor this you can use `new BigInteger(1, plaintext)` which will always result in a positive number. The first parameter is the sign.\r\n\r\nYou may need an encoding for specific structures, e.g. with zero bit values for the most significant bits (message-&gt; encode-&gt; convert to number -&gt; Paillier encryption -&gt; encode ciphertext and decode ciphertext -&gt; Paillier decryption -&gt; decode -&gt; message).\r\n\r\nSee [I2OSP](https://www.rfc-editor.org/rfc/rfc3447#section-4.1) and OS2IP for an example on how to encode / decode data to numbers.","title":"Can pailler cryptosystem encrypt and decrypt negative big integers?","body":"<p>No, you cannot use negative numbers as everything is computed modulo n.</p>\n<p>Yes, you can use any array, as long as the value, when converted to a number, is a number smaller than n.</p>\n<p>For this you can use <code>new BigInteger(1, plaintext)</code> which will always result in a positive number. The first parameter is the sign.</p>\n<p>You may need an encoding for specific structures, e.g. with zero bit values for the most significant bits (message-&gt; encode-&gt; convert to number -&gt; Paillier encryption -&gt; encode ciphertext and decode ciphertext -&gt; Paillier decryption -&gt; decode -&gt; message).</p>\n<p>See <a href=\"https://www.rfc-editor.org/rfc/rfc3447#section-4.1\" rel=\"nofollow noreferrer\">I2OSP</a> and OS2IP for an example on how to encode / decode data to numbers.</p>\n"},{"tags":[],"owner":{"account_id":10145406,"reputation":1343,"user_id":7846405,"display_name":"sefiks"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701098131,"creation_date":1701098131,"answer_id":77557996,"question_id":41913097,"body_markdown":"Paillier cryptosystem is defined over modulo n for plaintexts and n^2 for ciphertexts. So, if you even encrypt a negative number, it is going to have a positive equivalent for modulo n. This can be proven in python as:\r\n\r\n```python\r\n# pip install lightphe\r\nfrom lightphe import LightPHE\r\n \r\n# build a cryptosystem\r\ncs = LightPHE(algorithm_name = &#39;Paillier&#39;)\r\nmodulo = cs.cs.plaintext_modulo\r\n \r\n# define plaintexts\r\nm1 = -10\r\n \r\n# calculate ciphertexts\r\nc1 = cs.encrypt(m1)\r\n \r\n# performing homomorphic addition on ciphertexts\r\nassert cs.decrypt(c1) == m1 % modulo\r\n```","title":"Can pailler cryptosystem encrypt and decrypt negative big integers?","body":"<p>Paillier cryptosystem is defined over modulo n for plaintexts and n^2 for ciphertexts. So, if you even encrypt a negative number, it is going to have a positive equivalent for modulo n. This can be proven in python as:</p>\n<pre class=\"lang-py prettyprint-override\"><code># pip install lightphe\nfrom lightphe import LightPHE\n \n# build a cryptosystem\ncs = LightPHE(algorithm_name = 'Paillier')\nmodulo = cs.cs.plaintext_modulo\n \n# define plaintexts\nm1 = -10\n \n# calculate ciphertexts\nc1 = cs.encrypt(m1)\n \n# performing homomorphic addition on ciphertexts\nassert cs.decrypt(c1) == m1 % modulo\n</code></pre>\n"}],"owner":{"account_id":9568676,"reputation":3,"user_id":7107076,"display_name":"LPepe"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":608,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":41915938,"answer_count":2,"score":0,"last_activity_date":1701098131,"creation_date":1485627121,"question_id":41913097,"body_markdown":"I use paillier cryptosystem to encrypt and decrypt random data which at first are in the form of byte arrays and then i transform them to big integers and if the byte array become a negative big integer the decrypted number and the input number are different (basically it doesn&#39;t work with negative big integers). Is there a way to make this work without checking the input if it will become positive or negative ?","title":"Can pailler cryptosystem encrypt and decrypt negative big integers?","body":"<p>I use paillier cryptosystem to encrypt and decrypt random data which at first are in the form of byte arrays and then i transform them to big integers and if the byte array become a negative big integer the decrypted number and the input number are different (basically it doesn't work with negative big integers). Is there a way to make this work without checking the input if it will become positive or negative ?</p>\n"},{"tags":["java"],"comments":[{"owner":{"account_id":2485939,"reputation":19426,"user_id":2164365,"accept_rate":40,"display_name":"Abra"},"score":1,"creation_date":1701060543,"post_id":77554546,"comment_id":136723760,"body_markdown":"Can you use [markdown](https://stackoverflow.com/editing-help) to better format the stack trace?","body":"Can you use <a href=\"https://stackoverflow.com/editing-help\">markdown</a> to better format the stack trace?"}],"owner":{"account_id":26552595,"reputation":1,"user_id":20181674,"display_name":"Marydas Johnson"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":14,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"answer_count":0,"score":-1,"last_activity_date":1701097993,"creation_date":1701059958,"question_id":77554546,"body_markdown":"while converting maven to gradle getting exception error stack\r\n\r\n```JSON\r\nClass&quot;:&quot;o.j.w.Bootstrap&quot;,&quot;Level&quot;:&quot; \r\n\r\nINFO&quot;,&quot;Thread&quot;:&quot;main&quot;,&quot;Message&quot;:&quot;WELD-ENV-000028: Weld initialization s\r\n\r\nkipped - no bean archive found;&quot;,&quot;TimeTaken&quot;:&quot;&quot;}\r\n```\r\n\r\n```\r\nException in thread &quot;main&quot; java.lang.reflect.InvocationTargetException\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        \r\nCaused by: java.lang.RuntimeException: java`your text`.lang.IllegalStateException: Singleton not set for STATIC_INSTANCE =&gt; []\r\n        at io.undertow.servlet.core.DeploymentManagerImpl.deploy(DeploymentManagerImpl.java:257)\r\n        at com.ge.hc.cloud.app.query.Application.main(Application.java:55)\r\n        ... 8 more\r\nCaused by: java.lang.IllegalStateException: Singleton not set for STATIC_INSTANCE =&gt; []\r\n        at org.jboss.weld.bootstrap.api.helpers.RegistrySingletonProvider$RegistrySingleton.get(RegistrySingletonProvider.java:28)\r\n```\r\n \r\nI have tried with bean.xml also but still this error is getting","title":"WELD-ENV-000028: Weld initialization s kipped - no bean archive found;","body":"<p>while converting maven to gradle getting exception error stack</p>\n<pre><code>Class&quot;:&quot;o.j.w.Bootstrap&quot;,&quot;Level&quot;:&quot; \n\nINFO&quot;,&quot;Thread&quot;:&quot;main&quot;,&quot;Message&quot;:&quot;WELD-ENV-000028: Weld initialization s\n\nkipped - no bean archive found;&quot;,&quot;TimeTaken&quot;:&quot;&quot;}\n</code></pre>\n<pre><code>Exception in thread &quot;main&quot; java.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        \nCaused by: java.lang.RuntimeException: java`your text`.lang.IllegalStateException: Singleton not set for STATIC_INSTANCE =&gt; []\n        at io.undertow.servlet.core.DeploymentManagerImpl.deploy(DeploymentManagerImpl.java:257)\n        at com.ge.hc.cloud.app.query.Application.main(Application.java:55)\n        ... 8 more\nCaused by: java.lang.IllegalStateException: Singleton not set for STATIC_INSTANCE =&gt; []\n        at org.jboss.weld.bootstrap.api.helpers.RegistrySingletonProvider$RegistrySingleton.get(RegistrySingletonProvider.java:28)\n</code></pre>\n<p>I have tried with bean.xml also but still this error is getting</p>\n"},{"tags":["java","spring","spring-boot","microservices"],"comments":[{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":1,"creation_date":1701098316,"post_id":77557955,"comment_id":136729627,"body_markdown":"What do you mean rollback? Do you want to rollback the `repository.save` or the result of the `webclient.get` call? The latter isn&#39;t possible, the first should work out-of-the-box.","body":"What do you mean rollback? Do you want to rollback the <code>repository.save</code> or the result of the <code>webclient.get</code> call? The latter isn&#39;t possible, the first should work out-of-the-box."},{"owner":{"account_id":8909811,"reputation":2612,"user_id":6650475,"display_name":"Andrew S"},"score":1,"creation_date":1701098631,"post_id":77557955,"comment_id":136729711,"body_markdown":"@Transactional (and rollback on exception) is only for the current DB connection within the executing microservice, and does not cross HTTP requests.  Distributed transactions are really really hard to get right.  Search on distributed transactions, two phase commit, and eventual consistency.  [Here](https://www.baeldung.com/transactions-across-microservices) is a good jumping off point - it&#39;s a long fall.","body":"@Transactional (and rollback on exception) is only for the current DB connection within the executing microservice, and does not cross HTTP requests.  Distributed transactions are really really hard to get right.  Search on distributed transactions, two phase commit, and eventual consistency.  <a href=\"https://www.baeldung.com/transactions-across-microservices\" rel=\"nofollow noreferrer\">Here</a> is a good jumping off point - it&#39;s a long fall."},{"owner":{"account_id":15103376,"reputation":48,"user_id":10899753,"display_name":"anme98"},"score":0,"creation_date":1701099763,"post_id":77557955,"comment_id":136729999,"body_markdown":"@M.Deinum yes I need to rollback every db task. So the db task behind `webclient.get` should get rollbacked by its own @Transactional annotation and `repository.save` should get rollbacked on the unsuccessful HTTP response.","body":"@M.Deinum yes I need to rollback every db task. So the db task behind <code>webclient.get</code> should get rollbacked by its own @Transactional annotation and <code>repository.save</code> should get rollbacked on the unsuccessful HTTP response."},{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":0,"creation_date":1701157595,"post_id":77557955,"comment_id":136737235,"body_markdown":"As long as the transaction aspect sees the exception it will rollback.","body":"As long as the transaction aspect sees the exception it will rollback."}],"owner":{"account_id":15103376,"reputation":48,"user_id":10899753,"display_name":"anme98"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":41,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"answer_count":0,"score":-1,"last_activity_date":1701097781,"creation_date":1701097781,"question_id":77557955,"body_markdown":"I use several spring boot microservices which also have to execute DB transactions across several services for more complex tasks. Is it possible with the @Transactional annotation to perform rollbacks on unsuccessful HTTP responses? If not, how can I proceed in such cases?\r\n\r\nSo far I have always used the @Transactional annotation to reset the changes in case of internal errors.\r\n\r\nI would think of something like this:\r\n\r\n\r\n```\r\n@Transactional(rollbackFor = Exception.class)\r\npublic Flux&lt;Entity&gt; updateComplexDBTask(Entity entity) throws Exception {\r\n    entity.setX(&quot;X&quot;);\r\n    repository.save(entity)\r\n    try {\r\n         return this.webClient.get()\r\n                .uri(builder.build().toUri())\r\n                .retrieve();\r\n    } catch (Exception e) {\r\n         throw new Exception(e);\r\n    }\r\n}\r\n```\r\n","title":"Can I use the @Transactional Annotation to rollback on unsuccessful http responses?","body":"<p>I use several spring boot microservices which also have to execute DB transactions across several services for more complex tasks. Is it possible with the @Transactional annotation to perform rollbacks on unsuccessful HTTP responses? If not, how can I proceed in such cases?</p>\n<p>So far I have always used the @Transactional annotation to reset the changes in case of internal errors.</p>\n<p>I would think of something like this:</p>\n<pre><code>@Transactional(rollbackFor = Exception.class)\npublic Flux&lt;Entity&gt; updateComplexDBTask(Entity entity) throws Exception {\n    entity.setX(&quot;X&quot;);\n    repository.save(entity)\n    try {\n         return this.webClient.get()\n                .uri(builder.build().toUri())\n                .retrieve();\n    } catch (Exception e) {\n         throw new Exception(e);\n    }\n}\n</code></pre>\n"},{"tags":["java","pdfbox"],"comments":[{"owner":{"account_id":350117,"reputation":8663,"user_id":685806,"accept_rate":44,"display_name":"Pino"},"score":2,"creation_date":1701098581,"post_id":77557951,"comment_id":136729697,"body_markdown":"Does this answer your question? [Replace or remove text from PDF with PDFbox in Java](https://stackoverflow.com/questions/63592078/replace-or-remove-text-from-pdf-with-pdfbox-in-java)","body":"Does this answer your question? <a href=\"https://stackoverflow.com/questions/63592078/replace-or-remove-text-from-pdf-with-pdfbox-in-java\">Replace or remove text from PDF with PDFbox in Java</a>"},{"owner":{"account_id":255529,"reputation":17950,"user_id":535646,"accept_rate":40,"display_name":"Tilman Hausherr"},"score":0,"creation_date":1701099894,"post_id":77557951,"comment_id":136730033,"body_markdown":"There is a RemoveAllText.java example in the source code download. However this removes all. You could look with PDFDebugger at the content stream to see if there is some easy way to identify what you want to remove. Or you&#39;ll have to use a commercial tool like compart docbridge mill.","body":"There is a RemoveAllText.java example in the source code download. However this removes all. You could look with PDFDebugger at the content stream to see if there is some easy way to identify what you want to remove. Or you&#39;ll have to use a commercial tool like compart docbridge mill."},{"owner":{"account_id":1916831,"reputation":91511,"user_id":1729265,"display_name":"mkl"},"score":0,"creation_date":1701118662,"post_id":77557951,"comment_id":136733345,"body_markdown":"What do you actually mean by removing text? In particular do you hope that the remaining text will reflow? Or do you expect it to remain where it is? Also you say &quot;text&quot; - have you made sure that that &quot;text&quot; is drawn using text drawing instructions? Or does it merely have the look of text and actually is drawn as vector or bitmap images?","body":"What do you actually mean by removing text? In particular do you hope that the remaining text will reflow? Or do you expect it to remain where it is? Also you say &quot;text&quot; - have you made sure that that &quot;text&quot; is drawn using text drawing instructions? Or does it merely have the look of text and actually is drawn as vector or bitmap images?"},{"owner":{"account_id":14961660,"reputation":1403,"user_id":10801227,"display_name":"John"},"score":0,"creation_date":1701170843,"post_id":77557951,"comment_id":136739574,"body_markdown":"@mkl Yes, it is a text data. I have seen it in the PDFDebugger (Operations Tj and Td). I want to remove the part of the text, and the text that was left must stay in the same place.","body":"@mkl Yes, it is a text data. I have seen it in the PDFDebugger (Operations Tj and Td). I want to remove the part of the text, and the text that was left must stay in the same place."},{"owner":{"account_id":1916831,"reputation":91511,"user_id":1729265,"display_name":"mkl"},"score":0,"creation_date":1701180468,"post_id":77557951,"comment_id":136741342,"body_markdown":"Have you tried the answer @Pino has linked?","body":"Have you tried the answer @Pino has linked?"}],"owner":{"account_id":14961660,"reputation":1403,"user_id":10801227,"display_name":"John"},"comment_count":5,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":1,"is_answered":false,"view_count":36,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701097757,"creation_date":1701097757,"question_id":77557951,"body_markdown":"I have some PDF files and I have to remove a part of the text, but I can&#39;t find out how can I do this. A ```PDPageContentStream``` does not have any ```get``` or ```remove``` methods. Can anyone give me advice or any ideas? \r\nI must use the ```PDFBOX``` library.","title":"Remove text from a PDF document","body":"<p>I have some PDF files and I have to remove a part of the text, but I can't find out how can I do this. A <code>PDPageContentStream</code> does not have any <code>get</code> or <code>remove</code> methods. Can anyone give me advice or any ideas?\nI must use the <code>PDFBOX</code> library.</p>\n"},{"tags":["java","database","jpa","web","persistence"],"comments":[{"owner":{"account_id":124855,"reputation":19802,"user_id":320220,"accept_rate":85,"display_name":"beerbajay"},"score":4,"creation_date":1338154822,"post_id":10777394,"comment_id":14015260,"body_markdown":"Is the database running on localhost on that server?","body":"Is the database running on localhost on that server?"},{"owner":{"account_id":361403,"reputation":135,"user_id":703980,"display_name":"Kenny Roberts"},"score":0,"creation_date":1338188618,"post_id":10777394,"comment_id":14020190,"body_markdown":"I&#39;m not sure so probably not. What can I do about it?","body":"I&#39;m not sure so probably not. What can I do about it?"},{"owner":{"account_id":124855,"reputation":19802,"user_id":320220,"accept_rate":85,"display_name":"beerbajay"},"score":1,"creation_date":1338190004,"post_id":10777394,"comment_id":14020541,"body_markdown":"Contact the system administrator and have them start it. Or start it yourself if there is no system administrator.","body":"Contact the system administrator and have them start it. Or start it yourself if there is no system administrator."},{"owner":{"account_id":2209650,"reputation":2966,"user_id":1951909,"accept_rate":80,"display_name":"SSC"},"score":0,"creation_date":1412378384,"post_id":10777394,"comment_id":41063161,"body_markdown":"Have a look http://docs.oracle.com/javaee/6/tutorial/doc/bnadi.html","body":"Have a look <a href=\"http://docs.oracle.com/javaee/6/tutorial/doc/bnadi.html\" rel=\"nofollow noreferrer\">docs.oracle.com/javaee/6/tutorial/doc/bnadi.html</a>"}],"answers":[{"tags":[],"owner":{"account_id":308452,"reputation":29915,"user_id":620338,"accept_rate":85,"display_name":"Matt Handy"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1338231566,"creation_date":1338231566,"answer_id":10789285,"question_id":10777394,"body_markdown":"Glassfish comes with Java DB bundled. That&#39;s why it works on your local machine. Your deployment server either has a different database server configuration (check your persistence.xml) or no database server running at that port.","title":"Java web project + JPA/JDBC &quot;Error connecting to server localhost on port 1527 with message Connection refused&quot;","body":"<p>Glassfish comes with Java DB bundled. That's why it works on your local machine. Your deployment server either has a different database server configuration (check your persistence.xml) or no database server running at that port.</p>\n"}],"owner":{"account_id":361403,"reputation":135,"user_id":703980,"display_name":"Kenny Roberts"},"comment_count":4,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":8912,"favorite_count":0,"down_vote_count":0,"up_vote_count":2,"answer_count":1,"score":2,"last_activity_date":1701097465,"creation_date":1338153880,"question_id":10777394,"body_markdown":"I have this old web project which is called &quot;Drinks Archive&quot;. You can, among other things, add, remove, list and edit drinks. It runs fine locally from NetBeans but when I deploy my project as a .war file to a server, which uses Tomcat 6, it gives the following error every time I try to do a database operation (e.g. add drink to db):\r\n\r\n&gt; javax.persistence.PersistenceException: Exception [EclipseLink-4002] (Eclipse Persistence Services - 2.3.0.v20110604-r9504): org.eclipse.persistence.exceptions.DatabaseException\r\nInternal Exception: java.sql.SQLNonTransientConnectionException: java.net.ConnectException : Error connecting to server localhost on port 1527 with message Connection refused.\r\nError Code: 40000\r\n\torg.eclipse.persistence.internal.jpa.EntityManagerSetupImpl.deploy(EntityManagerSetupImpl.java:501)\r\n\torg.eclipse.persistence.internal.jpa.EntityManagerFactoryDelegate.getDatabaseSession(EntityManagerFactoryDelegate.java:188)\r\n\torg.eclipse.persistence.internal.jpa.EntityManagerFactoryDelegate.createEntityManagerImpl(EntityManagerFactoryDelegate.java:277)\r\n\torg.eclipse.persistence.internal.jpa.EntityManagerFactoryImpl.createEntityManagerImpl(EntityManagerFactoryImpl.java:290)\r\n\torg.eclipse.persistence.internal.jpa.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:268)\r\n\tarchive.Register.getEntityManager(Register.java:53)\r\n\tarchive.Register.getDrinks(Register.java:170)\r\n\tservlets.ListServlet.doGet(ListServlet.java:67)\r\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:617)\r\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:717)\r\n\r\nHere&#39;s my source code, (in NetBeans I use GlassFish as a server).\r\n\r\nRegister.java:\r\n\r\n    public class Register {\r\n    \r\n    private static Register instance;\r\n    private EntityManager em;\r\n    \r\n    private EntityManagerFactory emf = null;\r\n\r\n    public static Register getInstance() {\r\n        if (instance == null) {\r\n            instance = new Rekisteri();\r\n        }\r\n        \r\n        return instance;\r\n    }\r\n    \r\n    private Register() {\r\n        try {\r\n            Class.forName(&quot;org.apache.derby.jdbc.ClientDriver&quot;);\r\n        } catch (ClassNotFoundException ex) {\r\n            Logger.getLogger(Rekisteri.class.getName()).log(Level.SEVERE, null, ex);\r\n        }\r\n        emf = Persistence.createEntityManagerFactory(&quot;DrinksArchivePU&quot;);\r\n    }\r\n    \r\n    public EntityManager getEntityManager() {\r\n        return emf.createEntityManager();\r\n    }\r\n    \r\n    public void addDrink(Drink new) {\r\n        em = getEntityManager();\r\n        em.getTransaction().begin();\r\n        em.merge(new);\r\n        em.getTransaction().commit();     \r\n    }\r\n\r\n    etc...//\r\n    }\r\n\r\npersistence.xml:\r\n\r\n    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\r\n    &lt;persistence version=&quot;2.0&quot; xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;&gt;\r\n    &lt;persistence-unit name=&quot;DrinksArchivePU&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;\r\n        &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;\r\n        &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;\r\n        &lt;properties&gt;\r\n            &lt;property name=&quot;eclipselink.jdbc.driver&quot; value=&quot;org.apache.derby.jdbc.ClientDriver&quot;/&gt;\r\n            &lt;property name=&quot;eclipselink.jdbc.user&quot; value=&quot;d&quot;/&gt; \r\n            &lt;property name=&quot;eclipselink.jdbc.password&quot; value=&quot;d&quot;/&gt; \r\n            &lt;property name=&quot;eclipselink.jdbc.url&quot; value=&quot;jdbc:derby://localhost:1527/drinks;create=true&quot;/&gt;\r\n            &lt;property name=&quot;eclipselink.ddl-generation&quot; value=&quot;drop-and-create-tables&quot;/&gt;\r\n            &lt;property name=&quot;eclipselink.ddl-generation.output-mode&quot; value=&quot;database&quot;/&gt;\r\n            &lt;property name=&quot;eclipselink.weaving&quot; value=&quot;false&quot;/&gt;\r\n            &lt;property name=&quot;eclipselink.logging.level&quot; value=&quot;FINE&quot;/&gt;\r\n        &lt;/properties&gt;\r\n    &lt;/persistence-unit&gt;\r\n&lt;/persistence&gt;\r\n\r\nI read that the problem could be because of derby network server not starting on my server but if that&#39;s so, how to fix it?\r\n\r\n**EDIT:** Fixed, I changed to HSQLDB JDBC Driver in my persistence.xml settings and after that it was all about adding different missing jar-files to my project in the server.\r\n\r\nHere&#39;s persistence.xml now:\r\n\r\n    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\r\n    &lt;persistence version=&quot;2.0&quot; xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;  xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence  http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;&gt;\r\n    &lt;persistence-unit name=&quot;DrinksAchivePU&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;\r\n        \r\n        &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;\r\n        \r\n        &lt;class&gt;archive.Ingredient&lt;/class&gt;\r\n        &lt;class&gt;archive.Review&lt;/class&gt;\r\n        &lt;class&gt;archive.Drink&lt;/class&gt;\r\n        &lt;class&gt;archive.DrinkCategory&lt;/class&gt;\r\n        &lt;class&gt;archive.User&lt;/class&gt;\r\n        &lt;class&gt;archive.Register&lt;/class&gt;\r\n    \r\n        &lt;properties&gt;\r\n            &lt;property name=&quot;javax.persistence.jdbc.driver&quot; value=&quot;org.hsqldb.jdbcDriver&quot;/&gt;\r\n            &lt;property name=&quot;javax.persistence.jdbc.url&quot; value=&quot;jdbc:hsqldb:mem:testdb;default_schema=true&quot;/&gt;\r\n            &lt;property name=&quot;javax.persistence.jdbc.user&quot; value=&quot;sa&quot;/&gt;\r\n            &lt;property name=&quot;javax.persistence.jdbc.password&quot; value=&quot;&quot;/&gt;\r\n            &lt;property name=&quot;hibernate.dialect&quot; value=&quot;org.hibernate.dialect.HSQLDialect&quot;/&gt;\r\n            &lt;property name=&quot;hibernate.hbm2ddl.auto&quot; value=&quot;update&quot;/&gt;\r\n        &lt;/properties&gt;\r\n    &lt;/persistence-unit&gt;\r\n&lt;/persistence&gt;\r\n","title":"Java web project + JPA/JDBC &quot;Error connecting to server localhost on port 1527 with message Connection refused&quot;","body":"<p>I have this old web project which is called \"Drinks Archive\". You can, among other things, add, remove, list and edit drinks. It runs fine locally from NetBeans but when I deploy my project as a .war file to a server, which uses Tomcat 6, it gives the following error every time I try to do a database operation (e.g. add drink to db):</p>\n\n<blockquote>\n  <p>javax.persistence.PersistenceException: Exception [EclipseLink-4002] (Eclipse Persistence Services - 2.3.0.v20110604-r9504): org.eclipse.persistence.exceptions.DatabaseException\n  Internal Exception: java.sql.SQLNonTransientConnectionException: java.net.ConnectException : Error connecting to server localhost on port 1527 with message Connection refused.\n  Error Code: 40000\n      org.eclipse.persistence.internal.jpa.EntityManagerSetupImpl.deploy(EntityManagerSetupImpl.java:501)\n      org.eclipse.persistence.internal.jpa.EntityManagerFactoryDelegate.getDatabaseSession(EntityManagerFactoryDelegate.java:188)\n      org.eclipse.persistence.internal.jpa.EntityManagerFactoryDelegate.createEntityManagerImpl(EntityManagerFactoryDelegate.java:277)\n      org.eclipse.persistence.internal.jpa.EntityManagerFactoryImpl.createEntityManagerImpl(EntityManagerFactoryImpl.java:290)\n      org.eclipse.persistence.internal.jpa.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:268)\n      archive.Register.getEntityManager(Register.java:53)\n      archive.Register.getDrinks(Register.java:170)\n      servlets.ListServlet.doGet(ListServlet.java:67)\n      javax.servlet.http.HttpServlet.service(HttpServlet.java:617)\n      javax.servlet.http.HttpServlet.service(HttpServlet.java:717)</p>\n</blockquote>\n\n<p>Here's my source code, (in NetBeans I use GlassFish as a server).</p>\n\n<p>Register.java:</p>\n\n<pre><code>public class Register {\n\nprivate static Register instance;\nprivate EntityManager em;\n\nprivate EntityManagerFactory emf = null;\n\npublic static Register getInstance() {\n    if (instance == null) {\n        instance = new Rekisteri();\n    }\n\n    return instance;\n}\n\nprivate Register() {\n    try {\n        Class.forName(\"org.apache.derby.jdbc.ClientDriver\");\n    } catch (ClassNotFoundException ex) {\n        Logger.getLogger(Rekisteri.class.getName()).log(Level.SEVERE, null, ex);\n    }\n    emf = Persistence.createEntityManagerFactory(\"DrinksArchivePU\");\n}\n\npublic EntityManager getEntityManager() {\n    return emf.createEntityManager();\n}\n\npublic void addDrink(Drink new) {\n    em = getEntityManager();\n    em.getTransaction().begin();\n    em.merge(new);\n    em.getTransaction().commit();     \n}\n\netc...//\n}\n</code></pre>\n\n<p>persistence.xml:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;persistence version=\"2.0\" xmlns=\"http://java.sun.com/xml/ns/persistence\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd\"&gt;\n&lt;persistence-unit name=\"DrinksArchivePU\" transaction-type=\"RESOURCE_LOCAL\"&gt;\n    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;\n    &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;\n    &lt;properties&gt;\n        &lt;property name=\"eclipselink.jdbc.driver\" value=\"org.apache.derby.jdbc.ClientDriver\"/&gt;\n        &lt;property name=\"eclipselink.jdbc.user\" value=\"d\"/&gt; \n        &lt;property name=\"eclipselink.jdbc.password\" value=\"d\"/&gt; \n        &lt;property name=\"eclipselink.jdbc.url\" value=\"jdbc:derby://localhost:1527/drinks;create=true\"/&gt;\n        &lt;property name=\"eclipselink.ddl-generation\" value=\"drop-and-create-tables\"/&gt;\n        &lt;property name=\"eclipselink.ddl-generation.output-mode\" value=\"database\"/&gt;\n        &lt;property name=\"eclipselink.weaving\" value=\"false\"/&gt;\n        &lt;property name=\"eclipselink.logging.level\" value=\"FINE\"/&gt;\n    &lt;/properties&gt;\n&lt;/persistence-unit&gt;\n</code></pre>\n\n<p></p>\n\n<p>I read that the problem could be because of derby network server not starting on my server but if that's so, how to fix it?</p>\n\n<p><strong>EDIT:</strong> Fixed, I changed to HSQLDB JDBC Driver in my persistence.xml settings and after that it was all about adding different missing jar-files to my project in the server.</p>\n\n<p>Here's persistence.xml now:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;persistence version=\"2.0\" xmlns=\"http://java.sun.com/xml/ns/persistence\"  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"  xsi:schemaLocation=\"http://java.sun.com/xml/ns/persistence  http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd\"&gt;\n&lt;persistence-unit name=\"DrinksAchivePU\" transaction-type=\"RESOURCE_LOCAL\"&gt;\n\n    &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;\n\n    &lt;class&gt;archive.Ingredient&lt;/class&gt;\n    &lt;class&gt;archive.Review&lt;/class&gt;\n    &lt;class&gt;archive.Drink&lt;/class&gt;\n    &lt;class&gt;archive.DrinkCategory&lt;/class&gt;\n    &lt;class&gt;archive.User&lt;/class&gt;\n    &lt;class&gt;archive.Register&lt;/class&gt;\n\n    &lt;properties&gt;\n        &lt;property name=\"javax.persistence.jdbc.driver\" value=\"org.hsqldb.jdbcDriver\"/&gt;\n        &lt;property name=\"javax.persistence.jdbc.url\" value=\"jdbc:hsqldb:mem:testdb;default_schema=true\"/&gt;\n        &lt;property name=\"javax.persistence.jdbc.user\" value=\"sa\"/&gt;\n        &lt;property name=\"javax.persistence.jdbc.password\" value=\"\"/&gt;\n        &lt;property name=\"hibernate.dialect\" value=\"org.hibernate.dialect.HSQLDialect\"/&gt;\n        &lt;property name=\"hibernate.hbm2ddl.auto\" value=\"update\"/&gt;\n    &lt;/properties&gt;\n&lt;/persistence-unit&gt;\n</code></pre>\n\n<p></p>\n"},{"tags":["java","unit-testing","mockito","completable-future","powermockito"],"comments":[{"owner":{"account_id":4528798,"reputation":10533,"user_id":3679900,"accept_rate":48,"display_name":"y2k-shubham"},"score":0,"creation_date":1701160951,"post_id":77557045,"comment_id":136737832,"body_markdown":"One suggestion i got was to instead use `ExecutorService` for parallelization so that we can leverage [`MoreExecutors.newDirectExecutorService()`](https://guava.dev/releases/19.0/api/docs/com/google/common/util/concurrent/MoreExecutors.html#newDirectExecutorService()) for unit-tests (which will then run sequentially). While it certainly works, I don&#39;t want to do it because then effectively we run async computation in production while our unit-tests use synchronous computation, so such tests won&#39;t be very confident-inspiring.","body":"One suggestion i got was to instead use <code>ExecutorService</code> for parallelization so that we can leverage <a href=\"https://guava.dev/releases/19.0/api/docs/com/google/common/util/concurrent/MoreExecutors.html#newDirectExecutorService()\" rel=\"nofollow noreferrer\"><code>MoreExecutors.newDirectExecutorService()</code></a> for unit-tests (which will then run sequentially). While it certainly works, I don&#39;t want to do it because then effectively we run async computation in production while our unit-tests use synchronous computation, so such tests won&#39;t be very confident-inspiring."},{"owner":{"account_id":4528798,"reputation":10533,"user_id":3679900,"accept_rate":48,"display_name":"y2k-shubham"},"score":0,"creation_date":1701161050,"post_id":77557045,"comment_id":136737853,"body_markdown":"I also had a similar idea to try to somehow override the behaviour of `CompletableFuture.runAsync(..)` for tests so as to effectively make the underlying computation synchronous","body":"I also had a similar idea to try to somehow override the behaviour of <code>CompletableFuture.runAsync(..)</code> for tests so as to effectively make the underlying computation synchronous"},{"owner":{"account_id":3211603,"reputation":289317,"user_id":2711488,"display_name":"Holger"},"score":2,"creation_date":1701193483,"post_id":77557045,"comment_id":136744108,"body_markdown":"When you use `CompletableFuture.runAsync(…)` without specifying an executor, the [default Fork/Join pool](https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinPool.html#commonPool()) will be used. In that case, your unit test can use [`ForkJoinPool.commonPool().awaitQuiescence(your own timeout)`](https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinPool.html#awaitQuiescence(long,java.util.concurrent.TimeUnit)) to wait for all asynchronous jobs to complete, before checking whether the expected methods have been invoked.","body":"When you use <code>CompletableFuture.runAsync(…)</code> without specifying an executor, the <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinPool.html#commonPool()\" rel=\"nofollow noreferrer\">default Fork/Join pool</a> will be used. In that case, your unit test can use <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinPool.html#awaitQuiescence(long,java.util.concurrent.TimeUnit)\" rel=\"nofollow noreferrer\"><code>ForkJoinPool.commonPool().awaitQuiescence(your own timeout)</code></a> to wait for all asynchronous jobs to complete, before checking whether the expected methods have been invoked."}],"answers":[{"tags":[],"owner":{"account_id":4528798,"reputation":10533,"user_id":3679900,"accept_rate":48,"display_name":"y2k-shubham"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701097330,"creation_date":1701095834,"answer_id":77557713,"question_id":77557045,"body_markdown":"I *think* I might&#39;ve found a fix by using *a non-static method call being made after my static method call* as a &#39;proxy&#39; for hinting that our static method call must&#39;ve also happened\r\n\r\nI was logging an error metric in case my static method call fails as follows\r\n\r\n```\r\nimport java.util.concurrent.CompletableFuture;\r\n\r\nCompletableFuture.runAsync(() -&gt; {\r\n    try {\r\n        MyExternalServiceAccessor.myMethod(param1, param2);\r\n    } catch (final Exception e) {\r\n        // here metricLogger is injected into MyClass from outside so can be mocked for tests\r\n        metricLogger.logCounter(&quot;MyExternalServiceAccessor.myMethod:failure&quot;, 1);\r\n    }\r\n});\r\n```\r\n\r\nNow in above code\r\n - `metricLogger.logCounter(..)` call is a non-static call for which we can leverage mockito&#39;s [verification with timeout][1]\r\n - and since it occurs *after* our static `MyExternalServiceAccessor.myMethod(..)` call so we can be sure that if `logCounter` call has happened then `myMethod` call must&#39;ve also happened\r\n   - *although above statement is true only when we are unit-testing an error scenario where `myMethod` throws an exception*\r\n\r\nTherefore for an error scenario we write our test like this for waiting 100ms  before validating that expected methods invoked\r\n\r\n```\r\nverify(mockMetricLogger, timeout(100).times(1)).logCounter(eq(&quot;MyExternalServiceAccessor.myMethod:failure&quot;), eq(1));\r\nverifyStatic();\r\nMyExternalService.myMethod(eq(arg1), eq(arg2));\r\n```\r\n\r\nAnd for non-error scenario we can use the trick suggested in [this thread][2] to wait-and-verify that our mock was called &#39;zero&#39; times, i.e., not called even after waiting\r\n\r\n```\r\nverify(mockMetricLogger, timeout(100).times(0)).logCounter(eq(&quot;MyExternalServiceAccessor.myMethod:failure&quot;), eq(1));\r\nverifyStatic();\r\nMyExternalService.myMethod(eq(arg1), eq(arg2));\r\n```\r\n\r\nSo far my tests have been passing, but since (a) they were not too flaky to begin with and (b) we&#39;re dealing with notorious async issues that can show up intermittently, I&#39;m not certain if for non-error scenarios the flakiness has been completely eliminated or not.\r\n\r\n*(I can of course completely do away with the flakiness for example by also publishing a counter metric in success scenario and using that as a proxy, but don&#39;t want to do that just yet)*\r\n\r\n##### UPDATE-1\r\n\r\nI also had to test out the scenario where this entire block of async code is never called (due to upstream conditional expressions preventing flow from reaching up till this point where async block is triggered)\r\n\r\nFor that I leveraged `Mockito.never()` as suggested in [this thread][3]\r\n\r\n```\r\nverify(mockMetricLogger, timeout(100).times(0)).logCounter(eq(&quot;MyExternalServiceAccessor.myMethod:failure&quot;), eq(1));\r\nverifyStatic(never());\r\nMyExternalService.myMethod(eq(arg1), eq(arg2));\r\n```\r\n\r\n\r\n  [1]: https://javadoc.io/static/org.mockito/mockito-core/5.7.0/org/mockito/Mockito.html#22\r\n  [2]: https://stackoverflow.com/a/64460897/3679900\r\n  [3]: https://stackoverflow.com/q/50255565/3679900","title":"PowerMockito verifyStatic: validating async call to static method","body":"<p>I <em>think</em> I might've found a fix by using <em>a non-static method call being made after my static method call</em> as a 'proxy' for hinting that our static method call must've also happened</p>\n<p>I was logging an error metric in case my static method call fails as follows</p>\n<pre><code>import java.util.concurrent.CompletableFuture;\n\nCompletableFuture.runAsync(() -&gt; {\n    try {\n        MyExternalServiceAccessor.myMethod(param1, param2);\n    } catch (final Exception e) {\n        // here metricLogger is injected into MyClass from outside so can be mocked for tests\n        metricLogger.logCounter(&quot;MyExternalServiceAccessor.myMethod:failure&quot;, 1);\n    }\n});\n</code></pre>\n<p>Now in above code</p>\n<ul>\n<li><code>metricLogger.logCounter(..)</code> call is a non-static call for which we can leverage mockito's <a href=\"https://javadoc.io/static/org.mockito/mockito-core/5.7.0/org/mockito/Mockito.html#22\" rel=\"nofollow noreferrer\">verification with timeout</a></li>\n<li>and since it occurs <em>after</em> our static <code>MyExternalServiceAccessor.myMethod(..)</code> call so we can be sure that if <code>logCounter</code> call has happened then <code>myMethod</code> call must've also happened\n<ul>\n<li><em>although above statement is true only when we are unit-testing an error scenario where <code>myMethod</code> throws an exception</em></li>\n</ul>\n</li>\n</ul>\n<p>Therefore for an error scenario we write our test like this for waiting 100ms  before validating that expected methods invoked</p>\n<pre><code>verify(mockMetricLogger, timeout(100).times(1)).logCounter(eq(&quot;MyExternalServiceAccessor.myMethod:failure&quot;), eq(1));\nverifyStatic();\nMyExternalService.myMethod(eq(arg1), eq(arg2));\n</code></pre>\n<p>And for non-error scenario we can use the trick suggested in <a href=\"https://stackoverflow.com/a/64460897/3679900\">this thread</a> to wait-and-verify that our mock was called 'zero' times, i.e., not called even after waiting</p>\n<pre><code>verify(mockMetricLogger, timeout(100).times(0)).logCounter(eq(&quot;MyExternalServiceAccessor.myMethod:failure&quot;), eq(1));\nverifyStatic();\nMyExternalService.myMethod(eq(arg1), eq(arg2));\n</code></pre>\n<p>So far my tests have been passing, but since (a) they were not too flaky to begin with and (b) we're dealing with notorious async issues that can show up intermittently, I'm not certain if for non-error scenarios the flakiness has been completely eliminated or not.</p>\n<p><em>(I can of course completely do away with the flakiness for example by also publishing a counter metric in success scenario and using that as a proxy, but don't want to do that just yet)</em></p>\n<h5>UPDATE-1</h5>\n<p>I also had to test out the scenario where this entire block of async code is never called (due to upstream conditional expressions preventing flow from reaching up till this point where async block is triggered)</p>\n<p>For that I leveraged <code>Mockito.never()</code> as suggested in <a href=\"https://stackoverflow.com/q/50255565/3679900\">this thread</a></p>\n<pre><code>verify(mockMetricLogger, timeout(100).times(0)).logCounter(eq(&quot;MyExternalServiceAccessor.myMethod:failure&quot;), eq(1));\nverifyStatic(never());\nMyExternalService.myMethod(eq(arg1), eq(arg2));\n</code></pre>\n"}],"owner":{"account_id":4528798,"reputation":10533,"user_id":3679900,"accept_rate":48,"display_name":"y2k-shubham"},"comment_count":3,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":47,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":1,"score":0,"last_activity_date":1701097330,"creation_date":1701089518,"question_id":77557045,"body_markdown":"I&#39;m making call to an external system via a `static` method\r\n\r\n```\r\nMyExternalServiceAccessor.myMethod(param1, param2);\r\n```\r\n\r\nAnd so far I&#39;ve been [unit-testing above using `PowerMockito`&#39;s `verifyStatic`][1] as follows\r\n\r\n```\r\nimport static org.mockito.Matchers.eq;\r\nimport static org.powermock.api.mockito.PowerMockito.mockStatic;\r\nimport static org.powermock.api.mockito.PowerMockito.verifyStatic;\r\n..\r\n\r\nmockStatic(MyExternalServiceAccessor.class);\r\n\r\n..\r\n\r\nverifyStatic();\r\nMyExternalService.myMethod(eq(arg1), eq(arg2));\r\n```\r\n\r\n---\r\n\r\nI now want to make above call &#39;async&#39; (*best-effort* call with *fire-and-forget* semantics, I don&#39;t care for the response); so taking reference from [here][2] I wrapped it inside `CompletableFuture.runAsync(..)` as follows\r\n\r\n```\r\nimport java.util.concurrent.CompletableFuture;\r\n\r\nCompletableFuture.runAsync(() -&gt; {\r\n    MyExternalServiceAccessor.myMethod(param1, param2);\r\n});\r\n```\r\n\r\nBut with this change as expected the unit-test has become flaky because due to the async invocation of `MyExternalServiceAccessor.myMethod(..)`, sometimes validation fails with following error\r\n\r\n```\r\njava.lang.RuntimeException: Wanted but not invoked com.company.team.service.serviceutils.MyClass.myFunctionBeingUnitTested(\r\n    null,\r\n    null\r\n);\r\nActually, there were zero interactions with this mock.\r\n```\r\n\r\n----\r\n\r\n - I&#39;m aware that `Mockito` supports [*verification with timeout*][3] for *non-`static`* methods; is there a `PowerMockito` (or `Mockito`) equivalent of the same for `static` methods?\r\n - If not then what are the alternatives? Can I cleverly rewrite my code and tests in a way to keep it async while still having unit-tests pass everytime?\r\n\r\n\r\n  [1]: https://import%20static%20org.powermock.api.mockito.PowerMockito.mockStatic;%20import%20static%20org.powermock.api.mockito.PowerMockito.verifyStatic;\r\n  [2]: https://sumantmishra.medium.com/java-asynchronous-process-using-completablefuture-755f08d98106\r\n  [3]: https://javadoc.io/static/org.mockito/mockito-core/5.7.0/org/mockito/Mockito.html#22","title":"PowerMockito verifyStatic: validating async call to static method","body":"<p>I'm making call to an external system via a <code>static</code> method</p>\n<pre><code>MyExternalServiceAccessor.myMethod(param1, param2);\n</code></pre>\n<p>And so far I've been <a href=\"https://import%20static%20org.powermock.api.mockito.PowerMockito.mockStatic;%20import%20static%20org.powermock.api.mockito.PowerMockito.verifyStatic;\" rel=\"nofollow noreferrer\">unit-testing above using <code>PowerMockito</code>'s <code>verifyStatic</code></a> as follows</p>\n<pre><code>import static org.mockito.Matchers.eq;\nimport static org.powermock.api.mockito.PowerMockito.mockStatic;\nimport static org.powermock.api.mockito.PowerMockito.verifyStatic;\n..\n\nmockStatic(MyExternalServiceAccessor.class);\n\n..\n\nverifyStatic();\nMyExternalService.myMethod(eq(arg1), eq(arg2));\n</code></pre>\n<hr />\n<p>I now want to make above call 'async' (<em>best-effort</em> call with <em>fire-and-forget</em> semantics, I don't care for the response); so taking reference from <a href=\"https://sumantmishra.medium.com/java-asynchronous-process-using-completablefuture-755f08d98106\" rel=\"nofollow noreferrer\">here</a> I wrapped it inside <code>CompletableFuture.runAsync(..)</code> as follows</p>\n<pre><code>import java.util.concurrent.CompletableFuture;\n\nCompletableFuture.runAsync(() -&gt; {\n    MyExternalServiceAccessor.myMethod(param1, param2);\n});\n</code></pre>\n<p>But with this change as expected the unit-test has become flaky because due to the async invocation of <code>MyExternalServiceAccessor.myMethod(..)</code>, sometimes validation fails with following error</p>\n<pre><code>java.lang.RuntimeException: Wanted but not invoked com.company.team.service.serviceutils.MyClass.myFunctionBeingUnitTested(\n    null,\n    null\n);\nActually, there were zero interactions with this mock.\n</code></pre>\n<hr />\n<ul>\n<li>I'm aware that <code>Mockito</code> supports <a href=\"https://javadoc.io/static/org.mockito/mockito-core/5.7.0/org/mockito/Mockito.html#22\" rel=\"nofollow noreferrer\"><em>verification with timeout</em></a> for <em>non-<code>static</code></em> methods; is there a <code>PowerMockito</code> (or <code>Mockito</code>) equivalent of the same for <code>static</code> methods?</li>\n<li>If not then what are the alternatives? Can I cleverly rewrite my code and tests in a way to keep it async while still having unit-tests pass everytime?</li>\n</ul>\n"},{"tags":["java","spring","spring-boot","spring-mvc"],"owner":{"account_id":30004893,"reputation":1,"user_id":22994045,"display_name":"freebyte"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":49,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"answer_count":0,"score":0,"last_activity_date":1701096878,"creation_date":1701096849,"question_id":77557834,"body_markdown":"I have a little problem I can&#39;t work around. The idea is to have some generic controllers (and services) like this:\r\n\r\n**GenericPagingController** class that has a method like this: &lt;br&gt;\r\n`public ResponseEntity&lt;Page&lt;T1&gt;&gt; GetEntityPagedList(int page)`\r\n\r\n**GenericListController** class that has a method: &lt;br&gt;\r\n`public ResponseEntity&lt;List&lt;T1&gt;&gt; GetEntityList(int page)`\r\n\r\nand a **GenericCrudController** with methods like this: &lt;br&gt;\r\n`@PostMapping(&quot;&quot;) public ResponseEntity&lt;T1&gt; AddEntity(@RequestBody T3 entityDto)` &lt;br&gt;\r\n`@PutMapping(&quot;/{id}&quot;) public ResponseEntity&lt;T1&gt; UpdateEntity(@PathVariable ID id, @RequestBody T3 entityDto)` &lt;br&gt;\r\n`@DeleteMapping(&quot;/{id}&quot;) public ResponseEntity&lt;String&gt; DeleteEntity(@PathVariable ID id)` &lt;br&gt;\r\n\r\nAnd I want to have a base controller that uses those generic blocks something like this:\r\n\r\n```\r\n@RestController\r\n@RequestMapping(&quot;testing&quot;)\r\npublic class TestingController {\r\n    private GenericPagingController&lt;Test, TestRepository, Long&gt; genericPagingController;\r\n    private GenericCrudController&lt;Test, TestRepository, Long, TestRequestDTO&gt; genericCrudController;\r\n    public TestingController(TestRepository repository) {\r\n        genericPagingService = new GenericPagingService&lt;&gt;(repository);\r\n        genericCrudController = new GenericCrudController&lt;&gt;(repository);\r\n    }\r\n}\r\n```\r\n\r\nIs there a way to achieve this? I don&#39;t want to use interfaces, because I have a plenty of pretty much identical controllers and I think using some composition stuff can work\r\n\r\n\r\nI originally tried to extend multiple generic classes, but obviously Java can&#39;t do that.\r\nI also tried to come up with something with interfaces, but I don&#39;t think it can work well in this case","title":"Spring Rest Controller, but with composition","body":"<p>I have a little problem I can't work around. The idea is to have some generic controllers (and services) like this:</p>\n<p><strong>GenericPagingController</strong> class that has a method like this: <br>\n<code>public ResponseEntity&lt;Page&lt;T1&gt;&gt; GetEntityPagedList(int page)</code></p>\n<p><strong>GenericListController</strong> class that has a method: <br>\n<code>public ResponseEntity&lt;List&lt;T1&gt;&gt; GetEntityList(int page)</code></p>\n<p>and a <strong>GenericCrudController</strong> with methods like this: <br>\n<code>@PostMapping(&quot;&quot;) public ResponseEntity&lt;T1&gt; AddEntity(@RequestBody T3 entityDto)</code> <br>\n<code>@PutMapping(&quot;/{id}&quot;) public ResponseEntity&lt;T1&gt; UpdateEntity(@PathVariable ID id, @RequestBody T3 entityDto)</code> <br>\n<code>@DeleteMapping(&quot;/{id}&quot;) public ResponseEntity&lt;String&gt; DeleteEntity(@PathVariable ID id)</code> <br></p>\n<p>And I want to have a base controller that uses those generic blocks something like this:</p>\n<pre><code>@RestController\n@RequestMapping(&quot;testing&quot;)\npublic class TestingController {\n    private GenericPagingController&lt;Test, TestRepository, Long&gt; genericPagingController;\n    private GenericCrudController&lt;Test, TestRepository, Long, TestRequestDTO&gt; genericCrudController;\n    public TestingController(TestRepository repository) {\n        genericPagingService = new GenericPagingService&lt;&gt;(repository);\n        genericCrudController = new GenericCrudController&lt;&gt;(repository);\n    }\n}\n</code></pre>\n<p>Is there a way to achieve this? I don't want to use interfaces, because I have a plenty of pretty much identical controllers and I think using some composition stuff can work</p>\n<p>I originally tried to extend multiple generic classes, but obviously Java can't do that.\nI also tried to come up with something with interfaces, but I don't think it can work well in this case</p>\n"},{"tags":["java","spring","spring-boot","java-21","virtual-threads"],"comments":[{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":0,"creation_date":1699865936,"post_id":77472556,"comment_id":136580055,"body_markdown":"WIthout seeing your application this will be impossible to answer. I would also suggest to read-up on virtual threads especially on when to use them and when **not** to use them. They are useful in certain cases and in others they are not and will only degrade performance.","body":"WIthout seeing your application this will be impossible to answer. I would also suggest to read-up on virtual threads especially on when to use them and when <b>not</b> to use them. They are useful in certain cases and in others they are not and will only degrade performance."},{"owner":{"account_id":1939636,"reputation":28467,"user_id":1746118,"accept_rate":95,"display_name":"Naman"},"score":0,"creation_date":1699898052,"post_id":77472556,"comment_id":136585989,"body_markdown":"@M.Deinum What specifically at the application are you hinting towards that could be causing this? I thought(reason for asking) the change was pretty generic at the platform itself with the only primary line of code involved being `protocolHandler.setExecutor(Executors.newVirtualThreadPerTaskExecutor());`","body":"@M.Deinum What specifically at the application are you hinting towards that could be causing this? I thought(reason for asking) the change was pretty generic at the platform itself with the only primary line of code involved being <code>protocolHandler.setExecutor(Executors.newVirtualThreadPerTas&zwnj;&#8203;kExecutor());</code>"},{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":0,"creation_date":1699901570,"post_id":77472556,"comment_id":136586499,"body_markdown":"Virtual Threads offer the most benefits when using them for IO bound tasks not for compute bound tasks. Another thing is that, depending on the version of Spring (Boot), you might run into thread pinning issues due to the use of the `syncronized` keyword and use of `ThreadLocal` s . A real effort has been made in Spring Framework 6 and up to change parts of the framework to work better with virtual threads.","body":"Virtual Threads offer the most benefits when using them for IO bound tasks not for compute bound tasks. Another thing is that, depending on the version of Spring (Boot), you might run into thread pinning issues due to the use of the <code>syncronized</code> keyword and use of <code>ThreadLocal</code> s . A real effort has been made in Spring Framework 6 and up to change parts of the framework to work better with virtual threads."},{"owner":{"account_id":1939636,"reputation":28467,"user_id":1746118,"accept_rate":95,"display_name":"Naman"},"score":0,"creation_date":1699952261,"post_id":77472556,"comment_id":136592058,"body_markdown":"@M.Deinum  The version of Spring Boot in use with my application is `3.1.4` which is most likely based on `spring-framework:6.0.12`. Thanks for highlighting though, I do understand that most likely boot [`3.2` would be GA soon](https://spring.io/blog/2023/09/09/all-together-now-spring-boot-3-2-graalvm-native-images-java-21-and-virtual) and would have [`6.1.0` with more work around virtual threads](https://github.com/spring-projects/spring-framework/issues?q=is%3Aissue+virtual+threads+is%3Aclosed). Would wait, try out the upgrade to follow up with my findings.","body":"@M.Deinum  The version of Spring Boot in use with my application is <code>3.1.4</code> which is most likely based on <code>spring-framework:6.0.12</code>. Thanks for highlighting though, I do understand that most likely boot <a href=\"https://spring.io/blog/2023/09/09/all-together-now-spring-boot-3-2-graalvm-native-images-java-21-and-virtual\" rel=\"nofollow noreferrer\"><code>3.2</code> would be GA soon</a> and would have <a href=\"https://github.com/spring-projects/spring-framework/issues?q=is%3Aissue+virtual+threads+is%3Aclosed\" rel=\"nofollow noreferrer\"><code>6.1.0</code> with more work around virtual threads</a>. Would wait, try out the upgrade to follow up with my findings."},{"owner":{"account_id":1939636,"reputation":28467,"user_id":1746118,"accept_rate":95,"display_name":"Naman"},"score":0,"creation_date":1701096257,"post_id":77472556,"comment_id":136729153,"body_markdown":"@M.Deinum Have upgraded to [`spring-boot:3.2`](https://spring.io/blog/2023/11/23/spring-boot-3-2-0-available-now), but the trend of the latencies remain same. Shall I consider that using virtual threads via spring boot is recommended only for certain applications?","body":"@M.Deinum Have upgraded to <a href=\"https://spring.io/blog/2023/11/23/spring-boot-3-2-0-available-now\" rel=\"nofollow noreferrer\"><code>spring-boot:3.2</code></a>, but the trend of the latencies remain same. Shall I consider that using virtual threads via spring boot is recommended only for certain applications?"},{"owner":{"account_id":3192259,"reputation":117609,"user_id":2696260,"display_name":"M. Deinum"},"score":0,"creation_date":1701096565,"post_id":77472556,"comment_id":136729218,"body_markdown":"As mentioned, virtual threads, are only useful in IO situations not for concurrent computations. So if it isn&#39;t for IO don&#39;t use virtual threads as it will probably slow things down instead of speed things up, if it would at all. It isn&#39;t for gained performance but rather for less resource usage (the same with reactive).","body":"As mentioned, virtual threads, are only useful in IO situations not for concurrent computations. So if it isn&#39;t for IO don&#39;t use virtual threads as it will probably slow things down instead of speed things up, if it would at all. It isn&#39;t for gained performance but rather for less resource usage (the same with reactive)."},{"owner":{"account_id":1939636,"reputation":28467,"user_id":1746118,"accept_rate":95,"display_name":"Naman"},"score":0,"creation_date":1701096809,"post_id":77472556,"comment_id":136729276,"body_markdown":"@M.Deinum Got it, makes sense for me to revert to not using them for the current application. Thank you for your responses. I kind of presumed that there would be certain benefits(even small) if the framework is supporting it, but doesn&#39;t seem to be applicable for all.","body":"@M.Deinum Got it, makes sense for me to revert to not using them for the current application. Thank you for your responses. I kind of presumed that there would be certain benefits(even small) if the framework is supporting it, but doesn&#39;t seem to be applicable for all."}],"owner":{"account_id":1939636,"reputation":28467,"user_id":1746118,"accept_rate":95,"display_name":"Naman"},"comment_count":7,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":180,"favorite_count":0,"down_vote_count":1,"up_vote_count":0,"answer_count":0,"score":-1,"last_activity_date":1701096844,"creation_date":1699864004,"question_id":77472556,"body_markdown":"I have recently migrated one of our `spring-boot` applications deployed with `JDK-21` to making use of virtual threads referencing [this document](https://www.baeldung.com/spring-6-virtual-threads).\r\n\r\nThough with this change there is not much of a change in the application&#39;s average latency(~40ms), there is a slight difference in the **99th percentiles** as compared to those in the past. \r\n\r\n***Note*** - The gap between the present and the previous period lines in the image below after the hovered deployment time.\r\n[![enter image description here][1]][1]\r\n\r\n\r\nUpon observing the JVM metrics for this, the only correlation that I could draw was with the variation over an increased **Blocked** and **Waiting** thread count reported by the application.\r\n[![enter image description here][2]][2]\r\n\r\nAn obvious question that I have is whether moving to using virtual threads the way I did is correct or not. Any other factors to consider?\r\n\r\nAdditionally, what could have caused the change in the thread state reported via the metrics? Do note, roughly for a **day** these numbers were not as high, jittery pattern in the image.\r\n\r\n***Info*** - The application makes use of `spring-boot:3.1.4` which is based on `spring-framework:6.0.12`.\r\n\r\n  [1]: https://i.stack.imgur.com/UOwvH.jpg\r\n  [2]: https://i.stack.imgur.com/UQLxv.jpg","title":"Poor performance over Spring Boot application after moving to Virtual Thread","body":"<p>I have recently migrated one of our <code>spring-boot</code> applications deployed with <code>JDK-21</code> to making use of virtual threads referencing <a href=\"https://www.baeldung.com/spring-6-virtual-threads\" rel=\"nofollow noreferrer\">this document</a>.</p>\n<p>Though with this change there is not much of a change in the application's average latency(~40ms), there is a slight difference in the <strong>99th percentiles</strong> as compared to those in the past.</p>\n<p><em><strong>Note</strong></em> - The gap between the present and the previous period lines in the image below after the hovered deployment time.\n<a href=\"https://i.stack.imgur.com/UOwvH.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UOwvH.jpg\" alt=\"enter image description here\" /></a></p>\n<p>Upon observing the JVM metrics for this, the only correlation that I could draw was with the variation over an increased <strong>Blocked</strong> and <strong>Waiting</strong> thread count reported by the application.\n<a href=\"https://i.stack.imgur.com/UQLxv.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UQLxv.jpg\" alt=\"enter image description here\" /></a></p>\n<p>An obvious question that I have is whether moving to using virtual threads the way I did is correct or not. Any other factors to consider?</p>\n<p>Additionally, what could have caused the change in the thread state reported via the metrics? Do note, roughly for a <strong>day</strong> these numbers were not as high, jittery pattern in the image.</p>\n<p><em><strong>Info</strong></em> - The application makes use of <code>spring-boot:3.1.4</code> which is based on <code>spring-framework:6.0.12</code>.</p>\n"},{"tags":["java","testcontainers"],"comments":[{"owner":{"account_id":1670879,"reputation":1569,"user_id":1537370,"accept_rate":79,"display_name":"Damo"},"score":0,"creation_date":1601807876,"post_id":64182352,"comment_id":113515043,"body_markdown":"as a workaround, I can create a throwaway testcontainer and have it create the (damo) network as step 1, then mod docker-compose to join this external (damo) n/w. This of course then allows any further testcontainer join that network","body":"as a workaround, I can create a throwaway testcontainer and have it create the (damo) network as step 1, then mod docker-compose to join this external (damo) n/w. This of course then allows any further testcontainer join that network"},{"owner":{"account_id":57191,"reputation":7863,"user_id":171296,"accept_rate":100,"display_name":"tttppp"},"score":0,"creation_date":1619709877,"post_id":64182352,"comment_id":118993062,"body_markdown":"I was able to work around this problem by exposing the port from the docker-compose and then using `Testcontainers.exposeHostPorts(8200);` and then accessing this from the testcontainer with `http://host.testcontainers.internal:8200`  There are details about this approach here: https://www.testcontainers.org/features/networking/","body":"I was able to work around this problem by exposing the port from the docker-compose and then using <code>Testcontainers.exposeHostPorts(8200);</code> and then accessing this from the testcontainer with <code>http:&#47;&#47;host.testcontainers.internal:8200</code>  There are details about this approach here: <a href=\"https://www.testcontainers.org/features/networking/\" rel=\"nofollow noreferrer\">testcontainers.org/features/networking</a>"},{"owner":{"account_id":15267,"reputation":366,"user_id":3588231,"display_name":"Tim van der Leeuw"},"score":0,"creation_date":1625499477,"post_id":64182352,"comment_id":120637518,"body_markdown":"Why is your new image not referenced in the Compose file that you start, then build the image first next start the Compose file using that image?","body":"Why is your new image not referenced in the Compose file that you start, then build the image first next start the Compose file using that image?"}],"owner":{"account_id":1670879,"reputation":1569,"user_id":1537370,"accept_rate":79,"display_name":"Damo"},"comment_count":3,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":1915,"favorite_count":0,"down_vote_count":0,"up_vote_count":4,"answer_count":0,"score":4,"last_activity_date":1701096357,"creation_date":1601714682,"question_id":64182352,"body_markdown":"I wish to create a network via docker-compose (via DockerComposeContainer) and have another container (created via ImageFromDockerfile) join that same network. Is this possible?\r\n\r\nAsked another way, can ImageFromDockerfile join an existing network?\r\n(For me the order is crucial, because when i start my image it needs to connect to all the services running through compose)\r\n\r\n\r\nThe moving parts I have tried include:\r\n\r\n\r\n1. The docker compose file\r\n```\r\nversion: &#39;3.6&#39;\r\n\r\nservices:\r\n  vault:\r\n    image: docker.x.com/x/vault:123-ytr\r\n    ports:\r\n      - 8200:8200\r\n    networks:\r\n      - gateway\r\n    environment:\r\n      - APP_NAME=requestlogidentityconsumer\r\n\r\nnetworks:\r\n  gateway:\r\n    name: damo\r\n```\r\n\r\n2. Executing above compose file via DockerComposeContainer (incl. create damo network)\r\n\r\n3. Attempt to build and run rlic-container and have it join damo n/w \r\n```\r\n    Network network =\r\n        Network.builder().createNetworkCmdModifier(cmd -&gt; cmd.withName(&quot;damo&quot;)).build();\r\n\r\n    new GenericContainer(\r\n            new ImageFromDockerfile(&quot;rlic-container&quot;, true)\r\n                .withFileFromFile(&quot;Dockerfile&quot;, DOCKER_FILE_PATH.toFile()))\r\n        .withNetwork(network)\r\n        .start();\r\n```\r\n\r\nWhen I run step 3 i get:\r\n\r\n```Caused by: com.github.dockerjava.api.exception.ConflictException: {&quot;message&quot;:&quot;network with name damo already exists&quot;}```\r\n\r\nWhich makes sense (in so far as network does exist from step 2), and ties back to my question of; can i write step 3 such that it joins an existing network?\r\n\r\nThanks\r\n","title":"Can Testcontainers join existing network?","body":"<p>I wish to create a network via docker-compose (via DockerComposeContainer) and have another container (created via ImageFromDockerfile) join that same network. Is this possible?</p>\n<p>Asked another way, can ImageFromDockerfile join an existing network?\n(For me the order is crucial, because when i start my image it needs to connect to all the services running through compose)</p>\n<p>The moving parts I have tried include:</p>\n<ol>\n<li>The docker compose file</li>\n</ol>\n<pre><code>version: '3.6'\n\nservices:\n  vault:\n    image: docker.x.com/x/vault:123-ytr\n    ports:\n      - 8200:8200\n    networks:\n      - gateway\n    environment:\n      - APP_NAME=requestlogidentityconsumer\n\nnetworks:\n  gateway:\n    name: damo\n</code></pre>\n<ol start=\"2\">\n<li><p>Executing above compose file via DockerComposeContainer (incl. create damo network)</p>\n</li>\n<li><p>Attempt to build and run rlic-container and have it join damo n/w</p>\n</li>\n</ol>\n<pre><code>    Network network =\n        Network.builder().createNetworkCmdModifier(cmd -&gt; cmd.withName(&quot;damo&quot;)).build();\n\n    new GenericContainer(\n            new ImageFromDockerfile(&quot;rlic-container&quot;, true)\n                .withFileFromFile(&quot;Dockerfile&quot;, DOCKER_FILE_PATH.toFile()))\n        .withNetwork(network)\n        .start();\n</code></pre>\n<p>When I run step 3 i get:</p>\n<p><code>Caused by: com.github.dockerjava.api.exception.ConflictException: {&quot;message&quot;:&quot;network with name damo already exists&quot;}</code></p>\n<p>Which makes sense (in so far as network does exist from step 2), and ties back to my question of; can i write step 3 such that it joins an existing network?</p>\n<p>Thanks</p>\n"},{"tags":["java","r","rjava"],"answers":[{"comments":[{"owner":{"account_id":4624957,"reputation":405,"user_id":3749036,"display_name":"Jui-Hua Hsieh"},"score":0,"creation_date":1701185208,"post_id":77555939,"comment_id":136742337,"body_markdown":"Thank you for your suggestion.  I tried to change the double to Double using rJava&#39;s functions:  .jcall(curvefit_dbl, returnSig = &quot;S&quot;, method = &quot;performCurveFitting&quot;, \n            .jcast(.jarray(c(0.0001, 0.002, 0.01, 0.5)), &quot;[Ljava/lang/Double;&quot;, check = FALSE, convert.array = TRUE),\n            .jcast(.jarray(c(2,4,6,100)), &quot;[Ljava/lang/Double;&quot;, check = FALSE, convert.array = TRUE), \n            .jnew( &quot;java/lang/Double&quot;, 5), \n            .jnew(&quot;java/lang/Double&quot;, 10))","body":"Thank you for your suggestion.  I tried to change the double to Double using rJava&#39;s functions:  .jcall(curvefit_dbl, returnSig = &quot;S&quot;, method = &quot;performCurveFitting&quot;,              .jcast(.jarray(c(0.0001, 0.002, 0.01, 0.5)), &quot;[Ljava/lang/Double;&quot;, check = FALSE, convert.array = TRUE),             .jcast(.jarray(c(2,4,6,100)), &quot;[Ljava/lang/Double;&quot;, check = FALSE, convert.array = TRUE),              .jnew( &quot;java/lang/Double&quot;, 5),              .jnew(&quot;java/lang/Double&quot;, 10))"},{"owner":{"account_id":4624957,"reputation":405,"user_id":3749036,"display_name":"Jui-Hua Hsieh"},"score":0,"creation_date":1701185394,"post_id":77555939,"comment_id":136742388,"body_markdown":"The signature looks to be correct but JRE crashed.  # Problematic frame:\n# j  gov.nih.ncats.ifx.qhts.curvefitting.service.CurveFittingServiceImpl.toLog10([Ljava/lang/Double;)[D+19  any idea? Thank you!","body":"The signature looks to be correct but JRE crashed.  # Problematic frame: # j  gov.nih.ncats.ifx.qhts.curvefitting.service.CurveFittingServ&zwnj;&#8203;iceImpl.toLog10([Lja&zwnj;&#8203;va/lang/Double;)[D+1&zwnj;&#8203;9  any idea? Thank you!"},{"owner":{"account_id":6814076,"reputation":12697,"user_id":5295429,"display_name":"Oo.oO"},"score":0,"creation_date":1701190728,"post_id":77555939,"comment_id":136743567,"body_markdown":"I am pretty sure it will be easier to force your `Java` code to be compliant with `R`. Note that below the `R` level there is probably some nasty `JNI` stuff.","body":"I am pretty sure it will be easier to force your <code>Java</code> code to be compliant with <code>R</code>. Note that below the <code>R</code> level there is probably some nasty <code>JNI</code> stuff."},{"owner":{"account_id":4624957,"reputation":405,"user_id":3749036,"display_name":"Jui-Hua Hsieh"},"score":1,"creation_date":1701192260,"post_id":77555939,"comment_id":136743905,"body_markdown":"thanks a lot! I modified the java code to accept double as the input and it is working!","body":"thanks a lot! I modified the java code to accept double as the input and it is working!"}],"tags":[],"owner":{"account_id":6814076,"reputation":12697,"user_id":5295429,"display_name":"Oo.oO"},"comment_count":4,"down_vote_count":0,"up_vote_count":1,"is_accepted":true,"score":1,"last_activity_date":1701078655,"creation_date":1701078655,"answer_id":77555939,"question_id":77544492,"body_markdown":"The reason here is that your code looks for a method with `double` and you are defining it with `Double`\r\n\r\n```\r\n&gt; javap -s  Simple\r\nCompiled from &quot;Simple.java&quot;\r\npublic class Simple {\r\n  public Simple();\r\n    descriptor: ()V\r\n\r\n  public static java.lang.String performCurveFitting(java.lang.Double[], java.lang.Double[], java.lang.Double, java.lang.Double);\r\n    descriptor: ([Ljava/lang/Double;[Ljava/lang/Double;Ljava/lang/Double;Ljava/lang/Double;)Ljava/lang/String;\r\n\r\n  public static java.lang.String performCurveFitting2(double[], double[], double, double);\r\n    descriptor: ([D[DDD)Ljava/lang/String;\r\n}\r\n}\r\n```\r\n\r\nTry using `double` instead. Should be visible to your `R` code.\r\n\r\nWith `javap` command you can see the exact signature of your code. As you can see. Your signature is:\r\n\r\n```\r\n[Ljava/lang/Double;[Ljava/lang/Double;Ljava/lang/Double;Ljava/lang/Double;)Ljava/lang/String;\r\n```\r\n\r\nwhile your `R` code is looking for:\r\n\r\n```\r\n[D[DDD)Ljava/lang/String; \r\n```\r\n\r\nMost probably, `R` uses small Java&#39;s `doubles` whenever you are using `R` doubles passed to `Java`.","title":"rJava .jcall java method parameters input issue: with signature ([D[DDD)Ljava/lang/String; not found","body":"<p>The reason here is that your code looks for a method with <code>double</code> and you are defining it with <code>Double</code></p>\n<pre><code>&gt; javap -s  Simple\nCompiled from &quot;Simple.java&quot;\npublic class Simple {\n  public Simple();\n    descriptor: ()V\n\n  public static java.lang.String performCurveFitting(java.lang.Double[], java.lang.Double[], java.lang.Double, java.lang.Double);\n    descriptor: ([Ljava/lang/Double;[Ljava/lang/Double;Ljava/lang/Double;Ljava/lang/Double;)Ljava/lang/String;\n\n  public static java.lang.String performCurveFitting2(double[], double[], double, double);\n    descriptor: ([D[DDD)Ljava/lang/String;\n}\n}\n</code></pre>\n<p>Try using <code>double</code> instead. Should be visible to your <code>R</code> code.</p>\n<p>With <code>javap</code> command you can see the exact signature of your code. As you can see. Your signature is:</p>\n<pre><code>[Ljava/lang/Double;[Ljava/lang/Double;Ljava/lang/Double;Ljava/lang/Double;)Ljava/lang/String;\n</code></pre>\n<p>while your <code>R</code> code is looking for:</p>\n<pre><code>[D[DDD)Ljava/lang/String; \n</code></pre>\n<p>Most probably, <code>R</code> uses small Java's <code>doubles</code> whenever you are using <code>R</code> doubles passed to <code>Java</code>.</p>\n"}],"owner":{"account_id":4624957,"reputation":405,"user_id":3749036,"display_name":"Jui-Hua Hsieh"},"comment_count":0,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":30,"favorite_count":0,"down_vote_count":0,"up_vote_count":0,"accepted_answer_id":77555939,"answer_count":1,"score":0,"last_activity_date":1701095440,"creation_date":1700843067,"question_id":77544492,"body_markdown":"Here is my original java code with method of &quot;performCurveFitting&quot; method\r\n```\r\npublic static String performCurveFitting(Double[] conc, Double[] resp, Double classificationSD, Double minYrange) {\r\n        CurveFittingService fittingService = new CurveFittingServiceImpl();\r\n        FittingResult fittingResult = fittingService.doFit(conc, resp, classificationSD, minYrange);\r\n        \r\n        // Convert the fitting result to a String representation\r\n        return fittingResult.toString(); // Assuming FittingResult has overridden toString() method\r\n    }\r\n```\r\n\r\nIn R code, \r\n\r\nI did the following commands with no errors\r\n\r\n```\r\n.jinit(&#39;.&#39;)\r\n.jaddClassPath(&#39;inst/java/curve-fitting.jar&#39;)\r\ncurvefit &lt;- .jnew(&#39;gov/nih/ncats/ifx/qhts/curvefitting/CurveClassFit&#39;)\r\n.DollarNames(curvefit)\r\n```\r\n\r\nHowever, when I tested the method using the following command\r\n\r\n```\r\n.jcall(curvefit, returnSig = &quot;Ljava/lang/String;&quot;, method = &quot;performCurveFitting&quot;, c(5.5707525685E-10, 4.5123095805E-8, 1.2183235867E-6, 3.2894736842E-5),c(2,4,6,100), 5, 10)\r\n```\r\n\r\nI got this error\r\n&gt; Error in .jcall(curvefit, returnSig = &quot;Ljava/lang/String;&quot;, method = &quot;performCurveFitting&quot;,  : \r\n  method performCurveFitting with signature ([D[DDD)Ljava/lang/String; not found\r\n\r\nHow can I fix this error?\r\n\r\nThank you!\r\n\r\n\r\n","title":"rJava .jcall java method parameters input issue: with signature ([D[DDD)Ljava/lang/String; not found","body":"<p>Here is my original java code with method of &quot;performCurveFitting&quot; method</p>\n<pre><code>public static String performCurveFitting(Double[] conc, Double[] resp, Double classificationSD, Double minYrange) {\n        CurveFittingService fittingService = new CurveFittingServiceImpl();\n        FittingResult fittingResult = fittingService.doFit(conc, resp, classificationSD, minYrange);\n        \n        // Convert the fitting result to a String representation\n        return fittingResult.toString(); // Assuming FittingResult has overridden toString() method\n    }\n</code></pre>\n<p>In R code,</p>\n<p>I did the following commands with no errors</p>\n<pre><code>.jinit('.')\n.jaddClassPath('inst/java/curve-fitting.jar')\ncurvefit &lt;- .jnew('gov/nih/ncats/ifx/qhts/curvefitting/CurveClassFit')\n.DollarNames(curvefit)\n</code></pre>\n<p>However, when I tested the method using the following command</p>\n<pre><code>.jcall(curvefit, returnSig = &quot;Ljava/lang/String;&quot;, method = &quot;performCurveFitting&quot;, c(5.5707525685E-10, 4.5123095805E-8, 1.2183235867E-6, 3.2894736842E-5),c(2,4,6,100), 5, 10)\n</code></pre>\n<p>I got this error</p>\n<blockquote>\n<p>Error in .jcall(curvefit, returnSig = &quot;Ljava/lang/String;&quot;, method = &quot;performCurveFitting&quot;,  :\nmethod performCurveFitting with signature ([D[DDD)Ljava/lang/String; not found</p>\n</blockquote>\n<p>How can I fix this error?</p>\n<p>Thank you!</p>\n"},{"tags":["java","gradle","module","okhttp"],"comments":[{"owner":{"account_id":3618847,"reputation":867,"user_id":17695211,"display_name":"Alexey Veleshko"},"score":0,"creation_date":1701025342,"post_id":77008227,"comment_id":136721074,"body_markdown":"Works for me...","body":"Works for me..."}],"answers":[{"tags":[],"owner":{"account_id":1182555,"reputation":3471,"user_id":1157173,"accept_rate":71,"display_name":"Dorad"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1700775024,"creation_date":1700606662,"answer_id":77526350,"question_id":77008227,"body_markdown":"What worked for me was this version combination:\r\n\r\n* `okio-3.5.0`\r\n* `okio-jvm-3.5.0`\r\n* `okhttp-4.11.0`\r\n* `kotlin-stdlib-1.6.20`","title":"java, okhttp, I get these exception: java.lang.NoClassDefFoundError: okio/Buffer, without module not","body":"<p>What worked for me was this version combination:</p>\n<ul>\n<li><code>okio-3.5.0</code></li>\n<li><code>okio-jvm-3.5.0</code></li>\n<li><code>okhttp-4.11.0</code></li>\n<li><code>kotlin-stdlib-1.6.20</code></li>\n</ul>\n"},{"comments":[{"owner":{"account_id":29327881,"reputation":41,"user_id":22469969,"display_name":"Thomas"},"score":0,"creation_date":1701158510,"post_id":77557654,"comment_id":136737387,"body_markdown":"is module support a true need: yes, i added it to all progs.","body":"is module support a true need: yes, i added it to all progs."},{"owner":{"account_id":29874264,"reputation":478,"user_id":22894892,"display_name":"Laurent Schoelens"},"score":0,"creation_date":1701166043,"post_id":77557654,"comment_id":136738741,"body_markdown":"Since `requires okio;` loads the `okio-jvm` declared module, I&#39;m pretty sure the problem is that the `okio` library doesn&#39;t get his classes loaded since both shared the same `package`. Did you try upgrading to latest version of okhttp / okio / okio-jvm / kotlin-stdlib ?","body":"Since <code>requires okio;</code> loads the <code>okio-jvm</code> declared module, I&#39;m pretty sure the problem is that the <code>okio</code> library doesn&#39;t get his classes loaded since both shared the same <code>package</code>. Did you try upgrading to latest version of okhttp / okio / okio-jvm / kotlin-stdlib ?"}],"tags":[],"owner":{"account_id":29874264,"reputation":478,"user_id":22894892,"display_name":"Laurent Schoelens"},"comment_count":2,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1701095319,"creation_date":1701095319,"answer_id":77557654,"question_id":77008227,"body_markdown":"Not sure it&#39;ll answer your question but found this [issue][1] in okhttp repository discussing that okio and related dependencies does not support Java 9 Platform Module System (aka JPMS).\r\n\r\nAlso see that [other issue][2] which is related to the first one.\r\n\r\nMoreover, when you look at `okio-3.3.0.jar`&#39;s `MANIFEST.MF` file, you&#39;ll find that there&#39;s no `Automatic-Module-Name` directive (which is `Automatic-Module-Name: okio` in `okio-jvm-3.3.0.jar`). Since the `Builder` class is located in the okio&#39;s jar, that would explain why it can&#39;t resolve it with current configuration.\r\n\r\nKnowing that, is module support a *true* need in your project since it works without it ? \r\n\r\n  [1]: https://github.com/square/okhttp/issues/4184\r\n  [2]: https://github.com/square/okhttp/issues/6857","title":"java, okhttp, I get these exception: java.lang.NoClassDefFoundError: okio/Buffer, without module not","body":"<p>Not sure it'll answer your question but found this <a href=\"https://github.com/square/okhttp/issues/4184\" rel=\"nofollow noreferrer\">issue</a> in okhttp repository discussing that okio and related dependencies does not support Java 9 Platform Module System (aka JPMS).</p>\n<p>Also see that <a href=\"https://github.com/square/okhttp/issues/6857\" rel=\"nofollow noreferrer\">other issue</a> which is related to the first one.</p>\n<p>Moreover, when you look at <code>okio-3.3.0.jar</code>'s <code>MANIFEST.MF</code> file, you'll find that there's no <code>Automatic-Module-Name</code> directive (which is <code>Automatic-Module-Name: okio</code> in <code>okio-jvm-3.3.0.jar</code>). Since the <code>Builder</code> class is located in the okio's jar, that would explain why it can't resolve it with current configuration.</p>\n<p>Knowing that, is module support a <em>true</em> need in your project since it works without it ?</p>\n"}],"owner":{"account_id":29327881,"reputation":41,"user_id":22469969,"display_name":"Thomas"},"comment_count":1,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":false,"view_count":427,"favorite_count":0,"down_vote_count":0,"up_vote_count":4,"answer_count":2,"score":4,"last_activity_date":1701095319,"creation_date":1693399957,"question_id":77008227,"body_markdown":"I use java 17 and okhttp-4.9.3. The call is:\r\n\r\n```java\r\nOkHttpClient httpClient = new OkHttpClient.Builder().build();\r\n```\r\n\r\nRunning the program, i get the exception:\r\n\r\n```\r\nException in thread &quot;ReadStationsThread&quot; java.lang.NoClassDefFoundError: okio/Buffer\r\nat okhttp3@4.9.3/okhttp3.ResponseBody$Companion.create(ResponseBody.kt:248)\r\nat okhttp3@4.9.3/okhttp3.ResponseBody$Companion.create$default(ResponseBody.kt:247)\r\nat okhttp3@4.9.3/okhttp3.internal.Util.\\&lt;clinit\\&gt;(Util.kt:65)\r\n```\r\n\r\nThe program can be build without error. I use gradle with these dependencies:\r\n\r\n```\r\nimplementation &#39;:okhttp-4.9.3&#39;\r\nimplementation &#39;:okio-3.3.0&#39;\r\nimplementation &#39;:okio-jvm-3.3.0&#39;\r\nimplementation &#39;:kotlin-stdlib-1.8.21&#39;\r\n```\r\n\r\nin the module-info.java is these:\r\n\r\n```\r\nrequires okhttp3; \r\nrequires okio; \r\nrequires kotlin.stdlib;\r\n```\r\n\r\nrunning the program, calls the exception. When i remove the mdule-info.java file, also running the program without modules, it works without problems. Anny idea what the module-info misses?","title":"java, okhttp, I get these exception: java.lang.NoClassDefFoundError: okio/Buffer, without module not","body":"<p>I use java 17 and okhttp-4.9.3. The call is:</p>\n<pre class=\"lang-java prettyprint-override\"><code>OkHttpClient httpClient = new OkHttpClient.Builder().build();\n</code></pre>\n<p>Running the program, i get the exception:</p>\n<pre><code>Exception in thread &quot;ReadStationsThread&quot; java.lang.NoClassDefFoundError: okio/Buffer\nat okhttp3@4.9.3/okhttp3.ResponseBody$Companion.create(ResponseBody.kt:248)\nat okhttp3@4.9.3/okhttp3.ResponseBody$Companion.create$default(ResponseBody.kt:247)\nat okhttp3@4.9.3/okhttp3.internal.Util.\\&lt;clinit\\&gt;(Util.kt:65)\n</code></pre>\n<p>The program can be build without error. I use gradle with these dependencies:</p>\n<pre><code>implementation ':okhttp-4.9.3'\nimplementation ':okio-3.3.0'\nimplementation ':okio-jvm-3.3.0'\nimplementation ':kotlin-stdlib-1.8.21'\n</code></pre>\n<p>in the module-info.java is these:</p>\n<pre><code>requires okhttp3; \nrequires okio; \nrequires kotlin.stdlib;\n</code></pre>\n<p>running the program, calls the exception. When i remove the mdule-info.java file, also running the program without modules, it works without problems. Anny idea what the module-info misses?</p>\n"},{"tags":["java","file-io"],"comments":[{"owner":{"account_id":2113991,"reputation":12074,"user_id":1878670,"accept_rate":66,"display_name":"Prateek"},"score":0,"creation_date":1356690315,"post_id":14067843,"comment_id":33212516,"body_markdown":"Please look for the question already answered on stackoverflow......... http://stackoverflow.com/questions/5759925/printwriter-vs-filewriter-in-java","body":"Please look for the question already answered on stackoverflow......... <a href=\"http://stackoverflow.com/questions/5759925/printwriter-vs-filewriter-in-java\" title=\"printwriter vs filewriter in java\">stackoverflow.com/questions/5759925/&hellip;</a>"},{"owner":{"account_id":39309,"reputation":4430,"user_id":113305,"accept_rate":94,"display_name":"Manu"},"score":0,"creation_date":1579184491,"post_id":14067843,"comment_id":105686962,"body_markdown":"That question is different than the one asked here.","body":"That question is different than the one asked here."}],"answers":[{"comments":[{"owner":{"account_id":2225566,"reputation":3362,"user_id":1964435,"accept_rate":75,"display_name":"Math"},"score":2,"creation_date":1414690517,"post_id":14067913,"comment_id":41921533,"body_markdown":"This is wrong: `PrintWriter automatically invokes flush after every byte of data is written`. You may create an object with auto flush, but the default is without auto flush. [See here](http://docs.oracle.com/javase/7/docs/api/java/io/PrintWriter.html)","body":"This is wrong: <code>PrintWriter automatically invokes flush after every byte of data is written</code>. You may create an object with auto flush, but the default is without auto flush. <a href=\"http://docs.oracle.com/javase/7/docs/api/java/io/PrintWriter.html\" rel=\"nofollow noreferrer\">See here</a>"},{"owner":{"account_id":181983,"reputation":22075,"user_id":416369,"accept_rate":29,"display_name":"sactiw"},"score":1,"creation_date":1471033639,"post_id":14067913,"comment_id":65208918,"body_markdown":"@Math i think you are confusing PrintWriter class with PrintStream class because in PrintWriter class if automatic flushing is requested at time of object creation then it will be done **only when** one of the println(), printf(), format() methods is invoked and not always.","body":"@Math i think you are confusing PrintWriter class with PrintStream class because in PrintWriter class if automatic flushing is requested at time of object creation then it will be done <b>only when</b> one of the println(), printf(), format() methods is invoked and not always."},{"owner":{"account_id":1835287,"reputation":772,"user_id":1665809,"display_name":"mrod"},"score":1,"creation_date":1524123088,"post_id":14067913,"comment_id":86845932,"body_markdown":"@Math&#39;s point is absolutely right. PrintWriter **can** be instantiated with autoflush, but the default constructor sets it to false (see Javadoc / source code). So the third point of the answer is misleading IMO; it should read &quot;PrintWriter can be instantiated to automatically flush...&quot;.","body":"@Math&#39;s point is absolutely right. PrintWriter <b>can</b> be instantiated with autoflush, but the default constructor sets it to false (see Javadoc / source code). So the third point of the answer is misleading IMO; it should read &quot;PrintWriter can be instantiated to automatically flush...&quot;."},{"owner":{"account_id":2105298,"reputation":16079,"user_id":1871769,"accept_rate":60,"display_name":"Rahul"},"score":0,"creation_date":1524204937,"post_id":14067913,"comment_id":86885764,"body_markdown":"thanks for your inputs. corrected my answer as per your comments.","body":"thanks for your inputs. corrected my answer as per your comments."},{"owner":{"account_id":6099767,"reputation":4936,"user_id":4759176,"accept_rate":74,"display_name":"parsecer"},"score":0,"creation_date":1557528992,"post_id":14067913,"comment_id":98809554,"body_markdown":"You write `which will flush after every byte of data is writte`, but is it true? Isn&#39;t autoflush enacted when `println()` and similar methods are invoked? Then it&#39;s not necessarily a *byte* of data: `pw.println(&quot;Hello&quot;)` would contrain several bytes that would be flushed at once.","body":"You write <code>which will flush after every byte of data is writte</code>, but is it true? Isn&#39;t autoflush enacted when <code>println()</code> and similar methods are invoked? Then it&#39;s not necessarily a <i>byte</i> of data: <code>pw.println(&quot;Hello&quot;)</code> would contrain several bytes that would be flushed at once."},{"owner":{"account_id":39309,"reputation":4430,"user_id":113305,"accept_rate":94,"display_name":"Manu"},"score":0,"creation_date":1579184609,"post_id":14067913,"comment_id":105687032,"body_markdown":"…and what is the difference between PrintWriter(File) and PrintWriter(FileWriter(File)), as in the question’s excerpt?","body":"…and what is the difference between PrintWriter(File) and PrintWriter(FileWriter(File)), as in the question’s excerpt?"}],"tags":[],"owner":{"account_id":2105298,"reputation":16079,"user_id":1871769,"accept_rate":60,"display_name":"Rahul"},"comment_count":6,"down_vote_count":0,"up_vote_count":10,"is_accepted":true,"score":10,"last_activity_date":1524204873,"creation_date":1356689463,"answer_id":14067913,"question_id":14067843,"body_markdown":"Although both of these internally uses a FileOutputStream , the main difference is that PrintWriter offers some additional methods for formatting like println and printf.\r\n\r\ncode snippets:\r\n\r\n    public PrintWriter(File file) throws FileNotFoundException {\r\n         this(new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file))),\r\n         false);\r\n    }\r\n\r\n\r\n    public FileWriter(File file) throws IOException {\r\n           super(new FileOutputStream(file));\r\n    }\r\n\r\n\r\n\r\nMajor Differences : \r\n\r\n 1. FileWriter throws IOException in case of any IO failure.\r\n 2. None of the PrintWriter methods throws IOException, instead they set a boolean flag which can be obtained using checkError().\r\n 3. PrintWriter comes with an option of autoflush while creation(default is without autoflush) which will flush after every byte of data is written. In case of FileWriter, caller has to take care of invoking flush.\r\n\r\n","title":"Difference between PrintWriter and FileWriter class","body":"<p>Although both of these internally uses a FileOutputStream , the main difference is that PrintWriter offers some additional methods for formatting like println and printf.</p>\n\n<p>code snippets:</p>\n\n<pre><code>public PrintWriter(File file) throws FileNotFoundException {\n     this(new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file))),\n     false);\n}\n\n\npublic FileWriter(File file) throws IOException {\n       super(new FileOutputStream(file));\n}\n</code></pre>\n\n<p>Major Differences : </p>\n\n<ol>\n<li>FileWriter throws IOException in case of any IO failure.</li>\n<li>None of the PrintWriter methods throws IOException, instead they set a boolean flag which can be obtained using checkError().</li>\n<li>PrintWriter comes with an option of autoflush while creation(default is without autoflush) which will flush after every byte of data is written. In case of FileWriter, caller has to take care of invoking flush.</li>\n</ol>\n"},{"tags":[],"owner":{"account_id":279975,"reputation":15386,"user_id":575421,"accept_rate":50,"display_name":"Mikita Belahlazau"},"comment_count":0,"down_vote_count":0,"up_vote_count":1,"is_accepted":false,"score":1,"last_activity_date":1356689508,"creation_date":1356689508,"answer_id":14067923,"question_id":14067843,"body_markdown":"`PrintWriter` gives you some handy methods for formatting like `println` and `printf`. So if you need to write printed text - you can use it. `FileWriter` is more like &quot;low-level&quot; writer that gives you ability to write only strings and char arrays. Basically I don&#39;t think there is a big difference what you choose.","title":"Difference between PrintWriter and FileWriter class","body":"<p><code>PrintWriter</code> gives you some handy methods for formatting like <code>println</code> and <code>printf</code>. So if you need to write printed text - you can use it. <code>FileWriter</code> is more like \"low-level\" writer that gives you ability to write only strings and char arrays. Basically I don't think there is a big difference what you choose.</p>\n"},{"comments":[{"owner":{"account_id":13855,"reputation":19472,"user_id":28045,"accept_rate":69,"display_name":"johnny"},"score":1,"creation_date":1560273517,"post_id":14067924,"comment_id":99679356,"body_markdown":"This is the best answer.","body":"This is the best answer."}],"tags":[],"owner":{"account_id":23121,"reputation":527376,"user_id":57695,"accept_rate":75,"display_name":"Peter Lawrey"},"comment_count":1,"down_vote_count":0,"up_vote_count":2,"is_accepted":false,"score":2,"last_activity_date":1356689517,"creation_date":1356689517,"answer_id":14067924,"question_id":14067843,"body_markdown":"From the source what PrintWriter does when you pass a File is to open it in a *buffered* way\r\n\r\n    public PrintWriter(File file) throws FileNotFoundException {\r\n        this(new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file))),\r\n             false);\r\n    }\r\n\r\nif you pass it a FileWriter, it will open it, *without buffering*\r\n\r\n    public FileWriter(File file) throws IOException {\r\n        super(new FileOutputStream(file));\r\n    }\r\n\r\nThis means that the first example can be slightly more efficient.  However I would use the `File` without the `FileWriter` because to me it is simpler.\r\n\r\n\r\n","title":"Difference between PrintWriter and FileWriter class","body":"<p>From the source what PrintWriter does when you pass a File is to open it in a <em>buffered</em> way</p>\n\n<pre><code>public PrintWriter(File file) throws FileNotFoundException {\n    this(new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file))),\n         false);\n}\n</code></pre>\n\n<p>if you pass it a FileWriter, it will open it, <em>without buffering</em></p>\n\n<pre><code>public FileWriter(File file) throws IOException {\n    super(new FileOutputStream(file));\n}\n</code></pre>\n\n<p>This means that the first example can be slightly more efficient.  However I would use the <code>File</code> without the <code>FileWriter</code> because to me it is simpler.</p>\n"},{"tags":[],"owner":{"account_id":2052678,"reputation":134073,"user_id":1831293,"accept_rate":91,"display_name":"Evgeniy Dorofeev"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1356689826,"creation_date":1356689826,"answer_id":14067982,"question_id":14067843,"body_markdown":"While FileWriter has only a basic set of methods, PrintWriter has a rich set of convinience methods, one of them is in your example - `PrintWriter.println`. \r\n\r\nYou should also keep in mind that &quot;methods in this class never throw I/O exceptions, although some of its constructors may. The client may inquire as to whether any errors have occurred by invoking checkError()&quot;\r\n\r\n","title":"Difference between PrintWriter and FileWriter class","body":"<p>While FileWriter has only a basic set of methods, PrintWriter has a rich set of convinience methods, one of them is in your example - <code>PrintWriter.println</code>. </p>\n\n<p>You should also keep in mind that \"methods in this class never throw I/O exceptions, although some of its constructors may. The client may inquire as to whether any errors have occurred by invoking checkError()\"</p>\n"},{"tags":[],"owner":{"account_id":21408140,"reputation":1,"user_id":15768956,"display_name":"Tpk Valentino"},"comment_count":0,"down_vote_count":0,"up_vote_count":0,"is_accepted":false,"score":0,"last_activity_date":1621177510,"creation_date":1621177510,"answer_id":67558227,"question_id":14067843,"body_markdown":"One of the most important differences between the two, is that with FileWriter you can append text to the end of an existing file, whereas with PrintWriter you cannot.","title":"Difference between PrintWriter and FileWriter class","body":"<p>One of the most important differences between the two, is that with FileWriter you can append text to the end of an existing file, whereas with PrintWriter you cannot.</p>\n"}],"owner":{"account_id":1506691,"reputation":1445,"user_id":1409913,"accept_rate":27,"display_name":"nakul"},"comment_count":2,"delete_vote_count":0,"reopen_vote_count":0,"close_vote_count":0,"is_answered":true,"view_count":33323,"favorite_count":0,"down_vote_count":0,"up_vote_count":11,"accepted_answer_id":14067913,"answer_count":5,"score":11,"last_activity_date":1701094573,"creation_date":1356689170,"question_id":14067843,"body_markdown":"    try{\r\n\r\n        File file = new File(&quot;write.txt&quot;);\r\n        FileWriter writer = new FileWriter(file);\r\n\t\t\t\r\n        PrintWriter printWriter = new PrintWriter(writer);\r\n        printWriter.println(&quot;pqr&quot;);\r\n        printWriter.println(&quot;jkl&quot;);\r\n        printWriter.close();\r\n\t\t\t\r\n        PrintWriter printWriter = new PrintWriter(file);\r\n        printWriter.println(&quot;abc&quot;);\r\n        printWriter.println(&quot;xyz&quot;);\r\n        printWriter.close();\r\n    }\r\n\r\nI don&#39;t understand what is difference bet&#39;n these two way.\r\nIn which scenario i should use printWriter and fileWriter.","title":"Difference between PrintWriter and FileWriter class","body":"<pre><code>try{\n\n    File file = new File(\"write.txt\");\n    FileWriter writer = new FileWriter(file);\n\n    PrintWriter printWriter = new PrintWriter(writer);\n    printWriter.println(\"pqr\");\n    printWriter.println(\"jkl\");\n    printWriter.close();\n\n    PrintWriter printWriter = new PrintWriter(file);\n    printWriter.println(\"abc\");\n    printWriter.println(\"xyz\");\n    printWriter.close();\n}\n</code></pre>\n\n<p>I don't understand what is difference bet'n these two way.\nIn which scenario i should use printWriter and fileWriter.</p>\n"}],"has_more":true,"quota_max":10000,"quota_remaining":9883,"page":34,"page_size":100}
